<!DOCTYPE HTML>
<!--suppress HtmlFormInputWithoutLabel -->
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Tiger Admin</title>
  <script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}"></script>
  <script th:src="@{/webjars/jquery-ui/1.13.0/jquery-ui.min.js}"></script>
  <link th:href="@{/webjars/font-awesome/5.15.4/css/all.css}" rel="stylesheet">
  <link th:href="@{/webjars/bootstrap/5.1.1/css/bootstrap.min.css}" rel="stylesheet">
  <link th:href="@{/css/custom-sandstone.css}" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.css">
  <link th:href="@{/css/styles.css}" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.ui.position.js"></script>

</head>
<body>
<div class="container-fluid">
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-gradient-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#"><img class="tiger-logo" alt="Tiger logo" src="/img/tiger2-plain.svg"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor02"
              aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true"
               aria-expanded="false">Testenvironment</a>
            <div class="dropdown-menu">
              <a class="dropdown-item btn-new-testenv" href="#">New</a>
              <a class="dropdown-item btn-open-testenv" href="#">Open...</a>
              <a class="dropdown-item btn-save-testenv disabled" href="#">Save</a>
              <a class="dropdown-item btn-save-as-testenv disabled" href="#">Save as...</a>
              <!--
              <div class="dropdown-divider"></div>
              <a class="dropdown-item disabled" href="#">Separated link</a>
              -->
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/gematik/app-Tiger" target="github">About Tiger</a>
          </li>
        </ul>
        <!--
        <form class="d-flex">
          <input class="form-control me-sm-2" type="text" placeholder="Search">
          <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
        </form>
        -->
      </div>
    </div>
  </nav>
  <div class="row top-margin">
    <div class="col-sm-3 col-md-3 sidebar-col">
      <div class="testenv-sidebar-header hidden">
        <div class="row bg-primary text-white box-config-file server-label">
          <div class="col">
            <strong class="cfg-file-label">Unsaved test environment</strong>
          </div>
        </div>
        <div class="row">
          <div class="sidebar-toolbar border-primary btn-group-horizontal btn-group" role="group">
            <button type="button" class="btn text-success btn-add-server" title="Add server">
              <i class="fas fa-plus-circle fa-lg"></i>
              <span>Add</span>
            </button>
            <button type="button" class="hidden btn text-success btn-save-testenv" title="Save test environment">
              <i class="fas fa-save fa-lg"></i>
              <span>Save</span>
            </button>
          </div>
        </div>
        <div id="sidebar_server_local_proxy" class="box sidebar-local-proxy row mt-3">
          <div class="col-11 offset-1">
            <i title="local tiger proxy" class="server-icon fas fa-project-diagram">
            </i>
            <span class="server-label">Local Tiger proxy</span>
          </div>
        </div>
      </div>
      <div class="container sidebar server-container">
      </div>
    </div>
    <div class="col-sm-9 col-md-9 offset-3">
      <div class="server-content server-container centered">
      </div>
    </div>
  </div>
</div>

<section id="html-templates" class="d-none">

  <div class="card welcome-card d-none" id="template-welcome-card">
    <div class="card-body">
      <section class="highlight-clean">
        <div class="container">
          <div class="intro">
            <img alt="Tiger logo" class="float-end mb-4 ml-4 p-1 border border-primary rounded"
                 src="/img/tiger2-plain.svg" width="160">
            <h2 class="text-center mb-3">Tiger Administration GUI</h2>
            <p class="text-justify">
              Tiger is an agile test platform developed by a Team at gematik GmbH.</p>
            <p>Our main values/goals for Tiger are</p>
            <ul>
              <li>Perform automated IOP tests more efficiently</li>
              <li>Set up test environments more efficiently</li>
              <li>Perform analysis of test failures more efficiently</li>
              <li>Reuse cases/steps from existing test suites</li>
            </ul>
            <p>This site allows you to specify / compose a new test environment based upon
            </p>
            <ul>
              <li>docker images or</li>
              <li>compose scripts,</li>
              <li>external Jar files or even</li>
              <li>server nodes being accessible via an external URL.</li>
            </ul>
            <p class="text-justify">
              To learn more about the different types of nodes Tiger supports please checkout
              <a href="https://build.top.local/source/git/Testtools/tiger/-/blob/master/doc/testenv-config-types.md"
                 target="tiger_gitlab">
                this help document
              </a>,
              before using this UI.
            </p>
            <p class="text-justify">
              To ease your job we have also prepared some default nodes (AKA templates) that are (re)used throughout the
              company.
              Whether it is a local E-Rezept reference FD or the RISE IDP server in the RU/TU...
              All of these templates can easily be added to your test environment with a few clicks.
            </p>
            <p class="text-justify">
              So either start right away by adding a server to your empty test environment or browse through
              and modify existing YAML test environment configuration files.
            </p>
          </div>
          <div class="buttons text-center" style="clear: both;">
            <button class="btn btn-outline-success btn-lg btn-add-server" type="button">Add a server ...</button>
            <button class="btn btn-outline-primary btn-lg btn-open-testenv" type="button">Open Test environment file
              ...
            </button>
          </div>
        </div>
      </section>
    </div>
  </div>


  <div class="row flex-fill server-formular d-none" id="template-server-formular">
    <!-- left column with heading and general settings/source -->
    <div class="col-5 flex-fill topcol">
      <h1 class="text-break text-white bg-primary border-primary shadow"
          style="padding: 1rem;border-radius: 0 0 1rem 0;">
        <i class="server-icon"></i>
        <span class="server-key"></span>
        <i class="server-formular-collapse-icon fas fa-angle-down"></i>
        <i class="fas fa-toolbox btn-advanced global"></i>
      </h1>
      <fieldset section="node-settings"
                summarypattern="<b>${hostname}</b>&amp;nbsp;(${type}, ${template}, ${startupTimeoutSec} sec)">
        <legend>
          Node settings
          <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
          <span class="fieldset-summary fs-6"></span>
          <i class="fas fa-toolbox btn-advanced"></i>
        </legend>
        <!-- not shown as both values are dealt with in the heading -->
        <div class="hidden">
          <input name="type">
          <input name="key">
        </div>

        <div class="input-group">
          <span class="input-group-text">Hostname</span>
          <input class="form-control" type="text" name="hostname"
                 title="Hostname under which this server node is presented to the test suite. If empty defaults to the server key.">
        </div>
        <div class="input-group">
          <span class="input-group-text">Template</span>
          <input class="form-control disabled" disabled readonly type="text" name="template"
                 title="The template this node is based upon.">
          <button title="Reset node to initial template values" class="btn btn-reset-template btn-outline-warning hidden"
                  type="button">
            <i class="fas fa-redo-alt"></i>
          </button>
        </div>
        <div class="input-group advanced">
          <span class="flex-fill input-group-text">Startup Timeout (sec)</span>
          <input class="form-control" type="number" name="startupTimeoutSec"
                 title="Number of seconds to wait till healthcheck reports this server as started successfully">
        </div>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" name="active" checked>
          <label class="form-check-label">Instantiate this node on test run</label>
        </div>
      </fieldset>
      <fieldset class="editableList" section="source" summarypattern="${source}:${version}">
        <legend>
          Source
          <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
          <span class="fieldset-summary fs-6"></span>
        </legend>
        <div class="row">
          <div class="col align-items-stretch">
            <ul class="list-group" name="source"></ul>
          </div>
          <div class="col-auto col-list-btns">
          </div>
        </div>
        <div class="input-group" style="margin-top: 1rem;">
          <span class="input-group-text">Version</span>
          <input class="form-control" type="text" name="version"
                 title="Version of the docker image or tiger proxy to be downloaded and instantiated">
        </div>
      </fieldset>
      <div class="local_proxy_info hidden">
        <p>
          The local tiger proxy is instantiated automatically on startup of your test suite given you have included the
          Tiger BDD hooks.
          The Java proxy system properties
          <inlinepre>http(s).proxyHost</inlinepre>
          and
          <inlinepre>http(s).proxyPort</inlinepre>
          are adjusted
          and Restassured and Unirest calls will also be routed via the local proxy.
        </p>
        <p>
          If you have those system properties already set, Tiger will not overwriten them!
        </p>
        <p>
          Please note that all nodes will be available to your test suite via their configured hostname.
          You don't need to configure them here.
        </p>
        <p>Advanced settings are hidden per default and can be revealed by clicking on the toolbox icon
          <i class="fas fa-toolbox btn-advanced" title="Show advanced settings" style="font-size:100%;float:none;"></i>
        </p>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" name="localProxyActive" checked>
          <label class="form-check-label">Activate local Tiger proxy on startup</label>
        </div>
      </div>
    </div>
    <!-- right column with tabs -->
    <div class="col-7 flex-fill align-self-stretch order-last topcol tabbedpanel">
      <div>
        <!-- tab top links -->
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item" role="presentation" tab="dockerOptions"
              title="All settings related to your docker container or composition">
            <a class="nav-link" role="tab" data-bs-toggle="tab">Docker</a>
          </li>
          <li class="nav-item" role="presentation" tab="externalJarOptions"
              title="All settings for how to start the external Jar archive">
            <a class="nav-link" role="tab" data-bs-toggle="tab">External</a>
          </li>
          <li class="nav-item" role="presentation" tab="tigerProxy"
              title="All settings specific to the tiger proxy setup">
            <a class="nav-link active" role="tab" data-bs-toggle="tab">TigerProxy</a>
          </li>
          <li class="nav-item" role="presentation" tab="pkiKeys"
              title="All Keys and Certififcates you want to configure for the local Tiger proxy">
            <a class="nav-link" role="tab" data-bs-toggle="tab">PKI</a>
          </li>
          <li class="nav-item" role="presentation" tab="environment"
              title="Environment variables you want to provide to the node and System properties you want to export from this node">
            <a class="nav-link" role="tab" data-bs-toggle="tab">Environment</a>
          </li>
          <li class="nav-item" role="presentation" tab="urlMappings"
              title="Additional routings you want to add to the local tiger proxy specifically for this node">
            <a class="nav-link" role="tab" data-bs-toggle="tab">URL Mappings</a>
          </li>
        </ul>
        <div class="tab-content">
          <!-- DOCKER PANEL --->
          <div class="tab-pane fade dockerOptions" role="tabpanel">
            <fieldset section=".dockerOptions.dockerSettings"
                      summarypattern="${.dockerOptions.entryPoint}<br/>Proxied ${.dockerOptions.proxied}<br/>Oneshot ${.dockerOptions.oneShot}">
              <legend>
                Docker settings<i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                <span class="fieldset-summary fs-6"></span><i class="fas fa-toolbox btn-advanced"></i>
              </legend>
              <div class="input-group advanced" style="margin-bottom: 2rem;">
                <span class="input-group-text">Entry Point cmd</span>
                <input class="form-control" type="text" name=".dockerOptions.entryPoint"
                       title="Overwrite the entry point cmd for this docker image.">
              </div>
              <div class="form-check form-switch" style="clear:both;">
                <input class="form-check-input" type="checkbox" name=".dockerOptions.proxied">
                <label class="form-check-label">Proxied container (add Tigerproxy certs to container OS)</label>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name=".dockerOptions.oneShot">
                <label class="form-check-label">Apply One shot health check strategy</label></div>
            </fieldset>
            <fieldset class="editableList" section=".dockerOptions.serviceHealthchecks"
                      summarypattern="${.dockerOptions.serviceHealthchecks}">
              <legend>Service Healthchecks<i class="collapse-icon fas fa-angle-down"></i>&nbsp;<span
                  class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  URLs to be used to check for successfully started services
                </div>
              </div>

              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name=".dockerOptions.serviceHealthchecks"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
            </fieldset>
          </div>
          <!-- EXTERNAL JAR PANEL -->
          <div class="tab-pane fade externalJarOptions" role="tabpanel" id="tab-11" section=".externalJarOptions">
            <fieldset class="labels-col-2"
                      summarypattern="${.externalJarOptions.workingDir}  -  ${.externalJarOptions.healthcheck}"
                      section=".externalJarOptions.externalSettings">
              <legend>External Settings<i class="collapse-icon fas fa-angle-down"></i>&nbsp;<span
                  class="fieldset-summary fs-6"></span></legend>
              <div class="input-group">
                <span class="input-group-text">Working directory</span>
                <input class="form-control" type="text" name=".externalJarOptions.workingDir"
                       title="Folder from which to start the node's Jar archive. Resorts to temp folder if empty">
                <!--
                <button class="btn btn-secondary" type="button">Browse...</button>
                -->
              </div>
              <div class="input-group">
                <span class="input-group-text">Health check URL</span>
                <input class="form-control" type="url" name=".externalJarOptions.healthcheck"
                       title="URL to be used to check for successfully started node">
              </div>
            </fieldset>
            <fieldset class="editableList start-collapsed" section=".externalJarOptions.options"
                      summarypattern="${.externalJarOptions.options}">
              <legend>Options<i class="collapse-icon fas fa-angle-down"></i>&nbsp;<span
                  class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  Options for the Java virtual machine starting the Jar executable
                </div>
              </div>
              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name=".externalJarOptions.options"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
            </fieldset>
            <fieldset class="editableList start-collapsed" section=".externalJarOptions.arguments"
                      summarypattern="${.externalJarOptions.arguments}">
              <legend>Arguments<i class="collapse-icon fas fa-angle-down"></i>&nbsp;<span
                  class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  Arguments / Parameters for the Jar executable
                </div>
              </div>

              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name=".externalJarOptions.arguments"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
            </fieldset>
          </div>
          <!-- TIGER PROXY PANEL -->
          <div class="tab-pane fade tigerProxy" role="tabpanel" id="tab-12">
            <div class="proxyCfg">
              <fieldset class="labels-col-4" section=".tigerProxyCfg"
                        summarypattern="Proxied ${.tigerProxyCfg.proxiedServer} @ ${.tigerProxyCfg.proxyProtocol}://localhost:${.tigerProxyCfg.proxyPort}<br/>WebUI http://localhost:${.tigerProxyCfg.serverPort}/webui<br/>Loglevel ${.tigerProxyCfg.proxyCfg.proxyLogLevel}<br/>Rbel Endpoint ${.tigerProxyCfg.proxyCfg.activateRbelEndpoint}, ASN1 parsing ${.tigerProxyCfg.proxyCfg.activateAsn1Parsing},<br/>Log traffic even without routes ${.tigerProxyCfg.proxyCfg.activateForwardAllLogging}, Parse Rbel ${.tigerProxyCfg.proxyCfg.disableRbelParsing}">
                <legend>Tiger Proxy settings&nbsp;<i class="collapse-icon fas fa-angle-down"></i>&nbsp;<span
                    class="fieldset-summary fs-6"></span><i class="fas fa-toolbox btn-advanced"></i></legend>
                <div class="row">
                  <div class="col-md-6">
                    <div class="input-group">
                      <span class="input-group-text">Proxy Port</span>
                      <input class="form-control" type="number" name=".tigerProxyCfg.proxyPort"
                             title="Port on which the Tiger proxy is listening">
                    </div>
                    <div class="input-group advanced">
                      <span class="input-group-text">Proxy Protocol</span>
                      <select class="form-select" name=".tigerProxyCfg.proxyProtocol"
                              title="Which protocol the proxy is using. Normally HTTP is fine.">
                        <option value="http">HTTP</option>
                        <option value="https">HTTPS</option>
                      </select>
                    </div>
                    <div class="input-group advanced">
                      <span class="input-group-text">Log level</span>
                      <select class="form-select" name=".tigerProxyCfg.proxyCfg.proxyLogLevel"
                              title="Log level of the proxy. WARN is fint, TRACE produces a LOT of logs.">
                        <option value="WARN" selected="">WARN</option>
                        <option value="INFO">INFO</option>
                        <option value="TRACE">TRACE</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="input-group">
                      <span class="input-group-text">Proxied Server</span>
                      <select class="form-select" name=".tigerProxyCfg.proxiedServer"
                              title="Choose another node that will be reverse proxied by this tiger proxy.">
                      </select>
                    </div>
                    <div class="input-group advanced">
                      <span class="input-group-text">Server Port</span>
                      <input class="form-control" type="number" name=".tigerProxyCfg.serverPort"
                             title="Port the web ui and traffic endpoint is running on.">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-check form-switch advanced">
                      <input class="form-check-input" type="checkbox"
                             name=".tigerProxyCfg.proxyCfg.disableRbelParsing">
                      <label class="form-check-label">Parse Traffic via RbelLogger</label></div>
                    <div class="form-check form-switch advanced">
                      <input class="form-check-input" type="checkbox"
                             name=".tigerProxyCfg.proxyCfg.activateRbelEndpoint">
                      <label class="form-check-label">Activate RbelLogger user interface</label>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-check form-switch advanced">
                      <input class="form-check-input" type="checkbox"
                             name=".tigerProxyCfg.proxyCfg.activateForwardAllLogging">
                      <label class="form-check-label">Log traffic even without routes</label></div>
                    <div class="form-check form-switch advanced">
                      <input class="form-check-input" type="checkbox"
                             name=".tigerProxyCfg.proxyCfg.activateAsn1Parsing">
                      <label class="form-check-label">Parse ASN1 structures</label></div>
                  </div>
                </div>
              </fieldset>
              <fieldset class="complex-list" section=".tigerProxyCfg.proxyCfg.proxyRoutes"
                        summarypattern="${.tigerProxyCfg.proxyCfg.proxyRoutes}">
                <legend>
                  Routes
                  <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                  <span class="fieldset-summary fs-6"></span>
                  <i class="fas fa-toolbox btn-advanced"></i>
                </legend>
                <div class="row mb-3">
                  <div class="col form-text">
                    Configure any additional routes of this Tiger proxy.<br/>
                    From is the received scheme://host:port,<br/>
                    To is the rerouted target URL scheme://host:port
                  </div>
                </div>
                <div class="row">
                  <div class="col align-items-stretch">
                    <ul class="list-group" name=".tigerProxyCfg.proxyCfg.proxyRoutes"
                        summarypattern="${id}: [${basicAuth.username} ${basicAuth.password}] ${from} &#8611; ${to}"></ul>
                  </div>
                  <div class="col-auto col-list-btns">
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <fieldset class="subset subset-below">
                      <div class="row">
                        <div class="col">
                          <div class="input-group input-group">
                            <span class="input-group-text">Id</span>
                            <input class="form-control" type="text" name=".tigerProxyCfg.proxyCfg.proxyRoutes.id"
                                   title="Unique id of this routing.">
                          </div>
                          <div class="input-group input-group">
                            <span class="input-group-text">From</span>
                            <input class="form-control" type="text" name=".tigerProxyCfg.proxyCfg.proxyRoutes.from"
                                   title="scheme://host:port the client wants to reach. Using '/' means catch all (reverse proxy).">
                          </div>
                          <div class="input-group input-group">
                            <span class="input-group-text">To</span>
                            <input class="form-control" type="text" name=".tigerProxyCfg.proxyCfg.proxyRoutes.to"
                                   title="scheme://host:port the server will redirect the client request to.">
                          </div>
                        </div>
                        <div class="col-6"><label class="form-label">Authentication</label>
                          <div class="input-group input-group">
                            <span class="input-group-text">Username</span>
                            <input class="form-control" type="text"
                                   name=".tigerProxyCfg.proxyCfg.proxyRoutes.basicAuth.username"
                                   title="User name for basic authentication credentials for this route. Leave empty if no authenticationis required.">
                          </div>
                          <div class="input-group input-group">
                            <span class="input-group-text">Password</span>
                            <input class="form-control" type="text"
                                   name=".tigerProxyCfg.proxyCfg.proxyRoutes.basicAuth.password"
                                   title="Password for basic authentication credentials for this route.">
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <div class="form-check form-switch advanced">
                              <input class="form-check-input" type="checkbox"
                                     name=".tigerProxyCfg.proxyCfg.proxyRoutes.internalRoute">
                              <label class="form-check-label">Internal route</label>
                            </div>
                          </div>
                          <div class="col">
                            <div class="form-check form-switch advanced">
                              <input class="form-check-input" type="checkbox"
                                     name=".tigerProxyCfg.proxyCfg.proxyRoutes.disableRbelLogging">
                              <label class="form-check-label">Deactivate RbelLogger</label>
                              <!-- TODO rephrase and redefine property to be activating -->
                            </div>
                          </div>
                        </div>
                      </div>
                    </fieldset>
                  </div>
                </div>
              </fieldset>
              <fieldset class="labels-col-4 forwardToProxy advanced start-collapsed"
                        section=".tigerProxyCfg.proxyCfg.forwardToProxy"
                        summarypattern="${.tigerProxyCfg.proxyCfg.forwardToProxy.type}://${.tigerProxyCfg.proxyCfg.forwardToProxy.hostname}:${.tigerProxyCfg.proxyCfg.forwardToProxy.port}">
                <legend>
                  Forward Proxy
                  <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                  <span class="fieldset-summary fs-6"></span>
                </legend>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" name="enableForwardProxy">
                  <label class="form-check-label">Activate forward proxy</label>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="input-group">
                      <span class="input-group-text">Hostname</span>
                      <input class="form-control" type="text" name=".tigerProxyCfg.proxyCfg.forwardToProxy.hostname"
                             placeholder="Your company proxy">
                    </div>
                    <div class="input-group">
                      <span class="input-group-text">Proxy Protocol</span>
                      <select class="form-select" name=".tigerProxyCfg.proxyCfg.forwardToProxy.type">
                        <option value="http">HTTP</option>
                        <option value="https">HTTPS</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="input-group">
                      <span class="input-group-text">Port</span>
                      <input class="form-control" type="number" name=".tigerProxyCfg.proxyCfg.forwardToProxy.port"
                             placeholder="Your company proxy port">
                    </div>
                  </div>
                </div>
              </fieldset>
              <fieldset class="labels-col-3 editableList advanced start-collapsed"
                        section=".tigerProxyCfg.proxyCfg.trafficEndpoints"
                        summarypattern="Endpoints: <br/>${.tigerProxyCfg.proxyCfg.trafficEndpoints}<br/>Timeout ${.tigerProxyCfg.proxyCfg.connectionTimeoutInSeconds}<br/>Buffers in Mb ${.tigerProxyCfg.proxyCfg.stompClientBufferSizeInMb}, ${.tigerProxyCfg.proxyCfg.perMessageBufferSizeInMb}, ${.tigerProxyCfg.proxyCfg.rbelBufferSizeInMb}<br/>Skip subscription at startup ${.tigerProxyCfg.proxyCfg.skipTrafficEndpointsSubscription}">
                <legend>
                  Traffic Endpoints
                  <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                  <span class="fieldset-summary fs-6"></span>
                </legend>
                <div class="row mb-3">
                  <div class="col form-text">
                    Configure any mesh tiger proxies to aggregate traffic messages on this tiger proxy.
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox"
                             name=".tigerProxyCfg.proxyCfg.skipTrafficEndpointsSubscription">
                      <label class="form-check-label">Skip traffic endpoint subscription at startup</label>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="row">
                    <div class="col align-items-stretch">
                      <ul class="list-group" name=".tigerProxyCfg.proxyCfg.trafficEndpoints"></ul>
                    </div>
                    <div class="col-auto col-list-btns">
                    </div>
                  </div>
                </div>
                <div class="row mt-1">
                  <div class="col">
                    <div class="input-group">
                        <span class="flex-fill input-group-text">
                          Connection Timeout (sec)
                        </span>
                      <input class="form-control" type="number"
                             name=".tigerProxyCfg.proxyCfg.connectionTimeoutInSeconds">
                    </div>
                    <div class="input-group">
                      <span class="flex-fill input-group-text">Stomp Client Buffer (Mb)</span>
                      <input class="form-control" type="number"
                             name=".tigerProxyCfg.proxyCfg.stompClientBufferSizeInMb">
                    </div>
                  </div>
                  <div class="col">

                    <div class="input-group">
                      <span class="flex-fill input-group-text">Message Buffer (Mb)</span>
                      <input class="form-control" type="number"
                             name=".tigerProxyCfg.proxyCfg.perMessageBufferSizeInMb">
                    </div>
                    <div class="input-group">
                      <span class="flex-fill input-group-text">Rbel Buffer (Mb)</span>
                      <input class="form-control" type="number" name=".tigerProxyCfg.proxyCfg.rbelBufferSizeInMb">
                    </div>
                  </div>
                </div>
              </fieldset>
              <fieldset class="labels-col-3 start-collapsed advanced  complex-list"
                        section=".tigerProxyCfg.proxyCfg.modifications"
                        summarypattern="${.tigerProxyCfg.proxyCfg.modifications}">
                <legend>
                  Modifications
                  <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                  <span class="fieldset-summary fs-6"></span>
                </legend>
                <div class="row mb-3">
                  <div class="col form-text">
                    Configure any rewriting of traffic headers or bodies in this section.
                  </div>
                </div>
                <div class="row">
                  <div class="col align-items-stretch">
                    <ul class="list-group" name=".tigerProxyCfg.proxyCfg.modifications"
                        summarypattern="${name} ${condition}"></ul>
                  </div>
                  <div class="col-auto col-list-btns">
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <fieldset class="subset subset-below">
                      <div class="input-group input-group">
                        <span class="input-group-text">Name</span>
                        <input class="form-control" type="text" name=".tigerProxyCfg.proxyCfg.modifications.name">
                      </div>
                      <div class="input-group input-group">
                        <span class="input-group-text">Condition</span>
                        <input class="form-control" type="text"
                               name=".tigerProxyCfg.proxyCfg.modifications.condition">
                      </div>
                      <div class="input-group input-group">
                        <span class="input-group-text">Target Element</span>
                        <input class="form-control" type="text"
                               name=".tigerProxyCfg.proxyCfg.modifications.targetElement">
                      </div>
                      <div class="input-group input-group">
                        <span class="input-group-text">Replace With</span>
                        <input class="form-control" type="text"
                               name=".tigerProxyCfg.proxyCfg.modifications.replaceWith">
                      </div>
                      <div class="input-group input-group">
                        <span class="input-group-text">Regex Filter</span>
                        <input class="form-control" type="text"
                               name=".tigerProxyCfg.proxyCfg.modifications.regexFilter">
                      </div>
                    </fieldset>
                  </div>
                </div>
              </fieldset>
              <fieldset class="editableList advanced tls start-collapsed" section=".tigerProxyCfg.proxyCfg.tls"
                        summarypattern="${.tigerProxyCfg.proxyCfg.tls.domainName}<br/>RootCa ${.tigerProxyCfg.proxyCfg.tls.serverRootCa.fileLoadingInformation}<br/>Mutual TLS Identity ${.tigerProxyCfg.proxyCfg.tls.forwardMutualTlsIdentity.fileLoadingInformation}<br/>Server Identity ${.tigerProxyCfg.proxyCfg.tls.serverIdentity.fileLoadingInformation}<br/>Additional Names<br/> ${.tigerProxyCfg.proxyCfg.tls.alternativeNames}">
                <legend>
                  TLS Configuration
                  <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                  <span class="fieldset-summary fs-6"></span>
                </legend>
                <div class="row mb-3">
                  <div class="col form-text">
                    Configure TLS related settings like certificates to be used for TLS connections.
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="input-group">
                      <span class="input-group-text">Server Root Ca</span>
                      <input class="form-control" type="text"
                             name=".tigerProxyCfg.proxyCfg.tls.serverRootCa.fileLoadingInformation">
                    </div>
                    <div class="input-group">
                      <span class="input-group-text">Forward Mutual TLS Identity</span>
                      <input class="form-control" type="text"
                             name=".tigerProxyCfg.proxyCfg.tls.forwardMutualTlsIdentity.fileLoadingInformation">
                    </div>
                    <div class="input-group">
                      <span class="input-group-text">Server Identity</span>
                      <input class="form-control" type="text"
                             name=".tigerProxyCfg.proxyCfg.tls.serverIdentity.fileLoadingInformation">
                    </div>
                    <div class="input-group">
                      <span class="input-group-text">Domain Name</span>
                      <input class="form-control" type="text" name=".tigerProxyCfg.proxyCfg.tls.domainName">
                    </div>
                  </div>
                </div>
                <label class="form-label" style="margin-top: 1rem;">Alternative Names</label>
                <div class="row">
                  <div class="col align-items-stretch">
                    <ul class="list-group" name=".tigerProxyCfg.proxyCfg.tls.alternativeNames"></ul>
                  </div>
                  <div class="col-auto col-list-btns">
                  </div>
                </div>
              </fieldset>
            </div>
          </div>
          <!-- PKIKEYS Panel -->
          <div class="tab-pane fade pkiKeys" role="tabpanel" id="tab-13">
            <fieldset class="complex-list" section="pkiKeys" summarypattern="${pkiKeys}">
              <legend>
                PKI Keys
                <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                <span class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  Here you can specify keys and certificates that should be provided to the local tiger proxy.
                </div>
              </div>
              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name="pkiKeys" summarypattern="${id} (${type})"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <fieldset class="subset subset-below">
                    <div class="row">
                      <div class="col">
                        <div class="input-group input-group">
                          <span class="input-group-text">Id</span>
                          <input class="form-control" name="pkiKeys.id" type="text">
                        </div>
                      </div>
                      <div class="col">
                        <div class="input-group input-group">
                          <span class="input-group-text">Type</span>
                          <select class="form-select" name="pkiKeys.type"
                                  title="Select the type of the PKI item">
                            <option value="cert">Certificate</option>
                            <option value="key">Key</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="input-group input-group">
                          <span class="input-group-text" style="width:15%;">Pem</span>
                          <textarea class="form-control" rows="6" name="pkiKeys.pem">
                          </textarea>
                        </div>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </fieldset>
          </div>
          <!-- ENVIRONMENT PANEL -->
          <div class="tab-pane fade environment" role="tabpanel" id="tab-14">
            <fieldset class="editableList" section="environment" summarypattern="${environment}">
              <legend>
                Environment variables for server
                <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                <span class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  Here you can specify environment variables that will be set in the local context before instantiating
                  the node.
                  Please use the pattern ENV_VAR_NAME<b>=</b>value.<br/>
                </div>
              </div>
              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name="environment"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
            </fieldset>
            <fieldset class="always-shown editableList" section="exports" summarypattern="${exports}">
              <legend>
                Exported system properties
                <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                <span class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  Here you can specify java system properties that will be available to the test suite.
                  Please use the pattern system.property.key<b>=</b>value.<br/>
                  Using ${NAME} in the value part will be replaced with the configured hostname.
                  TODO also explain that env vars can be used as tokens
                </div>
              </div>
              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name="exports"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
            </fieldset>
          </div>
          <!-- URL MAPPINGS Panel -->
          <div class="tab-pane fade urlMappings" role="tabpanel" id="tab-15">
            <fieldset class="editableList" summarypattern="${urlMappings}" section="urlMappings">
              <legend>
                URL Mappings for local Tiger Proxy
                <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
                <span class="fieldset-summary fs-6"></span>
              </legend>
              <div class="row mb-3">
                <div class="col form-text">
                  Here you can specify routes for the local tiger proxy to be activated if this node is active.
                  Please provide it in the format http(s)://host:port <b>--&gt;</b> http(s)://newhost:newport
                </div>
              </div>
              <div class="row">
                <div class="col align-items-stretch">
                  <ul class="list-group" name="urlMappings"></ul>
                </div>
                <div class="col-auto col-list-btns">
                </div>
              </div>
            </fieldset>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="template-list-all-buttons">
    <div class="btn-group-vertical btn-group"
         role="group">
      <button class="btn btn-outline-success btn-list-add" title="Add" type="button">
        <i class="fas fa-plus-circle"></i>
      </button>
      <button class="btn btn-outline-danger btn-list-delete" title="Delete" type="button">
        <i class="far fa-trash-alt"></i>
      </button>
      <button class="btn btn-outline-success btn-list-apply" title="Apply" type="button">
        <i class="fas fa-check"></i>
      </button>
    </div>
  </div>
  <div id="template-list-add-delete-buttons">
    <div class="btn-group-vertical btn-group d-lg-flex flex-grow-1 flex-fill justify-content-lg-start"
         role="group">
      <button class="btn btn-outline-success btn-list-add" title="Add" type="button">
        <i class="fas fa-plus-circle"></i>
      </button>
      <button class="btn btn-outline-danger btn-list-delete" title="Delete" type="button">
        <i class="far fa-trash-alt"></i>
      </button>
    </div>
  </div>

  <fieldset id="template-source-list" class="editableList" section="source" summarypattern="${source}:${version}">
    <legend>
      Source
      <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
      <span class="fieldset-summary fs-6"></span>
    </legend>
    <div class="row">
      <div class="col align-items-stretch">
        <ul class="list-group" name="source"></ul>
      </div>
      <div class="col-auto col-list-btns">
      </div>
    </div>
    <div class="input-group" style="margin-top: 1rem;">
      <span class="input-group-text">Version</span>
      <input class="form-control" type="text" name="version"
             title="Version of the docker image or tiger proxy to be downloaded and instantiated">
    </div>
  </fieldset>

  <fieldset id="template-source-single" section="source" summarypattern="${source}:${version}">
    <legend>
      Source
      <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
      <span class="fieldset-summary fs-6"></span>
    </legend>
    <div class="input-group">
      <textarea class="form-control" rows="3" name="source" title="Source for this node"></textarea>
    </div>
    <div class="input-group" style="margin-top: 1rem;">
      <span class="input-group-text">Version</span>
      <input class="form-control" type="text" name="version"
             title="Version of the docker image to be downloaded and instantiated">
    </div>
  </fieldset>

  <fieldset id="template-source-select" section="source" summarypattern="${source}:${version}">
    <legend>
      Source
      <i class="collapse-icon fas fa-angle-down"></i>&nbsp;
      <span class="fieldset-summary fs-6"></span>
    </legend>
    <div class="input-group">
      <span class="input-group-text">Source</span>
      <select class="form-select" name="source"
              title="Select the source from where to download the tiger proxy">
        <option value="nexus" selected>nexus</option>
        <option value="maven">maven</option>
      </select></div>
    <div class="input-group" style="margin-top: 1rem;">
      <span class="input-group-text">Version</span>
      <input class="form-control" type="text" name="version"
             title="Version of the tiger proxy to be downloaded and instantiated">
    </div>
  </fieldset>
</section>

<section id="unique-modals">
  <div class="modal fade" id="file-navigation-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">File navigation</h5>
        </div>
        <div class="input-group filepath">
          <span class="input-group-text col-1">Path</span>
          <input class="form-control" name="file-navigation-path" type="text">
        </div>
        <div class="modal-body">
          Loading file list...
        </div>
        <div class="input-group file-navigation-save">
          <span class="input-group-text">Save as:</span>
          <input class="form-control" name="file-navigation-save" type="text">
        </div>
        <div class="modal-footer">
          <div class="dropup">
            <button class="btn btn-info dropdown-toggle" type="button" id="dropdown-rootfs" data-bs-toggle="dropdown"
                    aria-expanded="false">
              Drives
            </button>
            <ul class="dropdown-menu fs-list-roots-list" aria-labelledby="dropdown-rootfs">
            </ul>
          </div>
          <button type="button" class="btn btn-secondary btn-filenav-cancel">Cancel</button>
          <button type="button" class="btn btn-primary btn-filenav-ok">Ok</button>
        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="add-server-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Server</h5>
        </div>
        <div class="modal-body">
          <div class="row h-100">
            <div class="col-4 overflow-auto h-100">
              <div class="list-group list-server-types">
              </div>
            </div>
            <div class="info-block col rounded bg-light text-primary p-2">
            </div>
            <div class="info-intro-text hidden">
              <h2>Add a new server to your test environment</h2>
              <p>
                Please select one of the basic server types from the left list or choose a more sophisticated server
                node
                from the list of templates at the bottom of the left list. by clicking on it a more detailed description
                to each type/template will be shown. To add it press the button on the bottom right.
              </p>
            </div>
            <div class="info-docker hidden">
              <h2>Docker</h2>
              <p>
                With the base type "Docker" you can specify a docker image from a remote docker registry. Tiger will
                download the image and start a local container on your machine.
              </p>
              <p>
                <b><i class="far fa-hand-point-right"></i> Example use case:</b> run some tests agains a server in a
                docker container.
              </p>
              <p>
                Exposed ports will be available with the expression ${PORT:localport} in the Exports list.
                ${NAME} will be replaced with the hostname.
              </p>
            </div>
            <div class="info-externalJar hidden">
              <h2>External Jar</h2>
              <p>
                With the base type "external Jar" you can specify a local jar file to be executed on your machine (with
                customizable options and program arguments).
                In most cases the jar will start a server. The local test suite proxy will then route traffic from the
                given hostname for this node to the external Jar (reverse proxy mode).
                The healthcheck attribute will determine the servers access URL (= the destination address for the test
                suite proxy). This way your test suite needs to know nothing about the external address and can switch
                between different
                servers without any changes in its configuration.
              </p>
              <p>
                <b><i class="far fa-hand-point-right"></i> Example use case:</b> locally run some tests agains the
                server you are developing (your server = "the external jar")
              </p>
              <p>
                ${NAME} will be replaced with the hostname in the Exports list.
              </p>
            </div>
            <div class="info-tigerProxy hidden">
              <h2>Tiger Proxy</h2>
              <p>
                With the base type "Tiger proxy" you can add an additional forward or reverse proxy to your test
                environment.
                These proxies will not be available to the test suite or nodes out of the box but must be configured on
                the nodes.
              </p>
              <p>
                <b><i class="far fa-hand-point-right"></i> Example use case:</b> configure additional forward proxies
                for nodes in your environment or to facade nodes via a reverse proxy.
              </p>
            </div>
            <div class="info-externalUrl hidden">
              <h2>External URL</h2>
              <p>
                With the base type "external URL" you can specify an external internet address where a service is
                hosted. The local test suite proxy will then route traffic from the given hostname for this node to the
                external URL (reverse proxy mode).
                This way your test suite needs to know nothing about the external address and can switch between
                different servers without any changes in its configuration.
              </p>
              <p>
                <b><i class="far fa-hand-point-right"></i> Example use case:</b> run some tests agains a server that
                someone else is hosting (server address = "the external URL")
              </p>
              <p>
                ${NAME} will be replaced with the hostname in the Exports list.
              </p>
            </div>
            <div class="info-compose hidden">
              <h2>Docker Compose</h2>
              <p>
                With the base type "Docker Compose" you can specify one or more docker compose scripts and the test
                environment manager will set up all services locally.
              </p>
              <p>
                <b><i class="far fa-hand-point-right"></i> Example use case:</b> run some tests agains a group of
                servers in a docker composition.
              </p>
              <p>
                Exposed ports will be available with the expression ${PORT:localport} in the Exports list.
                ${NAME} will be replaced with the hostname.
              </p>
            </div>
            <div class="info-idp-ref hidden">
              <h2>Template IDP REF</h2>
              <p>
                This template provides the reference implementation of the IDP server as local docker container.
                The docker image is loaded from a gematik internal docker registry server.
              </p>
              <p>
                The system property IDP_SERVER is set to the URL of the Discovery Document end point and is available
                for all subsequently initiated test environment nodes.
              </p>
            </div>
            <div class="info-idp-rise-ru hidden">
              <h2>Template IDP Rise in RU</h2>
              <p>
                This template provides a route to the RISE IDP in the Gematik RU
              </p>
              <p>
                The system property IDP_SERVER is set to the URL of the Discovery Document end point and is available
                for all subsequently initiated test environment nodes.
              </p>
            </div>
            <div class="info-idp-rise-tu hidden">
              <h2>Template IDP Rise in TU</h2>
              <p>
                This template provides a route to the RISE IDP in the Gematik TU
              </p>
              <p>
                The system property IDP_SERVER is set to the URL of the Discovery Document end point and is available
                for all subsequently initiated test environment nodes.
              </p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-add-server-cancel">Cancel</button>
          <button type="button" class="btn btn-primary btn-add-server-ok">Add server</button>
        </div>
      </div>
    </div>
  </div>


</section>


<script th:src="@{/webjars/bootstrap/5.1.1/js/bootstrap.bundle.min.js}"></script>
<!--<script th:src="@{/webjars/popper.js/2.9.3/umd/popper.min.js}"></script>-->
<!-- https://github.com/Script47/bs5-utils -->
<script type="text/javascript" th:src="@{/js/bs5util.js}"></script>
<script type="text/javascript" th:src="@{/js/menu.js}"></script>
<script type="text/javascript" th:src="@{/js/formular.js}"></script>
<script type="text/javascript" th:src="@{/js/initialization.js}"></script>

</body>
</html>
