<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="User Manual for Tiger">
<meta name="author" content="TIGER@gematik.de">
<title>Tiger User Manual</title>
<style>
/*
 * Copyright 2024 gematik GmbH
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

@import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');

/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */

@import url(https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css); /* Default asciidoc style framework - important */

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */

:root {
    --maincolor: #FFFFFF;
    --primarycolor: #000E52;
    --secondarycolor: #000E52;
    --tertiarycolor: #225494;
}

body {
    font-family: "Verdana", sans-serif;
    font-size: 11pt;
    text-align: justify;
}

/* Text styles */
h1 {
    color: var(--primarycolor);
    font-weight: bold;
    text-align: center;
}

@media (min-width: 768px) {
    #header {
        padding: 20rem 0;
        background-position: top;
        background-repeat: no-repeat;
        background-image: url("media/title_white.plain.svg");
        height: 80rem;
    }

    #toc {
        border: 0;
    }

    /* TODO Anne to be kept locally */
    #header h1 {
        background-image: url("media/tiger-mono-picto-plain.svg");
        background-size: 150px;
        background-repeat: no-repeat;
        background-position: 120px bottom;
        padding-left: 10rem;
        line-height: 350%;
        font-size: 327%;
    }

    #header .details {
        text-align: center;
        display: block;
        padding-left: 120px;
        border: 0;
        margin-top: -40px;
    }
}

/** Small screens
Without the big background image and the tiger logo above the title*/
@media (max-width: 768px) {
    #header h1 {
        background-image: url("media/tiger-mono-picto-plain.svg");
        background-position: center top;
        background-repeat: no-repeat;
        background-size: 75px;
        padding-left: 0;
        padding-top: 75px; /* Adjust padding to ensure the image appears above the title */
        line-height: normal;
        font-size: 200%; /* Adjust font size for smaller screens */
    }

    #header .details {
        text-align: center;
        display: block;
        border: 0;
    }
}

/* end of to be kept locally */

h2 {
    color: var(--secondarycolor);
    font-weight: bold;
}

h3, h4, h5, h6 {
    color: var(--tertiarycolor);
    font-weight: bold;
}

h3 {
    margin-top: 5rem;
}

/* code blocks */
.listingblock > .content > pre.CodeRay, code, pre {
    font-family: "Fira Code", monospace;
    font-size: 82%;
}

.listingblock > .content > pre.CodeRay {
    background: #fafafa !important;
    border: 1px solid #ccc;
    border-radius: 0.5rem;
}


/* captions for all kinds of blocks
.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title
*/
.title {
    font-family: "Verdana", sans-serif !important;
    font-style: italic !important;
    color: #000000 !important;
}

/* links */
a {
    color: #00766e;
}

#toctitle {
    color: var(--primarycolor);
}

#toc, #toc a {
    color: var(--secondarycolor);
    line-height: 175%;
}

/* Table styles */
th {
    font-family: "Verdana", sans-serif
}

/* Responsiveness fixes */
video {
    max-width: 100%;
}

.indent {
    padding-left: 2rem;
}

@media all and (max-width: 600px) {
    table {
        width: 55vw !important;
        font-size: 3vw;
    }
}


</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Tiger User Manual</h1>
<div class="details">
<span id="author" class="author">TIGER@gematik.de</span><br>
<span id="revdate">Version 3.4.6 - 2024-12-09</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#use-cases">1.1. Use cases</a></li>
<li><a href="#components">1.2. Components</a></li>
</ul>
</li>
<li><a href="#getting-started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#requirements">2.1. Requirements</a></li>
<li><a href="#maven-in-a-nutshell">2.2. Maven in a nutshell</a></li>
<li><a href="#maven-plugin-details">2.3. Maven plugin details</a></li>
<li><a href="#_example_project">2.4. Example project</a></li>
<li><a href="#how-to-contact-the-tiger-team">2.5. How to contact the Tiger team</a></li>
<li><a href="#intellij">2.6. IntelliJ</a></li>
</ul>
</li>
<li><a href="#tiger-test-environment-manager-2">3. Tiger test environment manager</a>
<ul class="sectlevel2">
<li><a href="#supported-server-nodes-and-their-configuration">3.1. Supported server nodes and their configuration</a></li>
<li><a href="#provided-node-templates">3.2. Provided node templates</a></li>
<li><a href="#_configuring_the_local_test_suite_tiger_proxy">3.3. Configuring the local test suite Tiger Proxy</a></li>
<li><a href="#standalone-mode-vs-implicit-startup-with-test-suite">3.4. Standalone mode vs. implicit startup with test suite</a></li>
<li><a href="#using-environment-variables-and-system-properties">3.5. Using Environment variables and system properties</a></li>
</ul>
</li>
<li><a href="#tiger-proxy-2">4. Tiger Proxy</a>
<ul class="sectlevel2">
<li><a href="#excurse-what-are-proxies-reverse-forward">4.1. Excurse: What are proxies, reverse, forward</a></li>
<li><a href="#tiger-proxy-basics">4.2. Tiger Proxy basics</a></li>
<li><a href="#understanding-routes">4.3. Understanding routes</a></li>
<li><a href="#tls-keys-certificates-a-quick-tour-on-proxies">4.4. TLS, keys, certificates a quick tour on proxies</a></li>
<li><a href="#modifications">4.5. Modifications</a></li>
<li><a href="#_mesh_setup_traffic_endpoints">4.6. Mesh set up</a></li>
<li><a href="#_rbel_path_details">4.7. Understanding RBelPath</a></li>
<li><a href="#running-tiger-proxy-as-standalone-jar">4.8. Running Tiger Proxy as standalone JAR</a></li>
<li><a href="#additional-configuration">4.9. Additional configuration</a></li>
<li><a href="#understanding-filtering">4.10. Understanding filtering</a></li>
</ul>
</li>
<li><a href="#tiger-test-library-2">5. Tiger Test library</a>
<ul class="sectlevel2">
<li><a href="#_tiger_test_lib_configuration">5.1. Tiger test lib configuration</a></li>
<li><a href="#_cucumber_hooks">5.2. Cucumber and Hooks</a></li>
<li><a href="#using-the-cucumber-tiger-validation-steps">5.3. Using the Cucumber Tiger validation steps</a></li>
<li><a href="#modifying-rbelobjects-rbelbuilder">5.4. Modifying RbelObjects (RbelBuilder)</a></li>
<li><a href="#using-the-http-client-steps">5.5. Using the HTTP client steps</a></li>
<li><a href="#exemplaric-scenario-konnektorfarm-eau-validation">5.6. Exemplaric scenario Konnektorfarm EAU validation</a></li>
<li><a href="#using-tiger-test-lib-helper-classes">5.7. Using Tiger test lib helper classes</a></li>
<li><a href="#synchronizing-bdd-scenarios-with-polarion-test-cases-gematik-only">5.8. Synchronizing BDD scenarios with Polarion test cases (Gematik only)</a></li>
</ul>
</li>
<li><a href="#_tiger_configuration">6. Tiger Configuration</a>
<ul class="sectlevel2">
<li><a href="#_inlets">6.1. Inlets</a></li>
<li><a href="#key-translation">6.2. Key-translation</a></li>
<li><a href="#thread-based-configuration">6.3. Thread-based configuration</a></li>
<li><a href="#placeholders">6.4. Placeholders</a></li>
<li><a href="#rbelpath-style-retrieval">6.5. RbelPath-style retrieval</a></li>
<li><a href="#fallback-values">6.6. Fallback values</a></li>
<li><a href="#localized-configuration">6.7. Localized configuration</a></li>
<li><a href="#examples">6.8. Examples</a></li>
<li><a href="#pre-defined-values">6.9. Pre-Defined values</a></li>
<li><a href="#inline-jexl">6.10. Inline JEXL</a></li>
<li><a href="#_tiger_configuration_editor">6.11. Configuration Editor</a></li>
</ul>
</li>
<li><a href="#tiger-user-interfaces">7. Tiger User interfaces</a>
<ul class="sectlevel2">
<li><a href="#_workflow_ui">7.1. Workflow UI</a></li>
<li><a href="#postpone-start-of-test-scenarios">7.2. Postpone start of test scenarios</a></li>
<li><a href="#_web_ui">7.3. Standalone Tiger Proxy Log</a></li>
<li><a href="#_jexl_expression_detail">7.4. Explanation of JEXL Expressions</a></li>
</ul>
</li>
<li><a href="#tiger-zion">8. Tiger Zion</a>
<ul class="sectlevel2">
<li><a href="#simple-canned-response">8.1. Simple canned response</a></li>
<li><a href="#looping-tgrfor">8.2. Looping (tgrFor)</a></li>
<li><a href="#conditional-rendering-tgrif">8.3. Conditional rendering (tgrIf)</a></li>
<li><a href="#backend-request">8.4. Backend request</a></li>
<li><a href="#nested-response">8.5. Nested response</a></li>
<li><a href="#matching-path-variables">8.6. Matching path variables</a></li>
<li><a href="#tgrencodeas">8.7. tgrEncodeAs</a></li>
<li><a href="#rbelwriter-content-structures">8.8. RbelWriter content structures</a></li>
</ul>
</li>
<li><a href="#tiger-extensions-2">9. Tiger Extensions</a>
<ul class="sectlevel2">
<li><a href="#tiger-konnektor-management-extension">9.1. Tiger Konnektor Management Extension</a></li>
<li><a href="#tiger-on-fhir-extension">9.2. Tiger On FHIR Extension</a></li>
<li><a href="#tiger-cats-extension">9.3. Tiger CATS Extension</a></li>
<li><a href="#tiger-cloud-extension">9.4. Tiger Cloud Extension</a></li>
<li><a href="#tiger-pssim-extension">9.5. Tiger PSSIM Extension</a></li>
<li><a href="#tiger-robot-extension">9.6. Tiger Robot Extension</a></li>
</ul>
</li>
<li><a href="#rest-api">10. Rest API</a>
<ul class="sectlevel3">
<li><a href="#introduction-2">10.1. Introduction</a></li>
<li><a href="#endpoints">10.2. Endpoints</a></li>
<li><a href="#models">10.3. Models</a></li>
</ul>
</li>
<li><a href="#links-to-test-relevant-topics">11. Links to test relevant topics</a></li>
<li><a href="#frequently-asked-questions">12. Frequently asked questions</a>
<ul class="sectlevel2">
<li><a href="#maven">12.1. Maven</a></li>
<li><a href="#extensions">12.2. Extensions</a></li>
<li><a href="#workflow-ui">12.3. Workflow UI</a></li>
<li><a href="#other-topics">12.4. Other topics</a></li>
<li><a href="#extensions-2">12.5. Extensions</a></li>
<li><a href="#workflow-ui-2">12.6. Workflow UI</a></li>
<li><a href="#other-topics-2">12.7. Other topics</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get a quick introduction to the core concepts and features of the Tiger test framework check out our video</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://youtu.be/eJJZDeuFlyI?autoplay"><img src="media/tiger-pitch-still.png" alt="tiger pitch still" width="1024"></a>
</div>
<div class="title">Figure 1. Tiger product pitch video</div>
</div>
<div class="paragraph">
<p>Tiger is a framework for interface-driven BDD black-box-testing.</p>
</div>
<div class="paragraph">
<p>Tiger is a toolbox that supports and guides you when writing test suites. It lets you focus on writing the tests  and solves typical problems that every team encounters (configuration, setting up the test environment, parametrization, result reporting, test running). How, you ask?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tiger does not focus on components but on the interactions between them. The Tiger Proxy captures the traffic between components.</p>
</li>
<li>
<p>Tiger Proxy parses the traffic and builds a tree-structure which abstracts away the encoding (XML, JSON&#8230;&#8203;) and lets you focus on the data.</p>
</li>
<li>
<p>The Tiger test environment manager handles dockers, helm charts, JARs and external servers, boots the configured setup and routes the traffic, all with zero lines of Java, all in YAML only.</p>
</li>
<li>
<p>A complete configuration toolkit, which combines multiple source and supports custom configuration of your testsuite as well, again with zero lines of Java.</p>
</li>
<li>
<p>Common tasks (JSON-validation, message-filtering, scenario configuration, configuration of simulators&#8230;&#8203;) can be performed with the Tiger test library, which can be seamlessly imported into BDD test suites.<br>
This allows you to build mighty test suites with zero lines of java.</p>
</li>
<li>
<p>If you want to write custom steps and glue code our Java-API has got you covered by supporting common tasks (crypto, serialization&#8230;&#8203;) for you. So the little lines you have to write are be powerful and descriptive?!</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="use-cases"><a class="anchor" href="#use-cases"></a>1.1. Use cases</h3>
<div class="paragraph">
<p>In our first dive we focused on what Tiger should stand for and how we could improve the situation of test teams.</p>
</div>
<div class="ulist">
<div class="title">Core business use cases</div>
<ul>
<li>
<p>Fast and easy set up of test environments</p>
</li>
<li>
<p>Uncomplicated automated execution of IOP tests</p>
</li>
<li>
<p>Explicit analysis of test failures</p>
</li>
<li>
<p>Reuse of cases/steps from existing test suites</p>
</li>
<li>
<p>(non Java test automation support is not implemented yet)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger_use_cases.svg" alt="tiger use cases">
</div>
<div class="title">Figure 2. Tiger use cases</div>
</div>
</div>
<div class="sect2">
<h3 id="components"><a class="anchor" href="#components"></a>1.2. Components</h3>
<div class="paragraph">
<p>Tiger has a clear separation in three components, each of them having a clear purpose, described in the next subsections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tiger Proxy</p>
</li>
<li>
<p>Tiger Testenvironment Manager</p>
</li>
<li>
<p>Tiger Test library</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="tiger-proxy"><a class="anchor" href="#tiger-proxy"></a>1.2.1. Tiger Proxy</h4>
<div class="paragraph">
<p>The Tiger Proxy at its core is an extended Mock server, that has the following additional core feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rerouting</strong> - allows rerouting requests based on a configured lookup table</p>
</li>
<li>
<p><strong>Modifications</strong> - allows modifying the content of requests / responses on the fly</p>
</li>
<li>
<p><strong>Mesh set up</strong> - allows forwarding traffic data from one proxy to another for aggregated validations</p>
</li>
<li>
<p><strong>TLS man in the middle</strong> - allows tracing TLS encrypted traffic</p>
</li>
<li>
<p><strong>RBel logging</strong> - breaks up and parses each request / response received. This includes decryption of VAU and encrypted JWT.<br>
Structured data like JSON, XML, JWT is displayed in a sophisticated HTML report.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="tiger-test-environment-manager"><a class="anchor" href="#tiger-test-environment-manager"></a>1.2.2. Tiger test environment manager</h4>
<div class="paragraph">
<p>The Tiger test environment manager provides methods to configure and instantiate multiple server nodes in your test environment and offers the following core feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Instantiating test nodes</strong> - docker containers, docker compositions, helm charts, external Jars** and<br>
accessing server instances via external URL configurations</p>
</li>
<li>
<p><strong>Instantiating preconfigured server nodes</strong> - for common test scenarios like ePA, ERp, IDP, Demis</p>
</li>
<li>
<p><strong>Automatic shutdown</strong> - on tear down of test run, all the instantiated test nodes are ended</p>
</li>
<li>
<p><strong>Highly configurable</strong> - Multitude of parameters and configuration properties</p>
</li>
<li>
<p><strong>Flexible environment management</strong> - exporting and importing environment variables and system properties to other test nodes</p>
</li>
<li>
<p><strong>Customizing configuration properties</strong> - via command line system properties or environment variables</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="tiger-test-library"><a class="anchor" href="#tiger-test-library"></a>1.2.3. Tiger test library</h4>
<div class="paragraph">
<p>The Tiger test library provides the following core features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Validation</strong> - BDD steps to filter requests and validate responses</p>
</li>
<li>
<p><strong>Workflow UI</strong> - BDD steps to support tester guidance in test workflows</p>
</li>
<li>
<p><strong>Content assertion</strong> - BDD steps to assert JSON / XML data structures</p>
</li>
<li>
<p><strong>Product Integration</strong> - Synchronisation with Polarion, Serenity BDD and screenplay pattern</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="working-together"><a class="anchor" href="#working-together"></a>1.2.4. Working together</h4>
<div class="paragraph">
<p>The Testenvironment Manager instantiates all test nodes configured in the <code>tiger.yaml</code> config file.<br>
It also instantiates one local Tiger Proxy for the current test suite.<br>
This Tiger Proxy instance (and others created in the test environment if using a mesh setup) traces all requests and responses<br>
forwarded via this proxy and provides them to the test suite for further validation.</p>
</div>
<div class="paragraph">
<p>For each server node instantiated, the local Tiger Proxy adds a route so that the instantiated server node<br>
can be reached by the test suite via HTTP and the configured server hostname.</p>
</div>
<div class="paragraph">
<p>Each Tiger Proxy can be configured in a multitude of ways: as reverse or forward proxy with special routing features and<br>
modifications of content easily configurable, or in a mesh setup as proxy forwarding traffic to other Tiger Proxies&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The BDD or JUnit test suite can integrate the Tiger test library to validate messages (requests and responses) sent/received<br>
over Tiger Proxies using features such as RBelPath, VAU decryption, JSON checker and XML checker.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger_components.svg" alt="tiger components">
</div>
<div class="title">Figure 3. Tiger components</div>
</div>
</div>
<div class="sect3">
<h4 id="tiger-extensions"><a class="anchor" href="#tiger-extensions"></a>1.2.5. Tiger extensions</h4>
<div class="paragraph">
<p>As Tiger evolves we have implemented quite a nice set of extensions that eases your job as tester in areas not directly fitting the core of Tiger. The currently or soon available extensions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cloud</strong> extension provides the docker, docker compose and helm chart server types for the Tiger test environment mgr</p>
</li>
<li>
<p><strong>CATS</strong> extension provides BDD steps to configure and interact with the Cats Card Terminal simulator of gematik</p>
</li>
<li>
<p><strong>Konnektormanagement</strong> extension provides BDD steps to administer Konnektors</p>
</li>
<li>
<p><strong>PSSim</strong> extension provides BDD steps to simulate a Primärsystem</p>
</li>
<li>
<p><strong>HTTP Client</strong> extension follows the zero code philosophy and provides BDD steps to perform http requests without having to write any line of code</p>
</li>
<li>
<p><strong>FHIR validation</strong> extension provides BDD steps to perform FHIR scheme based / FHIRPath based validations (planned release early spring 2023)</p>
</li>
<li>
<p><strong>Kartenterminal Robot</strong> extension provides BDD steps to control the card terminal robot currently constructed at gematik labs (release mid 2023)</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image thumb"><img src="media/tiger2-plain.svg" alt="120" width="120" title="Tiger logo"></span> ROOOARRR!<br>
Ready to rumble!</p>
</div>
<div class="paragraph">
<p>Tiger is based on Java, Maven and Serenity BDD - so saddle the horses, check the operating system requirements and hit the road.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We do not at the moment have any plans to support gradle or other build environments.<br>
But if you are using it in your projects feel free to contact us, and we might find a way to support your specific build environment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t have time right now to look through the whole documentation, you can directly jump to our <a href="#_example_project">Example project</a> section.</p>
</div>
<div class="sect2">
<h3 id="requirements"><a class="anchor" href="#requirements"></a>2.1. Requirements</h3>
<div class="ulist">
<div class="title">System requirements</div>
<ul>
<li>
<p>Open JDK &gt;= 17</p>
</li>
<li>
<p>Maven &gt;= 3.6</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you are developing a testsuite (further), you should use an IDE (we recommend IntelliJ &gt;= 2021.2.3 because of the IntelliJ Cucumber plugin).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
On Windows you can use Git Bash or Powershell
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="maven-in-a-nutshell"><a class="anchor" href="#maven-in-a-nutshell"></a>2.2. Maven in a nutshell</h3>
<div class="paragraph">
<p>In order to use Tiger with your BDD/Cucumber/Serenity based test suite you need to add a few dependencies to integrate with Tiger</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Current version of Tiger test library</p>
</li>
<li>
<p>Current version of Tiger test library as test-jar artefact</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The second dependency is needed so that the IntelliJ Cucumber plugin detects the Steps/Glue code provided by the Tiger test library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And to trigger the test suite&#8217;s execution, you will need to add these plugins</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tiger maven plugin</p>
</li>
<li>
<p>Maven FailSafe plugin</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 1. Simple Tiger Maven pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
  ~ Copyright 2024 gematik GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  --&gt;

&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;de.gematik.test.tiger.examples&lt;/groupId&gt;
    &lt;artifactId&gt;TigerTestBDD&lt;/artifactId&gt;
    &lt;version&gt;1.2.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;

        &lt;version.junit5&gt;5.10.3&lt;/version.junit5&gt;
        &lt;version.maven.failsafe&gt;3.3.1&lt;/version.maven.failsafe&gt;
        &lt;!-- please adapt Tiger version property to the most current one obtained from --&gt;
        &lt;!-- maven central:
          https://mvnrepository.com/artifact/de.gematik.test/tiger-test-lib
          or from gematik internal Nexus
          https://nexus.prod.ccs.gematik.solutions/#browse/search=keyword%3Dtiger-test-lib
        --&gt;
        &lt;version.tiger&gt;3.1.1&lt;/version.tiger&gt;
        &lt;version.logback&gt;1.5.7&lt;/version.logback&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
                &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
                &lt;version&gt;${version.logback}&lt;/version&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;!-- tag::dependencies[] --&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
            &lt;artifactId&gt;tiger-test-lib&lt;/artifactId&gt;
            &lt;version&gt;${version.tiger}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-junit-platform-engine&lt;/artifactId&gt;
            &lt;version&gt;7.19.0&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;!-- end::dependencies[] --&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- tag::generator-plugin[] --&gt;
            &lt;!-- optional plugin to dynamically create JUnit driver classes on the fly.
            You may omit this plugin if you have written your driver classes manually.
            --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.mycila&lt;/groupId&gt;
                &lt;artifactId&gt;license-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;skip&gt;true&lt;/skip&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
                &lt;artifactId&gt;tiger-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${version.tiger}&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;configuration&gt;
                            &lt;!-- optional --&gt;
                            &lt;glues&gt;
                                &lt;glue&gt;de.gematik.test.tiger.glue&lt;/glue&gt;
                                &lt;!-- add your packages here --&gt;
                            &lt;/glues&gt;
                            &lt;!-- optional --&gt;
                            &lt;featuresDir&gt;${project.basedir}/src/test/resources/features&lt;/featuresDir&gt;
                            &lt;!-- optional --&gt;
                            &lt;includes&gt;
                                &lt;include&gt;**/*.feature&lt;/include&gt;
                            &lt;/includes&gt;
                            &lt;!-- optional --&gt;
                            &lt;driverPackage&gt;
                                de.gematik.test.tiger.examples.bdd.drivers
                            &lt;/driverPackage&gt;
                            &lt;!-- optional --&gt;
                            &lt;!--suppress UnresolvedMavenProperty --&gt;
                            &lt;driverClassName&gt;Driver${ctr}IT&lt;/driverClassName&gt;
                            &lt;!-- optional, defaults to the templated located at
                            /src/main/resources/driver4ClassTemplate.jtmpl
                            in the tiger-maven-plugin module.
                            This template will create a junit4 compliant driver class.
                            Use separate template file if you have spring boot apps to test
                            or need to do some more fancy set up stuff.
                            &lt;templateFile&gt;${project.basedir}/..../XXXX.jtmpl&lt;/templateFile&gt;
                            --&gt;
                            &lt;!-- optional --&gt;
                            &lt;skip&gt;false&lt;/skip&gt;
                            &lt;junit5Driver&gt;true&lt;/junit5Driver&gt;
                        &lt;/configuration&gt;
                        &lt;phase&gt;generate-test-sources&lt;/phase&gt;
                        &lt;id&gt;generate-tiger-drivers&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;!-- mandatory --&gt;
                            &lt;goal&gt;generate-drivers&lt;/goal&gt;
                            &lt;!-- optional. This will attach the Tiger-Agent to the VM running the
                            tests. This, in turn, enables tiger to access and store masterSecrets of TLS
                            connections. This can be used to decipher TLS-traffic in wireshark. --&gt;
                            &lt;goal&gt;attach-tiger-agent&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;id&gt;generate-tiger-report&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;
                                generate-serenity-reports
                            &lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;!-- end::generator-plugin[] --&gt;

            &lt;!-- tag::failsafe-plugin[] --&gt;
            &lt;!-- Runs the tests by calling the JUnit driver classes --&gt;
            &lt;!-- To filter features / scenarios use the system property
                 -Dcucumber.filter.tags --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
                &lt;version&gt;${version.maven.failsafe}&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;integration-test&lt;/goal&gt;
                            &lt;goal&gt;verify&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;configuration&gt;
                    &lt;includes&gt;
                        &lt;!-- adapt to the class names of your driver classes --&gt;
                        &lt;include&gt;**/Driver*IT.java&lt;/include&gt;
                    &lt;/includes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;!-- end::failsafe-plugin[] --&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a successful startup you also need a minimum Tiger test environment configuration yaml file in your project root:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Minimum Test environment configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># minimum viable test environment specification
# default local Tiger Proxy
tigerProxy:
# no server nodes
servers: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and finally a minimal feature file under src/test/resources/features:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Minimum Cucumber feature file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature: Test Tiger BDD

  Scenario: Dummy Test
    Given TGR set global variable "key01" to "value01"
    When TGR assert variable "key01" matches "v.*\d\d"</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these three files in place you can run the simple dummy test scenario defined in the feature file by issuing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn verify</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="maven-plugin-details"><a class="anchor" href="#maven-plugin-details"></a>2.3. Maven plugin details</h3>
<div class="paragraph">
<p>This section is for the ones that love to know all the details.<br>
If you are happy that everything works and don&#8217;t bother to understand all the bits / properties and settings just skip this section and head over to the <a href="#_example_project">Example project</a> section.</p>
</div>
<div class="sect3">
<h4 id="tiger-maven-plugin"><a class="anchor" href="#tiger-maven-plugin"></a>2.3.1. Tiger maven plugin</h4>
<div class="paragraph">
<p>This plugin allows to dynamically generate the JUnit driver classes that are then used in the Surefire plugin to start the test runs.<br>
And replaces the serenity maven plugin to generate Serenity BDD test reports.</p>
</div>
<div class="sect4">
<h5 id="generate-drivers-goal"><a class="anchor" href="#generate-drivers-goal"></a>Generate Drivers goal</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may decide to manually write your own JUnit driver classes in which case you can omit this plugin.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To activate this feature in your maven project add the following plugin block to your &lt;build&gt;&lt;plugins&gt; section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">            &lt;!-- optional plugin to dynamically create JUnit driver classes on the fly.
            You may omit this plugin if you have written your driver classes manually.
            --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.mycila&lt;/groupId&gt;
                &lt;artifactId&gt;license-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;skip&gt;true&lt;/skip&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
                &lt;artifactId&gt;tiger-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${version.tiger}&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;configuration&gt;
                            &lt;!-- optional --&gt;
                            &lt;glues&gt;
                                &lt;glue&gt;de.gematik.test.tiger.glue&lt;/glue&gt;
                                &lt;!-- add your packages here --&gt;
                            &lt;/glues&gt;
                            &lt;!-- optional --&gt;
                            &lt;featuresDir&gt;${project.basedir}/src/test/resources/features&lt;/featuresDir&gt;
                            &lt;!-- optional --&gt;
                            &lt;includes&gt;
                                &lt;include&gt;**/*.feature&lt;/include&gt;
                            &lt;/includes&gt;
                            &lt;!-- optional --&gt;
                            &lt;driverPackage&gt;
                                de.gematik.test.tiger.examples.bdd.drivers
                            &lt;/driverPackage&gt;
                            &lt;!-- optional --&gt;
                            &lt;!--suppress UnresolvedMavenProperty --&gt;
                            &lt;driverClassName&gt;Driver${ctr}IT&lt;/driverClassName&gt;
                            &lt;!-- optional, defaults to the templated located at
                            /src/main/resources/driver4ClassTemplate.jtmpl
                            in the tiger-maven-plugin module.
                            This template will create a junit4 compliant driver class.
                            Use separate template file if you have spring boot apps to test
                            or need to do some more fancy set up stuff.
                            &lt;templateFile&gt;${project.basedir}/..../XXXX.jtmpl&lt;/templateFile&gt;
                            --&gt;
                            &lt;!-- optional --&gt;
                            &lt;skip&gt;false&lt;/skip&gt;
                            &lt;junit5Driver&gt;true&lt;/junit5Driver&gt;
                        &lt;/configuration&gt;
                        &lt;phase&gt;generate-test-sources&lt;/phase&gt;
                        &lt;id&gt;generate-tiger-drivers&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;!-- mandatory --&gt;
                            &lt;goal&gt;generate-drivers&lt;/goal&gt;
                            &lt;!-- optional. This will attach the Tiger-Agent to the VM running the
                            tests. This, in turn, enables tiger to access and store masterSecrets of TLS
                            connections. This can be used to decipher TLS-traffic in wireshark. --&gt;
                            &lt;goal&gt;attach-tiger-agent&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;id&gt;generate-tiger-report&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;
                                generate-serenity-reports
                            &lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Mandatory configuration properties</div>
<ul>
<li>
<p><strong>List[glue] glues</strong> (mandatory)<br>
list of packages to be included as glue or hooks code</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Optional configuration properties or properties with default values</div>
<ul>
<li>
<p>List[include] includes (mandatory)<br>
list of include patterns for feature files in Ant format (directory/**.feature)</p>
</li>
<li>
<p>String featuresDir (default: local working directory)<br>
root folder from where to apply includes and excludes</p>
</li>
<li>
<p>List[exclude] excludes (default: empty)<br>
list of exclusion patterns for feature files in Ant format (directory/**.feature)</p>
</li>
<li>
<p>boolean skip (default: false)<br>
flag whether to skip the execution of this plugin</p>
</li>
<li>
<p>String driverPackage (default: de.gematik.test.tiger.serenity.drivers)<br>
package of the to be generated driver class</p>
</li>
<li>
<p>String driverClassName (default: Driver${ctr})<br>
Name of the to be generated driver class.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The ctr token ${ctr} is mandatory!<br>
For more details see section below
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>String templateFile (default: null which means that the plugin will use the built-in template file)<br>
Optional path to a custom template file to be used for generating the driver Java source code file.</p>
<div class="ulist">
<ul>
<li>
<p>The plugin currently supports the following list of tokens:</p>
<div class="ulist">
<ul>
<li>
<p>${ctr}<br>
counter value that is unique and incremented for each feature file.</p>
</li>
<li>
<p>${package}<br>
will be replaced with package declaration code line of the driver class.<br>
Either empty or of the pattern "package xxx.yyy.zzz;" where xxx.yyy.zzz is replaced with the configured driverPackage configuration property.</p>
</li>
<li>
<p>${driverClassName}<br>
name of the driver class (with the ctr token already being replaced with the incrementing counter value).</p>
</li>
<li>
<p>${feature}<br>
path to the feature file(s).</p>
</li>
<li>
<p>${gluesCsv}<br>
comma separated list of glue/hook packages without curly braces.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="manually-creating-driver-classes"><a class="anchor" href="#manually-creating-driver-classes"></a>Manually creating driver classes</h6>
<div class="paragraph">
<p>For each feature (or use wildcards / directories for single driver class) you can implement a driver class based on the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package de.gematik.test.tiger.integration.YOURPROJECT;

import static io.cucumber.junit.platform.engine.Constants.FILTER_TAGS_PROPERTY_NAME;
import static io.cucumber.junit.platform.engine.Constants.GLUE_PROPERTY_NAME;
import static io.cucumber.junit.platform.engine.Constants.PLUGIN_PROPERTY_NAME;

import org.junit.platform.suite.api.ConfigurationParameter;
import org.junit.platform.suite.api.IncludeEngines;
import org.junit.platform.suite.api.SelectClasspathResource;
import org.junit.platform.suite.api.Suite;

@Suite
@IncludeEngines("cucumber")
@SelectClasspathResource("features/YOURFEATURE.feature")
@ConfigurationParameter(key = FILTER_TAGS_PROPERTY_NAME, value = "not @Ignore")
@ConfigurationParameter(key = GLUE_PROPERTY_NAME, value = "de.gematik.test.tiger.glue,ANY ADDITIONAL PACKAGES containing GLUE or HOOKS code")
@ConfigurationParameter(
    key = PLUGIN_PROPERTY_NAME,
    value = "io.cucumber.core.plugin.TigerSerenityReporterPlugin,json:target/cucumber-parallel/1.json")
public class Driver1IT {}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="generate-reports-goal"><a class="anchor" href="#generate-reports-goal"></a>Generate Reports goal</h5>
<div class="paragraph">
<p>The second execution block in the example XML section above will trigger the report creation.<br>
There are no properties for configuration at the moment.<br>
Two reports will be generated under target/site/serenity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A simple HTML single page report for emailing (serenity-summary.html)</p>
</li>
<li>
<p>A fancy detailed overall report (index.html)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="start-tiger-test-environment-in-standalone-mode"><a class="anchor" href="#start-tiger-test-environment-in-standalone-mode"></a>Start Tiger test environment in standalone mode</h5>
<div class="paragraph">
<p>Adding the plugin as shown below will allow you to start a test environment in standalone mode by starting mvn as follows: <code><code>mvn tiger:setup-testenv</code></code>.<br>
Please be aware that this is a blocking call, you may specify a timeout configuration property <code><code>autoShutdownAfterSeconds</code></code> with timeout in seconds.<br>
To prematurely stop the process either press Ctrl+C in your console or kill it with operating system specific kill commands / tools.<br>
In order to customize the tiger yaml to be used either set the environment variable <code><code>TIGER_TESTENV_CFGFILE</code></code> or set the system property <code><code>tiger.testenv.cfgfile</code></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
     &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
     &lt;artifactId&gt;tiger-maven-plugin&lt;/artifactId&gt;
     &lt;version&gt;${version.tiger}&lt;/version&gt;
 &lt;/plugin&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="failsafe-plugin"><a class="anchor" href="#failsafe-plugin"></a>2.3.2. FailSafe plugin</h4>
<div class="paragraph">
<p>The failsafe plugin will trigger the test run.<br>
It is important to activate the <strong>testFailureIgnore</strong> property, to ensure that even if the test fails, the serenity report is created.</p>
</div>
<div class="paragraph">
<p>To filter the scenarios/features to be run you may pass in the Java system property cucumber.filter.tags.<br>
You can do so either within the &lt;systemPropertyVariables&gt; tag or via the command line using -Dcucumber.filter.tags</p>
</div>
<div class="paragraph">
<p>The "not @Ignore" is the default setting for maven verify as well as for IntelliJ, therefore scenarios that should be ignored are to be tagged with @Ignore.<br>
If the user uses the cucumber option "-Dcucumber.options" to set own tags then the default setting of "not @Ignore" is overridden.<br>
The same counts for own tag settings in the IntelliJ run configuration.</p>
</div>
<div class="paragraph">
<p>For more details about how to use filter tags see <a href="https://cucumber.io/docs/cucumber/api/#tags" class="bare">https://cucumber.io/docs/cucumber/api/#tags</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">            &lt;!-- Runs the tests by calling the JUnit driver classes --&gt;
            &lt;!-- To filter features / scenarios use the system property
                 -Dcucumber.filter.tags --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
                &lt;version&gt;${version.maven.failsafe}&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;integration-test&lt;/goal&gt;
                            &lt;goal&gt;verify&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;configuration&gt;
                    &lt;includes&gt;
                        &lt;!-- adapt to the class names of your driver classes --&gt;
                        &lt;include&gt;**/Driver*IT.java&lt;/include&gt;
                    &lt;/includes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
We do not recommend the parallel test execution with Tiger at the moment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Reason is that when using Tiger Proxies with the Tiger test library validation feature parallel execution may lead to messages from different threads / forked processes ending up in the wrong listening queue making it very complicated to make sure your validations are working as expected in different timing situations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_project"><a class="anchor" href="#_example_project"></a>2.4. Example project</h3>
<div class="paragraph">
<p>In the <code>/doc/examples/tigerOnly</code> folder of this project you will find an example for a minimum configured maven project that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>embeds Tiger</p>
</li>
<li>
<p>allows to use its Cucumber steps and</p>
</li>
<li>
<p>allows to easily configure your test environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All you need is to set up three files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a Maven <code>pom.xml</code> file to declare the dependencies and the plugins needed</p>
</li>
<li>
<p>a <code>tiger.yaml</code> to declare your test environment (servers needed, proxy routes,&#8230;&#8203;).<br>
This is currently "empty".</p>
</li>
<li>
<p>a <code>test.feature</code> file containing a test scenario and dummy test steps to be performed.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="media/structureTigerOnly.png" alt="structureTigerOnly">
</div>
<div class="title">Figure 4. File structure of TigerOnly example project</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-contact-the-tiger-team"><a class="anchor" href="#how-to-contact-the-tiger-team"></a>2.5. How to contact the Tiger team</h3>
<div class="paragraph">
<p>You can reach us via</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitHub <a href="https://github.com/gematik/app-Tiger" class="bare">https://github.com/gematik/app-Tiger</a></p>
</li>
<li>
<p>or email <a href="mailto:TIGER@gematik.de">TIGER@gematik.de</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="intellij"><a class="anchor" href="#intellij"></a>2.6. IntelliJ</h3>
<div class="paragraph">
<p>We recommend to use latest version of IntelliJ at least version 2021.1.</p>
</div>
<div class="sect3">
<h4 id="rundebug-settings"><a class="anchor" href="#rundebug-settings"></a>2.6.1. Run/Debug settings</h4>
<div class="paragraph">
<p>To be able to successfully start scenarios/features you first need to configure the Run/Debug settings of your project:</p>
</div>
<div class="ulist">
<div class="title">Run/Debug settings for Java Cucumber template</div>
<ul>
<li>
<p>Main class: io.cucumber.junit.TigerCucumberRunner</p>
</li>
<li>
<p>Glue:</p>
<div class="ulist">
<ul>
<li>
<p>de.gematik.test.tiger.glue</p>
</li>
<li>
<p>net.serenitybdd.cucumber.actors<br>
if you are using the screenplay pattern (PREFERRED!)</p>
</li>
<li>
<p>additional packages specific to your test suite</p>
</li>
</ul>
</div>
</li>
<li>
<p>VM Options:</p>
<div class="ulist">
<ul>
<li>
<p>Java proxy system properties (see <a href="#_proxy_configuration">Proxy configuration</a> below)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Environment variables:</p>
<div class="ulist">
<ul>
<li>
<p>Proxy environment variables (see <a href="#_proxy_configuration">Proxy configuration</a> below)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Best is to add these settings to the <strong>Configuration Templates</strong> for Cucumber Java.<br>
Depending on the version of IntelliJ these settings are located either on the top icon bar or at the bottom left as link.</p>
</div>
<div class="paragraph">
<p>Else you would have to apply these settings to any new Debug/Run Configuration, like when you start a new scenario, which was never executed before.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-intellij-run-settings.png" alt="tiger intellij run settings">
</div>
<div class="title">Figure 5. Run/Debug settings for IntelliJ</div>
</div>
</div>
<div class="sect3">
<h4 id="_proxy_configuration"><a class="anchor" href="#_proxy_configuration"></a>2.6.2. Proxy configuration</h4>
<div class="paragraph">
<p>If you are located behind a proxy please make sure to set the environment variables HTTPS_PROXY and HTTP_PROXY as well as the Java system properties http.proxyHost, http.proxyPort, https.proxyHost and https.proxyPort appropriately so that the internet connections are routed properly through your <strong>company proxy</strong>.</p>
</div>
<div class="paragraph">
<p>Please also make sure IntelliJ has its proxy settings configured appropriately for HTTP and HTTPS so that it can download the dependencies for the IntelliJ build environment too.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
BOTH settings (environment variables and system properties) are required as Maven and Java code and HTTP client libraries use both settings.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiger-test-environment-manager-2"><a class="anchor" href="#tiger-test-environment-manager-2"></a>3. Tiger test environment manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As outlined in <a href="#_overview">the overview section</a> the test environment manager is one of the three core components of the Tiger test framework.<br>
Its main task is to start various test server nodes configured in the <code>tiger.yaml</code> configuration file and initialize the local Tiger Proxy for the test suite.<br>
To choose a different test environmental configuration file you may set the environment variable <code>TIGER_TESTENV_CFGFILE</code>.</p>
</div>
<div class="paragraph">
<p>The test environment manager first checks if the env variable is set and tries to load the configuration file from this value.<br>
If this file does not exist the test environment manager tries to load the configuration from <code>tiger.yaml</code>.<br>
If none of these files exist it will fail the start-up.</p>
</div>
<div class="paragraph">
<p>If the environment variable is not set it searches for files named <code>tiger.yaml</code> or <code>tiger.yml</code>.<br>
If none of these files exist it will fail the start-up.</p>
</div>
<div class="paragraph">
<p>It then loads further yaml-files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tiger-${hostname}.yaml</code> and <code>tiger-${hostname}.yml</code> are read and give the possibility to make computer-dependent configuration.<br>
The hostname is the name of your own computer in the network (on Windows-machines typically the computername).</p>
</li>
<li>
<p>The list given under <code>tiger.additionalYamls</code> is read.<br>
Each list-entry has two properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>filename</code> pointing to the file to be read.<br>
This can be relative to the tiger.yaml (primary) or relative to the working-directory (secondary).<br>
Keep in mind that placeholders can be used in the filename!</p>
</li>
<li>
<p><code>baseKey</code>, an optional attribute, which gives you the chance to prefix every property from the given file with this key (keep in mind that the <code>tiger.yaml</code> has a baseKey of <code>tiger</code>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the start-up phase it also informs the local Tiger Proxy about the hostnames each node has configured, so that the local Tiger Proxy can create appropriate routing entries in its own configuration.</p>
</div>
<div class="paragraph">
<p>To configure your test environment you can compose the <code>tiger.yaml</code> file manually.</p>
</div>
<div class="paragraph">
<p>The nodes configured in the yaml file will be started asynchronously unless the dependsUpon property is set.</p>
</div>
<div class="sect2">
<h3 id="supported-server-nodes-and-their-configuration"><a class="anchor" href="#supported-server-nodes-and-their-configuration"></a>3.1. Supported server nodes and their configuration</h3>
<div class="paragraph">
<p>The Tiger testenvironment manager currently supports the following list of server nodes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Docker container</strong> is a node based on instantiating a specific docker image that is either locally available or downloaded from a remote docker repo configured in the source property.</p>
</li>
<li>
<p><strong>Docker compose</strong> is a node that you can use to start a group of services defined in one to several compose yaml files configured in the source list.</p>
</li>
<li>
<p><strong>Helm charts</strong> is a node that installs/updates a given helm chart on a local or remote kubernetes cluster (configuring a local context for remote clusters has to be done outside of Tiger)</p>
</li>
<li>
<p><strong>External jar</strong> is a node that is started by running <code>java -jar XXXX.jar</code> after downloading a Jar archive from the configured source URL.</p>
</li>
<li>
<p><strong>External URL</strong> is a symbolic node that is actually maintained outside the realm of the test environment manager.<br>
The main purpose is to allow the test suite to access this external server via a constant URL, regardless of what the actual access URL of the server is.<br>
So if you change the location of the external server has no adaptations effect on the test suite.</p>
</li>
<li>
<p><strong>Tiger Proxy</strong> is a specialized external Jar node that allows you to instantiate standalone Tiger Proxy nodes in your test environment in several locations to track, log and validate traffic between any two nodes.<br>
For this to work, you must either be able to force a proxy on the nodes or <a href="#_excurse_what_are_proxies_reverse_forward">use a reverse proxy set up scenario</a>.</p>
</li>
<li>
<p><strong>Helm Chart</strong> is a node that will be added to tiger via a plugin mechanism that starts a helm chart within a kubernetes environment.</p>
</li>
<li>
<p><strong>httpbin</strong> is a node mainly useful for testing purposes.<br>
It starts a <a href="https://github.com/gaul/java-httpbin">httpbin</a> server which provides mock endpoints.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="yaml-configuration-files-in-a-nutshell"><a class="anchor" href="#yaml-configuration-files-in-a-nutshell"></a>3.1.1. YAML configuration files in a nutshell</h4>
<div class="paragraph">
<p>Before you start writing your own <code>tiger.yaml</code> configuration files, make sure you have worked with yaml files before and know its syntax and structure.<br>
If unsure take a <a href="https://dev.to/techworld_with_nana/yaml-tutorial-for-beginners-a06">20 minutes primer</a>, although not everything in the video is relevant, it gives a good introduction to indenting properties and structures and specifying values in a yaml file.</p>
</div>
</div>
<div class="sect3">
<h4 id="general-properties"><a class="anchor" href="#general-properties"></a>3.1.2. General properties</h4>
<div class="paragraph">
<p>The general properties apply to each node type.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. General properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">serverKey_xxx:
  # OPTIONAL hostname of this node when accessing it via the test suite
  # (rerouted via the local test suite Tiger Proxy).
  # Defaults to the server name (serverKey_xxx)
  # For docker compose and helm chart this property must NOT be set!
  hostname: string
  # MANDATORY one of [tigerProxy|docker|compose|externalJar|externalUrl]
  type: string
  # OPTIONAL name of a template to apply.
  # Default value is empty
  template: string
  # OPTIONAL comma separated list of keys of server nodes that must be started
  # before this node is set up.
  # Default value is empty
  dependsUpon: csv string
  # OPTIONAL duration in seconds to wait for a successful start-up of the server node
  # Default value is 20
  startupTimeoutSec: int
  # OPTIONAL duration in milliseconds to wait between polls for the server node to start up
  # Default value is the property "tiger.internal.externalServer.startupPollIntervalMs" which defaults to 1000
  startupPollIntervalMs: int
  # MANDATORY type specific property in that for some types it's a list,
  # for some others it's a single URL
  source:
    - source entry 1
    - source entry 2
  # used by all node types, for external URL this property is OPTIONAl and fallback is the source URL
  healthcheckUrl: string
  # OPTIONAL only declare the server healthy once the specified return code
  # is given
  healthcheckReturnCode: int
  # type specific property for Tiger Proxy and docker container nodes
  version: string
  # OPTIONAL the logs of the server are also written to a file, if no logFile is
  # specified a default name will be used (default is "./target/serverLogs/[key of server in tiger.yaml].log")
  logFile: ./target/serverLogs/serverKey_xxx.log

  # OPTIONAL list of pki certs and keys to initialize
  # the local Tiger Proxy of the test suite with
  # Default value is empty array
  # For more details see "PKI configuration" section below
  pkiKeys: []
  # OPTIONAL type specific list of environmental variable assignments to be used
  # when starting the server node.
  # Each entry has to have the format ENV_VAR_NAME=VALUE
  # Has NO EFFECT on external Url nodes.
  # Default value is empty array
  environment:
    - ENV_VAR1=VALUE1
    - ENV_VAR2=VALUE2
    - http://tsl --&gt; https://download-ref.tsl.ti-dienste.de
  # OPTIONAL list of routes to be added to the local Tiger Proxy of the test suite.
  # Default value is empty array
  urlMappings:
    - https://www.orf.at --&gt; https://eitzen.at
  # OPTIONAL list of system properties that will be provided to following nodes.
  # Each entry has to have the format system.property.name=VALUE
  # Default value is empty array
  exports:
    - systemProp1=Value1
    - systemProp2=Value2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a little example how the server names are set and used and how there server is reachable via the Tiger Proxy.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Example with three external jar servers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  # here the server name is "identityServer" and
  # the server is reachable under "identityServer" via the Tiger Proxy
  identityServer:
    type: externalJar
    source:
      - local:../octopus-identity-service/target/octopus-identity-service-1.0-SNAPSHOT.jar
    healthcheckUrl: http://localhost:${tiger.ports.identity}/status
    externalJarOptions:
      options:
        - -Dhttp.proxyHost=127.0.0.1
        - -Dhttp.proxyPort=${tiger.ports.proxyPort}
      arguments:
        - --server.port=${tiger.ports.identity}
        - --services.shopping=http://myShoppingServer

  # here the server name is "shoppingServer"
  # but the server is reachable under "myShoppingServer" via the Tiger Proxy because hostname is set
  shoppingServer:
    hostname: myShoppingServer
    type: externalJar
    source:
      - local:../octopus-shopping-service/target/octopus-shopping-service-1.0-SNAPSHOT.jar
    healthcheckUrl: http://localhost:${tiger.ports.shopping}/inventory/status
    externalJarOptions:
      options:
        - -Dhttp.proxyHost=127.0.0.1
        - -Dhttp.proxyPort=${tiger.ports.proxyPort}
      arguments:
        - --server.port = ${tiger.ports.shopping}
        - --services.identity=http://identityServer

  testClient:
    type: externalJar
    source:
      - local:../octopus-example-client/target/octopus-example-client-1.0-SNAPSHOT.jar
    healthcheckUrl: http://localhost:${tiger.ports.client}/testdriver/status
    externalJarOptions:
      options:
        - -Dhttp.proxyHost=127.0.0.1
        - -Dhttp.proxyPort=${tiger.ports.proxyPort}
      arguments:
        - --server.port=${tiger.ports.client}
        # here are the examples how the servers are reachable
        - --services.shopping=http://myShoppingServer
        - --services.identity=http://identityServer</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general properties are followed by the type specific substructures, which configure specific aspects of each node type.<br>
Their meaning and format are explained in the related section.</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Type specific properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  # type specific sub structure for external jar, Tiger Proxy, docker and helm chart nodes
  externalJarOptions:
    # used by external jar and Tiger Proxy nodes
    workingDir: string
    # only used by external jar nodes
    options: []
    # used by external jar and Tiger Proxy nodes
    arguments: []
    # flag whether to forward log output from external jar processes to the workflow UI
    activateWorkflowLogs : true
    # flag whether to forward log output from external jar processes to workflow UI and console
    activateLogs: true

  # type specific sub structure for Tiger Proxy nodes
  tigerProxyConfiguration:
    # Here a normal Tiger Proxy configuration can be used.
    # This is explained in more depth down below
    adminPort: int
    proxiedServer: string
    proxiedServerProtocol: [HTTP|HTTPS]
    proxyRoutes:
        # defines a forward-proxy-route from this server
      - from: http://foobar
        # to this server
        to: https://cryptic.backend/server/with/path

  # type specific sub structure for docker container and compose nodes
  dockerOptions:
    # all properties below only used by docker container nodes
    proxied: boolean
    oneShot: boolean
    entryPoint: string
  # type specific sub structure for helm charts
  helmChartOptions:
    # context to install the helm chart to
    context:
    # name for the helm chart
    podName:
    # working directory for local helm and kubectl calls
    workingDir:
    # name space to install the helm chart to
    nameSpace:
    # flag whether to show more detailed infos about
    # the helm chart installation in the console
    debug:
    # list of regex names for pods to be running to signal
    # successful startup of helm chart **/
    healthcheckPods:
    # list of key value pairs to be used by the helm chart
    values:
    # comma separated list of port forwardings
    # Entries can be either "podNameRegex:xxxx", which is shorthand for
    # "podNameRegex:xxxx:xxxx or
    # "podNameRegex:xxxx:yyyy" where xxxx is the local port
    # and yyyy is the port in the pod
    exposedPorts:
    # list of regex for pod names logs should be shown
    logPods:</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the Tiger Proxy is explained in detail in the section <a href="#_configuring_the_local_test_suite_tiger_proxy">Configuring the local test suite Tiger Proxy</a></p>
</div>
</div>
<div class="sect3">
<h4 id="pki-configuration-in-pkikeys"><a class="anchor" href="#pki-configuration-in-pkikeys"></a>3.1.3. PKI configuration in pkiKeys</h4>
<div class="paragraph">
<p>The pkiKeys property contains a list of certificates and keys to be provided to the local Tiger Proxy of the test suite.<br>
Each entry has to provide a unique id, type and pem property.</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. PKI configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  pkiKeys:
      # MANDATORY unique key/certificate id
    - id: disc_sig
      # MANDATORY one of [Certificate|Key]
      type: Certificate
      # MANDATORY base64 encoded multiline string representing the certificate / key.
      pem: "MIICsTCCAligAwIBAgIHA61I5ACUjTAKBggqhkjOPQQDAjCBhDELMAkGA1UEBhMC
  REUxHzAdBgNVBAoMFmdlbWF0aWsgR21iSCBOT1QtVkFMSUQxMjAwBgNVBAsMKUtv
  .....
  xiKK4dW1R7MD334OpOPTFjeEhIVV"
    - id: disc_enc
      type: Key
      pem: "ISUADOGBESBXEZOBXWEDHBXOU..."</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-pki-identities-in-tiger-proxys-tls-section"><a class="anchor" href="#configuring-pki-identities-in-tiger-proxys-tls-section"></a>3.1.4. Configuring PKI identities in Tiger Proxy&#8217;s tls section</h4>
<div class="paragraph">
<p>PKI identities can be supplied in a number of ways (JKS, BKS, PKCS1, PKCS8).<br>
In every place a string can be given.<br>
It could be one of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"my/file/name.p12;p12password"</p>
</li>
<li>
<p>"p12password;my/file/name.p12"</p>
</li>
<li>
<p>"cert.pem;key.pkcs8"</p>
</li>
<li>
<p>"rsaCert.pem;rsaKey.pkcs1"</p>
</li>
<li>
<p>"key/store.jks;key"</p>
</li>
<li>
<p>"key/store.jks;key1;key2"</p>
</li>
<li>
<p>"key/store.jks;jks;key"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not supported pathname strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"D:\\myproject\\key\\store.jks;key"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supported pathname string on all platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"myproject/key/store.jks;key"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please notice, that double backslashes ("\\") are not supported as file separators, since they are not accepted on all platforms.<br>
Invalid pathname strings will also produce an exception.</p>
</div>
<div class="paragraph">
<p>Each part can be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>filename</p>
</li>
<li>
<p>password</p>
</li>
<li>
<p>store-type (accepted are P12, PKCS12, JKS, BKS, PKCS1 and PKCS8)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want, you can also describe the components in a map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tls.forwardMutualTlsIdentity:
  filename: myIdentity.p12
  password: "changeit"
  storeType: P12</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case both the storeType and the password are not mandatory and would be guessed (the store-type via the file extension and the password via a default-list).</p>
</div>
<div class="sect4">
<h5 id="pki-identity-passwords"><a class="anchor" href="#pki-identity-passwords"></a>PKI identity passwords</h5>
<div class="paragraph">
<p>Tiger will attempt to decrypt a given P12 file with a list of common passwords, among these are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"00", "123456", "gematik", "changeit"</pre>
</div>
</div>
<div class="paragraph">
<p>Users can insert additional passwords by configuring the <code>tiger.yaml</code> as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre>lib:
    additionalKeyStorePasswords: ["foo", "bar", "baz"]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-container-node"><a class="anchor" href="#docker-container-node"></a>3.1.5. Docker Container node</h4>
<div class="paragraph">
<p>The docker container node allows to instantiate a local docker container from the configured image.<br>
The exposed port of the docker container is available as a special token in the substitution process of the exports entries (<code>${PORT:xxxx}</code> where xxxx is the port being exposed inside the container).</p>
</div>
<div class="paragraph">
<p>To customize the docker container you may alter the entry point command line.<br>
Additionally, Tiger will automatically add the Tiger Proxy certificate to the container&#8217;s operating system list of trusted certificates.<br>
This modification can be disabled by setting the property <code>dockerOptions.proxied</code> to false.<br>
E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  exampleDockerServer:
    type: docker
    dockerOptions:
        proxied: false # default is true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For containers that should exit after a single command you may enable the oneShot property.</p>
</div>
<div class="paragraph">
<p>You can also copy files to the container by configuring the source and destinations paths of files or folder to be copied.</p>
</div>
<div class="paragraph">
<p>If there is no health check configured inside the docker image, Tiger will try to guess a healthcheck url by assuming the first exposed port as a get request to localhost to check for a successful startup of the docker container (e.g. <a href="http://127.0.0.1:xxxx" class="bare">http://127.0.0.1:xxxx</a>).</p>
</div>
<div class="paragraph">
<p>If no port is exposed at all, the startupTimeoutSec property will determine the wait period, after which Tiger assumes the container is up and running.</p>
</div>
<div class="paragraph">
<p>If you have your local docker environment set up hosting the docker containers on a remote docker hub server, you may set the environment variable <code>TIGER_DOCKER_HOST</code> to allow the health check url determined on runtime to point to the remote host instead of localhost.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use this server type you must include the tiger-cloud-extension dependency!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 8. Docker container configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">dockerContainer_001:
  hostname: myDockerContainer
  type: docker
  dependsUpon: csv string
  startupTimeoutSec: int

  # MANDATORY URL from where to download the docker image.
  source:
    - dockerhubrepo.somewhere.org/repo/project/docker.image
  # OPTIONAL version of the docker image to download.
  version: 0.1.2
  # OPTIONAL the logs of the docker container are also written to a file, if no logFile is
  # specified a default name will be used
  logFile: ./target/serverLogs/dockerContainer_001.log

  dockerOptions:
    # OPTIONAL Flag whether the container shall be modified by
    # o adding the Tiger Proxy certificate to the container operating system.
    # o adding docker.host.internal to the container's /etc/hosts file.
    # Default value is true.
    proxied: true
    # OPTIONAL Flag whether the container is a one shot container or not.
    # One shot meaning it will execute a command and then stop.
    # Default value is false.
    oneShot: false
    # OPTIONAL The entry point command line to be used to start up this container
    # overwriting any configured entry point in the docker image.
    # Default value is empty meaning to use the configured entry point command line.
    entryPoint: chmod a+x /startup.sh &amp;&amp; /startup.sh
    # OPTIONAL list of files to be copied to the container
    copyFiles:
      # path to the file or the folder to copy inside the container
      - sourcePath: ./example/path/file_to_copy.txt
      # path inside the container where the file should be copied to
        destinationPath: /path/in/container/file_to_copy.txt
      # OPTIONAL the file mode of the copied file as octal representation (see https://en.wikipedia.org/wiki/File-system_permissions#numericNotation
        fileMode: 0633
      # a complete folder can also be copied instead of a single file
      - sourcePath: ./example/copy_folder
        destinationPath: /path/in/container/copy_folder


  # The following properties are explained in the General properties section above
  pkiKeys: []
  environment: []
  urlMappings: []
  exports: []</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-compose-node"><a class="anchor" href="#docker-compose-node"></a>3.1.6. Docker Compose node</h4>
<div class="paragraph">
<p>The docker compose node is a very tricky type of node because we use testcontainer library, which is not exactly up to date in terms of docker compose support.<br>
So many of the yaml compose files will need to be modified to work with the testcontainer library.</p>
</div>
<div class="paragraph">
<p>For now, we support the ePA2 FD module and the DEMIS Meldeportal.</p>
</div>
<div class="paragraph">
<p>If you want to use your own compose files, please note that Tiger copies and processes your yml files to the target/tiger-testenv-mgr/${serverId} folder, replacing all variable/property expressions (for details check <a href="#_tiger_configuration">this chapter</a>).</p>
</div>
<div class="paragraph">
<p>The processing/copying flattens the file hierarchy, thus you must not depend on any additional file resources in your docker compose files.<br>
Each copied compose file will have a random UUID appended to its filename.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use this server type you must include the tiger-cloud-extension dependency!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 9. Docker compose configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  type: compose
  dependsUpon: csv string
  startupTimeoutSec: int
  # OPTIONAL the logs of the docker compose are also written to a file, if no logFile is
  # specified a default name will be used
  logFile: ./target/serverLogs/dockerCompose.log

  # MANDATORY list of yaml files to use to start up the services.
  # The entries can either be file paths or if starts with
  # classpath:....  a reference to a yaml file contained in the class path
  # (it could also be located inside a jar that is in the class path)
  source:
    - classpath:/de/gematik/test/tiger/testenvmgr/epa/titus-epa2.yml
    - classpath:/de/gematik/test/tiger/testenvmgr/epa/titus-epa2-local.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 10. Demis docker compose example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">demis_001:
  type: compose
  source:
    - classpath:/de/gematik/test/tiger/testenvmgr/demis/demis_localhost.yml
  startupTimeoutSec: 180</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="external-jar-node"><a class="anchor" href="#external-jar-node"></a>3.1.7. External Jar node</h4>
<div class="paragraph">
<p>The External Jar node is along with the Docker container node the most important/used node for test environments.<br>
Any Jar archive executable which can be started with the <code>java -jar</code> command can be configured as an external Jar node.</p>
</div>
<div class="paragraph">
<p>The options list are arguments added immediately after the java executable, while the arguments list is appended after the -jar argument.</p>
</div>
<div class="paragraph">
<p>The working directory is the place where the jar file is downloaded to and executed from.<br>
So if your jar archive expects some configuration files make sure to choose the folder appropriately.</p>
</div>
<div class="paragraph">
<p>If using the <code>local:</code> prefix you can also use wildcards to find any matching jar-files.<br>
Tiger will use the following order to try to find a matching file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the working directory a file with the filename contained in the source</p>
</li>
<li>
<p>From the working directory a file with a relative path equal to the source</p>
</li>
<li>
<p>In the working directory a file with a filename matching the source (eg. <code>app-*.jar</code>)</p>
</li>
<li>
<p>From the working directory a file with a relative path equal and matching the filename of the source (eg. <code>../target/app-*.jar</code>)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">java ${options} -jar externalJar.jar ${arguments}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 11. External jar configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">externalJar_001:
  hostname: mySpecialJar
  type: externalJar
  dependsUpon: csv string
  startupTimeoutSec: int

  # MANDATORY SINGLE ENTRY URL from where to download the Jar archive.
  # If the entry starts with "local:" followed by a file path the jar archive
  # is expected to be available at that location and no download is performed.
  # Only one entry is expected for this node type. Additional entries are silently ignored.
  source:
    - http://myjars.download.org/myproject/myjar.jar
  # MANDATORY URL to check for the successful startup of this node.
  # A successful start is indicated by ANY answer on this URL.
  # Any status is accepted as long as there is an answer.
  # If set to "NONE" no check is performed and
  # the test environment manager will wait for the startup timeout.
  healthcheckUrl: http://127.0.0.1:8080
  # OPTIONAL only declare the server healthy once the specified return code
  # is given
  healthcheckReturnCode: int
  # OPTIONAL the logs of the externalJar are also written to a file, if no logFile is
  # specified a default name will be used
  logFile: ./target/serverLogs/externalJar_001.log

  externalJarOptions:
    # OPTIONAL folder from where to start the external jar.
    # The downloaded jar file will be stored and executed from here
    # The default value is empty, which means that the operating-system-specific
    # temporary folder will be used.
    # hint: when the jar file is taken from a local directory and is set in source
    # and the workingDir is set then the workingDir has to be the directory where
    # the jar file is located
    workingDir: /home/user/test/myspecificjar
    # OPTIONAL Options to pass in to the java executable call.
    options: []
    # OPTIONAL provide additional arguments to the jar archive call.
    # Default value is empty.
    arguments:
      - --testarg1
      - -singledasharg2
      - --paramarg3=testvalue1

  # The following properties are explained in the General properties section above
  pkiKeys: []
  environment: []
  urlMappings: []
  exports: []</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the JVM used to start the JAR-File is the taken from the <code>java.home</code> system property, thus using the same JVM with which Tiger was started.<br>
To change the JVM used you can set the property <code>tiger.lib.javaHome</code> (e.g. by setting <code>-Dtiger.lib.javaHome</code>, by setting <code>TIGER_LIB_JAVAHOME</code> in the environment or by setting <code>lib.javaHome</code> in the <code>tiger.yaml</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="external-url-node"><a class="anchor" href="#external-url-node"></a>3.1.8. External URL node</h4>
<div class="paragraph">
<p>The symbolic node type that will not start a server instance, but simply allows external services to be used via the configured hostname.<br>
This is achieved by the test environment manager instructing the local Tiger Proxy to provide a route for the symbolic hostname to the external URL of the service.</p>
</div>
<div class="paragraph">
<p>So, in the following example, the test suite can send HTTP(S) requests to the server "http://myExternalServer" via the local Tiger Proxy, which will be rerouted to the external URL "https://www.medizin.de".<br>
If it is ever necessary to change the external URL, the test suite does not have to be modified, only the routing configuration for the node has to be changed.</p>
</div>
<div class="paragraph">
<p>Given the nature of this type, the environment section has no effect and is not to be used.</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. External URL configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">externalUrl_001:
  hostname: myExternalServer
  type: externalUrl
  dependsUpon: csv string
  startupTimeoutSec: int

  # MANDATORY URL of the external server
  source:
    - https://www.medizin.de

  # OPTIONAL URL to check for successful startup of this node.
  # A successful start is indicated by ANY answer on this URL.
  # Any status is accepted as long as there is an answer.
  # If the value is not set, then no health check is carried out
  # in the startup phase, instead the startupTimeout is waited for.
  # After this timeout it is assumed that the server is up.
  healthcheckUrl: https://www.medizin.de/healthyState.jsp
  # OPTIONAL only declare the server healthy once the specified return code
  # is given
  healthcheckReturnCode: int
  # OPTIONAL the logs of the externalUrl are also written to a file, if no logFile is
  # specified a default name will be used
  logFile: ./target/serverLogs/externalUrl_001.log

  # The following properties are explained in the General properties section above
  pkiKeys: []
  # IGNORE for this type as it has no effect
  environment: []
  urlMappings: []
  exports: []</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="helm-chart-node"><a class="anchor" href="#helm-chart-node"></a>3.1.9. Helm Chart node</h4>
<div class="paragraph">
<p>The helm chart node allows to start a helm chart from the configured source (local helm chart file / folder or remote helm chart).<br>
The helm chart is started and the server is ready when all pods are up and running, if port-forward is used (if exposedPorts are set), then port-forwarding is also done and the startup is finished and the service can be used for testing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use this server type you must include the tiger-cloud-extension dependency!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 13. Helm chart configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  testHelmChart_Nginx:
    type: helmChart
    startupTimeoutSec: 50
    # MANDATORY repository from where to download the docker image
    # if the helm chart is stored on the local file system that the
    # workingDir should be set.
    source:
      - bitnami/nginx
    # OPTIONAL version of the image
    version: 1.1.0
    helmChartOptions:
      # The kubernetes context
      context:
      # OPTIONAL if no working directory is set the default . is used.
      # if the helm chart is stored on the local file system the workingDir
      # should be set.
      workingdir:
      # OPTIONAL prints out debug messages if set to true, default is false.
      debug: true
      # OPTIONAL override the POD_NAMESPACE environment variable if set.
      # if not set, "default" will be used.
      nameSpace: buildslaves
      # MANDATORY pod name of the helm chart
      podName: test-tiger-nginx
      # OPTIONAL key-value pairs that will be used for starting the helm chart
      values:
      # OPTIONAL should contain a list of pods for the health check, regex can be used.
      healthcheckPods:
        - test-tiger-nginx-.*
      # OPTIONAL contains a list of regex to identify the pods whose logs
      # should be forwarded to the console and Tiger Workflow UI.
      logPods:
        - test-tiger-nginx.*
      # OPTIONAL contains a list that will be used for the port forwarding,
      # if empty no port forwarding is done. The syntax is:
      # &lt;POD_NAME_OR_REGEX&gt;,&lt;LOCAL_PORT&gt;:&lt;FORWARDING_PORT&gt;[,&lt;LOCAL_PORT&gt;:&lt;FORWARDING_PORT&gt;]*
      exposedPorts:
        - test-tiger-nginx.*,8080:80</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tiger-proxy-node"><a class="anchor" href="#tiger-proxy-node"></a>3.1.10. Tiger Proxy node</h4>
<div class="paragraph">
<p>The most complex and versatile node type.<br>
The Tiger Proxy will be started as an embedded spring boot application.<br>
This way the start-up time can be minimized, and it is always guaranteed to start the current version.</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Tiger Proxy configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy_001:
  hostname: myTigerProxy
  type: tigerProxy
  dependsUpon: csv string
  startupTimeoutSec: int

  tigerProxyConfiguration:
    # OPTIONAL port of the web user interface and the proxy management
    # (e.g. rbel-message forwarding)
    # Default value is empty, which means a random port will be used.
    # The chosen port is stored with the key tiger.internal.localproxy.admin.port in
    # the TigerGlobalConfiguration
    adminPort: 8080
    # OPTIONAL server name of the node this proxy shall be used as reverse proxy for.
    # If set the routes will be configured appropriately.
    # Default value is empty.
    proxiedServer: externalJar_001
    # OPTIONAL port of the proxy, where the proxy expects to receive proxy requests
    # Default value is empty, which means a random port will be used.
    proxyPort: 3128
    # OPTIONAL protocol the proxy is expecting requests in. One of [http|https]
    # Default value is http
    proxiedServerProtocol: http
    # configures the proxy itself. For more details
    # please check the chapter about the local test suite Tiger Proxy below
    ...
    proxyRoutes:
      - from: http://foobar
        # defines a forward-proxy-route from this server...
        to: https://cryptic.backend/server/with/path
        # to this server
    ...

  # The following properties are explained in the General properties section above
  pkiKeys: []
  environment: []
  urlMappings: []
  exports: []</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the Tiger Proxy is explained in detail in the section <a href="#_configuring_the_local_test_suite_tiger_proxy">Configuring the local test suite Tiger Proxy</a></p>
</div>
</div>
<div class="sect3">
<h4 id="httpbin-node"><a class="anchor" href="#httpbin-node"></a>3.1.11. httpbin node</h4>
<div class="paragraph">
<p>The httpbin simply starts a <a href="https://github.com/gaul/java-httpbin">httpbin</a> server.<br>
This provides several endpoints against which you can perform all kinds of http requests.<br>
The server port on which the server starts can be configured.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. httpbin configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">httpbin:
    type: httpbin
    serverPort: ${free.port.0}
    healthcheckUrl: http://localhost:${free.port.0}/status/200</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="provided-node-templates"><a class="anchor" href="#provided-node-templates"></a>3.2. Provided node templates</h3>
<div class="paragraph">
<p>Besides these basic nodes we also support tailored templates for nodes like IDP, ePA, ERp and DEMIS.<br>
This should allow you to bring up project specific test environments very fast.</p>
</div>
<div class="paragraph">
<p>All currently supported templates can be found in the tiger-testenv-mgr modul in the yaml file at /src/main/resources/de/gematik/test/tiger/testenvmgr/templates.yaml</p>
</div>
<div class="paragraph">
<p>To use such a template, just use the template attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myPersonalTestIDPInTheRU:
  template: idp-rise-ru</code></pre>
</div>
</div>
<div class="paragraph">
<p>or if you want to have an environment with a local reference implementation of the ERezept Fachdienst</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myLocalTestIDP:
  template: idp-ref
  hostname: idp

myLocalTestERp:
  template: erzpt-fd-ref
  dependsUpon: myLocalTestIDP</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="local-idp-reference-nodes"><a class="anchor" href="#local-idp-reference-nodes"></a>3.2.1. Local IDP reference nodes</h4>
<div class="paragraph">
<p>This template provides the reference implementation of the IDP server as a local docker container.<br>
The docker image is loaded from a gematik internal docker registry server.</p>
</div>
<div class="paragraph">
<p>The system property IDP_SERVER is set to the URL of the Discovery Document end point and is available for all subsequently initiated test environment nodes.</p>
</div>
</div>
<div class="sect3">
<h4 id="external-idp-rise-instance-nodes"><a class="anchor" href="#external-idp-rise-instance-nodes"></a>3.2.2. External IDP RISE instance nodes</h4>
<div class="paragraph">
<p>The idp-rise-ru template provides the RU instance of RISE&#8217;s IDP server as an "external URL".<br>
The system properties IDP_SERVER and GEMATIK_TESTCONFIG are set to the URL of the Discovery Document end point and a config-file for the IDP test suite respectively.<br>
They are available for all subsequently initiated test environment nodes.</p>
</div>
<div class="paragraph">
<p>The idp-rise-tu template provides the TU instance accordingly.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-erp-reference-nodes"><a class="anchor" href="#local-erp-reference-nodes"></a>3.2.3. Local ERp reference nodes</h4>
<div class="paragraph">
<p>This template provides the reference implementation of the eRezept server as a local docker container.<br>
The docker image is loaded from a gematik internal docker registry server.<br>
Make sure that an IDP server node is instantiated before the ERp FD is started and that it is available under <a href="http://idp" class="bare">http://idp</a> or adapt the environment variable configuration.</p>
</div>
<div class="paragraph">
<p>A large list of environment variables is set.<br>
But don&#8217;t worry, it is just the server that uses them.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-epa2-reference-nodes"><a class="anchor" href="#local-epa2-reference-nodes"></a>3.2.4. Local ePA2 reference nodes</h4>
<div class="paragraph">
<p>This template provides the gematik reference Aktensystem simulation as docker compose.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-pssim-node"><a class="anchor" href="#local-pssim-node"></a>3.2.5. Local PSSim node</h4>
<div class="paragraph">
<p>This template provides a Primärsystem simulation (as a jar), usable for ePA.<br>
See <a href="https://wiki.gematik.de/display/PTP/epa-ps" class="bare">https://wiki.gematik.de/display/PTP/epa-ps</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-konsim-node"><a class="anchor" href="#local-konsim-node"></a>3.2.6. Local KonSim node</h4>
<div class="paragraph">
<p>This template provides a Konnektor simulation (as external jar).<br>
See <a href="https://wiki.gematik.de/display/PTP/KonSim" class="bare">https://wiki.gematik.de/display/PTP/KonSim</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-epa-fdv-sim"><a class="anchor" href="#local-epa-fdv-sim"></a>3.2.7. Local ePA FdV Sim</h4>
<div class="paragraph">
<p>This template provides FdV simulation, usable for ePA.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-demis-reference-nodes"><a class="anchor" href="#local-demis-reference-nodes"></a>3.2.8. Local DEMIS reference nodes</h4>
<div class="paragraph">
<p>This template provides the DEMIS Meldeportal as local docker compose.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_local_test_suite_tiger_proxy"><a class="anchor" href="#_configuring_the_local_test_suite_tiger_proxy"></a>3.3. Configuring the local test suite Tiger Proxy</h3>
<div class="paragraph">
<p>The local Tiger Proxy for the test suite can be configured by using the following section(s) in the <code>tiger.yaml</code> file.<br>
For more information about what the Tiger Proxy is and how it works see the chapter <a href="#_tiger_proxy_basics">Tiger Proxy basics</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># Flag whether to activate the local Tiger Proxy. The local tiger proxy field will be null if this property is set to false
# Default value is true
localProxyActive: true

# Specifiy additional yaml-files to read in during startup
additionalConfigurationFiles:
  -
    # the path to the file to read
    filename: specialEnvironment.yaml
    # the key to which to map the given file. "tiger" is the base-key for the tiger.yaml-file
    baseKey: tiger

# the block where all the Tiger Proxy configuration properties are located
tigerProxy:
  # the port under which the server will be booted
  adminPort: 7777
  # logLevel of the proxy-server. DEBUG and TRACE will print traffic, so use with care!
  proxyLogLevel: TRACE
  # section to configure whether and where the proxy should dump
  # a traffic HTML report on shutdown
  fileSaveInfo:
    # should the cleartext http-traffic be logged to a file?
    writeToFile: true
    # configure the file name
    filename: "foobar.tgr"
    # default false
    clearFileOnBoot: true
    # read traffic from a file at startup
    sourceFile: "sourceFile.tgr"
    # filter messages read from file (JEXL expression)
    readFilter: "message.statusCode == '200'"
    # List of notes that should be added to the traffic
    notes:
        # The message to be added as a note
      - message: "This is a note on the HTTP method"
        # Only add this note to elements that EXACTLY match the given JEXL expression.
        # This will be checked for every message and every node in every message.
        jexlCriterion: "isRequest &amp;&amp; path == '$.method'"
      - message: "Hackers were here..."
        jexlCriterion: "element.decryptedUsingKeyWithId == 'mySuperSecretKey'"

  # a list of routing entries the proxy should apply to traffic
  proxyRoutes:
      # defines a forward-proxy-route from this server...
    - from: http://foobar
      # to this server
      to: https://cryptic.backend/server/with/path
      # reverse proxy-route. http://&lt;tiger-proxy&gt;/blub will be forwarded
    - from: "/blub"
      to: "https://another.de/server"
      # the traffic for this route will NOT be logged (default is false)
      disableRbelLogging: true
      hosts:
        - "www.google.com"
        - "www.bing.com"
      # For reverse proxy-routes this allows to differentiate requests based on the host-header. This is useful when the DNS-resolvement of the client can be influenced, but not the ports used.

  # a list of modifications that will be applied to every proxied request and response
  modifications:
    # a condition that needs to be fulfilled for the modification to be applied
    # (uses JEXL grammar)
  - condition: "isRequest"
    # which element should be targeted?
    targetElement: "$.header.user-agent"
    # the replacement string to be filled in.
    # This modification will replace the entire "user-agent" in all requests
    replaceWith: "modified user-agent"

  - condition: "isResponse &amp;&amp; $.responseCode == 200"
    targetElement: "$.body"
    # The name of this modification.
    # This can be used to identify, alter or remove this modification.
    name: "body replacement modification"
    # This will replace the body of every 200 response completely with the given json-string
    # (This ignores the existing body. For example this could be an XML-body.
    # Content-Type-headers will NOT be set accordingly).
    replaceWith: "{\"another\":{\"node\":{\"path\":\"correctValue\"}}}"
  - targetElement: "$.body"
    # The given regex will be used to target only parts of targeted element.
    regexFilter: "ErrorSeverityType:((Error)|(Warning))"
    # This modification has no condition,
    # so it will be applied to every request and every response
    replaceWith: "ErrorSeverityType:Error"

  # can be used if the target-server (to) is behind another proxy
  forwardToProxy:
    hostname: 192.168.110.10
    port: 3128
    type: HTTP
    noProxyHosts:
      - "localhost"
  # The Tiger Proxy will route google.com to google.com even if no route is set.
  # The traffic routed via this "forwardAll"-routing will be logged by default
  # (meaning it will show up in the Rbel-Logs and be forwarded to tracing-clients)
  # This can be deactivated by setting this flag to false
  activateForwardAllLogging: true
  # Limits the rbel-Buffer to approximately this size.
  # Note: When Rbel debugging is activated the size WILL vastly exceed this limit!
  rbelBufferSizeInMb: 1024
  # If set to false disables traffic-analysis by Rbel.
  # Deactivating will not impede proxy-forwarding nor
  # the traffic-endpoints.
  activateRbelParsing: true
  # While parsing the Tiger Proxy can block the communication from completing.
  # The end answer from the Tiger Proxy is only transmitted when parsing is completed
  # (and the message pair can be seen in the log). When 'false' the parsing is done
  # asynchronous.
  # Default is true ONLY for the local Tiger Proxy, otherwise default is false!!
  parsingShouldBlockCommunication: false
  # This will share the WebUI-Resources (various CSS-files) from the Tiger Proxy
  # locally, thus enabling usage when no internet connection exists
  localResources: true
  # When active the host-headers are rewritten even for a reverse-proxy-route
  rewriteHostHeader: true
  # This option can be used to deactivate TLS-Termination. Only deactivate this in
  # conjunction with a directReverseProxy
  activateTlsTermination: true

  tls:
    # Can be used to define a CA-Identity to be used with TLS. The Tiger Proxy will
    # generate an identity when queried by a client that matches the configured route.
    # If the client then in turn trusts the CA this solution will provide you with a seamless
    # TLS experience. It however requires access to the private-key of a trusted CA.
    serverRootCa: "certificate.pem;privateKey.pem;PKCS8"
    # Alternative solution: now all incoming TLS-traffic will be handled using this identity.
    # This might be easier but requires a certificate
    # which is valid for the configured routes
    serverIdentity: "certificateAndKeyAndChain.p12;Password"
    # Defines which SSL-Suites are allowed. This will delete all default-suites and only add the one
    # defined here. This configures the server-side of the proxy. Available values can be found here:
    # https://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html
    serverSslSuites:
      - "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA"
    # This configures the SSL-Suites for the client-side. Available values can be found here:
    # https://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html
    clientSslSuites:
      - "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA"
    # Define which TLS protocols the server will allow/use. Available values can be found here:
    # https://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html
    clientSupportedGroups:
      - "brainpoolP256r1"
      - "brainpoolP384r1"
      - "prime256v1"
      - "secp384r1"
    # Define the groups to be offered in the "client hello" message. More information can be found here:
    # https://datatracker.ietf.org/doc/html/rfc8446#section-4.2.7
    serverTlsProtocols:
      - "TLSv1.2"

    # This identity will be used as a client-identity for mutual-TLS when forwarding to
    # other servers. The information string can be
    # "my/file/name.p12;p12password" or
    # "p12password;my/file/name.p12" or
    # "cert.pem;key.pkcs8" or
    # "rsaCert.pem;rsaKey.pkcs1" or
    # "key/store.jks;key" or
    # "key/store.jks;key1;key2" or
    # "key/store.jks;jks;key"
    #
    # Each part can be one of:
    # * filename
    # * password
    # * store-type (accepted are P12, PKCS12, JKS, BKS, PKCS1 and PKCS8)
    forwardMutualTlsIdentity: "directory/where/another/identityResides.jks;changeit;JKS"
    # domain which will be used as the server address in the TLS-certificate
    domainName: deep.url.of.server.de
    # Alternate names to be added to the TLS-certificate
    # (localhost and 127.0.0.1 are added by default)
    alternativeNames:
      - localhost
      - 63.54.54.43
      - foo.bar.server.com
    # the file into which the master-secrets are written. For this to work
    # the tiger-java-agent has to be attached to the JVM
    # (eg. -javaagent:tiger-java-agent-3.1.4.jar). This can be done by
    # executing the goal 'attach-tiger-agent' to the tiger-maven-plugin.
    masterSecretsFile: "masterSecretsFile.txt"

  # the given folders are loaded into RBel for analysis. This is only necessary to decrypt
  # traffic when analyzing it. It has no effect on the proxy-functions themselves.
  keyFolders:
  - .

  # Filter out any messages larger from parsing (saving performance)
  skipParsingWhenMessageLargerThanKb: 8000
  # Filter out any messages (or message parts) from displaying
  skipDisplayWhenMessageLargerThanKb: 512

  # A list of upstream Tiger Proxies. This proxy will try to connect to all given sources to
  # gather traffic via the STOMP-protocol. If any of the given endpoints are not accessible
  # the server will not boot. (fail fast, fail early)
  trafficEndpoints:
    - http://another.tiger.proxy:&lt;proxyPort&gt;
  trafficEndpointConfiguration:
    # the name for the traffic Endpoint. can be any string, which will be
    # displayed at /tracingpoints
    name: "tigerProxy Tracing Point"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="standalone-mode-vs-implicit-startup-with-test-suite"><a class="anchor" href="#standalone-mode-vs-implicit-startup-with-test-suite"></a>3.4. Standalone mode vs. implicit startup with test suite</h3>
<div class="paragraph">
<p>If your test environment is very "expensive" to start or if you are developing your test suite scenarios thus starting many test runs in short time, you might want to keep your test environment running and not shut it down after each run.<br>
To do so, you can simply use the tiger maven plugin to start your test environment in standalone mode.</p>
</div>
<div class="paragraph">
<p>First prepare a standalone test environment configuration file (call it for example tiger-standalone.yaml) containing all the server nodes needed and with a deactivated the local Tiger Proxy section.</p>
</div>
<div class="paragraph">
<p>Now set the env var TIGER_TESTENV_CFGFILE or the Java system property tiger.testenv.cfgfile to point to this file.</p>
</div>
<div class="paragraph">
<p>And add the plugin block to your pom.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">           &lt;plugin&gt;
                &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
                &lt;artifactId&gt;tiger-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${version.tiger}&lt;/version&gt;
            &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you start the test environment manager standalone, it will keep the nodes running until you enter quit into the console or kill the process with Ctrl + C or the operating equivalent commando to the UNIX command kill ${PROCESS_ID}.<br>
In the latter case it is not guaranteed that all processes are cleanly shut down.<br>
Please check your process list with operating system specific tools.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">export TIGER_TESTENV_CFGFILE=....../tiger-standalone.yaml
mvn tiger:setup-testenv</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you also need cloud extension server types (docker, helmchart) make sure to add the Tiger cloud extensions as dependency to the <strong>plugin block</strong>.</p>
</div>
<div class="paragraph">
<p>Now before starting your test suite scenarios you need to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>disable / remove the test nodes in your default <code>tiger.yaml</code> (either by setting the property active to false or remove the server node entry completely).<br>
If you forget to do this, two nodes will be instantiated (one from the standalone test environment manager and the second during test run from the test environment manager started via the test suite hooks).</p>
</li>
<li>
<p>and add routes for each node to the local Tiger Proxy.<br>
If you forget to do this, your test suite will not be able to access the test nodes under their configured hostname as this configuration is only known to the standalone test environment manager and NOT to the local tiger proxy started by the test suite hooks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Best practice is to have three test environment configuration files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tiger-standalone.yaml to enable a persistent test environment during the development of test suite scenarios</p>
</li>
<li>
<p>tiger-nonodes.yaml for the test suite that will instantiate no nodes but only configure the routes to the nodes from the standalone test environment manager</p>
</li>
<li>
<p><code>tiger.yaml</code> a complete configuration that can be used in CI or after the test suite development is completed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first and the latter most of the time are identical besides the root level flag localProxyActive.<br>
So you may skip the first and just use it with two different values being set.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-environment-variables-and-system-properties"><a class="anchor" href="#using-environment-variables-and-system-properties"></a>3.5. Using Environment variables and system properties</h3>
<div class="sect3">
<h4 id="tokenvariable-substitution"><a class="anchor" href="#tokenvariable-substitution"></a>3.5.1. Token/variable substitution</h4>
<div class="paragraph">
<p>Entries in the exports list of a node will be parsed and specific tokens will be substituted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${PORT:xxxx} will be replaced with the port on the docker host interface</p>
</li>
<li>
<p>${NAME} will be replaced with the hostname of the node</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All exports entries of a node will be present when subsequent nodesare instantiated and can be used in the following properties:</p>
</div>
<div class="paragraph">
<p>Docker node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>source list</p>
</li>
<li>
<p>environment list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tiger Proxy node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from/to route URLs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>External URL node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>source list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>External Jar node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>options list</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiger-proxy-2"><a class="anchor" href="#tiger-proxy-2"></a>4. Tiger Proxy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="excurse-what-are-proxies-reverse-forward"><a class="anchor" href="#excurse-what-are-proxies-reverse-forward"></a>4.1. Excurse: What are proxies, reverse, forward</h3>
<div class="paragraph">
<p>There are a lot of different kind of proxies.<br>
Here we talk only about HTTP and HTTPS proxies!</p>
</div>
<div class="sect3">
<h4 id="forward-proxies"><a class="anchor" href="#forward-proxies"></a>4.1.1. Forward proxies</h4>
<div class="paragraph">
<p>Forward proxies work like a switch-station: You send a packet to your destination, via proxy.<br>
The proxy receives the packet, sees the address and can send that packet to wherever he sees fit.<br>
To use a forward proxy the sender has to be aware of it and send the packet accordingly.</p>
</div>
<div class="paragraph">
<p>This allows the creation of virtual domains, something we use extensively in tiger.</p>
</div>
<div class="paragraph">
<p>A forward proxy can always read the entire content of your communication, something we also use heavily.</p>
</div>
<div class="paragraph">
<p>Lastly a forward proxy acts as a man-in-the-middle, enabling the penetration of TLS-traffic.<br>
We also use this, but we will explain it in more depth later.</p>
</div>
</div>
<div class="sect3">
<h4 id="reverse-proxies"><a class="anchor" href="#reverse-proxies"></a>4.1.2. Reverse proxies</h4>
<div class="paragraph">
<p>Reverse proxies also receive traffic and may reroute them at their own discretion.<br>
But unlike a forward proxy a reverse proxy is invisible to the sender.<br>
Reverse proxies act like normal servers and are addressed as such.<br>
They then send the received packet to its actual destination and return the answer to the original caller.</p>
</div>
<div class="paragraph">
<p>The reverse proxy can also read the complete traffic.</p>
</div>
<div class="paragraph">
<p>The eventual destination is opaque to the original caller.<br>
This also enables path-rewriting (for example the GET <a href="http://reverse.proxy.de/my/deep/url" class="bare">http://reverse.proxy.de/my/deep/url</a> might be mapped to <a href="http://gematik.de/deep/url" class="bare">http://gematik.de/deep/url</a>, eliminating the /my)</p>
</div>
<div class="paragraph">
<p>A reverse proxy also terminates https, always.<br>
This is less of a problem with a reverse proxy since it is technically not a man-in-the-middle attack, due to the traffic being addressed to the reverse proxy.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tiger-proxy-basics"><a class="anchor" href="#tiger-proxy-basics"></a>4.2. Tiger Proxy basics</h3>
<div class="paragraph">
<p>The Tiger Proxy is a proxy-server.<br>
It comes in two flavours: Tiger Proxy and Tiger Standalone Proxy.<br>
The standalone tiger proxy is started from a JAR-file.<br>
The test environment manager boots the main tiger proxy (local tiger proxy) and also any additional ones (normal tiger proxy, not standalone).</p>
</div>
<div class="paragraph">
<p>Both types have a proxy-port (configurable via <code>tigerProxy.proxyPort</code>), which supports both http- and https-traffic, (so you do not have to differentiate between the two).<br>
Additionally, they have an admin-port (configurable via <code>tigerProxy.adminPort</code>).<br>
This provides the Tiger Proxy Log to monitor the traffic (described in detail <a href="#_web_ui">here</a>), a rest-interface to customize the behavior (add/delete route, add/delete modifications) and a web-socket interface to stream rbel-messages between multiple Tiger Proxies.</p>
</div>
</div>
<div class="sect2">
<h3 id="understanding-routes"><a class="anchor" href="#understanding-routes"></a>4.3. Understanding routes</h3>
<div class="paragraph">
<p>Routes are the fundamental mechanic of how the Tiger Proxy handles traffic.<br>
They can be for a forward- or reverse-proxy.<br>
A route has the following properties:</p>
</div>
<div class="sect3">
<h4 id="from"><a class="anchor" href="#from"></a>4.3.1. from</h4>
<div class="paragraph">
<p>From where should the traffic be collected?<br>
This can either be an absolute URL (e.g. <a href="http://foobar" class="bare">http://foobar</a>), which defines a forward-proxy route, or relative (e.g. /blub), defining a reverse-proxy-route.<br>
Please note: You can freely add parts (e.g. <a href="http://foobar/extra/part" class="bare">http://foobar/extra/part</a>) to further specify the mapping.</p>
</div>
<div class="paragraph">
<p>You can add multiple routes that match the same URL. If multiple matches are found the most specific route is select. For example if you have two routes <code>/</code> and <code>/foo</code> then for a request to <code>/foo/bar</code> the route <code>/foo</code> will be selected.</p>
</div>
</div>
<div class="sect3">
<h4 id="to"><a class="anchor" href="#to"></a>4.3.2. to</h4>
<div class="paragraph">
<p>The target of the mapping.<br>
This has to be an absolute URL.<br>
The Tiger Proxy will, upon receiving a request to this mapping, execute a matching request to the defined host.</p>
</div>
<div class="paragraph">
<p>An example.<br>
Consider the following route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyRoutes:
      - from: http://my.domain/
        to: http://orf.at/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "http://" in the <strong>from property</strong> indicates that we have a forward-proxy route defined.<br>
So when we execute: (assuming the Tiger Proxy is started locally under the port 1234)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -x http://localhost:1234 http://my.domain/news</pre>
</div>
</div>
<div class="paragraph">
<p>The result will match the following curl</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://orf.at/news</pre>
</div>
</div>
<div class="paragraph">
<p>Additional headers are kept and just patched through.<br>
The same goes for the body and the HTTP-Method.</p>
</div>
<div class="paragraph">
<p>Added parts of the from-URL are stripped when forwarding.<br>
Meaning: If you have a mapping</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyRoutes:
      - from: http://my.domain/deep/
        to: http://orf.at/blub/</code></pre>
</div>
</div>
<div class="paragraph">
<p>and you execute GET <a href="http://my.domain/deep/deeper" class="bare">http://my.domain/deep/deeper</a>, you will get the result of GET <a href="http://orf.at/blub/deeper" class="bare">http://orf.at/blub/deeper</a> (the /deep in between has been eliminated along with my.domain).</p>
</div>
</div>
<div class="sect3">
<h4 id="hosts"><a class="anchor" href="#hosts"></a>4.3.3. hosts</h4>
<div class="paragraph">
<p>In some instances you might be pressed to "hosts" multiple servers on one tiger-proxy. This can happen when you can influence DNS-Resolvement, but neither the path nor the port used. In this case you can use the hosts-property to define which hosts should be routed to which target.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyRoutes:
      hosts:
        - "www.google.com"
        - ".*.bing.com"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The entries are matched first as a total match, failing that as regular expressions. If you want to add ports you are free to do so: "myHost:80". This however will necessitate that the ports on all entries in this specific list are given (this does not apply to other routes).</p>
</div>
</div>
<div class="sect3">
<h4 id="multiple-targets"><a class="anchor" href="#multiple-targets"></a>4.3.4. Multiple targets</h4>
<div class="paragraph">
<p>Sometimes you can only at runtime know which target to use. This can be achieved by using the <code>to</code>-property as a list of targets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyRoutes:
      - from: /
        to:
          - http://orf.at/blub/
          - http://ard.de/bla/</code></pre>
</div>
</div>
<div class="paragraph">
<p>When booting the tiger-proxy the proxy tries to reach the target host by sending a HEAD-request to the host (dropping the path). If the server sends a valid HTTP (or HTTPS) response, the target is considered reachable and the route is used. If no target can be reached an exception is thrown. The return code is ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="criterions"><a class="anchor" href="#criterions"></a>4.3.5. criterions</h4>
<div class="paragraph">
<p>As an additional measure for a more fine-grained matching you can use criterions. These are JEXL-expressions which have to be fulfilled for the route to be used. This can be leveraged to make the routing decision dependent on the content of the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyRoutes:
      - from: /
        to: http://orf.at/blub/
        criterions:
          - $.header.foo == 'bar'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will only forward messages where the header contains a key "foo" with the value "bar".</p>
</div>
</div>
<div class="sect3">
<h4 id="disablerbellogging"><a class="anchor" href="#disablerbellogging"></a>4.3.6. disableRbelLogging</h4>
<div class="paragraph">
<p>You can deactivate the rbel-Logging on a per-Route basis.<br>
Rbel is a versatile and powerful tool, but the analysis of individual messages consumes a lot of both CPU and memory.<br>
Deactivating it for routes in which it is not needed is therefore a good idea.</p>
</div>
</div>
<div class="sect3">
<h4 id="authentication"><a class="anchor" href="#authentication"></a>4.3.7. Authentication</h4>
<div class="paragraph">
<p>You can add optional authentication configuration which will be added to the forwarded message. Here either Basic access authentication or Bearer Token can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyRoutes:
      - from: http://my.domain/basicAuth/
        to: http://orf.at/blub/
        authentication:
          username: "test1"
          password: "pwd2"
      - from: http://my.domain/bearerToken/
        to: http://orf.at/blub/
        authentication:
          bearerToken: "blubblab"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the phrase "Bearer " will be added automatically. Please do not add it yourself!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tls-keys-certificates-a-quick-tour-on-proxies"><a class="anchor" href="#tls-keys-certificates-a-quick-tour-on-proxies"></a>4.4. TLS, keys, certificates a quick tour on proxies</h3>
<div class="paragraph">
<p>A fundamental part of a proxy setup is TLS.<br>
Since a proxy is a constant man-in-the-middle attack TLS is designed to make this exact scenario (eavesdropping while forwarding) impossible.<br>
Since a lot of the traffic in the gematik context is security-relevant and thus TLS-secured this point is a very relevant one.</p>
</div>
<div class="paragraph">
<p>Fundamentally breaking into TLS requires two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A certificate which the server can present which is valid for the given domain</p>
</li>
<li>
<p>The certifying CA (or a CA reachable via a certification path) has to be part of the client truststore</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There a different ways to reach these two requirements.<br>
Which one should be taken is dependent on the setting and the client used (most importantly, of course: can you alter the truststore for the test-setup?)</p>
</div>
<div class="paragraph">
<p>Here are a few things to know and ways in which to enable TLS:</p>
</div>
<div class="sect3">
<h4 id="tls-and-https-proxy"><a class="anchor" href="#tls-and-https-proxy"></a>4.4.1. TLS and HTTPS-Proxy</h4>
<div class="paragraph">
<p>TLS can be done via a http- or a https-proxy.<br>
The proxy-protocol does NOT equate to the client-server-protocol.<br>
To minimize the headache in configuration it is therefore strongly recommended to simply always use the http-proxy (sidenote: using a http-proxy does NOT reduce the security of the overall protocol.<br>
The security still relies on server-certificate-verification.)</p>
</div>
<div class="paragraph">
<p>If, however, you can not avoid using the https-proxy you have to make sure that you add the given certificate to your truststore.<br>
In class TigerProxy.java in Tiger there are methods such as SSLContext getConfiguredTigerProxySslContext(), X509TrustManager buildTrustManagerForTigerProxy() and KeyStore buildTruststore() which can help you configure the SSLContext in your case, if you use HTTP 3rd party libraries (Unirest, okHttp, RestAssured, etc.) as well as vanilla Java.<br>
If you encounter any problems, please contact us.</p>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-server-identity"><a class="anchor" href="#dynamic-server-identity"></a>4.4.2. Dynamic server identity</h4>
<div class="paragraph">
<p>For successfully breaking into TLS traffic the Tiger Proxy needs to present a certificate which features the domain-name of the server.<br>
Since the domain-names are known only at runtime, we generate the needed certificate on-the-fly during the first connection.</p>
</div>
<div class="paragraph">
<p>For a forward-proxy this is easy: The client sends not only the path, but the complete URL to the proxy, letting him handle DNS-resolution.<br>
So when the Tiger Proxy receives a new request the necessary domain-name is given by the client.<br>
A new, matching, certificate is generated (these are cached) and presented.<br>
To complete the setup the client-truststore needs to be patched.<br>
The CA used by the Tiger Proxy is dynamically generated on each startup.</p>
</div>
<div class="paragraph">
<p>For a reverse-proxy the domain name, which should be used, is unknown to the Tiger Proxy (DNS-resolution is done on the client-side).<br>
Thus, a domain-name needs to be provided, which should be used for certificate-generation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
        domainName: deep.url.of.server.de</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="client-sided-truststore-modification"><a class="anchor" href="#client-sided-truststore-modification"></a>4.4.3. Client-sided truststore modification</h4>
<div class="paragraph">
<p>When using a non-default certificate (which will almost always be the case for the Tiger Proxy) the modification of the client-truststore is necessary.<br>
For cases where the client is running in the same JVM as the target Tiger Proxy (which is the typical case for a tiger-based testsuite) there exists helper method to make this task easier.</p>
</div>
<div class="paragraph">
<p>Depending on your HTTP- or REST- or SOAP-API you will need to choose the exact way yourself.<br>
The following two examples might give you some idea of what to do.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Unirest.config().sslContext(tigerProxy.buildSslContext());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> OkHttpClient client = new OkHttpClient.Builder()

    .proxy(new Proxy(
        Proxy.Type.HTTP,
        new InetSocketAddress(
            "localhost",
            tigerProxy.getPort())))

    .sslSocketFactory(
        tigerProxy.getConfiguredTigerProxySslContext().getSocketFactory(),
        tigerProxy.buildTrustManagerForTigerProxy())

    .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-ca"><a class="anchor" href="#custom-ca"></a>4.4.4. Custom CA</h4>
<div class="paragraph">
<p>If you can not or don&#8217;t want to alter the client-truststore you have two choices: You can either provide a custom CA to be used (and trusted by the client) or you can give the certificate to be used by the Tiger Proxy.<br>
To set a custom CA to be used for certificate generation simply specify it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
        serverRootCa: "certificate.pem;privateKey.pem;PKCS8"
# for more information on specifying PKI identities in tiger see "Configuring PKI identities"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fixed-server-identity"><a class="anchor" href="#fixed-server-identity"></a>4.4.5. Fixed server identity</h4>
<div class="paragraph">
<p>The final, easiest and most unflexible way to solve TLS-issues is to simply give a fixed server-identity.<br>
This identity will be used for all routes, but only if it matches the domain-name given by the client during the handshake. As a fallback (if the domain-name does not match) the dynamic server-identity will be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
      serverIdentity: "certificateAndKeyAndChain.p12;Password"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use the fixed-server identity only for requests to matching hosts and you have NOT supplied a <code>serverRootCa</code>, you can use the <code>allowGenericFallbackIdentity</code>-property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
      serverIdentity: "certificateForFoobar.p12;Password"
      allowGenericFallbackIdentity: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>certificateForFoobar.p12</code> contains a certificate for the FQDN <code>foobar.com</code>, then a request to <code>foobar.com</code> will use this certificate. If the request is to <code>barfoo.com</code> the generic server-identity will be used. If you have supplied a <code>serverRootCa</code> this CA will always be used for any request for which an exact match is not found.</p>
</div>
</div>
<div class="sect3">
<h4 id="multiple-server-identities"><a class="anchor" href="#multiple-server-identities"></a>4.4.6. Multiple server identities</h4>
<div class="paragraph">
<p>Sometimes you might want to use different server-identities for different hosts that are proxied. This can be achieved by using the <code>serverIdentities</code>-property. Simply list the properties, the proxy will automatically try to choose the correct one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
      serverIdentities:
        - "someIdentity.p12;00"
        - "anotherIdentity.p12;changeit"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ocsp-stapling"><a class="anchor" href="#ocsp-stapling"></a>4.4.7. OCSP stapling</h4>
<div class="paragraph">
<p>If you want the Tiger Proxy to use OCSP stapling you can directly specify the OCSP-Signer to use in the configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
      ocspSignerIdentity: "myOcspSigner.p12;Password"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server will then use this OCSP-Signer to create a fake OCSP-Response during the TLS-handshake.</p>
</div>
</div>
<div class="sect3">
<h4 id="tls-decryption-in-wireshark"><a class="anchor" href="#tls-decryption-in-wireshark"></a>4.4.8. TLS Decryption in wireshark</h4>
<div class="paragraph">
<p>Sometimes you might want to look at decrypted TLS-traffic in wireshark. To achieve this we need to extract the masterSecrets of every connection from the Tiger Proxy and provide them to wireshark. This is actually pretty straight forward, with one big caveat: It is very insecure to access the masterSecrets of a TLS-connection, so we need to attach a Java-Agent to the VM.</p>
</div>
<div class="paragraph">
<p>When you are using the Tiger Proxy in a normal tiger-testsuite you can simply add the                             <code>&lt;goal&gt;attach-tiger-agent&lt;/goal&gt;</code> goal to the tiger-maven-plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">            &lt;plugin&gt;
                &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
                &lt;artifactId&gt;tiger-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${project.version}&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;generate-test-sources&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;generate-drivers&lt;/goal&gt;
                            &lt;goal&gt;attach-tiger-agent&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will modify the <code>argLine</code> property used by failsafe to start the testsuite and attach the TigerAgent to the VM. Next we need to set the filename where to write the masterSecrets to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    tls:
      masterSecretsFile: "myMasterSecrets.txt"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Tiger Proxy will write the secrets to the given file.</p>
</div>
<div class="paragraph">
<p>The final step is to import the masterSecrets into wireshark:</p>
</div>
<div class="paragraph">
<p>Go to Edit &#8594; Preferences. Open the Protocols tree and select TLS. Alternatively, select a TLS packet in the packet list, right-click on the TLS layer in the packet details view and open the Protocol preferences menu. Set the <code>(Pre)-Master-Secret log filename</code> to the file containing the master secrets. Now wireshark should decrypt TLS traffic routed through the Tiger Proxy on-the-fly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modifications"><a class="anchor" href="#modifications"></a>4.5. Modifications</h3>
<div class="paragraph">
<p>Modifications are a powerful tool to alter messages before forwarding them.<br>
They can be applied to requests and responses, to routes in forward- and reverse-proxy-mode.<br>
You can choose to modify only specific parts of the message and only alter messages, if certain conditions are met.<br>
Response messages support so called "reason phrases" which are small text explanations to the response code, e.g. "200 OK", ("OK" is a reason phrase).<br>
You can add, modify and remove reason phrases.</p>
</div>
<div class="paragraph">
<p>Below is a sample configuration giving insight into how modifications are organized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    modifications:
    # a list of modifications that will be applied to every proxied request and response

        # The following modification will replace the entire "user-agent" in all requests
      -
        condition: "isRequest"
        # a condition that needs to be fullfilled for the modification to be applied (JEXL grammar)
        targetElement: "$.header.user-agent"
        # which element should be targeted?
        replaceWith: "modified user-agent"
        # the replacement string to be filled in.

        # The following modification will replace the body of every 200 response completely with the given json-string
        # (This ignores the existing body. For example this could be an XML-body. Content-Type-headers will NOT be set accordingly)
      -
        condition: "isResponse &amp;&amp; $.responseCode == 200"
        targetElement: "$.body"
        name: "body replacement modification"
        # The name of this modification. This can be used to identify, alter or remove this modification. A name is optional
        replaceWith: "{\"another\":{\"node\":{\"path\":\"correctValue\"}}}"

        # The following modification has no condition, so it will be applied to every request and every response
      -
        targetElement: "$.body"
        regexFilter: "ErrorSeverityType:((Error)|(Warning))"
        # The given regex will be used to target only parts of targeted element.
        replaceWith: "ErrorSeverityType:Error"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mesh_setup_traffic_endpoints"><a class="anchor" href="#_mesh_setup_traffic_endpoints"></a>4.6. Mesh set up</h3>
<div class="paragraph">
<p>One of the fundamental features of the Tiger Proxy is mesh set up AKA rbel-message forwarding.<br>
This transmits the information about the messages, which the proxy has logged, to other Tiger Proxies (where they will be logged as well).<br>
This enables the creation of "proxy-meshes", staggered Tiger Proxies.</p>
</div>
<div class="paragraph">
<p>In a mesh set up the "remote tiger proxy" is the one which intercepts the traffic and sends the information.<br>
Conversely, the "receiving tiger proxy" receives the information about the message from the remote tiger proxy.<br>
The "local tiger proxy" is the main tiger proxy booted by the testsuite.<br>
If you configured it to receive traffic from another tiger proxy (which should always be the case when you are doing a mesh set up) then it is also a receiving tiger proxy.</p>
</div>
<div class="paragraph">
<p>Common scenario for this approach might be the use of multiple reverse-proxies on the root level (e.g. when the client only allows the configuration of the server IP or domain, but no path-prefix) or the aggregation of traffic across machine-boundaries (e.g. one constantly running Tiger Proxy which is used by a testsuite on another machine).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-proxy-message-flow.svg" alt="tiger proxy message flow">
</div>
<div class="title">Figure 6. Tiger Proxy message flow</div>
</div>
<div class="paragraph">
<p>In the above picture the test object 2 would not be accessible directly by the test suite, thus using the reverse proxy allows circumventing network restrictions.<br>
The reverse proxy could either be started by the test environment manager or as standalone process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    proxyId: IBM
    trafficEndpoints:
      - http://another.tiger.proxy:&lt;adminPort&gt;
    # A list of upstream Tiger Proxies. This proxy will try to connect to all given sources to
    # gather traffic via the STOMP-protocol.
    skipTrafficEndpointsSubscription: false
    # If false then the subscription is tested at the beginning and if any of the given endpoints are not accessible the
    # server will not boot. (fail fast, fail early)
    # default of skipTrafficEndpointsSubscription is false
    downloadInitialTrafficFromEndpoints: true
    # Should the traffic currently available (cached) in the remote be download upon initial connection?
    # default of downloadInitialTrafficFromEndpoints is true
    failOnOfflineTrafficEndpoints: false
    # Should the Tiger Proxy fail on startup, when a traffic endpoint is offline? Default is true.
    # Ignoring this error might lead to an unexpected testing environment!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please be advised to use the server-port (<code>server.port</code>) here, not the proxy-port (<code>tigerProxy.proxyPort</code>).<br>
The traffic from routes with <code>disableRbelLogging: true</code> will not show up here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are setting up a Tiger Proxy to run constantly and simply forward traffic to a testsuite that is booted ad-hoc you might run into performance-problems.<br>
This is due to the Rbel-Logger being a very hungry beast.<br>
To stop Rbel from parsing all message simply add <code>tigerProxy.activateRbelParsing: false</code>.<br>
This will vastly reduce memory and CPU consumption of the application, while still forwarding logged traffic.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="mesh-api"><a class="anchor" href="#mesh-api"></a>4.6.1. Mesh API</h4>
<div class="paragraph">
<p>The Tiger Proxies use <a href="https://stomp.github.io/">STOMP</a> a simple/streaming text oriented messaging protocol via web socket to forward received traffic.<br>
For an external client to receive these traffic data, it must subscribe to the traces topic reachable at the subscription path /topic/traces.<br>
To do so the client must connect to the traffic endpoint URL of the Tiger Proxy.<br>
This is answered with HTTP status 100 and then redirected to web socket protocol via the same port.<br>
For each received traffic data pair (request/response) the Tiger Proxy will push a web socket message to all subscribed clients.</p>
</div>
<div class="paragraph">
<p>This JSON encoded message consists of:<br>
* UUID string * http request as base64 encoded data * http response as base64 encoded data * hostname and port of sender (if retrievable, worst case only IP address or empty) * hostname and port of receiver (if retrievable, worst case only IP address or empty)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "uuid": "UUID string",
    "request": "base64 encoded http request",
    "response": "base64 encoded http response",
    "sender": {
      "hostname": "hostname/ip address of sender",
      "port": portAsInt
    },
    "reveiver": {
      "hostname": "hostname/ip address of receiver",
      "port": portAsInt
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rbel_path_details"><a class="anchor" href="#_rbel_path_details"></a>4.7. Understanding RBelPath</h3>
<div class="paragraph">
<p>RBeL-Path is a XPath or JSON-Path inspired expression-language enabling the quick traversal of captured RBeL-Traffic (navigation of the RbelElement-tree).</p>
</div>
<div class="paragraph">
<p>A simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">assertThat(convertedMessage.findRbelPathMembers("$.header"))
    .containsExactly(convertedMessage.getFacetOrFail(RbelHttpMessageFacet.class).getHeader());</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">assertThat(convertedMessage.findElement("$.header"))
    .get()
    .isSameAs(convertedMessage.getFacetOrFail(RbelHttpMessageFacet.class).getHeader());</code></pre>
</div>
</div>
<div class="paragraph">
<p>(The first example executes the RbelPath and returns a list of all matching element, the second one returns an Optional containing a single result.<br>
If there are multiple matches an exception is given.)</p>
</div>
<div class="paragraph">
<p>RBeL-Path provides seamless retrieval of nested members.</p>
</div>
<div class="paragraph">
<p>Here is an example of HTTP-Message containing a JSON-Body:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/rbelPath1.jpg" alt="rbelPath1">
</div>
<div class="title">Figure 7. Rbel-Path expression in a HTTP-Response</div>
</div>
<div class="paragraph">
<p>The following message contains a JWT (Json Web Token, a structure which contains of a header, a body and a signature).<br>
In the body there is a claim (essentially a Key/Value pair represented in a JSON-structure) named <code>nbf</code> which we want to inspect.</p>
</div>
<div class="paragraph">
<p>Please note that the RBeL-Path expression contains no information about the types in the structure.<br>
This expression would also work if the HTTP-message contained a JSON-Object with the corresponding path, or an XML-Document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">assertThat(convertedMessage.findRbelPathMembers("$.body.body.nbf"))
    .containsExactly(convertedMessage.getFirst("body").get()
    .getFirst("body").get()
    .getFirst("nbf").get()
    .getFirst("content").get());</code></pre>
</div>
</div>
<div class="paragraph">
<p>(The closing .getFirst("content") in the assertion is due to a fix to make RbelPath in JSON-Context easier: If the RbelPath ends on a JSON-Value-Node the corresponding content is returned.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/rbelPath2.jpg" alt="rbelPath2">
</div>
<div class="title">Figure 8. Multiple body references</div>
</div>
<div class="paragraph">
<p>You can also use wildcards to retrieve all members of a certain level:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.body.[*].nbf</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.body.*.nbf</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can recursively descend and retrieve all members:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$..nbf</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.body..nbf</pre>
</div>
</div>
<div class="paragraph">
<p>will both return the same elements (maybe amongst other elements).</p>
</div>
<div class="paragraph">
<p>To use keys containing spaces, escape them via <code>['foo bar']</code>, like so:</p>
</div>
<div class="paragraph">
<p><code>$.body.['foo bar'].key</code></p>
</div>
<div class="paragraph">
<p>Please note that the keys in the bracket are URL unescaped.<br>
So to use special characters please URL encode them (Space is a special case since + and ' ' are allowed, depending on the exact position).</p>
</div>
<div class="sect3">
<h4 id="arrays"><a class="anchor" href="#arrays"></a>4.7.1. Arrays</h4>
<div class="paragraph">
<p>To make things easy and consistent, the entries of an array are simply stored as a map with the index as key. So the following expression will return the first element of the array:</p>
</div>
<div class="paragraph">
<p><code>$.body.array.0</code></p>
</div>
</div>
<div class="sect3">
<h4 id="differentiating-between-multiple-elements"><a class="anchor" href="#differentiating-between-multiple-elements"></a>4.7.2. Differentiating between multiple elements</h4>
<div class="paragraph">
<p>When a key is present multiple times, all elements are returned. To differentiate between them, you can use the index:</p>
</div>
<div class="paragraph">
<p><code>$.body.entry[0]</code></p>
</div>
<div class="paragraph">
<p>would give the first element in the following XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;body&gt;
    &lt;entry&gt;first&lt;/entry&gt;
    &lt;entry&gt;second&lt;/entry&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="alternate-keys"><a class="anchor" href="#alternate-keys"></a>4.7.3. Alternate keys</h4>
<div class="paragraph">
<p>To find alternating values, concatenate them using the pipe symbols, like so:<br>
<code>$.body.['foo'|'bar'].key</code></p>
</div>
<div class="paragraph">
<p>This expression will explore both subtrees to try to find the following nodes<br>
<code>$.body.foo.key</code> and <code>$.body.bar.key</code>.<br>
Please note that only elements that are present are returned.<br>
So if only always one of the two elements is present, only a single element will be returned.</p>
</div>
</div>
<div class="sect3">
<h4 id="case-insensitive-matching"><a class="anchor" href="#case-insensitive-matching"></a>4.7.4. Case-insensitive matching</h4>
<div class="paragraph">
<p>Sometimes it can be helpful to match keys in a case-insensitive manner. To achieve this you can use the <code>~</code>-operator:<br>
<code>$.body.[~'fOO'].key</code></p>
</div>
<div class="paragraph">
<p>This will match <code>$.body.foo.key</code> and <code>$.body.FOO.key</code> (and any other case-insensitive match).</p>
</div>
<div class="paragraph">
<p>To find multiple case-insensitive matches, concatenate them using the pipe symbols, like so:<br>
<code>$.body.[<sub>'fOO'|</sub>'bAR'].key</code>. With this expression, the following nodes will be found: <code>$.body.foo.key</code>, <code>$.body.FOO.key</code>, <code>$.body.bar.key</code> and <code>$.body.BAR.key</code> (and any other potential matches).</p>
</div>
</div>
<div class="sect3">
<h4 id="_jexl_expressions"><a class="anchor" href="#_jexl_expressions"></a>4.7.5. JEXL expressions</h4>
<div class="paragraph">
<p>RBeL-Path can be integrated with JEXL-expression, giving a much more powerful and flexible tool to extract certain element.<br>
This can be done using the syntax from the following example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$..[?(key=='nbf')]</pre>
</div>
</div>
<div class="paragraph">
<p>The expression in the round-brackets is interpreted as JEXL.<br>
The available syntax is described in more detail <a href="#_jexl_expression_detail">here</a> or <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" class="bare">https://commons.apache.org/proper/commons-jexl/reference/syntax.html</a></p>
</div>
<div class="paragraph">
<p>Please note that these Jexl-Expression can not be nested inside each other deeper then one level (You can write a RbelPath that contains a Jexl-Expression.<br>
And this Jexl-Expression can even contain a RbelPath.<br>
But the inner RbelPath can not contain another Jexl-Expression).</p>
</div>
<div class="paragraph">
<p>The variables that can be used are listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>element</code> contains the current RBeL-Element</p>
</li>
<li>
<p><code>parent</code> gives direct access to the parent element of the current element.<br>
Is <code>null</code> if not present</p>
</li>
<li>
<p><code>message</code> contains the HTTP-Message under which this element was found.<br>
It contains:</p>
<div class="ulist">
<ul>
<li>
<p><code>method</code> is the HTTP-Method (or null if it is a response)</p>
</li>
<li>
<p><code>url</code> is the request URL (or null if it is a response)</p>
</li>
<li>
<p><code>statusCode</code> is the status response code (or null if it is a request)</p>
</li>
<li>
<p><code>request</code> is a boolean denoting whether this message is a request</p>
</li>
<li>
<p><code>response</code> is a boolean denoting whether this message is a response</p>
</li>
<li>
<p><code>header</code> is a map containing all headers (as <code>Map&lt;String, List&lt;String&gt;&gt;</code>)</p>
</li>
<li>
<p><code>bodyAsString</code> is the body of the message as a raw string, or null if none given</p>
</li>
<li>
<p><code>body</code> is the RbelElement of the message-body, or null if none given</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>request</code> is the corresponding HTTP-Request.<br>
If <code>message</code> is a response, then the corresponding Request will be returned.<br>
If <code>message</code> is a request, then the <code>message</code> itself will be returned.</p>
</li>
<li>
<p><code>response</code> is the corresponding HTTP-Response.<br>
If <code>message</code> is a request, then the corresponding Response will be returned.<br>
If <code>message</code> is a response, then the <code>message</code> itself will be returned.</p>
</li>
<li>
<p><code>key</code> is a string containing the key that the current element can be found under in the parent-element.</p>
</li>
<li>
<p><code>path</code> contains the complete sequence of keys from <code>message</code> to <code>element</code>.</p>
</li>
<li>
<p><code>type</code> is a string containing the class-name of <code>element</code> (eg <code>RbelJsonElement</code>).</p>
</li>
<li>
<p><code>content</code> is a string describing the content of <code>element</code>.<br>
The actual representation depends heavily on the type of <code>element</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally you can always reference the current element (via @.) or the root element (via $.) in any JEXL-expression.<br>
Lets explain this using an example.</p>
</div>
<div class="paragraph">
<p>For more detailed information on JEXL expressions please refer to <a href="#_jexl_expression_detail">Detailed JEXL-expressions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="nested-rbelpath-expressions"><a class="anchor" href="#nested-rbelpath-expressions"></a>4.7.6. Nested RbelPath expressions</h4>
<div class="paragraph">
<p>Consider the following rbel tree:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-proxy-nested-array-tree.png" alt="tiger proxy nested array tree">
</div>
<div class="title">Figure 9. Nested RBel tree with array</div>
</div>
<div class="paragraph">
<p>At <code>$.body.body.idp_entity</code> we have an array with potentially multiple entries (here there is only one, entry <code>0</code>).<br>
We want to select an entry where the <code>iss</code>-claim matches our expectation.<br>
We can achieve this with using a nested Rbel-Path inside the JEXL-Expression:</p>
</div>
<div class="paragraph">
<p><code>$.body.body.idp_entity.[?(@.iss.content=='https://idpsek.dev.gematik.solutions')]</code></p>
</div>
<div class="paragraph">
<p>Here the <code>@.</code> references the current element: For each array entry the expression is tested, with <code>@.</code> always referring to the current entry.<br>
To access elements starting from the root you can use <code>$.</code> like so:</p>
</div>
<div class="paragraph">
<p><code>$.body.body.idp_entity.[?(@.iss.content==$.body.body.idp_entity.0.iss.content)]</code></p>
</div>
<div class="paragraph">
<p>You can use recursive descent here as well:<br>
<code>$.body.[?(@..content == 'ES256')]</code> would yield <code>$.body.header</code>.<br>
Let&#8217;s unpack this expression:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$.body</code> selects the http body</p>
</li>
<li>
<p><code>.</code> then selects a child (of the http-body, meaning either <code>header</code>, <code>body</code> or <code>signature</code>)</p>
</li>
<li>
<p>The JEXL-selector <code>[?(@..content == 'ES256')]</code> is then tested on each of the candidates.</p>
<div class="ulist">
<ul>
<li>
<p>In turn <code>@..</code> executes a recursive descent, meaning it will select all child nodes individually</p>
</li>
<li>
<p><code>content</code> selects only the elements which have a key matchin <code>content</code>.<br>
So we end up with all nodes in the respective subtrees that are named <code>content</code>.</p>
</li>
<li>
<p>The JEXL-expression <code>* == 'ES256''</code> is then selected for every member of the subtree (so for the header it will test <code>$.body.header.typ.content</code>, <code>$.body.header.kid.content</code> and <code>$.body.header.alg.content</code>).<br>
The individual results are then reduced using (so the overall expression matches if there is ANY matching element)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Since only one of the subtrees does fulfill the expression only this subtree is returned (and NOT the element itself, i.e. <code>$.body.header.alg.content</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please note that since the RbelPath-expressions are executed prior to the JEXL-expression the negation might yield unexpected results.<br>
Currently it is not recommended to use these. (e.g. <code>$.body.[?(not (@.. == 'ES256'))]</code>)</p>
</div>
</div>
<div class="sect3">
<h4 id="debugging-rbel-expressions"><a class="anchor" href="#debugging-rbel-expressions"></a>4.7.7. Debugging Rbel-Expressions</h4>
<div class="paragraph">
<p>To help users create RbelPath-Expressions there is a Debug-Functionality which produces log message designed to help.<br>
These can be activated by <code>RbelOptions.activateRbelPathDebugging();</code>.<br>
Please note that this is strictly intended for development purposes and will flood the log with quite a lot of messages.<br>
Act accordingly!</p>
</div>
<div class="paragraph">
<p>When you want to debug RbelPath in BDD test suites, you can add a <code>tiger.yaml</code> file to your project root and add the following property (for more details see <a href="#_tiger_test_lib_configuration">this chapter</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">lib:
    rbelPathDebugging: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get a better feel for a RbelElement (whether it being a complete message or just a part) you can print the tree with the <code>RbelElementTreePrinter</code>.<br>
It brings various options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RbelElementTreePrinter.builder()
    .rootElement(this) //the target element
    .printKeys(printKeys) // should the keys for every leaf be printed?
    .maximumLevels(100) // only descend this far into the three
    .printContent(true) // should the content of each element be printed?
    .build()
    .execute();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-tiger-proxy-as-standalone-jar"><a class="anchor" href="#running-tiger-proxy-as-standalone-jar"></a>4.8. Running Tiger Proxy as standalone JAR</h3>
<div class="paragraph">
<p>If you only want to run a Tiger Proxy instance without test environment manager or test library you may do so (e.g. in certain tracing set-ups).<br>
A spring boot executable JAR is available via <a href="https://repo1.maven.org/maven2/de/gematik/test/tiger-standalone-proxy">maven central</a>.</p>
</div>
<div class="paragraph">
<p>Supplying an application.yaml file allows you to configure the standalone proxy just like an instance started by the test environment manager.<br>
All properties can be used the same way as described in <a href="#_configuring_the_local_test_suite_tiger_proxy">this chapter</a>.<br>
There is however one additional property for the standalone proxy specifically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># flag whether to load all resources (js,css) locally or via CDN/internet.
# useful if you have no access to the internet in your environment
localResources: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="additional-configuration"><a class="anchor" href="#additional-configuration"></a>4.9. Additional configuration</h3>
<div class="paragraph">
<p>There are some additional configuration-flags in the Tiger Proxy:</p>
</div>
<div class="sect3">
<h4 id="performance"><a class="anchor" href="#performance"></a>4.9.1. Performance</h4>
<div class="paragraph">
<p>Below some properties along with their respective default values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    activateRbelParsing: true
    parsingShouldBlockCommunication: false
    activateTrafficLogging: true
    activateRbelParsingFor:
      - epa-vau</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="activaterbelparsing"><a class="anchor" href="#activaterbelparsing"></a>activateRbelParsing</h5>
<div class="paragraph">
<p>Deactivating this flag turns off all Rbel-Analysis of the incoming traffic.<br>
This is a huge deal in terms of memory- and CPU-consumption, but you will lose all benefit of performing Rbel-Analysis.</p>
</div>
</div>
<div class="sect4">
<h5 id="activaterbelparsingfor"><a class="anchor" href="#activaterbelparsingfor"></a>activateRbelParsingFor</h5>
<div class="paragraph">
<p>This option can activate various optional Rbel-Converters. Currently supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pop3</code> for RbelPop3CommandConverter and RbelPop3ResponseConverter</p>
</li>
<li>
<p><code>smtp</code> for RbelSmtpCommandConverter and RbelSmtpResponseConverter</p>
</li>
<li>
<p><code>mime</code> for RbelMimeConverter and RbelEncryptedMailConverter</p>
</li>
<li>
<p><code>asn1</code> for RbelAsn1Converter</p>
</li>
<li>
<p><code>epa-vau</code> for RbelVauEpaConverter and RbelVauEpaKeyDeriver</p>
</li>
<li>
<p><code>erp-vau</code> for RbelErpVauDecryptionConverter</p>
</li>
<li>
<p><code>epa3-vau</code> for RbelVauEpa3Converter</p>
</li>
<li>
<p><code>sicct</code> for RbelSicctCommandConverter and RbelSicctEnvelopeConverter</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="parsingshouldblockcommunication"><a class="anchor" href="#parsingshouldblockcommunication"></a>parsingShouldBlockCommunication</h5>
<div class="paragraph">
<p>If blocking is enabled the Tiger Proxy will only return the response when message parsing is completed.<br>
This is inadvisable in high-speed scenarios.<br>
It, however, greatly simplifies the test suite (after the communication is concluded the parsed message appears in the log).<br>
Therefore, the blocking is deactivated by default.<br>
The only exception is the local Tiger Proxy, which WILL block communication until parsing is completed.<br>
For all Tiger Proxies this default behavior can be changed.</p>
</div>
</div>
<div class="sect4">
<h5 id="directreverseproxy"><a class="anchor" href="#directreverseproxy"></a>directReverseProxy</h5>
<div class="paragraph">
<p>To enable the use of the TigerProxy for non-HTTP scenarios you can use the option <code>directReverseProxy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tigerProxy:
    directReverseProxy:
        hostname: 127.0.0.1
        port: 3858</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will directly forward any request to the given host.<br>
This is a form of reverseProxy, only also applicable for non-http-traffic.<br>
HTTP traffic will still be forwarded through use of a global reverse proxy.<br>
Other traffic will be directly forwarded, rerouted directly on the TCP layer.<br>
Messages transmitted can still be parsed via RBel.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="activatetrafficlogging"><a class="anchor" href="#activatetrafficlogging"></a>4.9.2. activateTrafficLogging</h4>
<div class="paragraph">
<p>This flag controls whether the Tiger Proxy will log all traffic. If activated every request and response is noted in the log. This can lead to a verbose and bloated log. If you are not interested in the traffic log, but only in the Rbel-Analysis, you can deactivate this flag. Default is true.</p>
</div>
</div>
<div class="sect3">
<h4 id="rewritehostheader"><a class="anchor" href="#rewritehostheader"></a>4.9.3. rewriteHostHeader</h4>
<div class="paragraph">
<p>This flag activates the rewriting of the host-header. If activated the host-header will be rewritten to the target host (only applicable for reverse proxy routes). Default is false.</p>
</div>
</div>
<div class="sect3">
<h4 id="rewritelocationheader"><a class="anchor" href="#rewritelocationheader"></a>4.9.4. rewriteLocationHeader</h4>
<div class="paragraph">
<p>This flag activates the rewriting of the location-header for 3xx responses. If activated the location-header will be modified so the client will still use the proxy to reach the new location. Default is true.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="understanding-filtering"><a class="anchor" href="#understanding-filtering"></a>4.10. Understanding filtering</h3>
<div class="paragraph">
<p>The filtering of messages in the tiger proxy consists of three main stages.<br>
These are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Traffic filter (trafficEndpointFilterString / readFilter, Determines which messages are accepted into the tiger proxy)</p>
</li>
<li>
<p>Tiger Proxy Log filter (Which messages are displayed in the Tiger Proxy Log?)</p>
</li>
<li>
<p>Pagination (Look around in smaller pages of messages)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lets dive a bit deeper!</p>
</div>
<div class="sect3">
<h4 id="traffic-filter"><a class="anchor" href="#traffic-filter"></a>4.10.1. Traffic filter</h4>
<div class="paragraph">
<p>At the core of the Tiger Proxy sits a RbelLogger instance.<br>
Here the messages are parsed and stored.<br>
Three sources feed into the RbelLogger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Messages intercepted in the Tiger Proxy</p>
</li>
<li>
<p>Messages relayed using a mesh setup</p>
</li>
<li>
<p>Messages imported from a file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Messages that are intercepted are automatically stored (the exception being the <code>tigerProxy.activateForwardAllLogging</code>-property, which can deactivate the logging of traffic not specifically forwarded via a route).<br>
For messages in a mesh setup and from a source file filter expressions can be defined to limit the messages that are actually stored.<br>
These can be defined using the <code>tigerProxy.trafficEndpointFilterString</code> (for mesh setups) and <code>tigerProxy.fileSaveInfo.readFilter</code> (for tgr-files) respectively.</p>
</div>
<div class="paragraph">
<p>When messages pass the filter, partner messages (request/response pairs) are kept intact.<br>
So when you filter for messages that have a return code of 200 the corresponding requests do not match the filter expression.<br>
They are however kept in memory since the partner, the response in that case, do match.</p>
</div>
<div class="paragraph">
<p>Filter expressions are <a href="#_jexl_expressions">JEXL-expressions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tiger-proxy-log-filter"><a class="anchor" href="#tiger-proxy-log-filter"></a>4.10.2. Tiger Proxy Log filter</h4>
<div class="paragraph">
<p>When you display the messages on the Tiger Proxy Log you have the ability to filter out certain messages to be displayed exclusively.<br>
The messages, which are filtered out, do still remain stored in the Tiger Proxy.<br>
Consequently, this has no effect if you store a TGR file (be it via the Tiger Proxy Log or the YAML).</p>
</div>
<div class="paragraph">
<p>The menu on the right side will only show the messages being filtered out to avoid confusion.<br>
However, the messages numbers do reference the order in the main Tiger Proxy store.<br>
This way they are consistent across different Tiger Proxy Log filters (message #10 will always refer to the same message, regardless of the Tiger Proxy Log filter being applied).</p>
</div>
<div class="paragraph">
<p>Filter expressions are <a href="#_jexl_expressions">JEXL-expressions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="pagination"><a class="anchor" href="#pagination"></a>4.10.3. Pagination</h4>
<div class="paragraph">
<p>Finally, pagination is applied in the Tiger Proxy Log.<br>
This comes after the Tiger Proxy Log-Filter has been applied.<br>
So when would filter out every second message via a Tiger Proxy Log-Filter every page would still contain 20 (or whatever page size you have set) messages.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiger-test-library-2"><a class="anchor" href="#tiger-test-library-2"></a>5. Tiger Test library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As outlined in <a href="#_overview">the overview section</a> the Tiger test library is one of the three core components of the Tiger test framework.<br>
Its main goal is to provide extensive support for BDD/Cucumber testing and integrating the local Tiger Proxy with the test environment manager and the started test environment.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
As of now we do not support multithreaded / parallel test runs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tiger_test_lib_configuration"><a class="anchor" href="#_tiger_test_lib_configuration"></a>5.1. Tiger test lib configuration</h3>
<div class="paragraph">
<p>In the root folder of your test project you may place a <em>tiger.yaml</em> configuration file to customize the Tiger test library integration and activate / deactivate certain features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">lib:
    # Flag to activate tracing at the Rbel Path Executor.
    # If activated the Executor will dump all evaluation steps of all levels to the console
    # when traversing through the document tree
    # Deactivated by default
    rbelPathDebugging: false
    # Flag whether the Executor's dump shall be in ANSI color.
    # If you are working on operating systems (Windows) that do not support
    # Ansi color sequences in their console you may deactivate the coloring with this flag.
    # Activated by default.
    rbelAnsiColors: true
    # Flag whether to start a browser window to display
    # the current steps / banner messages / rbel logs
    # when executing the test suite.
    # This feature can be used to instruct the tester to follow
    # a specific test workflow for manual tests.
    # Deactivated by default
    activateWorkflowUi: false
    # Flag whether to add a curl command details button to
    # SerenityRest Restassured calls
    # in the Serenity BDD report
    addCurlCommandsForRaCallsToReport: true
    # Flag whether to create the RBEL HTML reports during
    # a testsuite run, activated by default
    createRbelHtmlReports: true
    # maximum amount of seconds to wait / pause execution via pop up in the workflow ui, default is 5 hours.
    pauseExecutionTimeoutSeconds: 18000
    # Customize your Rbel-Logs with your own logo. Must be PNG format.
    # Path should be relative to execution-location
    rbelLogoFilePath: "myLogo.png"
    # If you want to use a fixed port for the workflowUI you can set it here.
    workflowUiPort: 8123
    # Flag whether to clear the initial traffic after the environment startup phase
    # activated by default
    clearEnvironmentStartupTraffic: true

# flag whether to start the local Tiger Proxy (default) or to omit it completely.
# if you have the local Tiger Proxy deactivated you will NOT be able to
# validate / log any traffic data from test requests / responses.
localProxyActive: true

# section to allow adapting the logging levels of packages/class loggers similar to spring boot
logging:
  level:
    # activate tracing for a specific class
    de.gematik.test.tiger.testenvmgr.TigerTestEnvMgr: TRACE
    # activate tracing for all classes and subpackages of a package
    de.gematik.test.tiger.proxy: TRACE
    # activate tracing for the local Tiger Proxy. This logger has a special name due to its importance in the tiger test framework
    localTigerProxy: TRACE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cucumber_hooks"><a class="anchor" href="#_cucumber_hooks"></a>5.2. Cucumber and Hooks</h3>
<div class="paragraph">
<p>As Tiger focuses on BDD and Cucumber based test suites all the setup and tear down as well as steps based actions are performed.</p>
</div>
<div class="paragraph">
<p>That&#8217;s why it is mandatory to use the TigerCucumberRunner, which internally registers the plugin <code>io.cucumber.core.pluginTigerSerenityReporterPlugin</code> to the plugins list.</p>
</div>
<div class="paragraph">
<p>The LocalProxyRbelMessageListener class initializes a static single RBelMessage listener to collect all messages received by the local Tiger Proxy and provides those messages via a getter method to the Tiger filter and validation steps.</p>
</div>
<div class="paragraph">
<p>At startup of the TigerCucumberRunner the TigerDirector gets called once to initiate the Tiger test environment manager, the local Tiger Proxy (unless it&#8217;s configured to be not active) and optionally the workflow UI.<br>
It adds a RbelMessage Listener once to the local Tiger proxy and also clears the RbelMessages queue before each scenario / scenario outline variant.<br>
Utilizing the close integration of SerenityBDD and RestAssured at startup also a Restassured request filter, which parses the details and adds a curl Command details button to the Serenity BDD report, is registered.<br>
The curl command shown in that section in the report allows to repeat the performed REST request, for manual test failure analysis.</p>
</div>
<div class="paragraph">
<p>After each scenario / data variant all collected RbelMessages are saved as HTML file to the <code>target/rbellogs</code> folder, and attached to the SerenityBDD report as test evidence.<br>
The current test run state (success/failed rate) is logged to the console.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-cucumber-tiger-validation-steps"><a class="anchor" href="#using-the-cucumber-tiger-validation-steps"></a>5.3. Using the Cucumber Tiger validation steps</h3>
<div class="paragraph">
<p>The Tiger validation steps are a set of Cucumber steps that enable you to search for requests and associated responses matching certain criteria.<br>
All of that without need to write your own code.<br>
Basic knowledge about RBelPath and regular expressions are sufficient.<br>
In order to use these steps you must ensure that the relevant traffic is routed via the local Tiger Proxy of the test suite or construct a <a href="#_mesh_setup_traffic_endpoints">Tiger Proxy mesh</a> set up.</p>
</div>
<div class="sect3">
<h4 id="filtering-requests"><a class="anchor" href="#filtering-requests"></a>5.3.1. Filtering requests</h4>
<div class="ulist">
<div class="title">Core features</div>
<ul>
<li>
<p>Filter for server, method, path, RBelPath node existing / matching given value in request</p>
</li>
<li>
<p>Find first / next / last matching request</p>
</li>
<li>
<p>Find absolute last request (no path input needed)</p>
</li>
<li>
<p>Find first / next / last request containing a RBelPath node</p>
</li>
<li>
<p>Clear all recorded messages</p>
</li>
<li>
<p>Specify timeout for filtering request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the <code>TGR find next request &#8230;&#8203;</code> steps you can validate a complete workflow of requests to exist in a specific order and validate each of their responses (see next chapter).</p>
</div>
</div>
<div class="sect3">
<h4 id="validating-responses"><a class="anchor" href="#validating-responses"></a>5.3.2. Validating responses</h4>
<div class="ulist">
<div class="title">Core features</div>
<ul>
<li>
<p>Assert that the body of the response matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath node exists</p>
</li>
<li>
<p>Assert that a given RBelPath node matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath node does not match regex</p>
</li>
<li>
<p>Assert that a given RBelPath node matches a JSON struct using the JSONChecker feature set</p>
</li>
<li>
<p>Assert that a given RBelPath node matches an XML struct using the XMLUnit difference evaluator</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 16. Tiger response validation steps example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature Tiger validation steps

  Scenario: Example steps

    Given TGR clear recorded messages
    And TGR filter requests based on host "testnode.example.org"
    And TGR filter requests based on method "POST"
    And TGR set request wait timeout to 20 seconds
    When TGR find request to path "/path/path/blabla" with "$..tag.value.text" matching "abc.*"
    And TGR find request to path "/path/path/blabla" containing node "$..tag"
    Then TGR current response with attribute "$..answer.result.text" matches "OK.*"
    But TGR current response with attribute "$..answer.reason.text" does not match "REQUEST.*"
    And TGR current response body matches:
    """
         body content
        """
    And TGR current response at "$..tag" matches as JSON:
    """
          {
            "arr1": [
              "asso", "bsso"
            ]
          }
        """
    And TGR current response at "$..tag" matches as XML:
    """
          &lt;arr1&gt;
            &lt;entry index="1"&gt;asso&lt;/entry&gt;
            &lt;entry index="2"&gt;bsso&lt;/entry&gt;
          &lt;/arr1&gt;
        """

    Given TGR find message with "$.pop3Body.mimeHeader.subject" matching ".*test.*"
    Given TGR find next message with "$.pop3Status" matching "-ERR"
    Given TGR find last message with "$.pop3Command" matching "RETR"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validating-requests"><a class="anchor" href="#validating-requests"></a>5.3.3. Validating requests</h4>
<div class="ulist">
<div class="title">Core features</div>
<ul>
<li>
<p>Assert that the body of the request matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath contains node</p>
</li>
<li>
<p>Assert that a given RBelPath node matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath node matches as JSON or XML</p>
</li>
<li>
<p>Assert that a given RBelPath node does not match regex</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 17. Tiger request validation steps example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature Tiger request validation steps

  Background:
    Given TGR clear recorded messages

  Scenario: Test validation Request
    When TGR send PUT request to "http://httpbin/put" with body "{'foo': 'bar'}"
    Then TGR find last request to path ".*"
    Then TGR current request body matches:
    """
    {'foo': 'bar'}
        """

    Then TGR current request contains node "$.body.foo"
    Then TGR current request with attribute "$.body.foo" matches "bar"
    Then TGR current request at "$.body" matches:
    """
    {'foo': 'bar'}
        """

    Then TGR current request at "$.body" matches as JSON:
    """
    {
      "foo": "${json-unit.ignore}"
    }
        """

    Then TGR current request with attribute "$.body.foo" does not match "foo"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="regex-matching"><a class="anchor" href="#regex-matching"></a>5.3.4. Regex matching</h4>
<div class="paragraph">
<p>When comparing values (e.g. in the <code>TGR current response body matches:</code>) generally the algorithms check for equality and only check for regex matches if they were not equal.</p>
</div>
</div>
<div class="sect3">
<h4 id="complete-set-of-steps-in-validation-glue-code"><a class="anchor" href="#complete-set-of-steps-in-validation-glue-code"></a>5.3.5. Complete set of steps in validation glue code</h4>
<div class="sect4">
<h5 id="tgr-setze-anfrage-timeout-auf-int-sekunden"><a class="anchor" href="#tgr-setze-anfrage-timeout-auf-int-sekunden"></a>TGR setze Anfrage Timeout auf {int} Sekunden</h5>

</div>
<div class="sect4">
<h5 id="tgr-set-request-wait-timeout-to-int-seconds"><a class="anchor" href="#tgr-set-request-wait-timeout-to-int-seconds"></a>TGR set request wait timeout to {int} seconds</h5>
<div class="paragraph indent">
<p>Specify the amount of seconds Tiger should wait when filtering for requests / responses before<br>
reporting them as not found.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-lösche-aufgezeichnete-nachrichten"><a class="anchor" href="#tgr-lösche-aufgezeichnete-nachrichten"></a>TGR lösche aufgezeichnete Nachrichten</h5>

</div>
<div class="sect4">
<h5 id="tgr-clear-recorded-messages"><a class="anchor" href="#tgr-clear-recorded-messages"></a>TGR clear recorded messages</h5>
<div class="paragraph indent">
<p>clear all validatable rbel messages. This does not clear the recorded messages later on<br>
reported via the rbel log HTML page or the messages shown on web ui of tiger proxies.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-filtere-anfragen-nach-server-tigerresolvedstring"><a class="anchor" href="#tgr-filtere-anfragen-nach-server-tigerresolvedstring"></a>TGR filtere Anfragen nach Server {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-filter-requests-based-on-host-tigerresolvedstring"><a class="anchor" href="#tgr-filter-requests-based-on-host-tigerresolvedstring"></a>TGR filter requests based on host {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>filter all subsequent findRequest steps for hostname. To reset set host name to empty string<br>
"".</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> hostname host name (regex supported) to filter for</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-filtere-anfragen-nach-http-methode-tigerresolvedstring"><a class="anchor" href="#tgr-filtere-anfragen-nach-http-methode-tigerresolvedstring"></a>TGR filtere Anfragen nach HTTP Methode {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-filter-requests-based-on-method-tigerresolvedstring"><a class="anchor" href="#tgr-filter-requests-based-on-method-tigerresolvedstring"></a>TGR filter requests based on method {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>filter all subsequent findRequest steps for method.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method method to filter for</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-lösche-den-gesetzten-http-methodenfilter"><a class="anchor" href="#tgr-lösche-den-gesetzten-http-methodenfilter"></a>TGR lösche den gesetzten HTTP Methodenfilter</h5>

</div>
<div class="sect4">
<h5 id="tgr-reset-request-method-filter"><a class="anchor" href="#tgr-reset-request-method-filter"></a>TGR reset request method filter</h5>
<div class="paragraph indent">
<p>reset filter for method for subsequent findRequest steps.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-warte-auf-eine-nachricht-in-der-knoten-tigerresolvedstring-mit-tigerresolvedstring-übereinstimmt"><a class="anchor" href="#tgr-warte-auf-eine-nachricht-in-der-knoten-tigerresolvedstring-mit-tigerresolvedstring-übereinstimmt"></a>TGR warte auf eine Nachricht, in der Knoten {tigerResolvedString} mit {tigerResolvedString}" + " übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-wait-for-message-with-node-tigerresolvedstring-matching-tigerresolvedstring"><a class="anchor" href="#tgr-wait-for-message-with-node-tigerresolvedstring-matching-tigerresolvedstring"></a>TGR wait for message with node {tigerResolvedString} matching {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Wait until a message is found in which the given node, specified by a RbelPath-Expression,<br>
matches the given value. This method will NOT alter currentRequest/currentResponse!!</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-warte-auf-eine-neue-nachricht-in-der-knoten-tigerresolvedstring-mit-tigerresolvedstring-übereinstimmt"><a class="anchor" href="#tgr-warte-auf-eine-neue-nachricht-in-der-knoten-tigerresolvedstring-mit-tigerresolvedstring-übereinstimmt"></a>TGR warte auf eine neue Nachricht, in der Knoten {tigerResolvedString} mit" + " {tigerResolvedString} übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-wait-for-new-message-with-node-tigerresolvedstring-matching-tigerresolvedstring"><a class="anchor" href="#tgr-wait-for-new-message-with-node-tigerresolvedstring-matching-tigerresolvedstring"></a>TGR wait for new message with node {tigerResolvedString} matching {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Wait until a NEW message is found in which the given node, specified by a RbelPath-Expression,<br>
matches the given value. NEW in this context means that the step will wait and check only<br>
messages which are received after the step has started. Any previously received messages will<br>
NOT be checked. Please also note that the currentRequest/currentResponse used by the find /<br>
find next steps are not altered by this step.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-erste-anfrage-mit-pfad-string"><a class="anchor" href="#tgr-finde-die-erste-anfrage-mit-pfad-string"></a>TGR finde die erste Anfrage mit Pfad {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-request-to-path-string"><a class="anchor" href="#tgr-find-request-to-path-string"></a>TGR find request to path {string}</h5>
<div class="paragraph indent">
<p>find the first request where the path equals or matches as regex and memorize it in the {<strong>link</strong><br>
#rbelValidator} instance</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-erste-anfrage-mit-pfad-string-und-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-erste-anfrage-mit-pfad-string-und-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die erste Anfrage mit Pfad {string} und Knoten {string} der mit {string}" + " übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-request-to-path-string-with-string-matching-string"><a class="anchor" href="#tgr-find-request-to-path-string-with-string-matching-string"></a>TGR find request to path {string} with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the first request where path and node value equal or match as regex and memorize it in the<br>
{<strong>link</strong> #rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match<br>
<strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-nächste-anfrage-mit-dem-pfad-string"><a class="anchor" href="#tgr-finde-die-nächste-anfrage-mit-dem-pfad-string"></a>TGR finde die nächste Anfrage mit dem Pfad {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-next-request-to-path-string"><a class="anchor" href="#tgr-find-next-request-to-path-string"></a>TGR find next request to path {string}</h5>
<div class="paragraph indent">
<p>find the NEXT request where the path equals or matches as regex and memorize it in the {<strong>link</strong><br>
#rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-nächste-anfrage-mit-pfad-string-und-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-nächste-anfrage-mit-pfad-string-und-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die nächste Anfrage mit Pfad {string} und Knoten {string} der mit {string}" + " übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-next-request-to-path-string-with-string-matching-string"><a class="anchor" href="#tgr-find-next-request-to-path-string-with-string-matching-string"></a>TGR find next request to path {string} with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the NEXT request where path and node value equal or match as regex and memorize it in the<br>
{<strong>link</strong> #rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match<br>
<strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-erste-anfrage-mit-pfad-string-die-den-knoten-string-enthält"><a class="anchor" href="#tgr-finde-die-erste-anfrage-mit-pfad-string-die-den-knoten-string-enthält"></a>TGR finde die erste Anfrage mit Pfad {string} die den Knoten {string} enthält</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-request-to-path-string-containing-node-string"><a class="anchor" href="#tgr-find-request-to-path-string-containing-node-string"></a>TGR find request to path {string} containing node {string}</h5>
<div class="paragraph indent">
<p>find the first request where path matches and request contains node with given rbel path and<br>
memorize it in the {<strong>link</strong> #rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match<br>
<strong>param</strong> rbelPath rbel path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-nächste-anfrage-mit-pfad-string-die-den-knoten-string-enthält"><a class="anchor" href="#tgr-finde-die-nächste-anfrage-mit-pfad-string-die-den-knoten-string-enthält"></a>TGR finde die nächste Anfrage mit Pfad {string} die den Knoten {string} enthält</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-next-request-to-path-string-containing-node-string"><a class="anchor" href="#tgr-find-next-request-to-path-string-containing-node-string"></a>TGR find next request to path {string} containing node {string}</h5>
<div class="paragraph indent">
<p>find the NEXT request where path matches and request contains node with given rbel path and<br>
memorize it in the {<strong>link</strong> #rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match<br>
<strong>param</strong> rbelPath rbel path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-letzte-anfrage-mit-dem-pfad-string"><a class="anchor" href="#tgr-finde-die-letzte-anfrage-mit-dem-pfad-string"></a>TGR finde die letzte Anfrage mit dem Pfad {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-last-request-to-path-string"><a class="anchor" href="#tgr-find-last-request-to-path-string"></a>TGR find last request to path {string}</h5>
<div class="paragraph indent">
<p>find the LAST request where the path equals or matches as regex and memorize it in the {<strong>link</strong><br>
#rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-letzte-anfrage-mit-pfad-string-und-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-letzte-anfrage-mit-pfad-string-und-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die letzte Anfrage mit Pfad {string} und Knoten {string} der mit {string}" + " übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-last-request-to-path-string-with-string-matching-string"><a class="anchor" href="#tgr-find-last-request-to-path-string-with-string-matching-string"></a>TGR find last request to path {string} with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the LAST request where path and node value equal or match as regex and memorize it in the<br>
{<strong>link</strong> #rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> path path to match<br>
<strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-letzte-anfrage-mit-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-letzte-anfrage-mit-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die letzte Anfrage mit Knoten {string} der mit {string}" + " übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-last-request-with-string-matching-string"><a class="anchor" href="#tgr-find-last-request-with-string-matching-string"></a>TGR find last request with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the LAST request where the node value equal or match as regex and memorize it in the<br>
{<strong>link</strong> #rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-letzte-anfrage"><a class="anchor" href="#tgr-finde-die-letzte-anfrage"></a>TGR finde die letzte Anfrage</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-the-last-request"><a class="anchor" href="#tgr-find-the-last-request"></a>TGR find the last request</h5>
<div class="paragraph indent">
<p>find the LAST request.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-eine-nachricht-mit-knoten-tigerresolvedstring-der-mit-tigerresolvedstring-übereinstimmt"><a class="anchor" href="#tgr-finde-eine-nachricht-mit-knoten-tigerresolvedstring-der-mit-tigerresolvedstring-übereinstimmt"></a>TGR finde eine Nachricht mit Knoten {tigerResolvedString} der mit {tigerResolvedString}" + " übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-any-message-with-attribute-tigerresolvedstring-matches-tigerresolvedstring"><a class="anchor" href="#tgr-any-message-with-attribute-tigerresolvedstring-matches-tigerresolvedstring"></a>TGR any message with attribute {tigerResolvedString} matches {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that there is any message with given rbel path node/attribute matching given value. The<br>
matching will NOT perform regular expression matching but only checks for identical string<br>
content The result (request or response) will not be stored in the {<strong>link</strong> #rbelValidator}<br>
instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute<br>
<strong>deprecated</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-erste-nachricht-mit-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-erste-nachricht-mit-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die erste Nachricht mit Knoten {string} der mit {string} übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-message-with-string-matching-string"><a class="anchor" href="#tgr-find-message-with-string-matching-string"></a>TGR find message with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the first message where node value equal or match as regex and memorize it in the {<strong>link</strong><br>
#rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-erste-nachricht-mit-knoten-string"><a class="anchor" href="#tgr-finde-die-erste-nachricht-mit-knoten-string"></a>TGR finde die erste Nachricht mit Knoten {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-message-with-string"><a class="anchor" href="#tgr-find-message-with-string"></a>TGR find message with {string}</h5>
<div class="paragraph indent">
<p>find the first message containing given node and memorize it in the {<strong>link</strong> #rbelValidator}<br>
instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-nächste-nachricht-mit-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-nächste-nachricht-mit-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die nächste Nachricht mit Knoten {string} der mit {string} übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-next-message-with-string-matching-string"><a class="anchor" href="#tgr-find-next-message-with-string-matching-string"></a>TGR find next message with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the next message where node value equal or match as regex and memorize it in the {<strong>link</strong><br>
#rbelValidator} instance. If the previous search using the 'find*message' steps found a<br>
response message, then this search starts after that response, otherwise, it starts after the<br>
current request message.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-nächste-nachricht-mit-knoten-string"><a class="anchor" href="#tgr-finde-die-nächste-nachricht-mit-knoten-string"></a>TGR finde die nächste Nachricht mit Knoten {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-next-message-with-string"><a class="anchor" href="#tgr-find-next-message-with-string"></a>TGR find next message with {string}</h5>
<div class="paragraph indent">
<p>find the next message containing given node and memorize it in the {<strong>link</strong> #rbelValidator}<br>
instance. If the previous search using any of the 'find*message' steps found a response<br>
message, then this search starts after that response, otherwise, it starts after the current<br>
request message.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-letzte-nachricht-mit-knoten-string-der-mit-string-übereinstimmt"><a class="anchor" href="#tgr-finde-die-letzte-nachricht-mit-knoten-string-der-mit-string-übereinstimmt"></a>TGR finde die letzte Nachricht mit Knoten {string} der mit {string} übereinstimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-last-message-with-string-matching-string"><a class="anchor" href="#tgr-find-last-message-with-string-matching-string"></a>TGR find last message with {string} matching {string}</h5>
<div class="paragraph indent">
<p>find the last message where node value equal or match as regex and memorize it in the {<strong>link</strong><br>
#rbelValidator} instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute<br>
<strong>param</strong> value value to match at given node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-finde-die-letzte-nachricht-mit-knoten-string"><a class="anchor" href="#tgr-finde-die-letzte-nachricht-mit-knoten-string"></a>TGR finde die letzte Nachricht mit Knoten {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-find-last-message-with-string"><a class="anchor" href="#tgr-find-last-message-with-string"></a>TGR find last message with {string}</h5>
<div class="paragraph indent">
<p>find the last message containing given node and memorize it in the {<strong>link</strong> * #rbelValidator}<br>
instance.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath rbel path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktueller-request-stimmt-im-body-überein-mit"><a class="anchor" href="#tgr-prüfe-aktueller-request-stimmt-im-body-überein-mit"></a>TGR prüfe aktueller Request stimmt im Body überein mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-request-body-matches"><a class="anchor" href="#tgr-current-request-body-matches"></a>TGR current request body matches:</h5>
<div class="paragraph indent">
<p>assert that request body matches.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> docString value / regex that should equal or match</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktueller-request-stimmt-im-knoten-tigerresolvedstring-überein-mit-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-aktueller-request-stimmt-im-knoten-tigerresolvedstring-überein-mit-tigerresolvedstring"></a>TGR prüfe aktueller Request stimmt im Knoten {tigerResolvedString} überein mit" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-request-with-attribute-tigerresolvedstring-matches-tigerresolvedstring"><a class="anchor" href="#tgr-current-request-with-attribute-tigerresolvedstring-matches-tigerresolvedstring"></a>TGR current request with attribute {tigerResolvedString} matches {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that request matches the value at given rbel path node/attribute. If multiple nodes are<br>
found, each is tested and if any matches, this step succeeds.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> value value / regex that should equal or match as string content with MultiLine and<br>
    DotAll regex option</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktueller-request-enthält-knoten-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-aktueller-request-enthält-knoten-tigerresolvedstring"></a>TGR prüfe aktueller Request enthält Knoten {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-request-contains-node-tigerresolvedstring"><a class="anchor" href="#tgr-current-request-contains-node-tigerresolvedstring"></a>TGR current request contains node {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that request contains at least 1 (or maybe more) node/attribute at given rbel path.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktueller-request-im-knoten-tigerresolvedstring-stimmt-überein-mit"><a class="anchor" href="#tgr-prüfe-aktueller-request-im-knoten-tigerresolvedstring-stimmt-überein-mit"></a>TGR prüfe aktueller Request im Knoten {tigerResolvedString} stimmt überein mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-request-at-tigerresolvedstring-matches"><a class="anchor" href="#tgr-current-request-at-tigerresolvedstring-matches"></a>TGR current request at {tigerResolvedString} matches:</h5>
<div class="paragraph indent">
<p>assert that request matches at given rbel path node/attribute. If multiple nodes are found,<br>
each is tested and if any matches, this step succeeds.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> docString value / regex that should equal or match as string content with MultiLine and<br>
    DotAll regex option supplied as DocString</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktueller-request-im-knoten-tigerresolvedstring-stimmt-als-modetype-überein-mit"><a class="anchor" href="#tgr-prüfe-aktueller-request-im-knoten-tigerresolvedstring-stimmt-als-modetype-überein-mit"></a>TGR prüfe aktueller Request im Knoten {tigerResolvedString} stimmt als {modeType} überein" + " mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-request-at-tigerresolvedstring-matches-as-modetype"><a class="anchor" href="#tgr-current-request-at-tigerresolvedstring-matches-as-modetype"></a>TGR current request at {tigerResolvedString} matches as {modeType}:</h5>
<div class="paragraph indent">
<p>assert that request matches at given rbel path node/attribute assuming it&#8217;s JSON or XML. If<br>
multiple nodes are found, each is tested, and if any matches, this step succeeds.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> mode one of JSON|XML<br>
<strong>param</strong> oracleDocStr value / regex that should equal or match as JSON or XML content<br>
<strong>see</strong> JsonChecker#compareJsonStrings(String, String, boolean)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktueller-request-stimmt-im-knoten-tigerresolvedstring-nicht-überein-mit-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-aktueller-request-stimmt-im-knoten-tigerresolvedstring-nicht-überein-mit-tigerresolvedstring"></a>TGR prüfe aktueller Request stimmt im Knoten {tigerResolvedString} nicht überein mit" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-request-with-attribute-tigerresolvedstring-does-not-match-tigerresolvedstring"><a class="anchor" href="#tgr-current-request-with-attribute-tigerresolvedstring-does-not-match-tigerresolvedstring"></a>TGR current request with attribute {tigerResolvedString} does not match" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that request does not match at given rbel path node/attribute. If multiple nodes are<br>
found, each is tested, and if any matches, this step fails.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> value value / regex that should NOT BE equal or should NOT match as string content with<br>
    MultiLine and DotAll regex option</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-speichere-wert-des-knotens-tigerresolvedstring-der-aktuellen-antwort-in-der-variable-tigerresolvedstring"><a class="anchor" href="#tgr-speichere-wert-des-knotens-tigerresolvedstring-der-aktuellen-antwort-in-der-variable-tigerresolvedstring"></a>TGR speichere Wert des Knotens {tigerResolvedString} der aktuellen Antwort in der Variable" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-store-current-response-node-text-value-at-tigerresolvedstring-in-variable-tigerresolvedstring"><a class="anchor" href="#tgr-store-current-response-node-text-value-at-tigerresolvedstring-in-variable-tigerresolvedstring"></a>TGR store current response node text value at {tigerResolvedString} in variable" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>store given rbel path node/attribute text value of current response.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> varName name of variable to store the node text value in</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-ersetze-tigerresolvedstring-mit-tigerresolvedstring-im-inhalt-der-variable-tigerresolvedstring"><a class="anchor" href="#tgr-ersetze-tigerresolvedstring-mit-tigerresolvedstring-im-inhalt-der-variable-tigerresolvedstring"></a>TGR ersetze {tigerResolvedString} mit {tigerResolvedString} im Inhalt der Variable" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-replace-tigerresolvedstring-with-tigerresolvedstring-in-content-of-variable-tigerresolvedstring"><a class="anchor" href="#tgr-replace-tigerresolvedstring-with-tigerresolvedstring-in-content-of-variable-tigerresolvedstring"></a>TGR replace {tigerResolvedString} with {tigerResolvedString} in content of variable" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>replace stored content with given regex</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> regexPattern regular expression to search for<br>
<strong>param</strong> replace string to replace all matches with<br>
<strong>param</strong> varName name of variable to store the node text value in</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-stimmt-im-body-überein-mit"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-stimmt-im-body-überein-mit"></a>TGR prüfe aktuelle Antwort stimmt im Body überein mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-body-matches"><a class="anchor" href="#tgr-current-response-body-matches"></a>TGR current response body matches:</h5>
<div class="paragraph indent">
<p>assert that response body of filtered request matches.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> docString value / regex that should equal or match</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-enthält-knoten-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-enthält-knoten-tigerresolvedstring"></a>TGR prüfe aktuelle Antwort enthält Knoten {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-contains-node-tigerresolvedstring"><a class="anchor" href="#tgr-current-response-contains-node-tigerresolvedstring"></a>TGR current response contains node {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that response of filtered request contains at least one node/attribute at given rbel<br>
path.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-stimmt-im-knoten-tigerresolvedstring-überein-mit-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-stimmt-im-knoten-tigerresolvedstring-überein-mit-tigerresolvedstring"></a>TGR prüfe aktuelle Antwort stimmt im Knoten {tigerResolvedString} überein mit" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-with-attribute-tigerresolvedstring-matches-tigerresolvedstring"><a class="anchor" href="#tgr-current-response-with-attribute-tigerresolvedstring-matches-tigerresolvedstring"></a>TGR current response with attribute {tigerResolvedString} matches {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that response of filtered request matches at given rbel path node/attribute. If multiple<br>
nodes are found, each is tested and if any matches, this step succeeds.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> value value / regex that should equal or match as string content with MultiLine and<br>
    DotAll regex option</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-stimmt-im-knoten-tigerresolvedstring-nicht-überein-mit-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-stimmt-im-knoten-tigerresolvedstring-nicht-überein-mit-tigerresolvedstring"></a>TGR prüfe aktuelle Antwort stimmt im Knoten {tigerResolvedString} nicht überein mit" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-with-attribute-tigerresolvedstring-does-not-match-tigerresolvedstring"><a class="anchor" href="#tgr-current-response-with-attribute-tigerresolvedstring-does-not-match-tigerresolvedstring"></a>TGR current response with attribute {tigerResolvedString} does not match" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>assert that response of filtered request does not match at given rbel path node/attribute. If<br>
multiple nodes are found, each is tested and if any matches, this step fails.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> value value / regex that should NOT BE equal or should NOT match as string content with<br>
    MultiLine and DotAll regex option</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-überein-mit"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-überein-mit"></a>TGR prüfe aktuelle Antwort im Knoten {tigerResolvedString} stimmt überein mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-at-tigerresolvedstring-matches"><a class="anchor" href="#tgr-current-response-at-tigerresolvedstring-matches"></a>TGR current response at {tigerResolvedString} matches:</h5>
<div class="paragraph indent">
<p>assert that response of filtered request matches at given rbel path node/attribute. If multiple<br>
nodes are found, each is tested and if any matches, this step succeeds.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> docString value / regex that should equal or match as string content with MultiLine and<br>
    DotAll regex option supplied as DocString</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-nicht-überein-mit"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-nicht-überein-mit"></a>TGR prüfe aktuelle Antwort im Knoten {tigerResolvedString} stimmt nicht überein mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-at-tigerresolvedstring-does-not-match"><a class="anchor" href="#tgr-current-response-at-tigerresolvedstring-does-not-match"></a>TGR current response at {tigerResolvedString} does not match:</h5>
<div class="paragraph indent">
<p>assert that response of filtered request does not match at given rbel path node/attribute. If<br>
multiple nodes are found, each is tested and if any matches, this step fails.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> docString value / regex that should equal or match as string content with MultiLine and<br>
    DotAll regex option supplied as DocString</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-als-modetype-überein-mit"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-als-modetype-überein-mit"></a>TGR prüfe aktuelle Antwort im Knoten {tigerResolvedString} stimmt als {modeType} überein" + " mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-at-tigerresolvedstring-matches-as-modetype"><a class="anchor" href="#tgr-current-response-at-tigerresolvedstring-matches-as-modetype"></a>TGR current response at {tigerResolvedString} matches as {modeType}:</h5>
<div class="paragraph indent">
<p>assert that response of filtered request matches at given rbel path node/attribute assuming<br>
it&#8217;s JSON or XML. If multiple nodes match, each is tested, and if any match this step succeeds.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> mode one of JSON|XML<br>
<strong>param</strong> oracleDocStr value / regex that should equal or match as JSON or XML content<br>
<strong>see</strong> JsonChecker#compareJsonStrings(String, String, boolean)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-als-xml-mit-folgenden-diff-optionen-tigerresolvedstring-überein-mit"><a class="anchor" href="#tgr-prüfe-aktuelle-antwort-im-knoten-tigerresolvedstring-stimmt-als-xml-mit-folgenden-diff-optionen-tigerresolvedstring-überein-mit"></a>TGR prüfe aktuelle Antwort im Knoten {tigerResolvedString} stimmt als XML mit folgenden diff" + " Optionen {tigerResolvedString} überein mit:</h5>

</div>
<div class="sect4">
<h5 id="tgr-current-response-at-tigerresolvedstring-matches-as-xml-and-diff-options-tigerresolvedstring"><a class="anchor" href="#tgr-current-response-at-tigerresolvedstring-matches-as-xml-and-diff-options-tigerresolvedstring"></a>TGR current response at {tigerResolvedString} matches as XML and diff options" + " {tigerResolvedString}:</h5>
<div class="paragraph indent">
<p>assert that response of filtered request matches at given rbel path node/attribute assuming its<br>
XML with the given list of diff options. If multiple nodes match, each is tested and if any<br>
match, this step succeeds</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> rbelPath path to node/attribute<br>
<strong>param</strong> diffOptionsCSV a csv separated list of diff option identifiers to be applied to<br>
    comparison of the two XML sources<br>
    &lt;ul&gt;<br>
      &lt;li&gt;nocomment &#8230;&#8203; {<strong>link</strong> DiffBuilder#ignoreComments()}<br>
      &lt;li&gt;txtignoreempty &#8230;&#8203; {<strong>link</strong> DiffBuilder#ignoreElementContentWhitespace()}<br>
      &lt;li&gt;txttrim &#8230;&#8203; {<strong>link</strong> DiffBuilder#ignoreWhitespace()}<br>
      &lt;li&gt;txtnormalize &#8230;&#8203; {<strong>link</strong> DiffBuilder#normalizeWhitespace()}<br>
    &lt;/ul&gt;<br>
<strong>param</strong> xmlDocStr value / regex that should equal or match as JSON content<br>
<strong>see</strong> &lt;a href="https://github.com/xmlunit/user-guide/wiki/DifferenceEvaluator"&gt;More on<br>
    DifferenceEvaluator&lt;/a&gt;</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-gebe-alle-nachrichten-als-rbel-tree-aus"><a class="anchor" href="#tgr-gebe-alle-nachrichten-als-rbel-tree-aus"></a>TGR gebe alle Nachrichten als Rbel-Tree aus</h5>

</div>
<div class="sect4">
<h5 id="tgr-print-all-messages-as-rbel-tree"><a class="anchor" href="#tgr-print-all-messages-as-rbel-tree"></a>TGR print all messages as rbel-tree</h5>
<div class="paragraph indent">
<p>Prints the rbel-tree of all requests and responses to the System-out</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-gebe-aktuelle-response-als-rbel-tree-aus"><a class="anchor" href="#tgr-gebe-aktuelle-response-als-rbel-tree-aus"></a>TGR gebe aktuelle Response als Rbel-Tree aus</h5>

</div>
<div class="sect4">
<h5 id="tgr-print-current-response-as-rbel-tree"><a class="anchor" href="#tgr-print-current-response-as-rbel-tree"></a>TGR print current response as rbel-tree</h5>
<div class="paragraph indent">
<p>Prints the rbel-tree of the current response to the System-out</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-gebe-aktuelle-request-als-rbel-tree-aus"><a class="anchor" href="#tgr-gebe-aktuelle-request-als-rbel-tree-aus"></a>TGR gebe aktuelle Request als Rbel-Tree aus</h5>

</div>
<div class="sect4">
<h5 id="tgr-print-current-request-as-rbel-tree"><a class="anchor" href="#tgr-print-current-request-as-rbel-tree"></a>TGR print current request as rbel-tree</h5>
<div class="paragraph indent">
<p>Prints the rbel-tree of the current request to the System-out</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-liest-folgende-tgr-datei-tigerresolvedstring"><a class="anchor" href="#tgr-liest-folgende-tgr-datei-tigerresolvedstring"></a>TGR liest folgende .tgr Datei {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-reads-the-following-tgr-file-tigerresolvedstring"><a class="anchor" href="#tgr-reads-the-following-tgr-file-tigerresolvedstring"></a>TGR reads the following .tgr file {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Reads a Tiger traffic file and sends messages to local Tiger proxy</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-the-custom-failure-message-is-set-to-tigerresolvedstring"><a class="anchor" href="#tgr-the-custom-failure-message-is-set-to-tigerresolvedstring"></a>TGR the custom failure message is set to {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-die-fehlermeldung-wird-gesetzt-auf-tigerresolvedstring"><a class="anchor" href="#tgr-die-fehlermeldung-wird-gesetzt-auf-tigerresolvedstring"></a>TGR die Fehlermeldung wird gesetzt auf: {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Sets a custom failure message that will be displayed in the logs if a following step in the<br>
test fails.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> customFailureMessage the custom failure message</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-clear-the-custom-failure-message"><a class="anchor" href="#tgr-clear-the-custom-failure-message"></a>TGR clear the custom failure message</h5>

</div>
<div class="sect4">
<h5 id="tgr-lösche-die-benutzerdefinierte-fehlermeldung"><a class="anchor" href="#tgr-lösche-die-benutzerdefinierte-fehlermeldung"></a>TGR lösche die benutzerdefinierte Fehlermeldung</h5>
<div class="paragraph indent">
<p>Clears the custom failure message</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modifying-rbelobjects-rbelbuilder"><a class="anchor" href="#modifying-rbelobjects-rbelbuilder"></a>5.4. Modifying RbelObjects (RbelBuilder)</h3>
<div class="sect3">
<h4 id="introduction"><a class="anchor" href="#introduction"></a>5.4.1. Introduction</h4>
<div class="paragraph">
<p>Tiger supports modifying JSON, XML and several token formats.<br>
After loading in an object from a string or a file the RbelObject can be modified in multiple ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changing a primitive value at a certain path</p>
</li>
<li>
<p>replacing a primitive node by an object node and vice versa</p>
</li>
<li>
<p>adding new nodes and primitive values as child path of an existing path</p>
</li>
<li>
<p>adding new nodes to an array/list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the adjustments the values of the modified RbelElements can be asserted.<br>
The object can be serialised back to a string.<br>
Jexl Expressions are implemented, as for reading a file or for serializing:<br>
<code>'!{rbelObject:serialize("myRbelObject")}'</code></p>
</div>
</div>
<div class="sect3">
<h4 id="list-of-all-possible-steps"><a class="anchor" href="#list-of-all-possible-steps"></a>5.4.2. List of all possible Steps</h4>
<div class="sect4">
<h5 id="tgr-erstellt-ein-neues-rbel-objekt-tigerresolvedstring-mit-inhalt-tigerresolvedstring"><a class="anchor" href="#tgr-erstellt-ein-neues-rbel-objekt-tigerresolvedstring-mit-inhalt-tigerresolvedstring"></a>TGR erstellt ein neues Rbel-Objekt {tigerResolvedString} mit Inhalt {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-creates-a-new-rbel-object-tigerresolvedstring-with-content-tigerresolvedstring"><a class="anchor" href="#tgr-creates-a-new-rbel-object-tigerresolvedstring-with-content-tigerresolvedstring"></a>TGR creates a new Rbel object {tigerResolvedString} with content {tigerResolvedString}</h5>
<div class="paragraph indent">
<div class="title">Using the Rbel builder steps</div>
<p>Creates a new Rbel object with a given key and string content; the string can be a jexl<br>
expression</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> name key of Rbel object<br>
<strong>param</strong> content content of Rbel object, or jexl expression resolving to one</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-erstellt-ein-neues-leeres-rbel-objekt-tigerresolvedstring-mit-typ-rbelcontenttype"><a class="anchor" href="#tgr-erstellt-ein-neues-leeres-rbel-objekt-tigerresolvedstring-mit-typ-rbelcontenttype"></a>TGR erstellt ein neues leeres Rbel-Objekt {tigerResolvedString} mit Typ {rbelContentType}</h5>

</div>
<div class="sect4">
<h5 id="tgr-creates-a-new-empty-rbel-object-tigerresolvedstring-of-type-rbelcontenttype"><a class="anchor" href="#tgr-creates-a-new-empty-rbel-object-tigerresolvedstring-of-type-rbelcontenttype"></a>TGR creates a new empty Rbel object {tigerResolvedString} of type {rbelContentType}</h5>
<div class="paragraph indent">
<p>Creates a new empty Rbel object</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> name key of Rbel object</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-setzt-rbel-objekt-tigerresolvedstring-an-stelle-tigerresolvedstring-auf-wert-tigerresolvedstring"><a class="anchor" href="#tgr-setzt-rbel-objekt-tigerresolvedstring-an-stelle-tigerresolvedstring-auf-wert-tigerresolvedstring"></a>TGR setzt Rbel-Objekt {tigerResolvedString} an Stelle {tigerResolvedString} auf Wert" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-sets-rbel-object-tigerresolvedstring-at-tigerresolvedstring-to-new-value-tigerresolvedstring"><a class="anchor" href="#tgr-sets-rbel-object-tigerresolvedstring-at-tigerresolvedstring-to-new-value-tigerresolvedstring"></a>TGR sets Rbel object {tigerResolvedString} at {tigerResolvedString} to new value" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Sets a value of an object at a specified path; newValue is of type String</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> objectName name of object in rbelBuilders<br>
<strong>param</strong> rbelPath path which is to be set<br>
<strong>param</strong> newValue new value to be set</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-ergänzt-rbel-objekt-tigerresolvedstring-an-stelle-tigerresolvedstring-um-tigerresolvedstring"><a class="anchor" href="#tgr-ergänzt-rbel-objekt-tigerresolvedstring-an-stelle-tigerresolvedstring-um-tigerresolvedstring"></a>TGR ergänzt Rbel-Objekt {tigerResolvedString} an Stelle {tigerResolvedString} um" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-extends-rbel-object-tigerresolvedstring-at-path-tigerresolvedstring-by-a-new-entry-tigerresolvedstring"><a class="anchor" href="#tgr-extends-rbel-object-tigerresolvedstring-at-path-tigerresolvedstring-by-a-new-entry-tigerresolvedstring"></a>TGR extends Rbel object {tigerResolvedString} at path {tigerResolvedString} by a new entry" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Adds a new entry to an array or a list of a Rbel object at a specific path</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> objectName name of Rbel object<br>
<strong>param</strong> rbelPath path of array/list<br>
<strong>param</strong> newEntry new entry</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüft-dass-rbel-objekt-tigerresolvedstring-an-stelle-tigerresolvedstring-gleich-tigerresolvedstring-ist"><a class="anchor" href="#tgr-prüft-dass-rbel-objekt-tigerresolvedstring-an-stelle-tigerresolvedstring-gleich-tigerresolvedstring-ist"></a>TGR prüft, dass Rbel-Objekt {tigerResolvedString} an Stelle {tigerResolvedString} gleich" + " {tigerResolvedString} ist</h5>

</div>
<div class="sect4">
<h5 id="tgr-asserts-rbel-object-tigerresolvedstring-at-tigerresolvedstring-equals-tigerresolvedstring"><a class="anchor" href="#tgr-asserts-rbel-object-tigerresolvedstring-at-tigerresolvedstring-equals-tigerresolvedstring"></a>TGR asserts Rbel object {tigerResolvedString} at {tigerResolvedString} equals" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Asserts whether a string value at a given path of the rootTreeNode of a RbelBuilder is a<br>
certain value</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> objectName name of RbelBuilder in rbelBuilders Map<br>
<strong>param</strong> rbelPath Path to specific node<br>
<strong>param</strong> expectedValue value to be asserted</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüft-dass-tigerresolvedstring-gleich-tigerresolvedstring-mit-typ-rbelcontenttype-ist"><a class="anchor" href="#tgr-prüft-dass-tigerresolvedstring-gleich-tigerresolvedstring-mit-typ-rbelcontenttype-ist"></a>TGR prüft, dass {tigerResolvedString} gleich {tigerResolvedString} mit Typ {rbelContentType}" + " ist</h5>

</div>
<div class="sect4">
<h5 id="tgr-asserts-tigerresolvedstring-equals-tigerresolvedstring-of-type-rbelcontenttype"><a class="anchor" href="#tgr-asserts-tigerresolvedstring-equals-tigerresolvedstring-of-type-rbelcontenttype"></a>TGR asserts {tigerResolvedString} equals {tigerResolvedString} of type {rbelContentType}</h5>
<div class="paragraph indent">
<p>Asserts, if 2 Rbel object serializations are equal</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> jexlExpressionActual actual value<br>
<strong>param</strong> jexlExpressionExpected expected value<br>
<strong>param</strong> contentType type of Rbel object content for comparison</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage-examples"><a class="anchor" href="#usage-examples"></a>5.4.3. Usage examples</h4>
<div class="listingblock">
<div class="title">Listing 18. Tiger Rbel Builder steps example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature Tiger validation steps

  Scenario: Example steps

    Given TGR clear recorded messages
    And TGR filter requests based on host "testnode.example.org"
    And TGR filter requests based on method "POST"
    And TGR set request wait timeout to 20 seconds
    When TGR find request to path "/path/path/blabla" with "$..tag.value.text" matching "abc.*"
    And TGR find request to path "/path/path/blabla" containing node "$..tag"
    Then TGR current response with attribute "$..answer.result.text" matches "OK.*"
    But TGR current response with attribute "$..answer.reason.text" does not match "REQUEST.*"
    And TGR current response body matches:
    """
         body content
        """
    And TGR current response at "$..tag" matches as JSON:
    """
          {
            "arr1": [
              "asso", "bsso"
            ]
          }
        """
    And TGR current response at "$..tag" matches as XML:
    """
          &lt;arr1&gt;
            &lt;entry index="1"&gt;asso&lt;/entry&gt;
            &lt;entry index="2"&gt;bsso&lt;/entry&gt;
          &lt;/arr1&gt;
        """

    Given TGR find message with "$.pop3Body.mimeHeader.subject" matching ".*test.*"
    Given TGR find next message with "$.pop3Status" matching "-ERR"
    Given TGR find last message with "$.pop3Command" matching "RETR"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-http-client-steps"><a class="anchor" href="#using-the-http-client-steps"></a>5.5. Using the HTTP client steps</h3>
<div class="paragraph">
<p>The Tiger HTTP client steps are a set of Cucumber steps that enable you to perform simple HTTP requests, with bodies, default and custom headers.</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. Tiger response validation steps example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature: HTTP/HTTPS GlueCode Test feature

  Background:
    Given TGR clear recorded messages

  Scenario: Simple Get Request
    Given TGR clear recorded messages
    When TGR send empty GET request to "http://httpbin/"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.method')}" matches "GET"
    And TGR assert "!{rbel:currentRequestAsString('$.path')}" matches "\/?"

  Scenario: Get Request to folder
    When TGR send empty GET request to "http://httpbin/get"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.method')}" matches "GET"
    And TGR assert "!{rbel:currentRequestAsString('$.path')}" matches "\/get\/?"

  Scenario: PUT Request to folder
    When TGR send empty PUT request to "http://httpbin/put"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.method')}" matches "PUT"
    And TGR assert "!{rbel:currentRequestAsString('$.path')}" matches "\/put\/?"

  Scenario: PUT Request with body to folder
    When TGR send PUT request to "http://httpbin/put" with body "{'hello': 'world!'}"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.method')}" matches "PUT"
    And TGR assert "!{rbel:currentRequestAsString('$.path')}" matches "\/put\/?"
    And TGR assert "!{rbel:currentRequestAsString('$.body.hello')}" matches "world!"

  Scenario: PUT Request with body from file to folder
    When TGR send PUT request to "http://httpbin/put" with body "!{file('pom.xml')}"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.method')}" matches "PUT"
    And TGR assert "!{rbel:currentRequestAsString('$.path')}" matches "\/put\/?"
    And TGR assert "!{rbel:currentRequestAsString('$.body.project.modelVersion.text')}" matches "4.0.0"
   # application/octet-stream is used since no rewriting is done, so unknown/default MIME-type is assumed
    And TGR assert "!{rbel:currentRequestAsString('$.header.Content-Type')}" matches "application/octet-stream.*"

  Scenario: DELETE Request without body
    When TGR send empty DELETE request to "http://httpbin/delete"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.method')}" matches "DELETE"
    And TGR assert "!{rbel:currentRequestAsString('$.path')}" matches "\/delete\/?"

  Scenario: Request with custom header
    When TGR send empty GET request to "http://httpbin/get" with headers:
      | foo    | bar |
      | schmoo | lar |
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.header.foo')}" matches "bar"
    And TGR assert "!{rbel:currentRequestAsString('$.header.schmoo')}" matches "lar"

  Scenario: Request with default header
    Given TGR set default header "key" to "value"
    When TGR send empty GET request to "http://httpbin/get"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.header.key')}" matches "value"
    When TGR send POST request to "http://httpbin/post" with body "hello world"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.header.key')}" matches "value"
    And TGR assert "!{rbel:currentRequestAsString('$.body')}" matches "hello world"

  Scenario: Request with custom and default header, check headers
    Given TGR set default header "key" to "value"
    When TGR send empty GET request to "http://httpbin/get" with headers:
      | foo | bar |
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.header.foo')}" matches "bar"
    And TGR assert "!{rbel:currentRequestAsString('$.header.key')}" matches "value"

  Scenario: Get Request with custom and default header, check body, application type url encoded
    Given TGR set local variable "configured_state_value" to "some weird $value§"
    Given TGR set local variable "configured_param_name" to "my_cool_param"
    When TGR send GET request to "http://httpbin/get" with:
      | ${configured_param_name} | state                     | redirect_uri        |
      | client_id                | ${configured_state_value} | https://my.redirect |
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.path.state.value')}" matches "${configured_state_value}"
    And TGR assert "!{rbel:currentRequestAsString('$.path.state')}" matches "state=!{urlEncoded('some weird $value§')}"
    And TGR assert "!{rbel:currentRequestAsString('$.path.my_cool_param')}" matches "${configured_param_name}=client_id"
    And TGR assert "!{rbel:currentRequestAsString('$.header.Content-Type')}" matches "application/x-www-form-urlencoded.*"

  Scenario: Post Request with custom and default header, check body, application type url encoded
    Given TGR set local variable "configured_state_value" to "some weird $value§"
    Given TGR set local variable "configured_param_name" to "my_cool_param"
    When TGR send POST request to "http://httpbin/post" with:
      | ${configured_param_name} | state                     | redirect_uri        |
      | client_id                | ${configured_state_value} | https://my.redirect |
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.body.state')}" matches "!{urlEncoded('some weird $value§')}"
    And TGR assert "!{rbel:currentRequestAsString('$.body.my_cool_param')}" matches "client_id"
    And TGR assert "!{rbel:currentRequestAsString('$.header.Content-Type')}" matches "application/x-www-form-urlencoded.*"
    And TGR assert "!{rbel:currentRequestAsString('$.body.redirect_uri')}" matches "!{urlEncoded('https://my.redirect')}"

  Scenario: Request with custom and default header, check application type json
    Given TGR set default header "Content-Type" to "application/json"
    When TGR send POST request to "http://httpbin/post" with:
      | ${configured_param_name} |
      | client_id                |
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.header.Content-Type')}" matches "application/json"

  Scenario Outline: JEXL Rbel Namespace Test
    Given TGR send empty GET request to "http://httpbin/html"
    Then TGR find request to path "/html"
    Then TGR current response with attribute "$.body.html.body.h1.text" matches "!{rbel:currentResponseAsString('$.body.html.body.h1.text')}"

    Examples: We use this data only for testing data variant display in workflow ui, there is no deeper sense in it
      | txt   | txt2 | txt3 | txt4 | txt5 |
      | text2 | 21   | 31   | 41   | 51   |
      | text2 | 22   | 32   | 42   | 52   |

  Scenario: Simple first test
    Given TGR send empty GET request to "http://httpbin/html"
    Then TGR find request to path "/html"
    Then TGR current response with attribute "$.body.html.body.h1.text" matches "Herman Melville - Moby-Dick"

  Scenario: Test Find Last Request
    Given TGR send empty GET request to "http://httpbin/anything?foobar=1"
    Then TGR send empty GET request to "http://httpbin/anything?foobar=2"
    Then TGR find last request to path "/anything"
    Then TGR current response with attribute "$.responseCode" matches "200"
    Then TGR current response with attribute "$.body.url.content.foobar.value" matches "2"

  Scenario: Test find last request with parameters
    Given TGR send empty GET request to "http://httpbin/anything?foobar=1"
    Then TGR send empty GET request to "http://httpbin/anything?foobar=1&amp;xyz=4"
    Then TGR send empty GET request to "http://httpbin/anything?foobar=2"
    Then TGR find last request to path "/anything" with "$.path.foobar.value" matching "1"
    Then TGR current response with attribute "$.body.url.content.xyz.value" matches "4"

  Scenario: Test find last request
    Given TGR send empty GET request to "http://httpbin/anything?foobar=1"
    Then TGR send empty GET request to "http://httpbin/anything?foobar=2"
    Then TGR send empty GET request to "http://httpbin/anything?foobar=3"
    Then TGR send empty GET request to "http://httpbin/status/404?other=param"
    Then TGR find the last request
    Then TGR current response with attribute "$.responseCode" matches "404"
    Then TGR assert "!{rbel:currentRequestAsString('$.path.other.value')}" matches "param"

  Scenario: Get Request to folder and test param is url decoded when access via $.path and ..value is url decoded
    When TGR send empty GET request to "http://httpbin/get?foo=bar%20and%20schmar"
    Then TGR find last request to path ".*"
    And TGR assert "!{rbel:currentRequestAsString('$.path.foo.value')}" matches "bar and schmar"
    And TGR assert "!{rbel:currentRequestAsString('$.path.foo')}" matches "foo=bar%20and%20schmar"

  Scenario: Test deactivate followRedirects
    When TGR disable HttpClient followRedirects configuration
    And TGR send empty GET request to "http://httpbin/redirect-to?url=!{urlEncoded('http://httpbin/status/200')}"
    Then TGR find the last request
    Then TGR current response with attribute "$.responseCode" matches "302"
    And TGR current response with attribute "$.header.Location" matches "http://httpbin/status/200"
    When TGR reset HttpClient followRedirects configuration
    And TGR send empty GET request to "http://httpbin/redirect-to?url=!{urlEncoded('http://httpbin/status/200')}"
    Then TGR find the last request
    Then TGR current response with attribute "$.responseCode" matches "200"

  Scenario: Test check filter POST request
    Given TGR send POST request to "http://httpbin/post" with body "{'foobar': '4'}"
    And TGR send empty GET request to "http://httpbin/anything?foobar=22"
    And TGR filter requests based on method "POST"
    Then TGR find last request to path ".*"
    Then TGR current response with attribute "$.body.data.foobar" matches "4"

  Scenario: Test check filter GET request
    Given TGR send empty GET request to "http://httpbin/anything?foobar=22"
    And TGR send POST request to "http://httpbin/post" with body "{'foobar': '4'}"
    And TGR filter requests based on method "GET"
    Then TGR find last request to path ".*"
    Then TGR current response with attribute "$.body.args.foobar" matches "22"

  Scenario: Test check filter method reset
    Given TGR reset request method filter
   # check resetting it works even if done twice
    And TGR reset request method filter
    And TGR send empty GET request to "http://httpbin/anything?foobar=22"
    And TGR send POST request to "http://httpbin/post" with body "{'foobar': '4'}"
    Given TGR reset request method filter
    Then TGR find the last request
    Then TGR current response with attribute "$.body.data.foobar" matches "4"

  Scenario: Test check filter POST request
    Given TGR send empty GET request to "http://httpbin/anything?foobar=66"
    When TGR find last request with "$.path.foobar.value" matching "66"
    Then TGR current response with attribute "$.body.args.foobar.content" matches "66"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="complete-set-of-steps-in-http-client-glue-code"><a class="anchor" href="#complete-set-of-steps-in-http-client-glue-code"></a>5.5.1. Complete set of steps in HTTP client glue code</h4>
<div class="sect4">
<h5 id="tgr-send-empty-requesttype-request-to-tigerresolvedurl"><a class="anchor" href="#tgr-send-empty-requesttype-request-to-tigerresolvedurl"></a>TGR send empty {requestType} request to {tigerResolvedUrl}</h5>

</div>
<div class="sect4">
<h5 id="tgr-eine-leere-requesttype-anfrage-an-tigerresolvedurl-sendet"><a class="anchor" href="#tgr-eine-leere-requesttype-anfrage-an-tigerresolvedurl-sendet"></a>TGR eine leere {requestType} Anfrage an {tigerResolvedUrl} sendet</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl"><a class="anchor" href="#tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl"></a>TGR sende eine leere {requestType} Anfrage an {tigerResolvedUrl}</h5>
<div class="paragraph indent">
<p>Sends an empty request via the selected method. Placeholders in address will be resolved.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-empty-requesttype-request-to-tigerresolvedurl-without-waiting-for-the-response"><a class="anchor" href="#tgr-send-empty-requesttype-request-to-tigerresolvedurl-without-waiting-for-the-response"></a>TGR send empty {requestType} request to {tigerResolvedUrl} without waiting for the response</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl-ohne-auf-antwort-zu-warten"><a class="anchor" href="#tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl-ohne-auf-antwort-zu-warten"></a>TGR sende eine leere {requestType} Anfrage an {tigerResolvedUrl} ohne auf Antwort zu warten</h5>
<div class="paragraph indent">
<p>Sends an empty request via the selected method. Placeholders in address will be resolved.</p>
</div>
<div class="paragraph indent">
<p>This method is NON-BLOCKING, meaning it will not wait for the response before continuing the<br>
test.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-empty-requesttype-request-to-tigerresolvedurl-with-headers"><a class="anchor" href="#tgr-send-empty-requesttype-request-to-tigerresolvedurl-with-headers"></a>TGR send empty {requestType} request to {tigerResolvedUrl} with headers:</h5>

</div>
<div class="sect4">
<h5 id="tgr-eine-leere-requesttype-anfrage-an-tigerresolvedurl-und-den-folgenden-headern-sendet"><a class="anchor" href="#tgr-eine-leere-requesttype-anfrage-an-tigerresolvedurl-und-den-folgenden-headern-sendet"></a>TGR eine leere {requestType} Anfrage an {tigerResolvedUrl} und den folgenden Headern" + " sendet:</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl-mit-folgenden-headern"><a class="anchor" href="#tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl-mit-folgenden-headern"></a>TGR sende eine leere {requestType} Anfrage an {tigerResolvedUrl} mit folgenden Headern:</h5>
<div class="paragraph indent">
<p>Sends an empty request via the selected method and expands the list of default headers with the<br>
headers provided by the caller. Placeholders in address and in the data table will be resolved.<br>
Example:</p>
</div>
<div class="listingblock indent">
<div class="content">
<pre>    When TGR send empty GET request to "${myAddress}" with headers:
     | name | bob |
     | age  | 27  |</pre>
</div>
</div>
<div class="paragraph indent">
<p>This will add two headers (name and age) with the respective values "bob" and "27" on top of<br>
the headers which are used by default.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>param</strong> customHeaders Markdown table of custom headers and their values<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-empty-requesttype-request-to-tigerresolvedurl-without-waiting-for-the-response-with-headers"><a class="anchor" href="#tgr-send-empty-requesttype-request-to-tigerresolvedurl-without-waiting-for-the-response-with-headers"></a>TGR send empty {requestType} request to {tigerResolvedUrl} without waiting for the response" + " with headers:</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl-ohne-auf-antwort-zu-warten-mit-folgenden-headern"><a class="anchor" href="#tgr-sende-eine-leere-requesttype-anfrage-an-tigerresolvedurl-ohne-auf-antwort-zu-warten-mit-folgenden-headern"></a>TGR sende eine leere {requestType} Anfrage an {tigerResolvedUrl} ohne auf Antwort zu warten" + " mit folgenden Headern:</h5>
<div class="paragraph indent">
<p>Sends an empty request via the selected method and expands the list of default headers with the<br>
headers provided by the caller. Placeholders in address and in the data table will be resolved.</p>
</div>
<div class="paragraph indent">
<p>This method is NON-BLOCKING, meaning it will not wait for the response before continuing the<br>
test.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>param</strong> customHeaders Markdown table of custom headers and their values<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-requesttype-request-to-tigerresolvedurl-with-body-string"><a class="anchor" href="#tgr-send-requesttype-request-to-tigerresolvedurl-with-body-string"></a>TGR send {requestType} request to {tigerResolvedUrl} with body {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-eine-leere-requesttype-anfrage-an-tigerresolvedurl-und-dem-folgenden-body-string-sendet"><a class="anchor" href="#tgr-eine-leere-requesttype-anfrage-an-tigerresolvedurl-und-dem-folgenden-body-string-sendet"></a>TGR eine leere {requestType} Anfrage an {tigerResolvedUrl} und dem folgenden body {string}" + " sendet</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-body-string"><a class="anchor" href="#tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-body-string"></a>TGR sende eine {requestType} Anfrage an {tigerResolvedUrl} mit Body {string}</h5>
<div class="paragraph indent">
<p>Sends a request containing the provided body via the selected method. Placeholders in the body<br>
and in address will be resolved.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> body to be included in the request<br>
<strong>param</strong> address target address<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-requesttype-request-to-tigerresolvedurl-with-body-string-without-waiting-for-the-response"><a class="anchor" href="#tgr-send-requesttype-request-to-tigerresolvedurl-with-body-string-without-waiting-for-the-response"></a>TGR send {requestType} request to {tigerResolvedUrl} with body {string} without waiting for" + " the response</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-body-string-ohne-auf-antwort-zu-warten"><a class="anchor" href="#tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-body-string-ohne-auf-antwort-zu-warten"></a>TGR sende eine {requestType} Anfrage an {tigerResolvedUrl} mit Body {string} ohne auf" + " Antwort zu warten</h5>
<div class="paragraph indent">
<p>Sends a request containing the provided body via the selected method. Placeholders in the body<br>
and in address will be resolved.</p>
</div>
<div class="paragraph indent">
<p>This method is NON-BLOCKING, meaning it will not wait for the response before continuing the<br>
test.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> body to be included in the request<br>
<strong>param</strong> address target address<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-requesttype-request-to-tigerresolvedurl-with"><a class="anchor" href="#tgr-send-requesttype-request-to-tigerresolvedurl-with"></a>TGR send {requestType} request to {tigerResolvedUrl} with:</h5>

</div>
<div class="sect4">
<h5 id="tgr-eine-requesttype-anfrage-an-tigerresolvedurl-mit-den-folgenden-daten-sendet"><a class="anchor" href="#tgr-eine-requesttype-anfrage-an-tigerresolvedurl-mit-den-folgenden-daten-sendet"></a>TGR eine {requestType} Anfrage an {tigerResolvedUrl} mit den folgenden Daten sendet:</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-folgenden-daten"><a class="anchor" href="#tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-folgenden-daten"></a>TGR sende eine {requestType} Anfrage an {tigerResolvedUrl} mit folgenden Daten:</h5>
<div class="paragraph indent">
<p>Sends a request via the selected method. The request is expanded by the provided key-value<br>
pairs. Placeholders in keys and values will be resolved. The values must not be URL encoded, as<br>
this is done by the step. Example:</p>
</div>
<div class="listingblock indent">
<div class="content">
<pre>     When Send POST request to "http://my.address.com" with
      | ${configured_param_name}   | state                     | redirect_uri        |
      | client_id                  | ${configured_state_value} | https://my.redirect |</pre>
</div>
</div>
<div class="paragraph indent">
<p><strong>NOTE:</strong> This Markdown table must contain exactly 1 row of headers and 1 row of values.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>param</strong> parameters to be sent with the request<br>
<strong>see</strong> RequestSpecification#formParams(Map)<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-requesttype-request-to-tigerresolvedurl-with-multiline-body"><a class="anchor" href="#tgr-send-requesttype-request-to-tigerresolvedurl-with-multiline-body"></a>TGR send {requestType} request to {tigerResolvedUrl} with multiline body:</h5>

</div>
<div class="sect4">
<h5 id="tgr-eine-requesttype-anfrage-an-tigerresolvedurl-mit-den-folgenden-mehrzeiligen-daten-sendet"><a class="anchor" href="#tgr-eine-requesttype-anfrage-an-tigerresolvedurl-mit-den-folgenden-mehrzeiligen-daten-sendet"></a>TGR eine {requestType} Anfrage an {tigerResolvedUrl} mit den folgenden mehrzeiligen Daten" + " sendet:</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-folgenden-mehrzeiligen-daten"><a class="anchor" href="#tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-folgenden-mehrzeiligen-daten"></a>TGR sende eine {requestType} Anfrage an {tigerResolvedUrl} mit folgenden mehrzeiligen" + " Daten:</h5>
<div class="paragraph indent">
<p>Sends a request via the selected method. For the given request&#8217;s body placeholders in keys and<br>
values will be resolved. This step is meant to be used for more complex bodys spanning multiple<br>
lines.</p>
</div>
<div class="paragraph indent">
<p>Example:</p>
</div>
<div class="listingblock indent">
<div class="content">
<pre>     When TGR send POST request to "http://my.address.com" with multiline body:
      """
        {
             "name": "value",
             "object": { "member": "value" },
             "array" : [ 1,2,3,4]
        }
      """</pre>
</div>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>param</strong> body body content of the request<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-send-requesttype-request-to-tigerresolvedurl-with-contenttype-string-and-multiline-body"><a class="anchor" href="#tgr-send-requesttype-request-to-tigerresolvedurl-with-contenttype-string-and-multiline-body"></a>TGR send {requestType} request to {tigerResolvedUrl} with contentType {string} and multiline" + " body:</h5>

</div>
<div class="sect4">
<h5 id="tgr-eine-requesttype-anfrage-an-tigerresolvedurl-mit-contenttype-string-und-den-folgenden-mehrzeiligen-daten-sendet"><a class="anchor" href="#tgr-eine-requesttype-anfrage-an-tigerresolvedurl-mit-contenttype-string-und-den-folgenden-mehrzeiligen-daten-sendet"></a>TGR eine {requestType} Anfrage an {tigerResolvedUrl} mit ContentType {string} und den" + " folgenden mehrzeiligen Daten sendet:</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-contenttype-string-und-folgenden-mehrzeiligen-daten"><a class="anchor" href="#tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-mit-contenttype-string-und-folgenden-mehrzeiligen-daten"></a>TGR sende eine {requestType} Anfrage an {tigerResolvedUrl} mit ContentType {string} und" + " folgenden mehrzeiligen Daten:</h5>

</div>
<div class="sect4">
<h5 id="tgr-send-requesttype-request-to-tigerresolvedurl-without-waiting-for-the-response-with"><a class="anchor" href="#tgr-send-requesttype-request-to-tigerresolvedurl-without-waiting-for-the-response-with"></a>TGR send {requestType} request to {tigerResolvedUrl} without waiting for the response with:</h5>

</div>
<div class="sect4">
<h5 id="tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-ohne-auf-antwort-zu-warten-mit-folgenden-daten"><a class="anchor" href="#tgr-sende-eine-requesttype-anfrage-an-tigerresolvedurl-ohne-auf-antwort-zu-warten-mit-folgenden-daten"></a>TGR sende eine {requestType} Anfrage an {tigerResolvedUrl} ohne auf Antwort zu warten mit" + " folgenden Daten:</h5>
<div class="paragraph indent">
<p>Sends a request via the selected method. The request is expanded by the provided key-value<br>
pairs. Placeholders in keys and values will be resolved. The values must not be URL encoded, as<br>
this is done by the step.</p>
</div>
<div class="paragraph indent">
<p>This method is NON-BLOCKING, meaning it will not wait for the response before continuing the<br>
test.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> method HTTP request method (see {<strong>link</strong> Method})<br>
<strong>param</strong> address target address<br>
<strong>param</strong> parameters to be sent with the request<br>
<strong>see</strong> RequestSpecification#formParams(Map)<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-set-default-header-tigerresolvedstring-to-tigerresolvedstring"><a class="anchor" href="#tgr-set-default-header-tigerresolvedstring-to-tigerresolvedstring"></a>TGR set default header {tigerResolvedString} to {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-den-default-header-tigerresolvedstring-auf-den-wert-tigerresolvedstring-setzen"><a class="anchor" href="#tgr-den-default-header-tigerresolvedstring-auf-den-wert-tigerresolvedstring-setzen"></a>TGR den default header {tigerResolvedString} auf den Wert {tigerResolvedString} setzen</h5>

</div>
<div class="sect4">
<h5 id="tgr-setze-den-default-header-tigerresolvedstring-auf-den-wert-tigerresolvedstring"><a class="anchor" href="#tgr-setze-den-default-header-tigerresolvedstring-auf-den-wert-tigerresolvedstring"></a>TGR setze den default header {tigerResolvedString} auf den Wert {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Expands the list of default headers with the provided key-value pair. If the key already<br>
exists, then the existing value is overwritten by the new value. Placeholders in the header<br>
name and in its value will be resolved.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> header key<br>
<strong>param</strong> value to be stored under the given key<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-set-default-headers"><a class="anchor" href="#tgr-set-default-headers"></a>TGR set default headers:</h5>

</div>
<div class="sect4">
<h5 id="tgr-setze-folgende-default-headers"><a class="anchor" href="#tgr-setze-folgende-default-headers"></a>TGR setze folgende default headers:</h5>

</div>
<div class="sect4">
<h5 id="tgr-folgende-default-headers-gesetzt-werden"><a class="anchor" href="#tgr-folgende-default-headers-gesetzt-werden"></a>TGR folgende default headers gesetzt werden:</h5>
<div class="paragraph indent">
<p>Expands the list of default headers with the provided key-value pairs. If the key already<br>
exists, then the existing value is overwritten by the new value. Placeholders in the header<br>
names and in their values will be resolved.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> docstring multiline doc string, one key value pair per line<br>
<strong>see</strong> TigerGlobalConfiguration#resolvePlaceholders(String)</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-clear-all-default-headers"><a class="anchor" href="#tgr-clear-all-default-headers"></a>TGR clear all default headers</h5>

</div>
<div class="sect4">
<h5 id="tgr-lösche-alle-default-headers"><a class="anchor" href="#tgr-lösche-alle-default-headers"></a>TGR lösche alle default headers</h5>
<div class="paragraph indent">
<p>Clear all default headers set in previous steps.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-disable-httpclient-followredirects-configuration"><a class="anchor" href="#tgr-disable-httpclient-followredirects-configuration"></a>TGR disable HttpClient followRedirects configuration</h5>

</div>
<div class="sect4">
<h5 id="tgr-httpclient-followredirects-konfiguration-deaktiviert"><a class="anchor" href="#tgr-httpclient-followredirects-konfiguration-deaktiviert"></a>TGR HttpClient followRedirects Konfiguration deaktiviert</h5>
<div class="paragraph indent">
<p>Modifies the global configuration of the HttpClient to not automatically follow redirects. All<br>
following requests will use the modified configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-reset-httpclient-followredirects-configuration"><a class="anchor" href="#tgr-reset-httpclient-followredirects-configuration"></a>TGR reset HttpClient followRedirects configuration</h5>

</div>
<div class="sect4">
<h5 id="tgr-httpclient-followredirects-konfiguration-zurücksetzt"><a class="anchor" href="#tgr-httpclient-followredirects-konfiguration-zurücksetzt"></a>TGR HttpClient followRedirects Konfiguration zurücksetzt</h5>
<div class="paragraph indent">
<p>Resets the global configuration of the HttpClient to its default behavior of automatically<br>
following redirects.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xmlunit-diff-builder"><a class="anchor" href="#xmlunit-diff-builder"></a>5.5.2. XMLUnit Diff Builder</h4>
<div class="paragraph">
<p>Using the validation steps <code>TGR current response at {string} matches as XML:</code> or<br>
<code>TGR current response at {string} matches as XML and diff options {string}:</code> you are able to compare the content of any RbelPath node in the response.<br>
The latter method even allows passing in the following options to the XMLUnit&#8217;s DiffBuilder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"nocomment" for DiffBuilder::ignoreComments</p>
</li>
<li>
<p>"txtignoreempty" for DiffBuilder::ignoreElementContentWhitespace</p>
</li>
<li>
<p>"txttrim" for DiffBuilder::ignoreWhitespace</p>
</li>
<li>
<p>"txtnormalize" for DiffBuilder::normalizeWhitespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Per default the comparison algorithm will ignore mismatches in namespace prefixes and URIs.<br>
Comparison is also performed on similarity and not equal content.</p>
</div>
<div class="paragraph">
<p>For more detailed explanation about the XMLUnit difference evaluator we refer to the <a href="https://github.com/xmlunit/user-guide/wiki/DiffBuilder">online documentation of the XMLUnit project</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jsonchecker"><a class="anchor" href="#jsonchecker"></a>5.5.3. JSONChecker</h4>
<div class="paragraph">
<p>Using the validation step <code>TGR current response at {string} matches as JSON:</code> you are able to compare the content of any RbelPath node in the response to the doc string beneath the step, with the help of the JSONChecker comparison algorithm.</p>
</div>
<div class="paragraph">
<p>The purpose of JSONChecker class is to compare JSON structures, including checking for the integrity of the whole RbelPath node, as well as matching values for particular keys.</p>
</div>
<div class="paragraph">
<p>To make sure all the attributes in your JSON RbelPath structure are present, such features as ${json-unit.ignore}, $NULL, optional attributes, regular expressions and lenient mode can come in handy.</p>
</div>
<div class="paragraph">
<p>${json-unit.ignore} is a parameter which allows ignoring certain values in your RbelPath node while comparing, and the result of such comparison always returns true.<br>
It also works when ${json-unit.ignore} is used in a JSON array or nested JSON object.<br>
This parameter should be placed as a value of a key.<br>
To ignore some attributes in the JSON structure, you can set a boolean value checkExtraAttributes as false.<br>
In this case if you miss one attribute in your doc string, the comparison will still be equal to true.</p>
</div>
<div class="paragraph">
<p>To check whether the value for a particular key is null, you can either use null or parameter $NULL at the place of the value.<br>
Checking whether a nested key is null also works with JSONChecker.</p>
</div>
<div class="paragraph">
<p>Four underscores "<em>__</em>" before the JSON keys indicate that these keys are optional and will be checked for the value ONLY if the value exists in the test JSON RBelPath node.<br>
Please note that checking whether a nested key is optional, is not yet possible with JsonChecker.</p>
</div>
<div class="paragraph">
<p>JSON Arrays are compared in lenient mode, meaning that the order of elements in JSON array doesn&#8217;t matter.</p>
</div>
<div class="paragraph">
<p>Identifying missing keys is made easy in JSONChecker with the help of parameter $REMOVE.</p>
</div>
<div class="paragraph">
<p>If you specify the name of the key and then $REMOVE parameter as its value, the comparison will result in true, if the key is indeed missing and false, if the key is present.<br>
It is worth noting that even if the value of the key is null, the key doesn&#8217;t count as missing.</p>
</div>
<div class="paragraph">
<p>Last but not least, regular expressions, which can be used for matching the whole JSON element, as well as particular values.<br>
It will be first checked, whether the expected value is equal to the actual one, and only afterwards, if the actual value matches a regular expression.</p>
</div>
<div class="paragraph">
<p>It should also be noted, that although JSONChecker can match multilevel JSON objects at a high level, it is not yet possible to access nested attributes out of the box.<br>
We are working on it :)</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. Simple adapted example from the IDP test suite</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  {
    "alg": "dir",
    "enc": "A256GCM",
    "cty": "$NULL",
    "exp": "[\\d]*",
    "____kid": ".*",
    "dummyentry": "${json-unit.ignore}",
    "dummyarray": [ "entry1", "entry2" ],
    "dummyarray2":  "${json-unit.ignore}"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows three main features of the JSONChecker.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Value specified as $NULL, meaning this value of this key is equal to null.</p>
</li>
<li>
<p>Usage of regular expression (e.g. ".*" and "[\\d]*") to match values.</p>
</li>
<li>
<p>Usage of "<em>__</em>" preceeding a json key: This indicates that the entry is optional but if it exists it must match the given value.</p>
</li>
<li>
<p>if a value is specified as "${json-unit.ignore}", there is no check performed at all.<br>
This applies also to objects and arrays as seen in the dummyarray2 entry.</p>
</li>
<li>
<p>if we match key dummyEntry2 to the value of $REMOVE, it will return true, because this key does not exist.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="json-schema-validation"><a class="anchor" href="#json-schema-validation"></a>JSON Schema Validation</h5>
<div class="paragraph">
<p>Using the validation step <code>TGR current response at {string} matches as JSON_SCHEMA:</code> you are able to assert that the content of any RbelPath node complies with the JSON Schema given in the doc string beneath the step.</p>
</div>
<div class="paragraph">
<p>We use the JSON Schema version 2020-12 for validation with the additional feature that we can have placeholders in the schema that will be replaced with values from the Tiger Global Configuration.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">TGR current response at "$.body" matches as JSON_SCHEMA:
"""
{
  "type": "object",
  "properties": {
    "name": {
      "type": "string"
    },
    "age": {
      "type": "integer",
      "minimum": 0
    },
    "email": {
      "type": "string",
      "format": "email"
    },
    "address": {
      "type": "string",
      "const": "${tiger.value.from.config}"
    }
  },
  "required": [
    "name",
    "age"
  ]
}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>would validate a message with a JSON body like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "hello",
  "age": 5,
  "email": "hello@example.com",
  "address": "Friedrichstraße"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>assuming that the value of <code>${tiger.value.from.config}</code> set in the Tiger Global Configuration is <code>Friedrichstraße</code>.</p>
</div>
<div class="paragraph">
<p>For full details how to specify a JSON Schema, refer to the external resource: <a href="https://json-schema.org/understanding-json-schema">Understanding JSON Schema</a>.<br>
In <a href="https://json-schema.org/implementations#validators-web-(online)">this list</a> you can find a list of online validators which you can use to test your schema.<br>
Remember to test under JSON Schema version 2020-12.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exemplaric-scenario-konnektorfarm-eau-validation"><a class="anchor" href="#exemplaric-scenario-konnektorfarm-eau-validation"></a>5.6. Exemplaric scenario Konnektorfarm EAU validation</h3>
<div class="paragraph">
<p>The EAU Konnektorfarm scenario is a scenario where customers can use their Primärsystem to test signing and verifying documents via a set of Konnektoren and that this works interoperable.<br>
For this purpose a phalanx of local Tiger Proxies is set up as reverse proxies for each Konnektor being hosted at the gematik location.<br>
Any message that is forwarded by any of these proxies is forwarded to an aggregating Tiger Proxy which in turn forwards all the received messages to the local Tiger Proxy for assertion via the validation test suite.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-integration-eau-testenv.svg" alt="tiger integration eau testenv">
</div>
<div class="title">Figure 10. Tiger EAU Konnektorfarm test environment</div>
</div>
<div class="paragraph">
<p>So after starting the validation test suite (and the test environment), the customer / Primärsystem manufacturer must perform the specified workflow.<br>
The test suite meanwhile will wait for a given order of requests/responses matching specified criteria to appear.<br>
If all is well, at the end the test report JSON files will be packed into a zip archive and can be uploaded to the Titus platform for further certification steps.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-integration-eau-process.svg" alt="tiger integration eau process">
</div>
<div class="title">Figure 11. Tiger EAU Konnektorfarm process</div>
</div>
</div>
<div class="sect2">
<h3 id="using-tiger-test-lib-helper-classes"><a class="anchor" href="#using-tiger-test-lib-helper-classes"></a>5.7. Using Tiger test lib helper classes</h3>
<div class="paragraph">
<p>If you don&#8217;t want to use the Tiger test framework but only pick a few helper classes the following classes might be of interest to you:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All classes listed here are part of the tiger-common module
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For BDD feature files Tiger provides some helper steps too.</p>
</div>
<div class="sect3">
<h4 id="complete-set-of-helper-steps-in-tiger-glue-code"><a class="anchor" href="#complete-set-of-helper-steps-in-tiger-glue-code"></a>5.7.1. Complete set of helper steps in Tiger glue code</h4>
<div class="sect4">
<h5 id="tgr-setze-globale-variable-tigerresolvedstring-auf-tigerresolvedstring"><a class="anchor" href="#tgr-setze-globale-variable-tigerresolvedstring-auf-tigerresolvedstring"></a>TGR setze globale Variable {tigerResolvedString} auf {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-set-global-variable-tigerresolvedstring-to-tigerresolvedstring"><a class="anchor" href="#tgr-set-global-variable-tigerresolvedstring-to-tigerresolvedstring"></a>TGR set global variable {tigerResolvedString} to {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Sets the given key to the given value in the global configuration store. Variable substitution<br>
is performed.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> key key of the context<br>
<strong>param</strong> value value for the context entry with given key</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-setze-lokale-variable-tigerresolvedstring-auf-tigerresolvedstring"><a class="anchor" href="#tgr-setze-lokale-variable-tigerresolvedstring-auf-tigerresolvedstring"></a>TGR setze lokale Variable {tigerResolvedString} auf {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-set-local-variable-tigerresolvedstring-to-tigerresolvedstring"><a class="anchor" href="#tgr-set-local-variable-tigerresolvedstring-to-tigerresolvedstring"></a>TGR set local variable {tigerResolvedString} to {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Sets the given key to the given value in the global configuration store. Variable substitution<br>
is performed. This value will only be available in the given scenario being clear up after the<br>
scenario run is finished.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> key key of the context<br>
<strong>param</strong> value value for the context entry with given key</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-setze-lokale-feature-variable-tigerresolvedstring-auf-tigerresolvedstring"><a class="anchor" href="#tgr-setze-lokale-feature-variable-tigerresolvedstring-auf-tigerresolvedstring"></a>TGR setze lokale Feature Variable {tigerResolvedString} auf {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-set-local-feature-variable-tigerresolvedstring-to-tigerresolvedstring"><a class="anchor" href="#tgr-set-local-feature-variable-tigerresolvedstring-to-tigerresolvedstring"></a>TGR set local feature variable {tigerResolvedString} to {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-prüfe-variable-tigerresolvedstring-stimmt-überein-mit-tigerresolvedstring"><a class="anchor" href="#tgr-prüfe-variable-tigerresolvedstring-stimmt-überein-mit-tigerresolvedstring"></a>TGR prüfe Variable {tigerResolvedString} stimmt überein mit {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-assert-variable-tigerresolvedstring-matches-tigerresolvedstring"><a class="anchor" href="#tgr-assert-variable-tigerresolvedstring-matches-tigerresolvedstring"></a>TGR assert variable {tigerResolvedString} matches {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>asserts that value with given key either equals or matches (regex) the given regex string.<br>
Variable substitution is performed. This checks both global and local variables!</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> key key of entry to check<br>
<strong>param</strong> regex regular expression (or equals string) to compare the value of the entry to</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-prüfe-variable-tigerresolvedstring-ist-unbekannt"><a class="anchor" href="#tgr-prüfe-variable-tigerresolvedstring-ist-unbekannt"></a>TGR prüfe Variable {tigerResolvedString} ist unbekannt</h5>

</div>
<div class="sect4">
<h5 id="tgr-assert-variable-tigerresolvedstring-is-unknown"><a class="anchor" href="#tgr-assert-variable-tigerresolvedstring-is-unknown"></a>TGR assert variable {tigerResolvedString} is unknown</h5>
<div class="paragraph indent">
<p>asserts that value of context entry with given key either equals or matches (regex) the given<br>
regex string. Variable substitution is performed.</p>
</div>
<div class="paragraph indent">
<p>Special values can be used:</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> key key of entry to check</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-zeige-word-banner-tigerresolvedstring"><a class="anchor" href="#tgr-zeige-word-banner-tigerresolvedstring"></a>TGR zeige {word} Banner {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-show-word-banner-tigerresolvedstring"><a class="anchor" href="#tgr-show-word-banner-tigerresolvedstring"></a>TGR show {word} banner {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-zeige-word-text-tigerresolvedstring"><a class="anchor" href="#tgr-zeige-word-text-tigerresolvedstring"></a>TGR zeige {word} Text {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-show-word-text-tigerresolvedstring"><a class="anchor" href="#tgr-show-word-text-tigerresolvedstring"></a>TGR show {word} text {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-zeige-banner-tigerresolvedstring"><a class="anchor" href="#tgr-zeige-banner-tigerresolvedstring"></a>TGR zeige Banner {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-show-banner-tigerresolvedstring"><a class="anchor" href="#tgr-show-banner-tigerresolvedstring"></a>TGR show banner {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-wait-for-user-abort"><a class="anchor" href="#tgr-wait-for-user-abort"></a>TGR wait for user abort</h5>

</div>
<div class="sect4">
<h5 id="tgr-warte-auf-abbruch"><a class="anchor" href="#tgr-warte-auf-abbruch"></a>TGR warte auf Abbruch</h5>
<div class="paragraph indent">
<p>This step aborts the test after user acknowledgement.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-pause-test-run-execution"><a class="anchor" href="#tgr-pause-test-run-execution"></a>TGR pause test run execution</h5>

</div>
<div class="sect4">
<h5 id="tgr-pausiere-testausführung"><a class="anchor" href="#tgr-pausiere-testausführung"></a>TGR pausiere Testausführung</h5>
<div class="paragraph indent">
<p>Pauses the validation test suite. Please note, these steps are only modified for the Workflow<br>
UI and don&#8217;t work on a regular console (no failure, there is just no pause).</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-pause-test-run-execution-with-message-string"><a class="anchor" href="#tgr-pause-test-run-execution-with-message-string"></a>TGR pause test run execution with message {string}</h5>

</div>
<div class="sect4">
<h5 id="tgr-pausiere-testausführung-mit-nachricht-string"><a class="anchor" href="#tgr-pausiere-testausführung-mit-nachricht-string"></a>TGR pausiere Testausführung mit Nachricht {string}</h5>
<div class="paragraph indent">
<p>Pauses the validation test suite with a message. Please note, these steps are only modified for<br>
the Workflow UI and don&#8217;t work on a regular console (no failure, there is just no popup /<br>
pause).</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> message message to be displayed in the Workflow UI.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-pause-test-run-execution-with-message-tigerresolvedstring-and-message-in-case-of-error-tigerresolvedstring"><a class="anchor" href="#tgr-pause-test-run-execution-with-message-tigerresolvedstring-and-message-in-case-of-error-tigerresolvedstring"></a>TGR pause test run execution with message {tigerResolvedString} and message in case of error" + " {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-pausiere-testausführung-mit-nachricht-tigerresolvedstring-und-meldung-im-fehlerfall-tigerresolvedstring"><a class="anchor" href="#tgr-pausiere-testausführung-mit-nachricht-tigerresolvedstring-und-meldung-im-fehlerfall-tigerresolvedstring"></a>TGR pausiere Testausführung mit Nachricht {tigerResolvedString} und Meldung im Fehlerfall" + " {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Pauses the validation test suite with a message shown and the option to either continue or fail<br>
with the given error message. Please note, these steps are only modified for the Workflow UI<br>
and don&#8217;t work on a regular console (no failure, there is just no popup / pause).</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> message message to be displayed in the Workflow UI.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-show-html-notification"><a class="anchor" href="#tgr-show-html-notification"></a>TGR show HTML Notification:</h5>

</div>
<div class="sect4">
<h5 id="tgr-zeige-html-notification"><a class="anchor" href="#tgr-zeige-html-notification"></a>TGR zeige HTML Notification:</h5>

</div>
<div class="sect4">
<h5 id="tgr-assert-tigerresolvedstring-matches-tigerresolvedstring"><a class="anchor" href="#tgr-assert-tigerresolvedstring-matches-tigerresolvedstring"></a>TGR assert {tigerResolvedString} matches {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-prüfe-das-tigerresolvedstring-mit-tigerresolvedstring-überein-stimmt"><a class="anchor" href="#tgr-prüfe-das-tigerresolvedstring-mit-tigerresolvedstring-überein-stimmt"></a>TGR prüfe das {tigerResolvedString} mit {tigerResolvedString} überein stimmt</h5>

</div>
<div class="sect4">
<h5 id="tgr-gebe-variable-tigerresolvedstring-aus"><a class="anchor" href="#tgr-gebe-variable-tigerresolvedstring-aus"></a>TGR gebe variable {tigerResolvedString} aus</h5>

</div>
<div class="sect4">
<h5 id="tgr-print-variable-tigerresolvedstring"><a class="anchor" href="#tgr-print-variable-tigerresolvedstring"></a>TGR print variable {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Prints the value of the given variable to the System-out</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-stop-server-tigerresolvedstring"><a class="anchor" href="#tgr-stop-server-tigerresolvedstring"></a>TGR stop server {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-stoppe-server-tigerresolvedstring"><a class="anchor" href="#tgr-stoppe-server-tigerresolvedstring"></a>TGR stoppe Server {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Stops the given server. If the server is not running or the server is not found, an exception<br>
is thrown.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> servername The server to be stopped.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-start-server-tigerresolvedstring"><a class="anchor" href="#tgr-start-server-tigerresolvedstring"></a>TGR start server {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-starte-server-tigerresolvedstring"><a class="anchor" href="#tgr-starte-server-tigerresolvedstring"></a>TGR starte Server {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Starts the given server. If the server is already running or the server is not found, an<br>
exception is thrown.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> servername The server to be started.</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-save-tigerglobalconfiguration-to-file-tigerresolvedstring"><a class="anchor" href="#tgr-save-tigerglobalconfiguration-to-file-tigerresolvedstring"></a>TGR save TigerGlobalConfiguration to file {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-speichere-tigerglobalconfiguration-in-datei-tigerresolvedstring"><a class="anchor" href="#tgr-speichere-tigerglobalconfiguration-in-datei-tigerresolvedstring"></a>TGR speichere TigerGlobalConfiguration in Datei {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Saves all the values of the Tiger Global Configuration in the given file formatted as yaml.</p>
</div>
<div class="paragraph indent">
<p>ATTENTION: If the file already exists it will be overwritten!</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> filename the file to save the configuration to<br>
<strong>throws</strong> IOException if an I/ O error occurs writing to or creating the file</p>
</div>
</div>
<div class="sect4">
<h5 id="tgr-load-tigerglobalconfiguration-from-file-tigerresolvedstring"><a class="anchor" href="#tgr-load-tigerglobalconfiguration-from-file-tigerresolvedstring"></a>TGR load TigerGlobalConfiguration from file {tigerResolvedString}</h5>

</div>
<div class="sect4">
<h5 id="tgr-lade-tigerglobalconfiguration-aus-datei-tigerresolvedstring"><a class="anchor" href="#tgr-lade-tigerglobalconfiguration-aus-datei-tigerresolvedstring"></a>TGR lade TigerGlobalConfiguration aus Datei {tigerResolvedString}</h5>
<div class="paragraph indent">
<p>Loads the Tiger Global Configuration from the given file. The file must be formatted as yaml.<br>
All previous values in the configuration will be cleared and only the values from the file will<br>
end up in the configuration.</p>
</div>
<div class="paragraph indent">
<p><strong>param</strong> filename the file to load the configuration from<br>
<strong>throws</strong> IOException if an I/O error occurs reading the file</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="banner"><a class="anchor" href="#banner"></a>5.7.2. Banner</h4>
<div class="paragraph">
<p>If you want to use large ASCII art style log banners you may find this class very helpful.<br>
Supports ANSI coloring and a set of different fonts.<br>
Furthermore, all banner messages are displayed and highlighted in the Workflow UI For more details please check the code and its usages in the Tiger test framework.</p>
</div>
</div>
<div class="sect3">
<h4 id="tigerserializationutil"><a class="anchor" href="#tigerserializationutil"></a>5.7.3. TigerSerializationUtil</h4>
<div class="paragraph">
<p>This class supports you in converting String representation of YAML and JSON data to an Java JSONObject or extract that or other loaded data to Java Maps.<br>
If you are planning to implement test data management or configuration sets, we propose to use the TigerGlobalConfiguration class described <a href="#_tiger_configuration">in detail here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tigerpkiidentityloader-tigerpkiidentity"><a class="anchor" href="#tigerpkiidentityloader-tigerpkiidentity"></a>5.7.4. TigerPkiIdentityLoader, TigerPkiIdentity</h4>
<div class="paragraph">
<p>The loader class allows to easily instantiate PKI identities from given files.<br>
For more details on the format and the supported file types please check <a href="#_configuring_pki_identities_in_tiger_proxys_tls_section">this section in the test environment chapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="performing-rest-calls-with-tiger"><a class="anchor" href="#performing-rest-calls-with-tiger"></a>5.7.5. Performing REST calls with Tiger</h4>
<div class="paragraph">
<p>Tiger is closely integrated with SerenityBDD, which in turn has integrated the RestAssured library, so if you use the <code>SerenityRest</code> helper class, you will get detailed information about each call inside the test report.<br>
The Tiger test library configuration also provides a flag to add curl command details to each of these calls, so that you can easily reproduce the REST call manually in case of test failure analysis.</p>
</div>
<div class="paragraph">
<p>For more information about REST testing in Tiger/SerenityBDD please check these two documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://serenity-bdd.github.io/theserenitybook/latest/serenity-rest.html">Serenity REST</a></p>
</li>
<li>
<p><a href="https://serenity-bdd.github.io/theserenitybook/latest/serenity-screenplay-rest.html">Serenity Screenplay REST</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-bdd-scenarios-with-polarion-test-cases-gematik-only"><a class="anchor" href="#synchronizing-bdd-scenarios-with-polarion-test-cases-gematik-only"></a>5.8. Synchronizing BDD scenarios with Polarion test cases (Gematik only)</h3>
<div class="paragraph">
<p>Within gematik we maintain test cases via feature files being committed to git repositories.<br>
To keep traceability to the requirements maintained in Polarion we have a Tiger sub project that synchronizes test cases in Polarion with the scenarios in our feature files.<br>
It is a one way synchronisation, where the master are the feature files.</p>
</div>
<div class="paragraph">
<p>To use this feature the scenarios need a minimal set of mandatory annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@TCID:xxx</strong> - a unique test case identifier, where 'xxx' matches the value of the custom field "cfInternalId" in Polarion</p>
</li>
<li>
<p><strong>@PRODUKT:p,p,p</strong> - reference to the custom field "cfProductType".<br>
You add this annotation above each feature, not each scenario. 'p' is a product, one is mandatory but it can be a list.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And following optional annotations exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@AFO-ID:xxx - a link to a defined requirement (Anforderung) in Polarion, where 'xxx' matches the custom field "cfAfoId"</p>
</li>
<li>
<p>@AF-ID:xxx - a link to a defined requirement (Anwendungsfall) in Polarion, where 'xxx' matches the custom field "cfAfId"</p>
</li>
<li>
<p>@AK-ID:xxx - a link to a defined requirement (Akzeptanzkriterium) in Polarion, where 'xxx' matches the work item id</p>
</li>
<li>
<p>@PRIO:n - priority number (1-4), default is '1'</p>
</li>
<li>
<p>@MODUS:xxx - describes the way of testing, default is 'automatisch'</p>
</li>
<li>
<p>@STATUS:xxx - describes the status of the test, default is 'implementiert'</p>
</li>
<li>
<p>@TESTFALL:n - describes if the test case is a negative testcase or positive one, default is 'positiv'</p>
</li>
<li>
<p>@TESTSTUFE:n - describes the test type, default is '3' (which is E2E-Test)</p>
</li>
<li>
<p>@DESCRIPTION - if your test case has a description, and you use this annotation, the description will be parsed.<br>
If not, the description stays empty and won&#8217;t overwrite the one already existing in Polarion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a scenario is identified that has no test case with a matching TCID, it will be created automatically in the sync run.<br>
Background blocks will be merged to each scenario before exporting its steps to Polarion.</p>
</div>
<div class="paragraph">
<p>For more details on how to perform the synchronisation, all choices for the annotations and how to upload generated test run reports to Polarion and Aurora, please check the README.md in the PolarionToolbox project on the Gematik GitLab.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tiger_configuration"><a class="anchor" href="#_tiger_configuration"></a>6. Tiger Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration is an integral part of testing.<br>
To make this task easier for you and to make configuration the various parts of the system as easy as possible Tiger has a central configuration store: TigerGlobalConfiguration.<br>
It combines properties from multiple source and feeds into various parts of the system.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-configuration-global.svg" alt="tiger configuration global">
</div>
<div class="title">Figure 12. The TigerGlobalConfiguration with inlets and outlets</div>
</div>
<div class="paragraph">
<p>This allows a vastly simplified retrieval and configuration of nearly all aspects of the system.<br>
It is therefore recommended reusing this system for your own testsuite as well.</p>
</div>
<div class="sect2">
<h3 id="_inlets"><a class="anchor" href="#_inlets"></a>6.1. Inlets</h3>
<div class="paragraph">
<p>The following inlets are considered in the TigerGlobalConfiguration (ordered from most to least important, meaning if a property occurs in multiple sources the one at the top is considered first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exports from ScopedExecutor</p>
</li>
<li>
<p>Thread-local exports</p>
</li>
<li>
<p>Exports done in glue code</p>
</li>
<li>
<p>Exports during runtime (<code>TigerGlobalConfiguration.putValue()</code>)</p>
</li>
<li>
<p>Command-line properties</p>
</li>
<li>
<p>System-Properties (System.setProperty)</p>
</li>
<li>
<p>Environment-Variables (export "FOO_BAR" = 42)</p>
</li>
<li>
<p>Full-text YAML file (value of <code>tiger.yaml</code> configuration key)</p>
</li>
<li>
<p>Additional YAML-Files (<code>additionalConfigurationFiles:</code>)</p>
</li>
<li>
<p>Host YAML-File (<code>tiger-&lt;hostname&gt;.yaml</code>)</p>
</li>
<li>
<p>Main YAML-File (<code>tiger.yaml</code>)</p>
</li>
<li>
<p>Interne Defaults</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="key-translation"><a class="anchor" href="#key-translation"></a>6.2. Key-translation</h3>
<div class="paragraph">
<p>To easily convert between the multiple sources the TigerGlobalConfiguration offers key-translation:</p>
</div>
<div class="paragraph">
<p><code>tiger.foo.bar</code> is equal to <code>TIGER_FOO_BAR</code> is equal to <code>tIgER.fOO.BaR</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the key consists only of letters and underscores then the underscores are converted to points.</p>
</li>
<li>
<p>Names are compared without considering the case.</p>
</li>
<li>
<p>Keys that contain '{', '}' or '|' are forbidden.<br>
To allow a clean startup on systems that have values like this configured the given characters are replaced by '_'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="thread-based-configuration"><a class="anchor" href="#thread-based-configuration"></a>6.3. Thread-based configuration</h3>
<div class="paragraph">
<p>To enable execution of multiple tests simultaneously some data has to be stored in a thread-based manner (the first step could for example store the result of a request in a variable, the second step could read it from that variable).</p>
</div>
<div class="paragraph">
<p>To enable this simply reference the Thread-context when storing a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TigerGlobalConfiguration.putValue("foo.value", "bar", ConfigurationFileType.THREAD_CONTEXT);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When retrieving the variable you could simply ask for <code>foo.value</code>: Only when you are in the thread that stored this variable you will find it again.</p>
</div>
</div>
<div class="sect2">
<h3 id="placeholders"><a class="anchor" href="#placeholders"></a>6.4. Placeholders</h3>
<div class="paragraph">
<p>The TigerGlobalConfiguration supports the use of placeholders.<br>
Say for example you have a test-environment with two servers, "A" and "B".<br>
For the server "A" you have two choices: Either a real URL in the internet or a locally booted server.<br>
The use can choose which to activate by setting "active" of the server to use.<br>
The server "B" should now use the activated server, without having to set it manually while booting.</p>
</div>
<div class="paragraph">
<p>You could achieve this by exporting the URL (<code>servers.myServer.exports</code>) and referencing it in an argument which is passed into server "B" (<code>serverAUrl=${serverA.url}</code>.<br>
The first part here before the equal is the name of the environment variable passed into server "B" while booting, the second part behind the equal is the name of the property. compare this to the exports in the two serverA-options):</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. Configuring using placeholders and exports</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">servers:
  serverAInternet:
    active: true
    type: externalUrl
    source:
      - https://my.real.server/api
    exports:
# The string SERVERA_URL is split internally into SERVERA and URL, which are then considered
# as lowercase keys
      - SERVERA_URL=https://my.real.server/api
  serverALocal:
    active: false
    type: externalUrl
    source:
      - https://localhost:8080/api
    exports:
      - SERVERA_URL=https://localhost:8080/api
  serverB:
    type: externalJar
    source:
      - http://nexus/download/server.jar
    healthcheckUrl: http://127.0.0.1:19307
    externalJarOptions:
      arguments:
# The second part is the placeholder which will be resolved using the internal value store.
# The string "serverA.url" is split into "serverA" and "url", again considered as lowercase,
# which then matches to "SERVERA_URL",
        - --serverAUrl=${serverA.url}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Placeholders which can not be resolved will not lead to errors but rather they will simply not be replaced.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="rbelpath-style-retrieval"><a class="anchor" href="#rbelpath-style-retrieval"></a>6.5. RbelPath-style retrieval</h3>
<div class="paragraph">
<p>The placeholders also support RbelPath-style expressions to allow for more flexible, dynamic retrieval of properties.<br>
Consider for example the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">myMap:
  anotherLevel:
    key1:
      value: foobar
      target: schmoo
    key2:
      value: xmas
      target: blublub
  hidden:
    treasure:
      buried: deep</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve values from this map you can use the following expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${myMap.anotherLevel.[?(@.value=='foobar')].target}</code> will resolve to "schmoo", retrieving the node <code>myMap.anotherLevel.key.target</code>.</p>
</li>
<li>
<p>The same value can be retrieved via <code>${..[?(@.target=='schmoo')].target}</code>.<br>
This expression uses the recursive descent mechanic of RbelPath.</p>
</li>
<li>
<p><code>${..buried}</code> will resolve to "deep", retrieving the node <code>myMap.hidden.treasure.buried</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="fallback-values"><a class="anchor" href="#fallback-values"></a>6.6. Fallback values</h3>
<div class="paragraph">
<p>Sometimes a default value is desired when a given key is not set.<br>
To define such a value, just use the pipe (|) after the key, like so:</p>
</div>
<div class="paragraph">
<p><code>${foo.bar|orThisValue}</code></p>
</div>
<div class="paragraph">
<p>This will first test for the presence of "foo.bar" as a configuration key.<br>
If that key is not found, the fallback value "orThisValue" will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="localized-configuration"><a class="anchor" href="#localized-configuration"></a>6.7. Localized configuration</h3>
<div class="paragraph">
<p>It is possible to set a local variable in the TigerGlobalConfiguration which will only be active for the duration of the test case execution.</p>
</div>
<div class="paragraph">
<p>This can be achieved with the glue code step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">TGR setze lokale Variable {tigerResolvedString} auf {tigerResolvedString}
TGR set local variable {tigerResolvedString} to {tigerResolvedString}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The variables will be removed from the TigerGlobalConfiguration after the test case execution.<br>
Bear in mind that this does not work with threading: The values are added to the global store and are removed automatically, but will still be visible by any parallel thread that attempts to read the TigerGlobalConfiguration.</p>
</div>
<div class="paragraph">
<p>It is also possible to set a variable that is local to the feature file where it is defined.<br>
With the glue code step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">TGR setze lokale Feature Variable {tigerResolvedString} auf {tigerResolvedString}
TGR set local feature variable {tigerResolvedString} to {tigerResolvedString}</code></pre>
</div>
</div>
<div class="paragraph">
<p>a variable can be set that will be removed from the TigerGlobalConfiguration when the execution of the feature file is finished.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>6.8. Examples</h3>
<div class="paragraph">
<p>Some examples to clarify:</p>
</div>
<div class="sect3">
<h4 id="example-1"><a class="anchor" href="#example-1"></a>6.8.1. Example 1</h4>
<div class="paragraph">
<p>Say you have an environment configured in your testenv.yaml.<br>
You want the Tiger Proxy to forward traffic on one route to your backend-server.<br>
This will normally be a local server, but on the build-server you want to address another host.<br>
You can simply set an environment variable to do the job for you.<br>
Below are the relevant snippets:</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. tiger.yaml with the Tiger Proxy routing everything to the local server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">tigerProxy:
    proxyRoutes:
        - from: /
          to: http://127.0.0.1:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the buildserver you can now simply overwrite the "to"-part of this route like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export TIGERPROXY_PROXYROUTES_0_TO = "http://real.server"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-2"><a class="anchor" href="#example-2"></a>6.8.2. Example 2</h4>
<div class="paragraph">
<p>In the above example let&#8217;s say you only want to customize the port.<br>
This can be done by using placeholders:</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. tiger.yaml with the Tiger Proxy routing everything to the local server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">tigerProxy:
    proxyRoutes:
        - from: /
          to: http://127.0.0.1:${backend.server.port}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time we don&#8217;t overwrite the complete to-url but only the port like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export BACKEND_SERVER_PORT = "8080"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-3"><a class="anchor" href="#example-3"></a>6.8.3. Example 3</h4>
<div class="paragraph">
<p>Now we want to assert that the reply coming from the server has the correct backend-url in the XML that is returned to the sender.<br>
To do this we have to reference the configured URL from above, since the value could be different on every execution.<br>
We can solve this using placeholders:</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. The testsuite</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Gherkin hljs" data-lang="Gherkin">    TGR current response with attribute "$.body.ReplyStructure.Header.Sender.url" matches "http://127.0.0.1:${backend.server.port}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The glue-code in Tiger automatically resolves the placeholders.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pre-defined-values"><a class="anchor" href="#pre-defined-values"></a>6.9. Pre-Defined values</h3>
<div class="paragraph">
<p>Tiger adds some pre-defined values to make your life easier configuring the environment.<br>
Currently, these are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>free.port.0</code> - <code>free.port.255</code>: Free ports that are randomly determined at startup but stay fixed during the execution.<br>
This enables side effect free execution of the testsuite.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="inline-jexl"><a class="anchor" href="#inline-jexl"></a>6.10. Inline JEXL</h3>
<div class="paragraph">
<p>In addition to the <code>${foo.bar}</code> syntax allowing the retrieval of configuration values there exists the <code>!{'foo' != 'bar'}</code> syntax allowing the execution of JEXL expressions.<br>
The JEXL-syntax is described in more depth here: <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" class="bare">https://commons.apache.org/proper/commons-jexl/reference/syntax.html</a></p>
</div>
<div class="paragraph">
<p>To give you more power and flexibility when creating inline-JEXL-expression you can access several namespaces from inside the JEXL expression.<br>
You will find two predefined namespaces and also the ability to add your own, allowing further customization.</p>
</div>
<div class="sect3">
<h4 id="the-default-namespace"><a class="anchor" href="#the-default-namespace"></a>6.10.1. The default namespace</h4>
<div class="paragraph">
<p>The default-namespace of the inline JEXL-expression carries the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file(&lt;filename&gt;)</code> loads the given file and returns it as a UTF-8 parsed string.</p>
</li>
<li>
<p><code>sha256</code> returns the HEX-encoded SHA256-value of the given string.</p>
</li>
<li>
<p><code>sha256Base64</code> returns the Base64-encoded SHA256-value of the given string.</p>
</li>
<li>
<p><code>sha512</code> returns the HEX-encoded SHA512-value of the given string.</p>
</li>
<li>
<p><code>sha512Base64</code> returns the Base64-encoded SHA512-value of the given string.</p>
</li>
<li>
<p><code>md5</code> returns the HEX-encoded MD5-value of the given string.</p>
</li>
<li>
<p><code>md5Base64</code> returns the Base64-encoded MD5-value of the given string.</p>
</li>
<li>
<p><code>base64Encode</code> returns the Base64-Encoding of the given string (non-url safe).</p>
</li>
<li>
<p><code>base64UrlEncode</code> returns the Base64-URL-Encoding of the given string.</p>
</li>
<li>
<p><code>base64Decode</code> decodes the given Base64-String (URL and non-url) and converts it into a UTF-8 string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a function-invocation in the default namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">!{file('src/test/resources/testMessage.json')}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will load the given file and replace any placeholders found in it.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-rbel-namespace"><a class="anchor" href="#the-rbel-namespace"></a>6.10.2. The rbel namespace</h4>
<div class="paragraph">
<p>To give you direct access to the messages sent please use the rbel-namespace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>currentResponse</code> returns the current response, optionally filtered by a given Rbel-path</p>
</li>
<li>
<p><code>currentResponseAsString</code> returns the string-representation of the current response, optionally filtered by a given Rbel-path</p>
</li>
<li>
<p><code>currentRequest</code> returns the current request, optionally filtered by a given Rbel-path</p>
</li>
<li>
<p><code>currentRequestAsString</code> returns the string-representation of the current request, optionally filtered by a given Rbel-path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can be done like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">!{rbel:currentResponseAsString('$.body.html.head.link.href')}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will immediately return the <code>href</code>-attribute of the link in question as a string.</p>
</div>
</div>
<div class="sect3">
<h4 id="adding-custom-namespaces"><a class="anchor" href="#adding-custom-namespaces"></a>6.10.3. Adding custom namespaces</h4>
<div class="paragraph">
<p>You can easily register additional namespaces by calling <code>TigerJexlExecutor.registerAdditionalNamespace(&lt;namespace-prefix&gt;, &lt;namespace class or object)</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tiger_configuration_editor"><a class="anchor" href="#_tiger_configuration_editor"></a>6.11. Configuration Editor</h3>
<div class="paragraph">
<p>The configuration editor allows to view and edit the tiger configuration during a test run.<br>
The editor is part of the <a href="#_workflow_ui">Workflow UI</a> and can be opened by clicking the gears icon in the sidebar (<a href="#editor_start_button">Figure 13</a>).</p>
</div>
<div id="editor_start_button" class="imageblock text-center">
<div class="content">
<img src="screenshots/sidebar_config_editor.png" alt="workflow UI with action buttons and gears icon highlighted">
</div>
<div class="title">Figure 13. Open the configuration editor by clicking the gears icon in the sidebar.</div>
</div>
<div class="paragraph">
<p>The configuration editor displays a table where you can view the current configuration properties loaded in the Tiger global configuration (<a href="#editor_table">Figure 14</a>).<br>
This includes properties from all <a href="#_inlets">inlet sources</a>.<br>
If a property is defined multiple times in different sources, only the one with higher importance is displayed.</p>
</div>
<div id="editor_table" class="imageblock text-center">
<div class="content">
<img src="screenshots/tg_global_config_editor.png" alt="view of the configuration editor table showing several properties">
</div>
<div class="title">Figure 14. The Tiger global configuration editor</div>
</div>
<div class="paragraph">
<p>The editor allows sorting and filtering each column so that you can easily find a specific property (<a href="#editor_column_filter">Figure 15</a>).<br>
Given that the Tiger global configuration includes many environment variables and system properties which are not directly relevant to Tiger, the filtering functionally proves to be especially useful.</p>
</div>
<div id="editor_column_filter" class="imageblock">
<div class="content">
<img src="screenshots/config_editor_example_filter_popup.png" alt="screenshot of Key column displaying a filter popup filtering by the word tgr">
</div>
<div class="title">Figure 15. Example of filtering the column key by the text 'tgr'</div>
</div>
<div class="paragraph">
<p>The values of existing configuration properties can be edited by double-clicking the value cells.<br>
This opens an input field where you can input a new value (<a href="#cell_editor">Figure 16</a>).</p>
</div>
<div id="cell_editor" class="imageblock">
<div class="content">
<img src="screenshots/config_editor_cell_editor_example.png" alt="cell editor popup showing how to edit a property value">
</div>
<div class="title">Figure 16. Double clicking a value cell opens the cell editor.</div>
</div>
<div class="paragraph">
<p>Additionally, you can remove existing configuration properties by clicking the delete button (<a href="#delete_button">Figure 17</a>)</p>
</div>
<div id="delete_button" class="imageblock">
<div class="content">
<img src="screenshots/config_editor_delete_button.png" alt="screenshot of editor table highlighting the delete button">
</div>
<div class="title">Figure 17. Clicking the delete button removes the property from the Tiger global configuration.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
Editing or removing configuration properties will not affect already ran tests.<br>
If you want to use edited properties in a specific test, then you should pause the test before editing the configuration.<br>
In <a href="#_workflow_ui">Workflow UI</a> you can see how to use custom steps to pause the test suite.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some variables in the table have multiline values, causing the text to appear truncated initially.<br>
These cells are equipped with an expand icon (<a href="#collapse_icon">Figure 18</a>), indicating the availability of additional content.</p>
</div>
<div id="collapse_icon" class="imageblock">
<div class="content">
<img src="screenshots/config_editor_collapse_icon.png" alt="collapse icon example">
</div>
<div class="title">Figure 18. Clicking on the expand icon reveals the full multiline content.</div>
</div>
<div class="paragraph">
<p>Clicking the expand icon uncover the complete multiline content, ensuring it is fully visible within the cell.</p>
</div>
<div id="expand_icon" class="imageblock">
<div class="content">
<img src="screenshots/config_editor_expand_icon.png" alt="expand icon example">
</div>
<div class="title">Figure 19. Click the expand icon to view the full multiline content.</div>
</div>
<div class="paragraph">
<p>To hide the multiline content and return to a truncated view, simply click on the collapse icon.<br>
This action collapses the multiline content, returning the text to its truncated state.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiger-user-interfaces"><a class="anchor" href="#tiger-user-interfaces"></a>7. Tiger User interfaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_workflow_ui"><a class="anchor" href="#_workflow_ui"></a>7.1. Workflow UI</h3>
<div class="paragraph">
<p>The Workflow UI is a feature for a better user experience during the test run of feature file(s).</p>
</div>
<div class="paragraph">
<p>If activated via the <code>tiger.yaml</code> <a href="#_tiger_test_lib_configuration">configuration file</a>, the Workflow UI will be opened in the current browser window during the test run and shows the status and logs of the servers as well as the results and request calls of the scenarios and feature files during the test run.<br>
If no browser is open at the time a new instance will be launched.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/workflowui.png" alt="workflowui">
</div>
<div class="title">Figure 20. Workflow UI</div>
</div>
<div class="paragraph">
<p>The image above shows the initial startup of the Workflow UI.<br>
The Workflow UI is divided into three sections: the <a href="#_status_bar">status bar</a>, the <a href="#_main_window">main window</a> with <a href="#_test_execution">test execution</a> and <a href="#_server_logs">server logs</a> and the <a href="#_rbel_logs">Rbel log details</a> (a slimmed down version of the <a href="#_web_ui">WebUI</a>).</p>
</div>
<div class="sect3">
<h4 id="_status_bar"><a class="anchor" href="#_status_bar"></a>7.1.1. Status Bar</h4>
<div class="paragraph">
<p>The section on the left is called status bar as shown in the picture below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebarclosed_highlight.png" alt="sidebarclosed highlight">
</div>
<div class="title">Figure 21. the status bar is situated on the left</div>
</div>
<div class="paragraph">
<p>When the user clicks on the tigers head on the top left the status bar slides open as shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebaropen.png" alt="sidebaropen">
</div>
<div class="title">Figure 22. open status bar</div>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebarbuttons.png" alt="sidebarbuttons">
</div>
<div class="title">Figure 23. status bar buttons: abort, pause, configuration editor</div>
</div>
<div id="_pause" class="paragraph">
<p>The first button stops the test execution and terminates the servers.<br>
As seen in the following screenshot the background color of the status bar changed to red and at a banner is shown that tells the user that the test execution has been aborted.<br>
Once the Workflow UI has quit, searches and filtering on the <a href="#_rbel_logs">Rbel log details</a> as well as on the <a href="#_web_ui">Web UI</a> are no longer possible.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/workflowui_quit.png" alt="workflowui quit">
</div>
<div class="title">Figure 24. test execution has stopped on user request</div>
</div>
<div class="paragraph">
<p>By clicking on the second button the test execution pauses.<br>
The background color of the status bar and the pause button change to indicate the pause as shown in the following picture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebar_pause.png" alt="sidebar pause">
</div>
<div class="title">Figure 25. test execution is paused</div>
</div>
<div class="paragraph">
<p>The test execution will be resumed once the user clicks on the green play button.<br>
The third button opens the Configuration Editor which is explained in detail in <a href="#_tiger_configuration_editor">this</a> section.</p>
</div>
<div class="paragraph">
<p>Below the buttons the status box shows how many feature files and how many scenarios were executed and also the amount of failed tests are shown.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebar_statusbox.png" alt="sidebar statusbox">
</div>
<div class="title">Figure 26. status box</div>
</div>
<div class="paragraph">
<p>In the feature box below each scenario name is displayed.<br>
The names are linked to the test and when the user clicks on the scenario the test is shown in the test execution on the main section.<br>
The green icon in front of the name indicates a passed scenario, the red exclamation mark indicates a failed scenario.<br>
The numbers in square brackets indicate that this is part of an outline scenario, meaning a test scenario that is run multiple times with different test data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebar_featurebox.png" alt="sidebar featurebox">
</div>
<div class="title">Figure 27. feature box</div>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebar_serverbox.png" alt="sidebar serverbox">
</div>
<div class="title">Figure 28. server box</div>
</div>
<div class="paragraph">
<p>The server box above displays the configured servers, its status (e.g. STARTING, RUNNING, STOPPED) and some outputs of its logs.<br>
When the icon color before the server name is green then the server is up and running correctly.</p>
</div>
<div class="paragraph">
<p>Below the server box the version number and the build date of the currently used tiger release is displayed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebar_version_build.png" alt="sidebar version build">
</div>
<div class="title">Figure 29. tiger version and build</div>
</div>
<div class="paragraph">
<p>The status bar can be minimized by clicking on the double arrow or by clicking on any of the icons in the status bar (e.g. status box icon, feature box icon, server box icon, tiger head icon).</p>
</div>
</div>
<div class="sect3">
<h4 id="_main_window"><a class="anchor" href="#_main_window"></a>7.1.2. Main window</h4>
<div class="paragraph">
<p>The main window of the Workflow UI has two sections: the <a href="#_test_execution">test execution</a> and the <a href="#_server_logs">server logs</a> which can be selected by the two buttons on top of the Workflow UI as seen in the picture below.</p>
</div>
<div class="sect4">
<h5 id="_server_logs"><a class="anchor" href="#_server_logs"></a>Server logs</h5>
<div class="paragraph">
<p>By clicking on the server logs button on top of the main window the user can have a look at the log files of each server.<br>
There the user can use several filter options to search in the log files.<br>
There are the following server buttons: you can see all logs of all servers, or only the logs of one or more servers by clicking on the corresponding buttons.<br>
The user can also search via text input after a certain text phrase.<br>
It is also possible to distinguish between the different log levels.<br>
In the picture below only the httpbin server is selected.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/serverlog_level_highlight.png" alt="serverlog level highlight">
</div>
<div class="title">Figure 30. Server Logs with httpbin server and all log levels selected</div>
</div>
</div>
<div class="sect4">
<h5 id="_test_execution"><a class="anchor" href="#_test_execution"></a>Test execution</h5>
<div class="paragraph">
<p>In the test execution tab the user sees the executed features and their scenarios as well as their execution status.<br>
A test can be either passed or failed.<br>
In the example below the scenario has passed but the feature itself has failed, which means that at least one of the scenarios of the feature has failed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/maincontent_tabs_highlight.png" alt="maincontent tabs highlight">
</div>
<div class="title">Figure 31. Test execution</div>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/maincontent_table_highlight.png" alt="maincontent table highlight">
</div>
<div class="title">Figure 32. execution status for scenarios and features</div>
</div>
<div class="paragraph">
<p>Beside the status at the end of the feature/scenario name the user can also see the status at the icon before the name.<br>
During text execution or while <a href="#_pause">pausing</a> the Workflow UI there is a third status the feature/scenario can have which is "pending".<br>
The icon before the name would be a spinner icon to indicate that status.</p>
</div>
<div class="paragraph">
<p>TGR banner step will be displayed at the bottom of the Workflow UI and will stay there till the next banner step replaces the message.<br>
This way you can instruct manual testers to follow a specified test workflow.<br>
This feature is used in the EAU Konnektorfarm validation test suite to guide the Primärsystem manufacturers through the interoperability combinations of signing/verifying documents against all Konnektors available.</p>
</div>
<div class="paragraph">
<p>Additionally, a test scenario can be replayed.<br>
When clicking the replay button next to the scenario name, the scenario will be rerun again.<br>
If placeholder variables were modified with the configuration editor, the new values will be used when replaying the scenario.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/maincontent_replaybutton.png" alt="maincontent replaybutton">
</div>
<div class="title">Figure 33. The replay button</div>
</div>
<div class="paragraph">
<p>Alternatively, a scenario can be replayed by clicking the small replay button in the feature box in the sidebar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/sidebar_replaybutton.png" alt="sidebar replaybutton">
</div>
<div class="title">Figure 34. Small replay buttons in the sidebar</div>
</div>
<div id="_rbel_logs" class="paragraph">
<p>The communication requests that are called during the step execution are displayed beneath the step that initiated the request.<br>
When the user clicks on the light blue rectangle with the number (whereas uneven numbers are requests, even number are responses) of the request then the Rbel Log view opens on the right hand side of the Workflow UI as shown on the screenshot below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/maincontent_rbelpath.png" alt="maincontent rbelpath">
</div>
<div class="title">Figure 35. Rbel Log Details</div>
</div>
<div class="paragraph">
<p>In the Rbel Log Details view the RbelMessages are displayed that are also saved as HTML files as described in the <a href="#_cucumber_hooks">Cucumber and Hooks</a> section.<br>
Next to the headline there is a link to the <a href="#_web_ui">WebUI (aka Tiger Proxy UI)</a> which opens the WebUI in a new tab as shown in the picture below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/maincontent_rbelpath_urllink_highlight.png" alt="maincontent rbelpath urllink highlight">
</div>
<div class="title">Figure 36. Link to open the Tiger Proxy Log</div>
</div>
<div class="paragraph">
<p>The Rbel Log Details view is described in the <a href="#_web_ui">WebUI</a> section as it is a slimmed down version of the WebUI.<br>
In order to increase/decrease the width of the Rbel Log Details view the user can drag the border between the main window and the Rbel Log Details view.<br>
The Rbel Log Details can be minimized by clicking on the double arrow on the top left of the Rbel Log Details section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="traffic-visualization"><a class="anchor" href="#traffic-visualization"></a>7.1.3. Traffic Visualization</h4>
<div class="paragraph">
<p>An additional feature of the Workflow UI is the traffic visualization.<br>
This feature allows to visualize the traffic between the servers under test in a sequence diagram.<br>
The feature needs to be explicitly enabled in the <code>tiger.yaml</code> configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">lib:
  trafficVisualization: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will enable a third section in the main window of the Workflow UI where a sequence diagram is displayed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/maincontent_sequence_diagram.png" alt="maincontent sequence diagram">
</div>
<div class="title">Figure 37. Traffic Visualization</div>
</div>
<div class="paragraph">
<p>The sequence diagram shows the messages that were exchanged between the servers under test.<br>
By clicking on a message in the sequence diagram, the corresponding Rbel Log Details will be displayed in the Rbel Log Details section.</p>
</div>
<div class="paragraph">
<p>The traffic visualization currently supports the following server types: <code>externalJar</code>, <code>externalUrl</code>, <code>zion</code>, <code>docker</code> and <code>compose</code>.</p>
</div>
<div class="paragraph">
<p>For messages to show up in the sequence diagram they need to be routed through the Tiger Proxy.<br>
This is the case for all the messages originating in the local tiger client and their responses.<br>
If there are additional messages originating on one the servers under test, they need to be routed through the Tiger Proxy as well.<br>
In Zion servers this is automatically configured.<br>
For external jars this can be achieved by configuring the servers with the following VM options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">externalJarOptions:
  options:
    - -Dhttp.proxyHost=127.0.0.1
    - -Dhttp.proxyPort=${tiger.tigerProxy.proxyPort}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the server types docker and compose, we do not yet support the visualization of messages originating on a client port of these servers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="postpone-start-of-test-scenarios"><a class="anchor" href="#postpone-start-of-test-scenarios"></a>7.2. Postpone start of test scenarios</h3>
<div class="paragraph">
<p>It is possible to configure the Workflow UI to not start all tests automatically at startup.<br>
When setting the following configuration option in the <code>tiger.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">lib:
    runTestsOnStart: false # default is true</code></pre>
</div>
</div>
<div class="paragraph">
<p>the tests will only be discovered and displayed in the Workflow UI.<br>
The user can then choose which test scenario he/she wants to execute.<br>
This can be done by clicking the play buttons in either the Test Execution pane or in the Status Bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/play_button.png" alt="play button">
</div>
<div class="title">Figure 38. Play Buttons</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_ui"><a class="anchor" href="#_web_ui"></a>7.3. Standalone Tiger Proxy Log</h3>
<div class="paragraph">
<p>To watch the recorded messages and to be able to analyze issues at test run time already you can visit the Tiger Proxy web user interface at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-http request hljs" data-lang="http request">http://127.0.0.1:${SERVERPORT}/webui</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>ADMINPORT</code> being the configured server port of the Tiger Proxy.</p>
</div>
<div class="paragraph">
<p>When the user works with the <a href="#_workflow_ui">Workflow UI</a> the Tiger Proxy UI can be opened via a link in the Rbel Log Details view in a new browser tab.</p>
</div>
<div class="sect3">
<h4 id="overview"><a class="anchor" href="#overview"></a>7.3.1. Overview</h4>
<div class="paragraph">
<p>The following screenshot shows the WebUI.<br>
On the left side the request/response pairs are displayed.<br>
The user can see the request type and the error code of the response as well as the timestamp of the request.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui.png" alt="webui">
</div>
<div class="title">Figure 39. Tiger Proxy Log</div>
</div>
<div class="paragraph">
<p>On the top right the tiger version and the build date are displayed.<br>
In the middle the full request and response messages are shown with detailed header and body.</p>
</div>
</div>
<div class="sect3">
<h4 id="bottom-menu-bar"><a class="anchor" href="#bottom-menu-bar"></a>7.3.2. Bottom menu bar</h4>
<div class="imageblock">
<div class="content">
<img src="media/TigerProxyBottomNavBar.png" alt="TigerProxyBottomNavBar">
</div>
<div class="title">Figure 40. Tiger Proxy UI bottom menu bar </div>
</div>
<div class="paragraph">
<p>The displayed buttons can trigger the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Routes</strong> … allows you to modify and add the routes configured on this Tiger Proxy</p>
</li>
<li>
<p><strong>Scroll Lock</strong> … allows you to lock the scroll position.<br>
Incoming messages will still be added to the list at the bottom of the page.</p>
</li>
<li>
<p><strong>Toggle Button</strong>  … has two possibilities (hide headers and hide details) which collapses either all headers (request headers as well as response headers) or all the detailed information of the requests and responses.</p>
</li>
<li>
<p><strong>Filter</strong>  … allows you to filter the received messages with a RbelPath or a JEXL expression.<br>
You can also search for text or a regex in this input field, but then you need to place the search text inside quotation marks (").</p>
</li>
<li>
<p><strong>Reset</strong> … allows you to delete all recorded messages so far.<br>
This will delete all messages on the Tiger Proxy!</p>
</li>
<li>
<p><strong>Export</strong> … allows you to export all or the currently filtered received messages as an HTML page or as a machine-readable tgr file.</p>
</li>
<li>
<p><strong>Page</strong> … allows pagination of the messages.</p>
</li>
<li>
<p><strong>Size</strong> … changes the size of the messages.</p>
</li>
<li>
<p><strong>Import</strong> … allows you to import the previously stored traffic file.</p>
</li>
<li>
<p><strong>Quit</strong> … allows you to quit the Tiger Proxy instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some modals are explained in more detail in the following sections.</p>
</div>
<div class="sect4">
<h5 id="filter-modal"><a class="anchor" href="#filter-modal"></a>Filter Modal</h5>
<div class="paragraph">
<p>When a lot of messages are recorded, it is sometimes hard to find the message you are looking for.<br>
Therefore, the user can filter the messages with a Rbel-Path or a regex using either the filter modal as shown in the picture below or the JEXL Debugging modal described <a href="#_jexl_filter">here</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_filter_open.png" alt="webui filter open">
</div>
<div class="title">Figure 41. Filter Managment</div>
</div>
</div>
<div class="sect4">
<h5 id="rbel-pathjexl-debugging-modal"><a class="anchor" href="#rbel-pathjexl-debugging-modal"></a>RBel-Path/JEXL Debugging Modal</h5>
<div class="paragraph">
<p>When the user wants to inspect a Rbel-Path or have a look at some JEXL expressions, the user can click on the corresponding button in the top right corner of the request or the response that is highlighted in the following screenshot.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_inspect_highlight.png" alt="webui inspect highlight">
</div>
<div class="title">Figure 42. Access RBel-Path/JEXL Debugging</div>
</div>
<div class="paragraph">
<p>The picture below shows the RBel-Path tab.<br>
The user can execute the RBel-Path on the request or the response and the result is displayed in the bottom part of the modal.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_inspect_rbelpath_highlight.png" alt="webui inspect rbelpath highlight">
</div>
<div class="title">Figure 43. RBel-Path</div>
</div>
<div class="paragraph">
<p>For more information in the Rbel-Path check out <a href="#_rbel_path_details">this</a> section.</p>
</div>
<div class="paragraph">
<p>The picture below shows the JEXL Debugging tab.<br>
The user can execute the JEXL expression on the request or the response and the result is displayed in the bottom part of the modal.<br>
Further information on JEXL expressions can be found in <a href="#_jexl_expression_detail">Explanation of JEXL Expressions</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_inspect_jexl_highlight.png" alt="webui inspect jexl highlight">
</div>
<div class="title">Figure 44. JEXL Debugging</div>
</div>
<div id="_jexl_filter" class="paragraph">
<p>When the user wants to filter the messages with a JEXL expression, the user can click on the "Use as filter" button in the modal.</p>
</div>
</div>
<div class="sect4">
<h5 id="routing-modal"><a class="anchor" href="#routing-modal"></a>Routing Modal</h5>
<div class="paragraph">
<p>The user can add/delete routes in the routing modal which is shown in the following screenshot.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_routing_open.png" alt="webui routing open">
</div>
<div class="title">Figure 45. Route Managment</div>
</div>
</div>
<div class="sect4">
<h5 id="message-content"><a class="anchor" href="#message-content"></a>Message Content</h5>
<div class="paragraph">
<p>The user can have a look at the request/response message content of the header, body or both by clicking on the corresponding button in the top right corner of the request or the response that is highlighted in the following screenshot.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_btn_content_highlight.png" alt="webui btn content highlight">
</div>
<div class="title">Figure 46. Buttons to show message content</div>
</div>
<div class="paragraph">
<p>The picture below shows the content of the whole response.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_btn_content.png" alt="webui btn content">
</div>
<div class="title">Figure 47. Example of the content of a response</div>
</div>
</div>
<div class="sect4">
<h5 id="switching-between-requestresponse"><a class="anchor" href="#switching-between-requestresponse"></a>Switching between request/response</h5>
<div class="paragraph">
<p>Since the order in the list is based upon the reception of the corresponding message it can be hard to find the corresponding request or response to a given message. To make this easier the user can switch between the request and the response by clicking on the corresponding button in the top right corner of the request or the response that is highlighted in the following screenshot.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="screenshots/webui_message_partner.png" alt="webui message partner">
</div>
<div class="title">Figure 48. Buttons to switch between request and response</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jexl_expression_detail"><a class="anchor" href="#_jexl_expression_detail"></a>7.4. Explanation of JEXL Expressions</h3>
<div class="paragraph">
<p>In the <a href="#_workflow_ui">Workflow UI</a> and in the <a href="#_web_ui">WebUI</a> you can inspect the requests and response messages.<br>
For that you can use RbelPath and/or JEXL expressions. This section should give you a brief review on the JEXL expressions.</p>
</div>
<div class="paragraph">
<p>Important to know is that an JEXL expression is usually a "condition1 operator condition2" expression which is compared.<br>
Therefor the following operators could be used.</p>
</div>
<div class="sect3">
<h4 id="operators"><a class="anchor" href="#operators"></a>7.4.1. Operators</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">and | &amp;&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cond1 <em>and</em> cond2  and cond1 <em>&amp;&amp;</em> cond2 are equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or | ||</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cond1 <em>or</em> cond2  and cond1 || cond2 are equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not | !</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ! operator can be used as well as the word <em>not</em>, e.g. !cond1 and not cond1 are equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">==</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equality, e.g. cond1 == cond2<br>
<br>
         <em>null</em> is only ever equal to null, that means when you compare null to a non-null value, the result is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inequality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8656;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than ot equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In or match, can be used to check that a string matches a regular expression.<br>
      For example "abcdef" =~ "abc.* returns true. It also checks whether any collection, set or map contains a value or not;<br>
      in that case, it behaves as an "in" operator. "a" =~ ["a","b","c","d","e",f"] returns true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not in or not-match, can be used to check that a string does not match a regular expression.<br>
      For example "abcdef" !~ "abc.* returns false. It also checks whether any collection, set or map does not contain a value.<br>
     "a" !~ ["a","b","c","d","e",f"] returns false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">startsWith, for example "abcdef" =^ "abc" returns true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">startsNotWith, "abcdef" !^ "abc" returns false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">endsWith, for example "abcdef" =$ "def" returns true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">endsNotWith, for example "abcdef" !$ "def" returns false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unary empty operator behaves like the corresponding function empty().</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unary size operator behaves like the corresponding function size().</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="media/jexlspacesright.png" alt="jexlspacesright" width="50%">
</div>
<div class="title">Figure 49. Rbel Path Expression</div>
</div>
</div>
<div class="sect3">
<h4 id="access-on-array-lists-and-maps"><a class="anchor" href="#access-on-array-lists-and-maps"></a>7.4.2. Access on Array, Lists and Maps</h4>
<div class="paragraph">
<p>To access maps in JEXL/RbelPath the point notations is used. In case of lists use the number of the list entry you want to access, starting with 0, 1, 2 and so on.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/accessarray.png" alt="accessarray" width="50%">
</div>
<div class="title">Figure 50. The access of the elements of a list is done with the number, starting with 0. For maps the point notation is used. </div>
</div>
</div>
<div class="sect3">
<h4 id="access-jexl-contexts"><a class="anchor" href="#access-jexl-contexts"></a>7.4.3. Access JEXL contexts</h4>
<div class="paragraph">
<p>There are predefined JEXL contexts which can be used for the query, for example <code>isRequest</code>, <code>isResponse</code>, <code>charset</code>, <code>content</code> or also more<br>
complex contexts like <code>response.statuscode</code>, <code>request.url</code>, <code>message.method</code> etc.<br>
For more details check the InlineJexlToolbox</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/accessjexlcontext.png" alt="accessjexlcontext" width="50%">
</div>
<div class="title">Figure 51. Use single quotes when using JEXL contexts with a hyphen. </div>
</div>
</div>
<div class="sect3">
<h4 id="more-examples"><a class="anchor" href="#more-examples"></a>7.4.4. More Examples</h4>
<div class="paragraph">
<p><code>message.headers.'content-length'.0 == "0"</code>  &#8594; Use single quotes when using JEXL contexts with a hyphen.</p>
</div>
<div class="paragraph">
<p><code>@.body.0.name.content =^ "Jasmin"</code> &#8594; check whether the content starts with "Jasmin"</p>
</div>
<div class="paragraph">
<p><code>$.body.recordId == "X12349035"</code>   &#8594; checks for the recordId of a decrypted EPA-VAU-message</p>
</div>
<div class="paragraph">
<p><code>$.header.Content-Type == "application/json"</code>  &#8594; check if the message is a JSON-message</p>
</div>
<div class="paragraph">
<p><code>request.method == "GET"</code> &#8594; check if request is da GET request</p>
</div>
<div class="paragraph">
<p><code>charset =~ "UTF-.*"</code> &#8594; check the charset with a regex</p>
</div>
<div class="paragraph">
<p><code>empty(response.url)==true</code> oder auch <code>empty(response.url)</code> &#8594; url is not set</p>
</div>
<div class="paragraph">
<p><code>$.body.recordId == "Y243631459" &amp;&amp; charset == "UTF-8"</code> &#8594; combines the two criterions</p>
</div>
</div>
<div class="sect3">
<h4 id="post-form-get-parameters"><a class="anchor" href="#post-form-get-parameters"></a>7.4.5. POST Form / GET parameters</h4>
<div class="paragraph">
<p>When accessing parameters POST and GET are handled differently.<br>
POST form data requests contain the data as Url encoded query string in the body of the request.<br>
There is no easy way to decode this data generically within Rbel/JEXL.<br>
To help you ease the situation for POST we do have a helper JEXL inline method: <code><code>!{urlEncoded('value')}</code></code><br>
To access POST form data you may use <code><code>$.body.paramname</code></code> which will return the URL encoded value.</p>
</div>
<div class="paragraph">
<p>For GET requests you have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><code>$.path.paramname</code></code> which will return the string "paramaname=URLENCODED_VALUE" or</p>
</li>
<li>
<p><code><code>$.path.paramname.value</code></code> which will return the URL decoded original value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For further help on JEXL please check out the official website (<a href="https://commons.apache.org/proper/commons-jexl" class="bare">https://commons.apache.org/proper/commons-jexl</a>).</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiger-zion"><a class="anchor" href="#tiger-zion"></a>8. Tiger Zion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tiger Zion is a server that is highly customizable.<br>
It serves as a stand-in, an interactive, Zero-Line mock for more complicated servers.</p>
</div>
<div class="paragraph">
<p>It can be stateful, do backend-requests, give conditional answers (allowing for error cases, edge cases).<br>
It can return JSON, XML, JWT, JWE and many more, nest these formats into each other.<br>
The underlying templating language supports loops and conditions.<br>
It can be used both as a standalone server or as a server directly inside of tiger.</p>
</div>
<div class="paragraph">
<p>In order to use zion, make sure that you add the tiger-zion dependency in the most recent version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;de.gematik.test&lt;/groupId&gt;
            &lt;artifactId&gt;tiger-zion&lt;/artifactId&gt;
            &lt;version&gt;${tiger.version}&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="simple-canned-response"><a class="anchor" href="#simple-canned-response"></a>8.1. Simple canned response</h3>
<div class="paragraph">
<p>To start lets write a server that has one endpoint: Return a simple JSON.<br>
We do this as part of a tiger testsuite.</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. tiger.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  zionServer:
    type: zion
    zionConfiguration:
      # define the server port.
      # In a real setup you would leave this empty (then a random port will be used)
      serverPort: 8080
      mockResponses:
      # a map with all the responses
        helloWorld:
        # the name is arbitrary. It can be used to alter the response later on
          requestCriterions:
          # This is a list of JEXL expressions. Only when all expressions are met is this response considered
            - message.method == 'GET'
            - message.path == '/helloWorld'
          response:
            statusCode: 200
            body: '{"Hello":"World"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will give us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl localhost:8080/helloWorld
{"Hello": "World"}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="looping-tgrfor"><a class="anchor" href="#looping-tgrfor"></a>8.2. Looping (tgrFor)</h3>
<div class="paragraph">
<p>Let&#8217;s now make this a bit more interactive: Return a map of all given HTTP headers.<br>
And please return it as an XML!</p>
</div>
<div class="paragraph">
<p>Because XMLs are large and get complicated easily we don&#8217;t want to write it directly inside the <code>tiger.yaml</code>.<br>
So we reference an external file, where we do the heavy lifting:</p>
</div>
<div class="listingblock">
<div class="title">Listing 26. tiger.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  zionServer:
    type: zion
    zionConfiguration:
      serverPort: 8080
      mockResponses:
        helloWorld:
          requestCriterions:
            - message.method == 'GET'
            - message.path == '/helloWorld'
          response:
            statusCode: 200
            bodyFile: complicatedResponse.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 27. complicatedResponse.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;requestDescription&gt;
    &lt;headers&gt;
        &lt;header&gt;
            &lt;tgrFor&gt;header : request.headers.entrySet()&lt;/tgrFor&gt;
            ${header}
        &lt;/header&gt;
    &lt;/headers&gt;
&lt;/requestDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s try it out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl localhost:8080/helloWorld
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;requestDescription&gt;
  &lt;url&gt;http://localhost:8080/helloWorld&lt;/url&gt;
  &lt;path&gt;/helloWorld&lt;/path&gt;
  &lt;headers&gt;
    &lt;header&gt;host=[localhost:8080]&lt;/header&gt;
    &lt;header&gt;accept=[*/*]&lt;/header&gt;
    &lt;header&gt;user-agent=[curl/7.88.1]&lt;/header&gt;
  &lt;/headers&gt;
&lt;/requestDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you see a <code>tgrFor</code> construct.<br>
As the name leads on, it is used for looped rendering.<br>
It reside WITHIN the element which needs to be considered, which is a bit different compared to other templating languages.<br>
It just has to be beneath the element in the logical tree of the document.<br>
So the <code>tgrFor</code> can be a tag within <code>&lt;header&gt;</code>, but it also could have been an attribute.<br>
It can also be used in a JSON-fragment: The tgrFor then has to be a field in the object that you want looped.</p>
</div>
<div class="paragraph">
<p>The <code>tgrFor</code> must consist of three parts: The name of the loop-variable (here: <code>header</code>), followed by colon and then the loop expression to be evaluated.<br>
The loop expression must yield a Java-Collection as a result.<br>
Some examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1..42</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>{ 'one' , 2, 'more'}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>{ 'one' : 1}.entrySet()</pre>
</div>
</div>
<div class="paragraph">
<p>The loop-variable will be set for every iteration in the TigerConfiguration.<br>
So to access it directly, use <code>${myLoopVariable}</code>.<br>
You can then also combine the loop-variable with JEXL like so:</p>
</div>
<div class="listingblock">
<div class="title">Listing 28. complicatedResponse.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;requestDescription&gt;
    &lt;headers&gt;
        &lt;header&gt;
            &lt;tgrFor&gt;header : {1,2,3}&lt;/tgrFor&gt;
            ${header} and !{ ${header} + 1}
        &lt;/header&gt;
    &lt;/headers&gt;
&lt;/requestDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>will lead to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;requestDescription&gt;
  &lt;headers&gt;
    &lt;header&gt;1 and 2&lt;/header&gt;
    &lt;header&gt;2 and 3&lt;/header&gt;
    &lt;header&gt;3 and 4&lt;/header&gt;
  &lt;/headers&gt;
&lt;/requestDescription&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conditional-rendering-tgrif"><a class="anchor" href="#conditional-rendering-tgrif"></a>8.3. Conditional rendering (tgrIf)</h3>
<div class="paragraph">
<p>To make the presence of elements conditional you can use the <code>tgrIf</code> statement.<br>
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 29. complicatedResponse.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;requestDescription&gt;
    &lt;checkIf tgrIf="1 &amp;lt; 5" logic="still applies" /&gt;
&lt;/requestDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will give us</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;requestDescription&gt;
  &lt;checkIf logic="still applies"&gt;&lt;/checkIf&gt;
&lt;/requestDescription&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The tgrIf statement just consist of one single JEXL expression.<br>
The result must be of type boolean.<br>
Please note that the tgrIf-statement, like the tgrFor, has to be beneath the target element in the document tree.<br>
This can be done via an attribute in XML, but it can also be done using a tag:</p>
</div>
<div class="listingblock">
<div class="title">Listing 30. complicatedResponse.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;requestDescription&gt;
    &lt;checkIf logic="still applies"&gt;
        &lt;tgrIf&gt;1 &amp;lt; 5&lt;/tgrIf&gt;
    &lt;/checkIf&gt;
&lt;/requestDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are some examples for other possible criteria:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.header.connection == 'Keep-Alive'</pre>
</div>
</div>
<div class="paragraph">
<p>This will only be true if the matching header is present.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.header.host =~ 'local.*'</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the more complex JEXL operators (here <code>=~</code>, comparing using a regex).</p>
</div>
</div>
<div class="sect2">
<h3 id="backend-request"><a class="anchor" href="#backend-request"></a>8.4. Backend request</h3>
<div class="paragraph">
<p>To simulate complex interactions you can execute backend requests.<br>
The following example should clarify the mechanism:</p>
</div>
<div class="paragraph">
<p>We want measure the length of the response by google to a query:</p>
</div>
<div class="listingblock">
<div class="title">Listing 31. tiger.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  zionServer:
    type: zion
    zionConfiguration:
      serverPort: 8080
      mockResponses:
        helloWorld:
          requestCriterions:
            - message.method == 'GET'
            - message.path == '/helloWorld'
          backendRequests:
            tokenCheck:
              url: "https://google.com/!{$.path.myParam.value}"
# the method is optional. GET is the default, POST if a body is present
              method: GET
              assignments:
                length: "$.header.Content-Length"
          response:
            statusCode: 200
            body: "{'responseLength':'${length}', 'testedPath':'?{$.path.myParam.value}'}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test, we sent:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ curl "localhost:8080/helloWorld?myParam=dsfds"
{"responseLength": "1566","testedPath": "dsfds"}</pre>
</div>
</div>
<div class="paragraph">
<p>The request is sent, the path is taken from the <code>myParam</code> query-parameter of the initial request.<br>
Afterwards, the value of the <code>Content-Length</code>-Header is stored in the variable named <code>length</code> in the TigerGlobalConfiguration.<br>
We then sent a response with status-code 200 and json-body.<br>
Here we first reference the measured <code>length</code> variable from the backend-request and next we return the testedPath, taking the parameter from the initial request.</p>
</div>
</div>
<div class="sect2">
<h3 id="nested-response"><a class="anchor" href="#nested-response"></a>8.5. Nested response</h3>
<div class="paragraph">
<p>To reduce the overhead when simulating conditional responses you can use the <code>nestedResponses</code> mechanism.<br>
This allows subdividing responses.<br>
Consider the following example, where we check the password of the calling party (which is given in cleartext in the request header).</p>
</div>
<div class="listingblock">
<div class="title">Listing 32. tiger.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  zionServer:
    type: zion
    zionConfiguration:
      serverPort: 8080
      mockResponses:
        passwordCheckResponse:
          requestCriterions:
            - message.method == 'GET'
            - message.path == '/helloWorld'
          nestedResponses:
            correctPassword:
              importance: 10
              requestCriterions:
                - "'?{$.header.password}' == 'geheim'"
              response:
                statusCode: 200
                body: '{"Hello":"World"}'
            wrongPassword:
              importance: 0
              response:
                statusCode: 405
                body: '{"Wrong":"The password !{$.header.password} is not correct"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two answers are both considered.<br>
Since they are stored in the YAML as a map, the order in the YAML is of no significance.<br>
Rather you have to specify the importance of a response, with a higher number meaning a higher importance meaning the response will be considered first.</p>
</div>
</div>
<div class="sect2">
<h3 id="matching-path-variables"><a class="anchor" href="#matching-path-variables"></a>8.6. Matching path variables</h3>
<div class="paragraph">
<p>In many REST-Apis it is usual to include variables as part of the resource path.<br>
Zion allows to configure a response that will match a path and extract the given variables.<br>
The assigned values can then be used in the response or be used in additional matching criteria.<br>
Here is an example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 33. tiger.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  zionServer:
    type: zion
    zionConfiguration:
      serverPort: 8080
      mockResponses:
        users:
          request:
            path: "/users/{userId}"
            method: "GET"
            additionalCriterions:
              - "'${userId}' == '123'"
          response:
            statusCode: 200
            body: "{'id':'${userId}', 'username': 'Tiger'}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The matching of the response is made with the new configuration entry <code>request</code>.Here we defined the <code>path</code> and <code>method</code> that should match and <code>additionalCriterions</code>.In the path we can see a variable defined with <code>{userId}</code>.</p>
</div>
<div class="paragraph">
<p>When making the following request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ curl "localhost:8080/users/123"
{'id':'123', 'username': 'Tiger'}</pre>
</div>
</div>
<div class="paragraph">
<p>the variable <code>userId</code> will be matched with the requested url and be assigned the value of <code>"123"</code>.<br>
This value can then be used in the <code>additionalCriterions</code> and in the <code>body</code>.</p>
</div>
<div class="paragraph">
<p>The matching of paths using the <code>request</code> configuration can also be made using nested responses.<br>
The path to match will combine paths specified in the different levels of the nested response.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 34. tiger.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  zionServer:
    type: zion
    zionConfiguration:
      serverPort: 8080
      mockResponses:
        users:
          request:
            path: "/users"
          nestedResponses:
            getSpecificUser:
              request:
                path: "/{userId}"
                method: "GET"
                additionalCriterions:
                  - "'${userId}' == '123'"
              response:
                statusCode: 200
                body: "{'id':'${userId}', 'username': 'Tiger'}"
            addUser:
              request:
                method: "POST"
                path: ""
              response:
                statusCode: 201
                headers:
                  Location: "/users/456"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have two nested responses in the <code>/users</code> path.<br>
One will match GET requests to the path <code>/users/{userId}</code> and the other will match POST-Requests to the path <code>/users</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tgrencodeas"><a class="anchor" href="#tgrencodeas"></a>8.7. tgrEncodeAs</h3>
<div class="paragraph">
<p>One of the core capabilities of Zion is the ability to switch between media types.<br>
You can return XML, JSON, JWT and many more types.<br>
You can also embed one into the other.</p>
</div>
<div class="paragraph">
<p>As an example we want to return a JSON containing a freshly signed JWT (JSON Web Token).<br>
For this we use the following response body file:</p>
</div>
<div class="listingblock">
<div class="title">Listing 35. complicatedResponse.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "myToken": {
    "tgrEncodeAs": "JWT",
    "header": {
      "alg": "BP256R1",
      "typ": "JWT"
    },
    "body": {
      "name": "Max Power",
      "iat": {
        "tgrAttributes": ["jsonNonStringPrimitive"],
        "value": "!{currentTimestamp()}"
      }
    },
    "signature": {
      "verifiedUsing": "idpEnc"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will lead to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "myToken": "eyJhbGciOiJCUDI1NlIxIiwidHlwIjoiSldUIn0.eyJuYW1lIjogIk1heCBQb3dlciIsImlhdCI6IDE2ODg2MzQ5MjR9.aOnFMxSkzvo9fJjnDSFCeX0G5-IP3XFQPZCRyZFBOEyBAgV2Dy3ImEjz_DpFRqSqtkHdkCcV-T_e6aBejN_A2g"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see the keyword <code>tgrEncodeAs</code> being used here.<br>
Currently the following values are supported: <code>XML, JSON, JWT, JWE, URL, BEARER_TOKEN</code>.<br>
A JWT consists of three parts: header, body, signature.<br>
The given nodes are searched and taken.<br>
The description of the JWT also could have been done in XML.</p>
</div>
<div class="paragraph">
<p>We then see another mode-switch being done in the <code>iat</code>-claim in the body of the JWT: <code>iat</code> is the Unix-Timestamp at which the token was issued.<br>
For our faked ad-hoc token we of course want to use the current time for this claim.<br>
Unfortunately the <code>iat</code> claim is a number, which precludes the direct use of a JEXL-expression.<br>
To solve this problem make the claim complex, add the <code>"jsonNonStringPrimitive"</code> attribute to the resulting node and set the value to the desired value.<br>
This also works for floating-point and boolean values.</p>
</div>
</div>
<div class="sect2">
<h3 id="rbelwriter-content-structures"><a class="anchor" href="#rbelwriter-content-structures"></a>8.8. RbelWriter content structures</h3>
<div class="paragraph">
<p>In this paragraph we&#8217;ll take a look at the various structures that can be serialized with the RbelWriter, which sits at the core of the Zion-Server.<br>
The following examples are kept in JSON (apart from the Bearer token example).<br>
Please note that the same result can be achieved from XML (or any other format for that matter).</p>
</div>
<div class="sect3">
<h4 id="jwt"><a class="anchor" href="#jwt"></a>8.8.1. JWT</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "tgrEncodeAs": "JWT",
  "header": {
    "alg": "BP256R1",
    "typ": "JWT"
  },
  "body": {
    "claim": "value"
  },
  "signature": {
    "verifiedUsing": "idpEnc"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three parts denote the different part of a JWT: The header claims (header), body claims (body) and signature properties (signature).<br>
RbelWriter will automatically try to sign the given JWT.<br>
For this the key at <code>$.signature.verifiedUsing</code> is consulted and a matching key is searched in the tiger key-database.<br>
This will be filled at start-time by digging through the root-directory of the application recursively and trying to open all found key-files with various default passwords.</p>
</div>
<div class="paragraph">
<p>Please note that the header-claims have to match the given key, otherwise the signing operation can&#8217;t be completed successfully.</p>
</div>
</div>
<div class="sect3">
<h4 id="jwe"><a class="anchor" href="#jwe"></a>8.8.2. JWE</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "tgrEncodeAs": "JWE",
  "header": {
    "alg": "ECDH-ES",
    "enc": "A256GCM"
  },
  "body": {
    "some_claim": "foobar",
    "other_claim": "code"
  },
  "encryptionInfo": {
    "decryptedUsingKeyWithId": "idpEnc"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the JWT, for the JWE all relevant claims are to be found in the appropriate sections.<br>
The signature has been replaced by the <code>encryptionInfo</code>-section.<br>
Here you need to specify the key to be used for the encryption.<br>
Here in this example we are using a public/private key-pair (with the same name as before).<br>
Again the header claims have to match the key used.</p>
</div>
<div class="paragraph">
<p>Apart from a public/private key-pair you can also use direct keys to encrypt your JWE.<br>
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "tgrEncodeAs": "JWE",
  "header": {
    "alg": "dir",
    "enc": "A256GCM"
  },
  "body": {
    "some_claim": "foobar",
    "other_claim": "code"
  },
  "encryptionInfo": {
    "decryptedUsingKey": "YVI2Ym5wNDVNb0ZRTWFmU1Y1ZTZkRTg1bG9za2tscjg"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we are using a AES 256 bit key the supplied key has to exactly carry 256 bits, Base64 encoded.</p>
</div>
</div>
<div class="sect3">
<h4 id="url"><a class="anchor" href="#url"></a>8.8.3. URL</h4>
<div class="paragraph">
<p>To generate a URL you can also use the RbelWriter.<br>
Consult the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "tgrEncodeAs": "url",
  "basicPath": "http://blub/fdsa",
  "parameters": {
    "foo": "bar"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameters will be added as query-parameters.<br>
This can be rather useful to construct more complex parameters, for example a dynamically generated JWT.</p>
</div>
</div>
<div class="sect3">
<h4 id="bearer-token"><a class="anchor" href="#bearer-token"></a>8.8.4. Bearer Token</h4>
<div class="paragraph">
<p>A Bearer token can also be serialized directly via RbelWriter.<br>
This is very relevant if you want to, for example, generate a JWT on the fly and use it as the Bearer token.<br>
The straight-forward way would be to directly write the Bearer token like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Bearer {
  "tgrEncodeAs":"JWT",
  "header":{
    "alg": "BP256R1",
    "typ": "JWT"
  },
  "body":{
    "claim": "value",
  },
  "signature":{
    "verifiedUsing":"idpEnc"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the whole arrangement will be parsed as a Bearer token (Which is essentially the Word <code>Bearer</code>, followed by a space and any string).<br>
The value of the Bearer token will be parsed as a JSON.<br>
When the result is then serialized, the <code>tgrEncodeAs</code> is interpreted and the JSON will be written as a Base64-encoded JWT.</p>
</div>
<div class="paragraph">
<p>The following example will produce the same result.<br>
However the overall structure is a JSON, which will be written as a Bearer token (<code>"tgrEncodeAs": "BEARER_TOKEN"</code>).<br>
The content of the token is taken from the child-node with the name <code>BearerToken</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "tgrEncodeAs": "BEARER_TOKEN",
  "BearerToken": {
    "tgrEncodeAs": "JWT",
    "header": {
      "alg": "BP256R1",
      "typ": "JWT"
    },
    "body": {
      "claim": "value"
    },
    "signature": {
      "verifiedUsing": "idpEnc"
    }
  }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiger-extensions-2"><a class="anchor" href="#tiger-extensions-2"></a>9. Tiger Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tiger has certain extensions that fulfil certain tasks.<br>
The different extensions are shortly described in the following sections.</p>
</div>
<div class="sect2">
<h3 id="tiger-konnektor-management-extension"><a class="anchor" href="#tiger-konnektor-management-extension"></a>9.1. Tiger Konnektor Management Extension</h3>
<div class="paragraph">
<p>The Tiger-Konnektor-Management-Extension provides an interface to the KMS system of different connector providers.<br>
It also provides cucumber feature steps to access the different connectors.<br>
This is an internal gematik extension and can be found on GitLab <a href="https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-konnektor-management-extensions" class="bare">https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-konnektor-management-extensions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tiger-on-fhir-extension"><a class="anchor" href="#tiger-on-fhir-extension"></a>9.2. Tiger On FHIR Extension</h3>
<div class="paragraph">
<p>The Tiger-On-Fhir-extension provides a set of simple BDD steps which can be used to check for valid FHIR content therein.<br>
FHIR stands for Fast Healthcare Interoperability Resources.<br>
The tiger-on-fhir can be found on GitHub <a href="https://github.com/gematik/tiger-on-fhir" class="bare">https://github.com/gematik/tiger-on-fhir</a> and it uses the Gematik Referenzvalidator located on GitHub <a href="https://github.com/gematik/app-referencevalidator" class="bare">https://github.com/gematik/app-referencevalidator</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tiger-cats-extension"><a class="anchor" href="#tiger-cats-extension"></a>9.3. Tiger CATS Extension</h3>
<div class="paragraph">
<p>CATS stands for Card Terminal Simulator.<br>
Tiger-Cats-Extensions offers the option to use the REST interface of CATS as Java functionality or as BDD steps.<br>
This is an internal gematik extension and can be found on GitLab <a href="https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-cats-extensions" class="bare">https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-cats-extensions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tiger-cloud-extension"><a class="anchor" href="#tiger-cloud-extension"></a>9.4. Tiger Cloud Extension</h3>
<div class="paragraph">
<p>The Tiger-Cloud-Extension allows to embed docker image based containers, docker compose scripts and even helm charts to local or remote kubernetes clusters.<br>
The GitHub repo is <a href="https://github.com/gematik/tiger-cloud-extension" class="bare">https://github.com/gematik/tiger-cloud-extension</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tiger-pssim-extension"><a class="anchor" href="#tiger-pssim-extension"></a>9.5. Tiger PSSIM Extension</h3>
<div class="paragraph">
<p>The Tiger-PSSIM-Extension is an extension for simulating a Primärsystem (PS) in your tests.<br>
It provides a wide range of BDD Steps and covers the majority of PS functionalities.<br>
This is an internal gematik extension and can be found on GitLab <a href="https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-pssim-extension" class="bare">https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-pssim-extension</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tiger-robot-extension"><a class="anchor" href="#tiger-robot-extension"></a>9.6. Tiger Robot Extension</h3>
<div class="paragraph">
<p>The Tiger-Robot-Extension is an extension designed to control the Cardterminal Robot created by the gematik.<br>
This is an internal gematik extension and can be found on GitLab <a href="https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-robot-extension" class="bare">https://gitlab.prod.ccs.gematik.solutions/git/Testtools/tiger/tiger-robot-extension</a>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rest-api"><a class="anchor" href="#rest-api"></a>10. Rest API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tiger test environment provides a Rest API which allows the automation of the execution of tests and retrieval of the corresponding test results.</p>
</div>
<div class="paragraph">
<p>The Rest API is disabled by default.<br>
You can enable it by setting the following configuration entry in the tiger.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">lib:
    enableTestManagementRestApi: true # set to true to enable the Rest API. default is false</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable the Rest API it is required to have the <code>cucumber-junit-platform-engine</code> in the class path.</p>
</div>
<div class="paragraph">
<p>E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-junit-platform-engine&lt;/artifactId&gt;
    &lt;version&gt;7.19.0&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is transitively included if you are importing the <code>tiger-test-lib</code>.<br>
But it is not included if you just import the <code>tiger-testenv-mgr</code>.</p>
</div>
<div class="paragraph">
<p>The following section provides an overview of the available endpoints and their functionality.<br>
Additionally, the OpenApi specification yaml can be found in the <a href="https://github.com/gematik/app-Tiger/blob/master/tiger-testenv-mgr/src/main/resources/tiger-management-api.yaml">tiger repository</a>.</p>
</div>
<div class="sect3">
<h4 id="introduction-2"><a class="anchor" href="#introduction-2"></a>10.1. Introduction</h4>
<div class="paragraph">
<p>API for managing the tiger test environment. You can start tests and retrieve the test results.</p>
</div>
</div>
<div class="sect3">
<h4 id="endpoints"><a class="anchor" href="#endpoints"></a>10.2. Endpoints</h4>
<div class="sect4 Tests">
<h5 id="tests"><a class="anchor" href="#tests"></a>Tests</h5>
<div class="sect5 getAvailableTests">
<h6 id="getavailabletests"><a class="anchor" href="#getavailabletests"></a>getAvailableTests</h6>
<div class="paragraph">
<p><code>GET /tests</code></p>
</div>
<div class="paragraph">
<p>get list of available tests</p>
</div>
<div class="sect6">
<h7 id="description"><a class="anchor" href="#description"></a>Description</h7>
<div class="paragraph">
<p>gets the list of available tests that were discovered by the JUnit Platform.</p>
</div>
</div>
<div class="sect6">
<h7 id="parameters"><a class="anchor" href="#parameters"></a>Parameters</h7>

</div>
<div class="sect6">
<h7 id="return-type"><a class="anchor" href="#return-type"></a>Return Type</h7>
<div class="paragraph">
<p>array[<a href="#TestDescription"><em>TestDescription</em></a>]</p>
</div>
</div>
<div class="sect6">
<h7 id="content-type"><a class="anchor" href="#content-type"></a>Content Type</h7>
<div class="ulist">
<ul>
<li>
<p>application/json</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="responses"><a class="anchor" href="#responses"></a>Responses</h7>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. HTTP Response Codes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Message</th>
<th class="tableblock halign-left valign-top">Datatype</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of available tests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List[<a href="#TestDescription"><em>TestDescription</em></a>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something went wrong server internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default error response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5 getTestResults">
<h6 id="gettestresults"><a class="anchor" href="#gettestresults"></a>getTestResults</h6>
<div class="paragraph">
<p><code>GET /tests/runs/{testRunId}</code></p>
</div>
<div class="paragraph">
<p>get the results of a test run</p>
</div>
<div class="sect6">
<h7 id="description-2"><a class="anchor" href="#description-2"></a>Description</h7>
<div class="paragraph">
<p>gets the results of a test run. This includes a global test result and  the results for each test case. In case of failing tests, the failure message is also included.</p>
</div>
</div>
<div class="sect6">
<h7 id="parameters-2"><a class="anchor" href="#parameters-2"></a>Parameters</h7>
<div class="sect7">
<h8 id="path-parameters"><a class="anchor" href="#path-parameters"></a>Path Parameters</h8>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRunId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRunId for which to get the test results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect6">
<h7 id="return-type-2"><a class="anchor" href="#return-type-2"></a>Return Type</h7>
<div class="paragraph">
<p><a href="#TestExecutionResult"><em>TestExecutionResult</em></a></p>
</div>
</div>
<div class="sect6">
<h7 id="content-type-2"><a class="anchor" href="#content-type-2"></a>Content Type</h7>
<div class="ulist">
<ul>
<li>
<p>application/json</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="responses-2"><a class="anchor" href="#responses-2"></a>Responses</h7>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. HTTP Response Codes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Message</th>
<th class="tableblock halign-left valign-top">Datatype</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the test results for the given testRunId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TestExecutionResult"><em>TestExecutionResult</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified resource was not found</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something went wrong server internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default error response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5 postExecutionRequest">
<h6 id="postexecutionrequest"><a class="anchor" href="#postexecutionrequest"></a>postExecutionRequest</h6>
<div class="paragraph">
<p><code>POST /tests/runs</code></p>
</div>
<div class="paragraph">
<p>request the execution of a selection of tests</p>
</div>
<div class="sect6">
<h7 id="description-3"><a class="anchor" href="#description-3"></a>Description</h7>
<div class="paragraph">
<p>sends a request for the execution of a selection of tests. The tests to be executed are specified with a TestExecutionRequest which includes uniqueIds, tags and file paths.  The execution request is queued for execution and will be executed as soon as any previously running tests finish. The response includes the id of the test run and the url where to find the results of the execution.</p>
</div>
</div>
<div class="sect6">
<h7 id="parameters-3"><a class="anchor" href="#parameters-3"></a>Parameters</h7>
<div class="sect7">
<h8 id="body-parameter"><a class="anchor" href="#body-parameter"></a>Body Parameter</h8>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TestExecutionRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test execution request <a href="#TestExecutionRequest"><em>TestExecutionRequest</em></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect6">
<h7 id="return-type-3"><a class="anchor" href="#return-type-3"></a>Return Type</h7>
<div class="paragraph">
<p><a href="#TestExecutionInformation"><em>TestExecutionInformation</em></a></p>
</div>
</div>
<div class="sect6">
<h7 id="content-type-3"><a class="anchor" href="#content-type-3"></a>Content Type</h7>
<div class="ulist">
<ul>
<li>
<p>application/json</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="responses-3"><a class="anchor" href="#responses-3"></a>Responses</h7>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. HTTP Response Codes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Message</th>
<th class="tableblock halign-left valign-top">Datatype</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request was received and test run is started</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TestExecutionInformation"><em>TestExecutionInformation</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified resource was not found</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something went wrong server internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default error response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5 postExecutionRequestAllTests">
<h6 id="postexecutionrequestalltests"><a class="anchor" href="#postexecutionrequestalltests"></a>postExecutionRequestAllTests</h6>
<div class="paragraph">
<p><code>POST /tests/runs/all</code></p>
</div>
<div class="paragraph">
<p>request execution of all tests</p>
</div>
<div class="sect6">
<h7 id="description-4"><a class="anchor" href="#description-4"></a>Description</h7>
<div class="paragraph">
<p>sends a request for the execution of all tests. The execution request is queued for execution and will be executed as soon as any previously running tests finish. The response includes the id of the test run and the url where to find the results of the execution.</p>
</div>
</div>
<div class="sect6">
<h7 id="parameters-4"><a class="anchor" href="#parameters-4"></a>Parameters</h7>

</div>
<div class="sect6">
<h7 id="return-type-4"><a class="anchor" href="#return-type-4"></a>Return Type</h7>
<div class="paragraph">
<p><a href="#TestExecutionInformation"><em>TestExecutionInformation</em></a></p>
</div>
</div>
<div class="sect6">
<h7 id="content-type-4"><a class="anchor" href="#content-type-4"></a>Content Type</h7>
<div class="ulist">
<ul>
<li>
<p>application/json</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="responses-4"><a class="anchor" href="#responses-4"></a>Responses</h7>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. HTTP Response Codes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Message</th>
<th class="tableblock halign-left valign-top">Datatype</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request was received and test run is started</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TestExecutionInformation"><em>TestExecutionInformation</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified resource was not found</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something went wrong server internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default error response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Error"><em>Error</em></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="models"><a class="anchor" href="#models"></a>10.3. Models</h4>
<div class="sect4">
<h5 id="Error"><a class="anchor" href="#Error"></a><em>Error</em></h5>
<div class="paragraph">
<p>Default error object with information about the occurred error</p>
</div>
<table class="tableblock frame-all grid-all stretch fields-Error">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A code identifying this error</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A readable message describing the error</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ExecutionResult"><a class="anchor" href="#ExecutionResult"></a><em>ExecutionResult</em></h5>
<div class="paragraph">
<p>the result of an executed test</p>
</div>
<table class="tableblock frame-all grid-all stretch fields-ExecutionResult">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#String">[String]</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enum:</em> PENDING, RUNNING, SUCCESSFUL, ABORTED, FAILED,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureMessage</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="TestDescription"><a class="anchor" href="#TestDescription"></a><em>TestDescription</em></h5>
<div class="paragraph">
<p>The description of a test case</p>
</div>
<table class="tableblock frame-all grid-all stretch fields-TestDescription">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uniqueId</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unique identifier of the tests which is generated by the test platform.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceFile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">source file from where the test was discovered</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">displayName</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display name of the test</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set   of <a href="#string">[string]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags associated with the test as specified in the feature file</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="TestExecutionInformation"><a class="anchor" href="#TestExecutionInformation"></a><em>TestExecutionInformation</em></h5>
<div class="paragraph">
<p>information of which tests were started and where to find the results of the test run</p>
</div>
<table class="tableblock frame-all grid-all stretch fields-TestExecutionInformation">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRunId</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUID</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultUrl</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uri</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testsToExecute</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List   of <a href="#TestDescription"><em>TestDescription</em></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="TestExecutionRequest"><a class="anchor" href="#TestExecutionRequest"></a><em>TestExecutionRequest</em></h5>
<div class="paragraph">
<p>Request the execution of a subset of tests. Multiple specifications will be combined with AND. If one of the tags, sourceFiles, or testUniqueIds is an empty list, it will not be considered in the selection of tests. If all are empty, all tests are selected.</p>
</div>
<table class="tableblock frame-all grid-all stretch fields-TestExecutionRequest">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List   of <a href="#string">[string]</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceFiles</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List   of <a href="#string">[string]</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testUniqueIds</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List   of <a href="#string">[string]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the unique ids generated by the test platform. See the endpoint &#x60;GET /tests&#x60; for the available tests.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="TestExecutionResult"><a class="anchor" href="#TestExecutionResult"></a><em>TestExecutionResult</em></h5>
<div class="paragraph">
<p>the result of the executed tests</p>
</div>
<table class="tableblock frame-all grid-all stretch fields-TestExecutionResult">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRunStarted</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date-time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRunFinished</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date-time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ExecutionResult"><em>ExecutionResult</em></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tests</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List   of <a href="#TestExecutionResult_tests_inner">[TestExecutionResult_tests_inner]</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="TestExecutionResultTestsInner"><a class="anchor" href="#TestExecutionResultTestsInner"></a><em>TestExecutionResultTestsInner</em></h5>
<table class="tableblock frame-all grid-all stretch fields-TestExecutionResultTestsInner">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 36.3636%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TestDescription"><em>TestDescription</em></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ExecutionResult"><em>ExecutionResult</em></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="links-to-test-relevant-topics"><a class="anchor" href="#links-to-test-relevant-topics"></a>11. Links to test relevant topics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>3-Amigos</p>
<div class="ulist">
<ul>
<li>
<p>presumably first mentioned in <a href="https://blog.gdinwiddie.com/2009/06/17/if-you-dont-automate-acceptance-tests/">George Dinwiddie&#8217;s blog</a> (2009)</p>
</li>
<li>
<p><a href="https://johnfergusonsmart.com/three-amigos-requirements-discovery/">John Ferguson&#8217;s Blog about 3 Amigos</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Cucumber</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://cucumber.io/">Product website</a></p>
</li>
<li>
<p><a href="https://www.guru99.com/gherkin-test-cucumber.html">Guru99&#8217;s Intro to Gherkin</a></p>
</li>
<li>
<p><a href="https://cucumber.io/docs/gherkin/reference/">Cucumbers Gherkin reference</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://serenity-bdd.info/">Serenity BDD</a></p>
</li>
<li>
<p>SOLID</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-five-principles-of-object-oriented-design">Explaining all five concepts with simple Geometry</a></p>
</li>
<li>
<p><a href="https://stackify.com/solid-design-principles/">In depth discussion of the 5 principles</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://effectivesoftwaredesign.com/2012/02/05/separation-of-concerns/">Separation of concerns principle</a></p>
</li>
<li>
<p>Screenplay Pattern</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.infoq.com/articles/Beyond-Page-Objects-Test-Automation-Serenity-Screenplay/">Nice overview of what the screenplay pattern is about</a></p>
</li>
<li>
<p><a href="https://dzone.com/articles/page-objects-refactored-solid-steps-to-the-screenp">From Page Objects to SOLID Screenplay</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>FIRST principle for Unit tests</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://agileinaflash.blogspot.com/2009/02/first.html">AgileOtters Blog</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="frequently-asked-questions"><a class="anchor" href="#frequently-asked-questions"></a>12. Frequently asked questions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="maven"><a class="anchor" href="#maven"></a>12.1. Maven</h3>
<div class="sect3">
<h4 id="fm01-which-serenity-are-we-currently-using"><a class="anchor" href="#fm01-which-serenity-are-we-currently-using"></a>12.1.1. FM01 Which Serenity are we currently using?</h4>
<div class="paragraph">
<p>You can find the Serenity compatible with each Tiger version in the [ReleaseNotes](ReleaseNotes.md)</p>
</div>
</div>
<div class="sect3">
<h4 id="fm02-when-using-maven-no-tests-are-executed"><a class="anchor" href="#fm02-when-using-maven-no-tests-are-executed"></a>12.1.2. FM02 When using maven, no tests are executed.</h4>
<div class="paragraph">
<p>Please first make sure that either the surefire or failsafe plugin is enabled and shown as running in the console. If you use Junit4 test annotations, you have to make sure that the junit vintage engine from the Junit5 library is included in the dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
    &lt;version&gt;${version.junit5}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fm03-when-running-tests-in-tiger-the-test-run-aborts-with-a-java-lang-nosuchmethoderror"><a class="anchor" href="#fm03-when-running-tests-in-tiger-the-test-run-aborts-with-a-java-lang-nosuchmethoderror"></a>12.1.3. FM03 When running tests in Tiger, the test run aborts with a java.lang.NoSuchMethodError.</h4>
<div class="paragraph">
<p>More specifically, the error is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Exception in thread 'main' java.lang.NoSuchMethodError: 'java.util.Set org.json.JSONObject.keySet()'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is due to a dependency conflict which may be solved by an exclusion in the tiger-test-lib:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;exclusion&gt;
    &lt;groupId&gt;com.vaadin.external.google&lt;/groupId&gt;
    &lt;artifactId&gt;android-json&lt;/artifactId&gt;
&lt;/exclusion&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fm04-i-dont-see-any-log-output-there-are-only-warnings-about-outdated-versions-at-the-beginning"><a class="anchor" href="#fm04-i-dont-see-any-log-output-there-are-only-warnings-about-outdated-versions-at-the-beginning"></a>12.1.4. FM04 I don&#8217;t see any log output, there are only warnings about outdated versions at the beginning</h4>
<div class="paragraph">
<p>Apparently you included SLF4J V2 dependencies.<br>
We currently use the logback classic 1.2.x branch, which is delivered in the most recent SpringBoot version. This is not compatible to SLF4J 2.x.x.</p>
</div>
</div>
<div class="sect3">
<h4 id="fm05-there-are-selenium-version-conflicts-when-i-want-to-run-my-project-with-springboot-and-tiger-with-selenium"><a class="anchor" href="#fm05-there-are-selenium-version-conflicts-when-i-want-to-run-my-project-with-springboot-and-tiger-with-selenium"></a>12.1.5. FM05 There are selenium version conflicts when I want to run my project with SpringBoot and tiger with selenium</h4>
<div class="paragraph">
<p>SpringBoot deploys an outdated selenium version. To solve the conflicts, please use the versions stated in the release notes via dependency managent in the maven pom.xml.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extensions"><a class="anchor" href="#extensions"></a>12.2. Extensions</h3>
<div class="sect3">
<h4 id="fe01-when-i-start-a-docker-image-in-tiger-yaml-the-testenvironmentmanagers-startup-fails"><a class="anchor" href="#fe01-when-i-start-a-docker-image-in-tiger-yaml-the-testenvironmentmanagers-startup-fails"></a>12.2.1. FE01 When I start a docker image in tiger.yaml, the TestenvironmentManager&#8217;s startup fails</h4>
<div class="paragraph">
<p>Please make sure that you added the tiger-cloud-extension dependency in the most recent version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.gematik&lt;/groupId&gt;
    &lt;artifactId&gt;tiger-cloud-extension&lt;/artifactId&gt;
    &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fe02-when-using-the-tiger-cloud-extensions-healthcheck-at-docker-servertypes-in-gematik-sw-factory-fails"><a class="anchor" href="#fe02-when-using-the-tiger-cloud-extensions-healthcheck-at-docker-servertypes-in-gematik-sw-factory-fails"></a>12.2.2. FE02 When using the tiger-cloud-extensions, healthcheck at docker servertypes in Gematik SW factory fails</h4>
<div class="paragraph">
<p>Tiger expects that Docker Daemon starts the container locally.<br>
However, if this is not the case, you may use the environment variable TIGER_DOCKER_HOST to share on which server instance the container is started and the HealthcheckURL is adjusted accordingly. For purposes of the Gematik SW-factory, the following code snippet is recommended for the pipeline script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">stage('Test') {
    environment {
        TIGER_DOCKER_HOST = dockerGetCurrentHostname()
    }
    steps {
        mavenVerify(POM_PATH)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="workflow-ui"><a class="anchor" href="#workflow-ui"></a>12.3. Workflow UI</h3>
<div class="sect3">
<h4 id="fw01-in-the-workflow-ui-scenarios-are-listed-twice-and-are-refreshed-the-same-time-as-if-they-ran-parallely"><a class="anchor" href="#fw01-in-the-workflow-ui-scenarios-are-listed-twice-and-are-refreshed-the-same-time-as-if-they-ran-parallely"></a>12.3.1. FW01 In the workflow UI scenarios are listed twice and are refreshed the same time (as if they ran parallely)</h4>
<div class="paragraph">
<p>Usually, this only happens when the test suite is started in intellij and TigerCucumberListener is delivered as a plugin in TigerCucumberListener.<br>
This is no longer necessary since v1.3 because the listener is added automatically. Due to this manual adjustment, two listeners are running that communicate the scenarios twice to the workflow UI.<br>
If this happens in a mvn call, please check the tiger-maven-plugin configuration or the generated driver classes in terms of additional plugins in CucumberOptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="fw02-after-having-pressed-shutdown-in-the-workflow-ui-i-cannot-see-messages-in-rbellog-details-pane-anymore"><a class="anchor" href="#fw02-after-having-pressed-shutdown-in-the-workflow-ui-i-cannot-see-messages-in-rbellog-details-pane-anymore"></a>12.3.2. FW02 After having pressed shutdown in the workflow UI, I cannot see messages in RbelLog Details Pane anymore</h4>
<div class="paragraph">
<p>By stopping the test runs, the workflow UI backend is terminated as well. You may recognize this by the light-red color of the side bar. However, navigating in the RbelLog Details Pane requires a running backend. In addition, RbelPath- and JEXL inspect dialogues are not working.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-topics"><a class="anchor" href="#other-topics"></a>12.4. Other topics</h3>
<div class="sect3">
<h4 id="fo01-how-can-i-change-the-logging-levels-of-loggers-used-by-tiger"><a class="anchor" href="#fo01-how-can-i-change-the-logging-levels-of-loggers-used-by-tiger"></a>12.4.1. FO01 How can I change the logging levels of loggers used by Tiger</h4>
<div class="paragraph">
<p>Inside the tiger.yaml file, you can add a section logging.level: and add a list of packages / classes and the desired logging level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logging:
  level:
    de.gematik.test.tiger.testenvmgr.TigerTestEnvMgr: TRACE
    de.gematik.test.tiger.lib.TigerDirector: TRACE
    de.gematik.test.tiger.proxy: TRACE
    localTigerProxy: TRACE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fo02-docker-container-creation-fails"><a class="anchor" href="#fo02-docker-container-creation-fails"></a>12.4.2. FO02 Docker container creation fails</h4>
<div class="paragraph">
<p>Use the command below to remove all unused containers. Or look for containers starting with "tiger", stop and remove them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">docker system prune</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last resort:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">netcfg -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>and restart docker</p>
</div>
</div>
<div class="sect3">
<h4 id="fo03-adding-alternative-names-programatically-throws-sslexception"><a class="anchor" href="#fo03-adding-alternative-names-programatically-throws-sslexception"></a>12.4.3. FO03 Adding alternative names programatically throws SSLException</h4>
<div class="paragraph">
<p>When using directly the method <code>de.gematik.test.tiger.proxy.TigerProxy.addAlternativeName()</code> to add multiple alternative names to the TLS certificate of the tiger proxy the following exception may come up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">12:17:48.604 [MockServer-EventLog13] ERROR o.mockserver.log.MockServerEventLog - 58165 exception creating SSL context for serverfailed to set certificate and key
javax.net.ssl.SSLException: failed to set certificate and key</code></pre>
</div>
</div>
<div class="paragraph">
<p>The tiger proxy uses a mockserver internally which creates a SSLContext when handling the first request. Adding additional names after the first request will not update the created SSLContext and the exception will be thrown.</p>
</div>
<div class="paragraph">
<p>A workaround for this behaviour is to explicitly restart the internal mockserver after adding an alternative name. E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">TigerProxy proxy = TigerDirector.getTigerTestEnvMgr().getLocalTigerProxyOrFail();
proxy.addAlternativeName(host);
proxy.restartMockserver();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fm01-what-serenity-do-we-use-currently"><a class="anchor" href="#fm01-what-serenity-do-we-use-currently"></a>12.4.4. FM01 What serenity do we use currently?</h4>
<div class="paragraph">
<p>Das zu jeder Tiger Version kompatible Serenity findet ihr in den [ReleaseNotes](ReleaseNotes.md)</p>
</div>
</div>
<div class="sect3">
<h4 id="fm02-bei-der-nutzung-von-maven-werden-keine-tests-ausgeführt"><a class="anchor" href="#fm02-bei-der-nutzung-von-maven-werden-keine-tests-ausgeführt"></a>12.4.5. FM02 Bei der Nutzung von maven werden keine Tests ausgeführt</h4>
<div class="paragraph">
<p>Bitte stell zuerst sicher, dass entweder das surefire oder das failsafe plugin aktiviert ist und auch in der Konsole als ausgeführt angezeigt wird. Solltest Du Junit4 Test Annotationen verwenden so musst Du noch sicherstellen, dass die junit vintage engine aus der Junit5 Library in den dependencies mit angeführt ist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
    &lt;version&gt;${version.junit5}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fm03-beim-ausführen-von-tests-im-tiger-bricht-der-testlauf-mit-einem-java-lang-nosuchmethoderror-ab"><a class="anchor" href="#fm03-beim-ausführen-von-tests-im-tiger-bricht-der-testlauf-mit-einem-java-lang-nosuchmethoderror-ab"></a>12.4.6. FM03 Beim Ausführen von Tests im Tiger bricht der Testlauf mit einem java.lang.NoSuchMethodError ab</h4>
<div class="paragraph">
<p>Genauer geht es um folgenden Fehler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Exception in thread 'main' java.lang.NoSuchMethodError: 'java.util.Set org.json.JSONObject.keySet()'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Der Grund hierfür ist ein Dependency Konflikt und kann durch eine Exklusion in der tiger-test-lib dependency aufgelöst werden:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;exclusion&gt;
    &lt;groupId&gt;com.vaadin.external.google&lt;/groupId&gt;
    &lt;artifactId&gt;android-json&lt;/artifactId&gt;
&lt;/exclusion&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fm04-ich-sehe-keine-log-ausgabe-lediglich-am-anfang-stehen-warnungen-über-veraltete-versionen"><a class="anchor" href="#fm04-ich-sehe-keine-log-ausgabe-lediglich-am-anfang-stehen-warnungen-über-veraltete-versionen"></a>12.4.7. FM04 Ich sehe keine Log-Ausgabe, lediglich am Anfang stehen Warnungen über veraltete Versionen</h4>
<div class="paragraph">
<p>Du hast anscheinend Dependencies zu SLF4J V2 eingebunden.<br>
Wir verwenden derzeit den logback classic 1.2.x branch, da dieser in der von uns verwendeten Spring Boot Version mitgeliefert wird. Dieses ist NICHT kompatibel zu SLF4J 2.x.x!</p>
</div>
</div>
<div class="sect3">
<h4 id="fm05-wenn-ich-in-meinem-projekt-spring-boot-und-tiger-mit-selenium-nutzen-will-gibt-es-versionskonflikte-bei-selenium"><a class="anchor" href="#fm05-wenn-ich-in-meinem-projekt-spring-boot-und-tiger-mit-selenium-nutzen-will-gibt-es-versionskonflikte-bei-selenium"></a>12.4.8. FM05 Wenn ich in meinem Projekt Spring Boot und Tiger mit Selenium nutzen will, gibt es Versionskonflikte bei Selenium</h4>
<div class="paragraph">
<p>Spring Boot liefert eine veraltete Version von Selenium aus. Um die Konflikte zu lösen, bitte die in den ReleaseNotes angeführten Versionen über DependencyManagement im maven pom.xml lösen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extensions-2"><a class="anchor" href="#extensions-2"></a>12.5. Extensions</h3>
<div class="sect3">
<h4 id="fe01-wenn-ich-in-der-tiger-yaml-ein-docker-image-starten-will-so-schlägt-der-startup-des-testenvironmentmanagers-fehl"><a class="anchor" href="#fe01-wenn-ich-in-der-tiger-yaml-ein-docker-image-starten-will-so-schlägt-der-startup-des-testenvironmentmanagers-fehl"></a>12.5.1. FE01 Wenn ich in der tiger.yaml ein Docker image starten will, so schlägt der Startup des TestenvironmentManagers fehl.</h4>
<div class="paragraph">
<p>Stelle sicher, dass du die tiger-cloud-extension in der aktuellsten Version als dependency hinzugefügt hast.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.gematik&lt;/groupId&gt;
    &lt;artifactId&gt;tiger-cloud-extension&lt;/artifactId&gt;
    &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fe02-wenn-ich-die-tiger-cloud-extensions-nutze-schlägt-der-healthcheck-bei-docker-servertypen-in-der-gematik-sw-factory-fehl"><a class="anchor" href="#fe02-wenn-ich-die-tiger-cloud-extensions-nutze-schlägt-der-healthcheck-bei-docker-servertypen-in-der-gematik-sw-factory-fehl"></a>12.5.2. FE02 Wenn ich die tiger-cloud-extensions nutze, schlägt der Healthcheck bei docker Servertypen in der Gematik SW Factory fehl</h4>
<div class="paragraph">
<p>Normalerweise geht Tiger davon aus, dass der Docker Daemon die Container am lokalen Rechner startet.<br>
Sollte dies nicht so sein, so kann man Tiger mit der Umgebungsvariable TIGER_DOCKER_HOST mitteilen, auf welchem Rechner die Container gestartet werden und die HealthcheckURL wird dementsprechend angepasst. Für die Gematik SW-Factory empfiehlt sich folgendes Code Snippet für das Pipeline-Skript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">stage('Test') {
    environment {
        TIGER_DOCKER_HOST = dockerGetCurrentHostname()
    }
    steps {
        mavenVerify(POM_PATH)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="workflow-ui-2"><a class="anchor" href="#workflow-ui-2"></a>12.6. Workflow UI</h3>
<div class="sect3">
<h4 id="fw01-in-der-workflow-ui-sind-die-szenarios-doppelt-aufgeführt-und-werden-auch-zeitgleich-aktualisiert-es-scheint-als-ob-sie-parallel-ablaufen"><a class="anchor" href="#fw01-in-der-workflow-ui-sind-die-szenarios-doppelt-aufgeführt-und-werden-auch-zeitgleich-aktualisiert-es-scheint-als-ob-sie-parallel-ablaufen"></a>12.6.1. FW01 In der Workflow UI sind die Szenarios doppelt aufgeführt und werden auch zeitgleich aktualisiert (es scheint, als ob sie parallel ablaufen)</h4>
<div class="paragraph">
<p>Passiert eigentlich nur, wenn die Testsuite aus Intellij gestartet wurde und in der RuntimeConfiguration der TigerCucumberListener als plugin mitgegeben wird. Dies ist seit v1.3 nicht mehr notwendig, weil der Listener automatisch hinzugefügt wird. Durch den manuellen Eintrag laufen also dann zwei Listener, welche die Szenarien dann auch doppelt an die Workflow UI kommunizieren &#8230;&#8203;<br>
Sollte dieser Effekt auch bei einem mvn call auftreten, dann bitte die Konfiguration des tiger-maven-plugins überprüfen, bzw. die generierten Treiberklassen bezüglich zusätzlicher Plugins in den CucumberOptions checken.</p>
</div>
</div>
<div class="sect3">
<h4 id="fw02-nachdem-ich-auf-shutdown-in-der-workflow-ui-gedrückt-habe-kann-ich-die-nachrichten-in-der-rbellog-details-pane-nicht-mehr-ansehen"><a class="anchor" href="#fw02-nachdem-ich-auf-shutdown-in-der-workflow-ui-gedrückt-habe-kann-ich-die-nachrichten-in-der-rbellog-details-pane-nicht-mehr-ansehen"></a>12.6.2. FW02 Nachdem ich auf Shutdown in der Workflow UI gedrückt habe, kann ich die Nachrichten in der RbelLog Details Pane nicht mehr ansehen</h4>
<div class="paragraph">
<p>Durch das Beenden des Testlaufs ist das Backend der Workflow UI auch beendet worden. Dies kannst Du auch daran erkennen, dass die linke Seitenleiste nun blass rot eingefärbt ist. Das Navigieren in der RbelLog Details Pane benötigt aber das Backend und klappt daher zum jetzigen Zeitpunkt nicht mehr. Auch die RbelPath- und JEXL Inspect Dialoge sind nicht mehr funktional.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-topics-2"><a class="anchor" href="#other-topics-2"></a>12.7. Other topics</h3>
<div class="sect3">
<h4 id="fo01-how-can-i-change-the-logging-levels-of-loggers-used-by-tiger-2"><a class="anchor" href="#fo01-how-can-i-change-the-logging-levels-of-loggers-used-by-tiger-2"></a>12.7.1. FO01 How can I change the logging levels of loggers used by Tiger</h4>
<div class="paragraph">
<p>Inside the tiger.yaml file you can add a section logging.level: and add a list of packages / classes and the desired logging level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logging:
  level:
    de.gematik.test.tiger.testenvmgr.TigerTestEnvMgr: TRACE
    de.gematik.test.tiger.lib.TigerDirector: TRACE
    de.gematik.test.tiger.proxy: TRACE
    localTigerProxy: TRACE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fo02-docker-container-creation-fails-2"><a class="anchor" href="#fo02-docker-container-creation-fails-2"></a>12.7.2. FO02 Docker container creation fails</h4>
<div class="paragraph">
<p>Use the command below to remove all unused containers. Or look for containers starting with "tiger", stop and remove them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">docker system prune</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last resort:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">netcfg -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>and restart docker</p>
</div>
</div>
<div class="sect3">
<h4 id="fo03-adding-alternative-names-programatically-throws-sslexception-2"><a class="anchor" href="#fo03-adding-alternative-names-programatically-throws-sslexception-2"></a>12.7.3. FO03 Adding alternative names programatically throws SSLException</h4>
<div class="paragraph">
<p>When using directly the method <code>de.gematik.test.tiger.proxy.TigerProxy.addAlternativeName()</code> to add multiple alternative names to the TLS certificate of the tiger proxy the following exception may come up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">12:17:48.604 [MockServer-EventLog13] ERROR o.mockserver.log.MockServerEventLog - 58165 exception creating SSL context for serverfailed to set certificate and key
javax.net.ssl.SSLException: failed to set certificate and key</code></pre>
</div>
</div>
<div class="paragraph">
<p>The tiger proxy uses a mockserver internally which creates a SSLContext when handling the first request. Adding additional names after the first request will not update the created SSLContext and the exception will be thrown.</p>
</div>
<div class="paragraph">
<p>A workaround for this behaviour is to explicitly restart the internal mockserver after adding an alternative name. E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">TigerProxy proxy = TigerDirector.getTigerTestEnvMgr().getLocalTigerProxyOrFail();
proxy.addAlternativeName(host);
proxy.restartMockserver();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-12-09 11:54:15 +0100
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>