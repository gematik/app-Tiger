<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="description" content="User Manual for Tiger">
<meta name="author" content="TIGER@gematik.de">
<title>Tiger User Manual</title>
<style>
/*
 * ${GEMATIK_COPYRIGHT_STATEMENT}
 */

@import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');

/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */

@import url(https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css); /* Default asciidoc style framework - important */

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */

:root {
    --maincolor: #FFFFFF;
    --primarycolor: #000E52;
    --secondarycolor: #000E52;
    --tertiarycolor: #225494;
}

body {
    font-family: "Verdana", sans-serif;
    font-size: 11pt;
    text-align: justify;
}

/* Text styles */
h1 {
    color: var(--primarycolor);
    font-weight: bold;
    text-align: center;
}

#header {
    padding: 20rem 0;
    background-position: top;
    background-repeat: no-repeat;
    background-image: url("media/title_white.plain.svg");
    height: 80rem;
}

/* TODO Anne to be kept locally */
#header h1 {
    background-image: url("media/tiger-mono-picto-plain.svg");
    background-size: 150px;
    background-repeat: no-repeat;
    background-position: 120px bottom;
    padding-left: 10rem;
    line-height: 350%;
    font-size: 327%;
}

#header .details {
    text-align: center;
    display: block;
    padding-left: 120px;
    border: 0;
    margin-top: -40px;
}
/* end of to be kept locally */

h2 {
    color: var(--secondarycolor);
    font-weight: bold;
}

h3, h4, h5, h6 {
    color: var(--tertiarycolor);
    font-weight: bold;
}

h3 {
    margin-top: 5rem;
}

/* code blocks */
.listingblock > .content > pre.CodeRay, code, pre {
    font-family: "Fira Code";
    font-size: 82%;
}

.listingblock > .content > pre.CodeRay {
    background: #fafafa !important;
    border: 1px solid #ccc;
    border-radius: 0.5rem;
}


/* captions for all kinds of blocks
.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title
*/
.title {
    font-family: "Verdana" !important;
    font-style: italic !important;
    color: #000000 !important;
}

/* links */
a {
    color: #00766e;
}

#toctitle {
    color: var(--primarycolor);
}

#toc, #toc a {
    color: var(--secondarycolor);
    line-height: 175%;
}

/* Table styles */
th {
    font-family: "Verdana", sans-serif
}

/* Responsiveness fixes */
video {
    max-width: 100%;
}

@media all and (max-width: 600px) {
    table {
        width: 55vw;
        font-size: 3vw;
    }
}


</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Tiger User Manual</h1>
<div class="details">
<span id="author" class="author">TIGER@gematik.de</span><br>
<span id="revdate">Version 0.22.2 - 2022-06-02</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_use_cases">1.1. Use cases</a></li>
<li><a href="#_components">1.2. Components</a></li>
</ul>
</li>
<li><a href="#_getting_started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#_requirements">2.1. Requirements</a></li>
<li><a href="#_maven_in_a_nutshell">2.2. Maven in a nutshell</a></li>
<li><a href="#_maven_plugin_details">2.3. Maven plugin details</a></li>
<li><a href="#_example_project">2.4. Example project</a></li>
<li><a href="#_how_to_contact_the_tiger_team">2.5. How to contact the Tiger team</a></li>
<li><a href="#_intellij">2.6. IntelliJ</a></li>
</ul>
</li>
<li><a href="#_tiger_test_environment_manager_2">3. Tiger test environment manager</a>
<ul class="sectlevel2">
<li><a href="#_supported_server_nodes_and_their_configuration">3.1. Supported server nodes and their configuration</a></li>
<li><a href="#_provided_node_templates">3.2. Provided node templates</a></li>
<li><a href="#_configuring_the_local_test_suite_tiger_proxy">3.3. Configuring the local test suite Tiger Proxy</a></li>
<li><a href="#_standalone_mode_vs_implicit_startup_with_test_suite">3.4. Standalone mode vs. implicit startup with test suite</a></li>
<li><a href="#_using_environment_variables_and_system_properties">3.5. Using Environment variables and system properties</a></li>
</ul>
</li>
<li><a href="#_tiger_proxy_2">4. Tiger Proxy</a>
<ul class="sectlevel2">
<li><a href="#_excurse_what_are_proxies_reverse_forward">4.1. Excurse: What are proxies, reverse, forward</a></li>
<li><a href="#_tiger_proxy_basics">4.2. Tiger Proxy basics</a></li>
<li><a href="#_understanding_routes">4.3. Understanding routes</a></li>
<li><a href="#_tls_keys_certificates_a_quick_tour_on_proxies">4.4. TLS, keys, certificates a quick tour on proxies</a></li>
<li><a href="#_modifications">4.5. Modifications</a></li>
<li><a href="#_mesh_setup_traffic_endpoints">4.6. Mesh set up</a></li>
<li><a href="#_understanding_rbelpath">4.7. Understanding RBelPath</a></li>
<li><a href="#_running_tiger_proxy_as_standalone_jar">4.8. Running Tiger Proxy as standalone JAR</a></li>
<li><a href="#_additional_configuration">4.9. Additional configuration</a></li>
</ul>
</li>
<li><a href="#_tiger_test_library_2">5. Tiger Test library</a>
<ul class="sectlevel2">
<li><a href="#_tiger_test_lib_configuration">5.1. Tiger test lib configuration</a></li>
<li><a href="#_cucumber_and_hooks">5.2. Cucumber and Hooks</a></li>
<li><a href="#_using_the_cucumber_tiger_validation_steps">5.3. Using the Cucumber Tiger validation steps</a></li>
<li><a href="#_using_tiger_test_lib_helper_classes">5.4. Using Tiger test lib helper classes</a></li>
<li><a href="#_synchronizing_bdd_scenarios_with_polarion_test_cases_gematik_only">5.5. Synchronizing BDD scenarios with Polarion test cases (Gematik only)</a></li>
</ul>
</li>
<li><a href="#_tiger_configuration">6. Tiger Configuration</a>
<ul class="sectlevel2">
<li><a href="#_inlets">6.1. Inlets</a></li>
<li><a href="#_key_translation">6.2. Key-translation</a></li>
<li><a href="#_thread_based_configuration">6.3. Thread-based configuration</a></li>
<li><a href="#_placeholders">6.4. Placeholders</a></li>
<li><a href="#_localized_configuration">6.5. Localized configuration</a></li>
<li><a href="#_examples">6.6. Examples</a></li>
<li><a href="#_pre_defined_values">6.7. Pre-Defined values</a></li>
<li><a href="#_inline_jexl">6.8. Inline JEXL</a></li>
</ul>
</li>
<li><a href="#_tiger_user_interfaces">7. Tiger User interfaces</a>
<ul class="sectlevel2">
<li><a href="#_admin_ui">7.1. Admin UI</a></li>
<li><a href="#_workflow_ui_2">7.2. Workflow UI</a></li>
<li><a href="#_standalone_tiger_proxy_ui">7.3. Standalone Tiger Proxy UI</a></li>
</ul>
</li>
<li><a href="#_links_to_test_relevant_topics">8. Links to test relevant topics</a></li>
<li><a href="#_faqs">9. FAQs</a>
<ul class="sectlevel2">
<li><a href="#_docker_container_creation_fails">9.1. docker container creation fails</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get a quick introduction to the core concepts and features of the Tiger test framework check out our video</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://youtu.be/eJJZDeuFlyI?autoplay"><img src="media/tiger-pitch-still.png" alt="tiger pitch still" width="1024"></a>
</div>
<div class="title">Figure 1. Tiger product pitch video</div>
</div>
<div class="paragraph">
<p>Tiger is a framework for interface-driven BDD black-box-testing.</p>
</div>
<div class="paragraph">
<p>Tiger is a toolbox that supports and guides you when writing test suites. It lets you focus on writing the tests  and solves typical problems that every team encounters (configuration, setting up the test environment, parametrization, result reporting, test running). How, you ask?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tiger does not focus on components but on the interactions between them. The Tiger Proxy captures the traffic between components.</p>
</li>
<li>
<p>Tiger Proxy parses the traffic and builds a tree-structure which abstracts away the encoding (XML, JSON&#8230;&#8203;) and lets you focus on the data.</p>
</li>
<li>
<p>The Tiger test environment manager handles dockers, JARs and external servers, boots the configured setup and routes the traffic, all with zero lines of Java, all in YAML only.</p>
</li>
<li>
<p>A complete configuration toolkit, which combines multiple source and supports custom configuration of your testsuite as well, again with zero lines of Java.</p>
</li>
<li>
<p>Common tasks (JSON-validation, message-filtering, scenario configuration, configuration of simulators&#8230;&#8203;) can be performed with the Tiger test library, which can be seamlessly imported into BDD test suites.<br>
This allows you to build mighty test suites with zero lines of java.</p>
</li>
<li>
<p>If you want to write custom steps and glue code our Java-API has got you covered by supporting common tasks (crypto, serialization&#8230;&#8203;) for you. So the little lines you have to write are be powerful and descriptive?!</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_use_cases">1.1. Use cases</h3>
<div class="paragraph">
<p>In our first dive we focused on what Tiger should stand for and how we could improve the situation of test teams.</p>
</div>
<div class="ulist">
<div class="title">Core business use cases</div>
<ul>
<li>
<p>Fast and easy set up of test environments</p>
</li>
<li>
<p>Uncomplicated automated execution of IOP tests</p>
</li>
<li>
<p>Explicit analysis of test failures</p>
</li>
<li>
<p>Reuse of cases/steps from existing test suites</p>
</li>
<li>
<p>(non Java test automation support is not implemented yet)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger_use_cases.svg" alt="tiger use cases">
</div>
<div class="title">Figure 2. Tiger use cases</div>
</div>
</div>
<div class="sect2">
<h3 id="_components">1.2. Components</h3>
<div class="paragraph">
<p>Tiger has a clear separation in three components, each of them having a clear purpose, described in the next subsections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tiger Proxy</p>
</li>
<li>
<p>Tiger Testenvironment Manager</p>
</li>
<li>
<p>Tiger Test library</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_tiger_proxy">1.2.1. Tiger Proxy</h4>
<div class="paragraph">
<p>The Tiger Proxy at its core is an extended Mock server, that has the following additional core feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rerouting</strong> - allows rerouting requests based on a configured lookup table</p>
</li>
<li>
<p><strong>Modifications</strong> - allows modifying the content of requests / responses on the fly</p>
</li>
<li>
<p><strong>Mesh set up</strong> - allows forwarding traffic data from one proxy to another for aggregated validations</p>
</li>
<li>
<p><strong>TLS man in the middle</strong> - allows tracing TLS encrypted traffic</p>
</li>
<li>
<p><strong>RBel logging</strong> - breaks up and parses each request / response received. This includes decryption of VAU and encrypted JWT.<br>
Structured data like JSON, XML, JWT is displayed in a sophisticated HTML report.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tiger_test_environment_manager">1.2.2. Tiger test environment manager</h4>
<div class="paragraph">
<p>The Tiger test environment manager provides methods to configure and instantiate multiple server nodes in your test environment and offers the following core feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Instantiating test nodes</strong> - docker containers, docker compositions, external Jars** and<br>
accessing server instances via external URL configurations</p>
</li>
<li>
<p><strong>Instantiating preconfigured server nodes</strong> - for common test scenarios like ePA, ERp, IDP, Demis</p>
</li>
<li>
<p><strong>Automatic shutdown</strong> - on tear down of test run, all the instantiated test nodes are ended</p>
</li>
<li>
<p><strong>Highly configurable</strong> - Multitude of parameters and configuration properties</p>
</li>
<li>
<p><strong>Flexible environment management</strong> - exporting and importing environment variables and system properties to other test nodes</p>
</li>
<li>
<p><strong>Customizing configuration properties</strong> - via command line system properties or environment variables</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tiger_test_library">1.2.3. Tiger test library</h4>
<div class="paragraph">
<p>The Tiger test library provides the following core features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Validation</strong> - BDD steps to filter requests and validate responses</p>
</li>
<li>
<p><strong>Workflow UI</strong> - BDD steps to support tester guidance in test workflows</p>
</li>
<li>
<p><strong>Content assertion</strong> - BDD steps to assert JSON / XML data structures</p>
</li>
<li>
<p><strong>Product Integration</strong> - Synchronisation with Polarion, Serenity BDD and screenplay pattern</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_working_together">1.2.4. Working together</h4>
<div class="paragraph">
<p>The Testenvironment Manager instantiates all test nodes configured in the <code>tiger.yaml</code> config file.<br>
It also instantiates one local Tiger Proxy for the current test suite.<br>
This Tiger Proxy instance (and others created in the test environment if using a mesh setup) traces all requests and responses<br>
forwarded via this proxy and provides them to the test suite for further validation.</p>
</div>
<div class="paragraph">
<p>For each server node instantiated, the local Tiger Proxy adds a route so that the instantiated server node<br>
can be reached by the test suite via HTTP and the configured server hostname.</p>
</div>
<div class="paragraph">
<p>Each Tiger Proxy can be configured in a multitude of ways: as reverse or forward proxy with special routing features and<br>
modifications of content easily configurable, or in a mesh setup as proxy forwarding traffic to other Tiger Proxies&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The BDD or JUnit test suite can integrate the Tiger test library to validate messages (requests and responses) sent/received<br>
over Tiger Proxies using features such as RBelPath, VAU decryption, JSON checker and XML checker.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger_components.svg" alt="tiger components">
</div>
<div class="title">Figure 3. Tiger components</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image thumb"><img src="media/tiger2-plain.svg" alt="120" width="120" title="Tiger logo"></span> ROOOARRR! Ready to rumble!</p>
</div>
<div class="paragraph">
<p>Tiger is based on Java, Maven and Serenity BDD - so saddle the horses, check the operating system requirements and hit the road.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We do not at the moment have any plans to support gradle or other build environments.<br>
But if you are using it in your projects feel free to contact us, and we might find a way to support your specific build environment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t have time right now to look through the whole documentation, you can directly jump to our <a href="#_example_project">Example project</a> section.</p>
</div>
<div class="sect2">
<h3 id="_requirements">2.1. Requirements</h3>
<div class="ulist">
<div class="title">Operating system requirements</div>
<ul>
<li>
<p>Open JDK &gt;= 11</p>
</li>
<li>
<p>Maven &gt;= 3.6</p>
</li>
<li>
<p>IntelliJ &gt;= 2021.2.3</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
On Windows please refrain from using Powershell or DOS command line windows but stick with GitBash
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_maven_in_a_nutshell">2.2. Maven in a nutshell</h3>
<div class="paragraph">
<p>In order to use Tiger with your BDD/Cucumber/Serenity based test suite you need to add a few dependencies to integrate with Tiger</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Current version of Tiger test library</p>
</li>
<li>
<p>Current version of Tiger test library as test-jar artefact</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The second dependency is needed so that the IntelliJ Cucumber plugin detects the Steps/Glue code provided by the Tiger test library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And to trigger the test suite&#8217;s execution, you will need to add these plugins</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tiger maven plugin</p>
</li>
<li>
<p>Maven FailSafe plugin</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 1. Simple Tiger Maven pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="comment">&lt;!--
  ~ ${GEMATIK_COPYRIGHT_STATEMENT}
  --&gt;</span>

<span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

    <span class="tag">&lt;groupId&gt;</span>de.gematik.test.tiger.examples<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>TigerTestBDD<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>

    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;maven.compiler.source&gt;</span>11<span class="tag">&lt;/maven.compiler.source&gt;</span>
        <span class="tag">&lt;maven.compiler.target&gt;</span>11<span class="tag">&lt;/maven.compiler.target&gt;</span>

        <span class="comment">&lt;!-- please adapt Tiger version property to the most current one obtained from --&gt;</span>
        <span class="comment">&lt;!-- maven central:
          https://mvnrepository.com/artifact/de.gematik.test/tiger-test-lib
          or from gematik internal Nexus
          https://build.top.local/nexus/#nexus-search;quick~tiger-test-lib
        --&gt;</span>
        <span class="tag">&lt;version.tiger&gt;</span>0.20.0<span class="tag">&lt;/version.tiger&gt;</span>
        <span class="tag">&lt;version.serenity.core&gt;</span>3.2.2<span class="tag">&lt;/version.serenity.core&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>

    <span class="comment">&lt;!-- tag::dependencies[] --&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>de.gematik.test<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>tiger-test-lib<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version.tiger}<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;type&gt;</span>test-jar<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>de.gematik.test<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>tiger-test-lib<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version.tiger}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="comment">&lt;!-- Optional if you have JUnit5 dependencies
        but use JUnit4 for your driver classes
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
            &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
            &lt;version&gt;5.8.2&lt;/version&gt;
        &lt;/dependency&gt;
        --&gt;</span>
        <span class="comment">&lt;!-- needed for the JUnit driver class @CucumberOptions annotation --&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>serenity-cucumber<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version.serenity.core}<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
    <span class="comment">&lt;!-- end::dependencies[] --&gt;</span>

    <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;plugins&gt;</span>
            <span class="comment">&lt;!-- tag::generator-plugin[] --&gt;</span>
            <span class="comment">&lt;!-- optional plugin to dynamically create JUnit driver classes on the fly.
            You may omit this plugin if you have written your driver classes manually.
            --&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>de.gematik.test<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>tiger-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>${version.tiger}<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;configuration&gt;</span>
                            <span class="comment">&lt;!-- mandatory --&gt;</span>
                            <span class="tag">&lt;glues&gt;</span>
                                <span class="tag">&lt;glue&gt;</span>de.gematik.test.tiger.glue<span class="tag">&lt;/glue&gt;</span>
                                <span class="comment">&lt;!-- add your packages here --&gt;</span>
                            <span class="tag">&lt;/glues&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;featuresDir&gt;</span>${project.basedir}/src/test/resources/features<span class="tag">&lt;/featuresDir&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;includes&gt;</span>
                                <span class="tag">&lt;include&gt;</span>**/*.feature<span class="tag">&lt;/include&gt;</span>
                            <span class="tag">&lt;/includes&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;driverPackage&gt;</span>
                                de.gematik.test.tiger.examples.bdd.drivers
                            <span class="tag">&lt;/driverPackage&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="comment">&lt;!--suppress UnresolvedMavenProperty --&gt;</span>
                            <span class="tag">&lt;driverClassName&gt;</span>Driver${ctr}IT<span class="tag">&lt;/driverClassName&gt;</span>
                            <span class="comment">&lt;!-- optional, defaults to the templated located at
                            /src/main/resources/driverClassTemplate.jtmpl
                            in the tiger-maven-plugin module.
                            Use separate template file if you have spring boot apps to test
                            or need to do some more fancy set up stuff.
                            &lt;templateFile&gt;${project.basedir}/..../XXXX.jtmpl&lt;/templateFile&gt;
                            --&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;skip&gt;</span>false<span class="tag">&lt;/skip&gt;</span>
                        <span class="tag">&lt;/configuration&gt;</span>
                        <span class="tag">&lt;phase&gt;</span>generate-test-sources<span class="tag">&lt;/phase&gt;</span>
                        <span class="tag">&lt;id&gt;</span>generate-tiger-drivers<span class="tag">&lt;/id&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>generate-drivers<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;id&gt;</span>generate-tiger-report<span class="tag">&lt;/id&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>
                                generate-serenity-reports
                            <span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
            <span class="comment">&lt;!-- end::generator-plugin[] --&gt;</span>

            <span class="comment">&lt;!-- tag::failsafe-plugin[] --&gt;</span>
            <span class="comment">&lt;!-- Runs the tests by calling the JUnit driver classes --&gt;</span>
            <span class="comment">&lt;!-- To filter features / scenarios use the system property
                 -Dcucumber.filter.tags --&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>3.0.0-M5<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>integration-test<span class="tag">&lt;/goal&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>verify<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
                <span class="tag">&lt;configuration&gt;</span>
                    <span class="tag">&lt;includes&gt;</span>
                        <span class="comment">&lt;!-- adapt to the class names of your driver classes --&gt;</span>
                        <span class="tag">&lt;include&gt;</span>**/Driver*IT.java<span class="tag">&lt;/include&gt;</span>
                    <span class="tag">&lt;/includes&gt;</span>
                <span class="tag">&lt;/configuration&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
            <span class="comment">&lt;!-- end::failsafe-plugin[] --&gt;</span>
        <span class="tag">&lt;/plugins&gt;</span>
    <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a successful startup you also need a minimum Tiger test environment configuration yaml file in your project root:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Minimum Test environment configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># minimum viable test environment specification</span>
<span class="comment"># default local Tiger Proxy</span>
<span class="key">tigerProxy</span>:
<span class="comment"># no server nodes</span>
<span class="key">servers</span>: <span class="string"><span class="content">{}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and finally a minimal feature file under src/test/resources/features:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Minimum Cucumber feature file</div>
<div class="content">
<pre class="CodeRay highlight"><code>Feature: Test Tiger BDD

  Scenario: Dummy Test
    Given TGR set global variable &quot;key01&quot; to &quot;value01&quot;
    When TGR assert variable &quot;key01&quot; matches &quot;v.*\d\d&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these three files in place you can run the simple dummy test scenario defined in the feature file by issuing</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn verify</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven_plugin_details">2.3. Maven plugin details</h3>
<div class="paragraph">
<p>This section is for the ones that love to know all the details. If you are happy that everything works and<br>
don&#8217;t bother to understand all the bits / properties and settings just skip this section and head over to the <a href="#_example_project">Example project</a> section.</p>
</div>
<div class="sect3">
<h4 id="_tiger_maven_plugin">2.3.1. Tiger maven plugin</h4>
<div class="paragraph">
<p>This plugin allows to dynamically generate the JUnit driver classes that are then used in the Surefire plugin to start the test runs. And replaces the serenity maven plugin to generate Serenity BDD test reports.</p>
</div>
<div class="sect4">
<h5 id="_generate_drivers_goal">Generate Drivers goal</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may decide to manually write your own JUnit driver classes in which case you can omit this plugin.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To activate this feature in your maven project add the following plugin block to your &lt;build&gt;&lt;plugins&gt; section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            <span class="comment">&lt;!-- optional plugin to dynamically create JUnit driver classes on the fly.
            You may omit this plugin if you have written your driver classes manually.
            --&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>de.gematik.test<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>tiger-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>${version.tiger}<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;configuration&gt;</span>
                            <span class="comment">&lt;!-- mandatory --&gt;</span>
                            <span class="tag">&lt;glues&gt;</span>
                                <span class="tag">&lt;glue&gt;</span>de.gematik.test.tiger.glue<span class="tag">&lt;/glue&gt;</span>
                                <span class="comment">&lt;!-- add your packages here --&gt;</span>
                            <span class="tag">&lt;/glues&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;featuresDir&gt;</span>${project.basedir}/src/test/resources/features<span class="tag">&lt;/featuresDir&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;includes&gt;</span>
                                <span class="tag">&lt;include&gt;</span>**/*.feature<span class="tag">&lt;/include&gt;</span>
                            <span class="tag">&lt;/includes&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;driverPackage&gt;</span>
                                de.gematik.test.tiger.examples.bdd.drivers
                            <span class="tag">&lt;/driverPackage&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="comment">&lt;!--suppress UnresolvedMavenProperty --&gt;</span>
                            <span class="tag">&lt;driverClassName&gt;</span>Driver${ctr}IT<span class="tag">&lt;/driverClassName&gt;</span>
                            <span class="comment">&lt;!-- optional, defaults to the templated located at
                            /src/main/resources/driverClassTemplate.jtmpl
                            in the tiger-maven-plugin module.
                            Use separate template file if you have spring boot apps to test
                            or need to do some more fancy set up stuff.
                            &lt;templateFile&gt;${project.basedir}/..../XXXX.jtmpl&lt;/templateFile&gt;
                            --&gt;</span>
                            <span class="comment">&lt;!-- optional --&gt;</span>
                            <span class="tag">&lt;skip&gt;</span>false<span class="tag">&lt;/skip&gt;</span>
                        <span class="tag">&lt;/configuration&gt;</span>
                        <span class="tag">&lt;phase&gt;</span>generate-test-sources<span class="tag">&lt;/phase&gt;</span>
                        <span class="tag">&lt;id&gt;</span>generate-tiger-drivers<span class="tag">&lt;/id&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>generate-drivers<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;id&gt;</span>generate-tiger-report<span class="tag">&lt;/id&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>
                                generate-serenity-reports
                            <span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Mandatory configuration properties</div>
<ul>
<li>
<p><strong>List[glue] glues</strong> (mandatory)<br>
list of packages to be included as glue or hooks code</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Optional configuration properties or properties with default values</div>
<ul>
<li>
<p>List[include] includes (mandatory)<br>
list of include patterns for feature files in Ant format (directory/**.feature)</p>
</li>
<li>
<p>String featuresDir (default: local working directory)<br>
root folder from where to apply includes and excludes</p>
</li>
<li>
<p>List[exclude] excludes (default: empty)<br>
list of exclusion patterns for feature files in Ant format (directory/**.feature)</p>
</li>
<li>
<p>boolean skip (default: false)<br>
flag whether to skip the execution of this plugin</p>
</li>
<li>
<p>String driverPackage (default: de.gematik.test.tiger.serenity.drivers)<br>
package of the to be generated driver class</p>
</li>
<li>
<p>String driverClassName (default: Driver${ctr})<br>
Name of the to be generated driver class.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The ctr token ${ctr} is mandatory! For more details see section below
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>String templateFile (default: null which means that the plugin will use the built-in template file)<br>
Optional path to a custom template file to be used for generating the driver Java source code file.</p>
<div class="ulist">
<ul>
<li>
<p>The plugin currently supports the following list of tokens:</p>
<div class="ulist">
<ul>
<li>
<p>${ctr}<br>
counter value that is unique and incremented for each feature file.</p>
</li>
<li>
<p>${package}<br>
will be replaced with package declaration code line of the driver class.<br>
Either empty or of the pattern "package xxx.yyy.zzz;" where xxx.yyy.zzz is replaced with the configured driverPackage configuration property.</p>
</li>
<li>
<p>${driverClassName}<br>
name of the driver class (with the ctr token already being replaced with the incrementing counter value).</p>
</li>
<li>
<p>${feature}<br>
path to the feature file(s).</p>
</li>
<li>
<p>${glues}<br>
comma separated list of glue/hook packages as specified by the glues configuration property.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_manually_creating_driver_classes">Manually creating driver classes</h6>
<div class="paragraph">
<p>For each feature (or use wildcards / directories for single driver class) you can implement a driver class based on the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">de.gematik.test.tiger.integration.YOURPROJECT</span>;

<span class="keyword">import</span> <span class="include">io.cucumber.junit.CucumberOptions</span>;
<span class="keyword">import</span> <span class="include">de.gematik.test.tiger.TigerCucumberRunner</span>;
<span class="keyword">import</span> <span class="include">org.junit.runner.RunWith</span>;

<span class="annotation">@RunWith</span>(TigerCucumberRunner.class)
<span class="annotation">@CucumberOptions</span>(
    features = {<span class="string"><span class="delimiter">&quot;</span><span class="content">src/test/resources/features/YOURFEATURE.feature</span><span class="delimiter">&quot;</span></span>},
    plugin = {<span class="string"><span class="delimiter">&quot;</span><span class="content">json:target/cucumber-parallel/1.json</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">de.gematik.test.tiger.TigerCucumberListener</span><span class="delimiter">&quot;</span></span>},
    monochrome = <span class="predefined-constant">false</span>,
    glue = {<span class="string"><span class="delimiter">&quot;</span><span class="content">de.gematik.test.tiger.glue</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ANY ADDITIONAL PACKAGES containing GLUE or HOOKS code</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Driver1IT</span> {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_generate_reports_goal">Generate Reports goal</h5>
<div class="paragraph">
<p>The second execution block in the example XML section above will trigger the report creation. There are no properties for configuration at the moment.<br>
Two reports will be generated under target/site/serenity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A simple HTML single page report for emailing (serenity-summary.html)</p>
</li>
<li>
<p>A fancy detailed overall report (index.html)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_failsave_plugin">2.3.2. FailSave plugin</h4>
<div class="paragraph">
<p>The failsafe plugin will trigger the test run.<br>
It is important to activate the <strong>testFailureIgnore</strong> property, to ensure that even if the test fails, the serenity report is created.</p>
</div>
<div class="paragraph">
<p>To filter the scenarios/features to be run you may pass in the Java system property cucumber.filter.tags. You can do so either within the &lt;systemPropertyVariables&gt; tag or via the command line using -Dcucumber.filter.tags</p>
</div>
<div class="paragraph">
<p>For more details about how to use filter tags see <a href="https://cucumber.io/docs/cucumber/api/#tags" class="bare">https://cucumber.io/docs/cucumber/api/#tags</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            <span class="comment">&lt;!-- Runs the tests by calling the JUnit driver classes --&gt;</span>
            <span class="comment">&lt;!-- To filter features / scenarios use the system property
                 -Dcucumber.filter.tags --&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>3.0.0-M5<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>integration-test<span class="tag">&lt;/goal&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>verify<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
                <span class="tag">&lt;configuration&gt;</span>
                    <span class="tag">&lt;includes&gt;</span>
                        <span class="comment">&lt;!-- adapt to the class names of your driver classes --&gt;</span>
                        <span class="tag">&lt;include&gt;</span>**/Driver*IT.java<span class="tag">&lt;/include&gt;</span>
                    <span class="tag">&lt;/includes&gt;</span>
                <span class="tag">&lt;/configuration&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
We do not recommend the parallel test execution with Tiger at the moment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Reason is that when using Tiger Proxies with the Tiger test library validation feature parallel execution may lead to messages<br>
from different threads / forked processes ending up in the wrong listening queue<br>
making it very complicated to make sure your validations are working as expected in different timing situations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_project">2.4. Example project</h3>
<div class="paragraph">
<p>In the /doc/examples/tigerOnly` folder of this project you will find an example for a minimum configured maven project that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>embedds Tiger</p>
</li>
<li>
<p>allows to use its Cucumber steps and</p>
</li>
<li>
<p>allows to easily configure your test environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All you need is to set up three files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a Maven <code>pom.xml</code> file to declare the dependencies and the plugins needed</p>
</li>
<li>
<p>a <code>tiger.yaml</code> to declare your test environment (servers needed, proxy routes,&#8230;&#8203;). This is currently "empty".</p>
</li>
<li>
<p>a <code>test.feature</code> file containing a test scenario and dummy test steps to be performed.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tigerOnly-file-structure.svg" alt="tigerOnly file structure" width="1047" height="548">
</div>
<div class="title">Figure 4. File structure of TigerOnly example project</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_contact_the_tiger_team">2.5. How to contact the Tiger team</h3>
<div class="paragraph">
<p>You can reach us via</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitHub <a href="https://github.com/gematik/app-Tiger" class="bare">https://github.com/gematik/app-Tiger</a></p>
</li>
<li>
<p>or email <a href="mailto:TIGER@gematik.de">TIGER@gematik.de</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_intellij">2.6. IntelliJ</h3>
<div class="paragraph">
<p>We recommend to use latest version of IntelliJ at least version 2021.1.</p>
</div>
<div class="sect3">
<h4 id="_rundebug_settings">2.6.1. Run/Debug settings</h4>
<div class="paragraph">
<p>To be able to successfully start scenarios/features you first need to configure the Run/Debug settings of your project:</p>
</div>
<div class="ulist">
<div class="title">Run/Debug settings for Java Cucumber template</div>
<ul>
<li>
<p>Main class: de.gematik.test.tiger.TigerCucumberRunner</p>
</li>
<li>
<p>Glue:</p>
<div class="ulist">
<ul>
<li>
<p>de.gematik.test.tiger.glue</p>
</li>
<li>
<p>net.serenitybdd.cucumber.actors<br>
if you are using the screenplay pattern (PREFERRED!)</p>
</li>
<li>
<p>additional packages specific to your test suite</p>
</li>
</ul>
</div>
</li>
<li>
<p>VM Options:</p>
<div class="ulist">
<ul>
<li>
<p>Java proxy system properties (see <a href="#_proxy_configuration">Proxy configuration</a> below)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Program arguments:</p>
<div class="ulist">
<ul>
<li>
<p>--plugin de.gematik.test.tiger.TigerCucumberListener</p>
</li>
</ul>
</div>
</li>
<li>
<p>Environment variables:</p>
<div class="ulist">
<ul>
<li>
<p>Proxy environment variables (see <a href="#_proxy_configuration">Proxy configuration</a> below)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Best is to add these settings to the <strong>Configuration Templates</strong> for Cucumber Java.<br>
Depending on the version of IntelliJ these settings are located either on the top icon bar or at the bottom left as link.</p>
</div>
<div class="paragraph">
<p>Else you would have to apply these settings to any new Debug/Run Configuration, like when you start a new scenario, which was never executed before.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-intellij-run-settings.png" alt="tiger intellij run settings">
</div>
<div class="title">Figure 5. Run/Debug settings for IntelliJ</div>
</div>
</div>
<div class="sect3">
<h4 id="_proxy_configuration">2.6.2. Proxy configuration</h4>
<div class="paragraph">
<p>If you are located behind a proxy please make sure to set the environment variables HTTPS_PROXY and HTTP_PROXY as well as<br>
the Java system properties http.proxyHost, http.proxyPort, https.proxyHost and https.proxyPort appropriately so that the internet connections are routed properly through your <strong>company proxy</strong>.</p>
</div>
<div class="paragraph">
<p>Please also make sure IntelliJ has its proxy settings configured appropriately for HTTP and HTTPS so that it can download the dependencies for the IntelliJ build environment too.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Suggestion"></i>
</td>
<td class="content">
BOTH settings (environment variables and system properties) are required as Maven and Java code and HTTP client libraries use both settings.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tiger_test_environment_manager_2">3. Tiger test environment manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As outlined in <a href="#_overview">the overview section</a> the test environment manager is one of the three core components of the Tiger test framework.<br>
Its main task is to start various test server nodes configured in the tiger.yaml configuration file and initialize the local Tiger Proxy for the test suite.<br>
To choose a different test environmental configuration file you may set the environment variable TIGER_TESTENV_CFGFILE.</p>
</div>
<div class="paragraph">
<p>The test environment manager first checks if the env variable is set and tries to load the configuration file from this value. If this file does not exist the test environment manager tries to load the configuration from tiger.yaml.<br>
If none of these files exist it will fail the start up.</p>
</div>
<div class="paragraph">
<p>If the environment variable is not set, then the test environment manager first checks for a file named tiger-${COMPUTERNAME}.yaml, and if this also does not exist, it searches for a file named tiger.yaml.<br>
If none of these files exist it will fail the startup.</p>
</div>
<div class="paragraph">
<p>In the startup phase it also informs the local Tiger Proxy about the hostnames each node has configured, so that the local Tiger Proxy can create appropriate routing entries in its own configuration.</p>
</div>
<div class="paragraph">
<p>To configure your test environment you can either compose the tiger.yaml file manually or much preferred<br>
use the <a href="#_admin_ui">Tiger Admin UI</a>.</p>
</div>
<div class="paragraph">
<p>The nodes configured in the yaml file will be started asynchronously unless the dependsUpon property is set.</p>
</div>
<div class="sect2">
<h3 id="_supported_server_nodes_and_their_configuration">3.1. Supported server nodes and their configuration</h3>
<div class="paragraph">
<p>The Tiger testenviroment manager currently supports the following list of server ndoes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Docker container</strong> is a node based on instantiating a specific docker image that is either locally available or downloaded from a remote docker repo configured in the source property.</p>
</li>
<li>
<p><strong>Docker compose</strong> is a node that you can use to start a group of services defined in one to several compose yaml files configured in the source list.</p>
</li>
<li>
<p><strong>External jar</strong> is a node that is started by running <code>java -jar XXXX.jar</code> after downloading a Jar archive from the configured source URL.</p>
</li>
<li>
<p><strong>External URL</strong> is a symbolic node that is actually maintained outside of the realm of the test environment manager. The main purpose is to allow the test suite to access this external server via a constant URL, regardless of what the actual access URL of the server is. So if you change the location of the external server has no adaptations effect on the test suite.</p>
</li>
<li>
<p><strong>Tiger Proxy</strong> is a specialized external Jar node that allows you to instantiate standalone Tiger Proxy nodes in your test environment in several locations to track, log and validate traffic between any two nodes. For this to work, you must either be able to force a proxy on the nodes or <a href="#_excurse_what_are_proxies_reverse_forward">use a reverse proxy set up scenario</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_yaml_configuration_files_in_a_nutshell">3.1.1. YAML configuration files in a nutshell</h4>
<div class="paragraph">
<p>Before you start writing your own tiger.yaml configuration files, make sure you have worked with yaml files before and know its syntax and structure. If unsure take a <a href="https://dev.to/techworld_with_nana/yaml-tutorial-for-beginners-a06">20 minutes primer</a>, although not everything in the video is relevant, it gives a good introduction to indenting properties and structures and specifying values in a yaml file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_general_properties">3.1.2. General properties</h4>
<div class="paragraph">
<p>The general properties apply to each node type.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. General properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">serverKey_xxx</span>:
  <span class="comment"># OPTIONAL host name of this node when accessing it via the test suite</span>
  <span class="comment"># (rerouted via the local test suite Tiger Proxy).</span>
  <span class="comment"># Defaults to the server key (serverKey_xxx)</span>
  <span class="key">hostname</span>: <span class="string"><span class="content">string</span></span>
  <span class="comment"># MANDATORY one of [tigerProxy|docker|compose|externalJar|externalUrl]</span>
  <span class="key">type</span>: <span class="string"><span class="content">string</span></span>
  <span class="comment"># OPTIONAL name of a template to apply.</span>
  <span class="comment"># Default value is empty</span>
  <span class="key">template</span>: <span class="string"><span class="content">string</span></span>
  <span class="comment"># OPTIONAL comma separated list of keys of server nodes that must be started</span>
  <span class="comment"># before this node is set up.</span>
  <span class="comment"># Default value is empty</span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">csv string</span></span>
  <span class="comment"># OPTIONAL duration in seconds to wait for a successful start up of the server node</span>
  <span class="comment"># Default value is 20</span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">int</span></span>
  <span class="comment"># MANDATORY type specific property in that for some types it's a list,</span>
  <span class="comment"># for some others it's a single URL</span>
  <span class="key">source</span>:
    - <span class="string"><span class="content">source entry 1</span></span>
    - <span class="string"><span class="content">source entry 2</span></span>
  <span class="comment"># used by all node types</span>
  <span class="key">healthcheckUrl</span>: <span class="string"><span class="content">string</span></span>
  <span class="comment"># OPTIONAL only declare the server healthy once the specified return code</span>
  <span class="comment"># is given</span>
  <span class="key">healthcheckReturnCode</span>: <span class="string"><span class="content">int</span></span>
  <span class="comment"># type specific property for Tiger Proxy and docker container nodes</span>
  <span class="key">version</span>: <span class="string"><span class="content">string</span></span>
  <span class="comment"># OPTIONAL list of pki certs and keys to initialize</span>
  <span class="comment"># the local Tiger Proxy of the test suite with</span>
  <span class="comment"># Default value is empty array</span>
  <span class="comment"># For more details see &quot;PKI configuration&quot; section below</span>
  <span class="key">pkiKeys</span>: <span class="string"><span class="content">[]</span></span>
  <span class="comment"># OPTIONAL type specific list of environmental variable assignments to be used</span>
  <span class="comment"># when starting the server node.</span>
  <span class="comment"># Each entry has to have the format ENVVARNAME=VALUE</span>
  <span class="comment"># Has NO EFFECT on external Url nodes.</span>
  <span class="comment"># Default value is empty array</span>
  <span class="key">environment</span>:
    - <span class="string"><span class="content">ENVVAR1=VALUE1</span></span>
    - <span class="string"><span class="content">ENVVAR2=VALUE2</span></span>
    - <span class="string"><span class="content">http://tsl --&gt; https://download-ref.tsl.ti-dienste.de</span></span>
  <span class="comment"># OPTIONAL list of routes to be added to the local Tiger Proxy of the test suite.</span>
  <span class="comment"># Default value is empty array</span>
  <span class="key">urlMappings</span>:
    - <span class="string"><span class="content">https://www.orf.at --&gt; https://eitzen.at</span></span>
  <span class="comment"># OPTIONAL list of system properties that will be provided to following nodes.</span>
  <span class="comment"># Each entry has to have the format system.property.name=VALUE</span>
  <span class="comment"># Default value is empty array</span>
  <span class="key">exports</span>:
    - <span class="string"><span class="content">systemProp1=Value1</span></span>
    - <span class="string"><span class="content">systemProp2=Value2</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The general properties are followed by the type specific substructures, which configure specific aspects of each node type.<br>
Their meaning and format are explained in the related section.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Type specific properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="comment"># type specific sub structure for external jar, external url and Tiger Proxy nodes</span>
  <span class="key">externalJarOptions</span>:
    <span class="comment"># used by external jar and Tiger Proxy nodes</span>
    <span class="key">workingDir</span>: <span class="string"><span class="content">string</span></span>
    <span class="comment"># only used by external jar nodes</span>
    <span class="key">options</span>: <span class="string"><span class="content">[]</span></span>
    <span class="comment"># used by external jar and Tiger Proxy nodes</span>
    <span class="key">arguments</span>: <span class="string"><span class="content">[]</span></span>

  <span class="comment"># type specific sub structure for Tiger Proxy nodes</span>
  <span class="key">tigerProxyCfg</span>:
    <span class="comment"># Here a normal Tiger Proxy configuration can be used.</span>
    <span class="comment"># This is explained in more depth down below</span>
    <span class="key">adminPort</span>: <span class="string"><span class="content">int</span></span>
    <span class="key">proxiedServer</span>: <span class="string"><span class="content">string</span></span>
    <span class="key">proxiedServerProtocol</span>: <span class="string"><span class="content">[HTTP|HTTPS]</span></span>
    <span class="key">proxyRoutes</span>:
        <span class="comment"># defines a forward-proxy-route from this server</span>
      - <span class="string"><span class="content">from: http://foobar</span></span>
        <span class="comment"># to this server</span>
        <span class="key">to</span>: <span class="string"><span class="content">https://cryptic.backend/server/with/path</span></span>

  <span class="comment"># type specific sub structure for docker container and compose nodes</span>
  <span class="key">dockerOptions</span>:
    <span class="comment"># all properties below only used by docker container nodes</span>
    <span class="key">proxied</span>: <span class="string"><span class="content">boolean</span></span>
    <span class="key">oneShot</span>: <span class="string"><span class="content">boolean</span></span>
    <span class="key">entryPoint</span>: <span class="string"><span class="content">string</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the Tiger Proxy is explained in detail in the section <a href="#_configuring_the_local_test_suite_tiger_proxy">Configuring the local test suite Tiger Proxy</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_pki_configuration_in_pkikeys">3.1.3. PKI configuration in pkiKeys</h4>
<div class="paragraph">
<p>The pkiKeys property contains a list of certificates and keys to be provided to the local Tiger Proxy of the test suite.<br>
Each entry has to provide a unique id, type and pem property.</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. PKI configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">pkiKeys</span>:
      <span class="comment"># MANDATORY unique key/certificate id</span>
    - <span class="string"><span class="content">id: disc_sig</span></span>
      <span class="comment"># MANDATORY one of [Certificate|Key]</span>
      <span class="key">type</span>: <span class="string"><span class="content">Certificate</span></span>
      <span class="comment"># MANDATORY base64 encoded multiline string representing the certificate / key.</span>
      <span class="key">pem</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">MIICsTCCAligAwIBAgIHA61I5ACUjTAKBggqhkjOPQQDAjCBhDELMAkGA1UEBhMC
  REUxHzAdBgNVBAoMFmdlbWF0aWsgR21iSCBOT1QtVkFMSUQxMjAwBgNVBAsMKUtv
  .....
  xiKK4dW1R7MD334OpOPTFjeEhIVV</span><span class="delimiter">&quot;</span></span>
    - <span class="string"><span class="content">id: disc_enc</span></span>
      <span class="key">type</span>: <span class="string"><span class="content">Key</span></span>
      <span class="key">pem</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ISUADOGBESBXEZOBXWEDHBXOU...</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_pki_identities_in_tiger_proxys_tls_section">3.1.4. Configuring PKI identities in Tiger Proxy&#8217;s tls section</h4>
<div class="paragraph">
<p>PKI identities can be supplied in a number of ways (JKS, BKS, PKCS1, PKCS8). In every place a string can be given. It could be one of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"my/file/name.p12;p12password"</p>
</li>
<li>
<p>"p12password;my/file/name.p12"</p>
</li>
<li>
<p>"cert.pem;key.pkcs8"</p>
</li>
<li>
<p>"rsaCert.pem;rsaKey.pkcs1"</p>
</li>
<li>
<p>"key/store.jks;key"</p>
</li>
<li>
<p>"key/store.jks;key1;key2"</p>
</li>
<li>
<p>"key/store.jks;jks;key"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not supported pathname strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"D:\\myproject\\key\\store.jks;key"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supported pathname string on all platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"myproject/key/store.jks;key"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please notice, that double backslashes ("\\") are not supported as file separators, since they are not accepted on all platforms.<br>
Invalid pathname strings will also produce an exception.</p>
</div>
<div class="paragraph">
<p>Each part can be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>filename</p>
</li>
<li>
<p>password</p>
</li>
<li>
<p>store-type (accepted are P12, PKCS12, JKS, BKS, PKCS1 and PKCS8)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_docker_container_node">3.1.5. Docker Container node</h4>
<div class="paragraph">
<p>The docker container node allows to instantiate a local docker container from the configured image.<br>
The exposed port of the docker container is available as a special token in the substitution process of the exports entries.</p>
</div>
<div class="paragraph">
<p>To customize the docker container you may alter the entry point command line and add the Tiger Proxy certificate to the container&#8217;s operating system list of trusted certificates.<br>
For containers that should exit after a single command you may enable the oneShot property.</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Docker container configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dockerContainer_001</span>:
  <span class="key">hostname</span>: <span class="string"><span class="content">myDockerContainer</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">docker</span></span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">csv string</span></span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">int</span></span>

  <span class="comment"># MANDATORY URL from where to download the docker image.</span>
  <span class="key">source</span>:
    - <span class="string"><span class="content">dockerhubrepo.somewhere.org/repo/project/docker.image</span></span>
  <span class="comment"># OPTIONAL version of the docker image to download.</span>
  <span class="key">version</span>: <span class="string"><span class="content">0.1.2</span></span>

  <span class="key">dockerOptions</span>:
    <span class="comment"># OPTIONAL Flag whether the container shall be modified by</span>
    <span class="comment"># o adding the Tiger Proxy certificate to the container operating system.</span>
    <span class="comment"># o adding docker.host.internal to the container's /etc/hosts file.</span>
    <span class="comment"># Default value is true.</span>
    <span class="key">proxied</span>: <span class="string"><span class="content">true</span></span>
    <span class="comment"># OPTIONAL Flag whether the container is a one shot container or not.</span>
    <span class="comment"># One shot meaning it will execute a command and then stop.</span>
    <span class="comment"># Default value is false.</span>
    <span class="key">oneShot</span>: <span class="string"><span class="content">false</span></span>
    <span class="comment"># OPTIONAL The entry point command line to be used to start up this container</span>
    <span class="comment"># overwriting any configured entry point in the docker image.</span>
    <span class="comment"># Default value is empty meaning to use the configured entry point command line.</span>
    <span class="key">entryPoint</span>: <span class="string"><span class="content">chmod a+x /startup.sh &amp;&amp; /startup.sh</span></span>

  <span class="comment"># The following properties are explained in the General properties section above</span>
  <span class="key">pkiKeys</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">environment</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">urlMappings</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">exports</span>: <span class="string"><span class="content">[]</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_docker_compose_node">3.1.6. Docker Compose node</h4>
<div class="paragraph">
<p>The docker compose node is a very tricky type of node because we use testcontainer library, which is not exactly up to date in terms of docker compose support. So many of the yaml compose files will need to be modified to work with the testcontainer library.</p>
</div>
<div class="paragraph">
<p>For now we support the ePA2 FD module and the DEMIS Meldeportal.</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. Docker compose configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">type</span>: <span class="string"><span class="content">compose</span></span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">csv string</span></span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">int</span></span>

  <span class="comment"># MANDATORY list of yaml files to use to start up the services.</span>
  <span class="comment"># The entries can either be file paths or if starts with</span>
  <span class="comment"># classpath:....  a reference to a yaml file contained in the class path</span>
  <span class="comment"># (it could also be located inside a jar that is in the class path)</span>
  <span class="key">source</span>:
    - <span class="string"><span class="content">classpath:/de/gematik/test/tiger/testenvmgr/epa/titus-epa2.yml</span></span>
    - <span class="string"><span class="content">classpath:/de/gematik/test/tiger/testenvmgr/epa/titus-epa2-local.yml</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 9. Demis docker compose example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">demis_001</span>:
  <span class="key">type</span>: <span class="string"><span class="content">compose</span></span>
  <span class="key">source</span>:
    - <span class="string"><span class="content">classpath:/de/gematik/test/tiger/testenvmgr/demis/demis_localhost.yml</span></span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">180</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_jar_node">3.1.7. External Jar node</h4>
<div class="paragraph">
<p>The External Jar node is along with the Docker container node the most important/used node for test environments. Any Jar archive executable which can be started with the <code>java -jar</code> command can be configured as an external Jar node.</p>
</div>
<div class="paragraph">
<p>The options list are arguments added immediately after the java executable, while the arguments list is appended after the -jar argument.</p>
</div>
<div class="paragraph">
<p>The working directory is the place where the jar file is downloaded to and executed from.<br>
So if your jar archive expects some configuration files make sure to choose the folder appropriately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">java ${options} -jar externalJar.jar ${arguments}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 10. External jar configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">externalJar_001</span>:
  <span class="key">hostname</span>: <span class="string"><span class="content">mySpecialJar</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">externalJar</span></span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">csv string</span></span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">int</span></span>

  <span class="comment"># MANDATORY SINGLE ENTRY URL from where to download the Jar archive.</span>
  <span class="comment"># If the entry starts with &quot;local:&quot; followed by a file path the jar archive</span>
  <span class="comment"># is expected to be available at that location and no download is performed.</span>
  <span class="comment"># Only one entry is expected for this node type. Additional entries are silently ignored.</span>
  <span class="key">source</span>:
    - <span class="string"><span class="content">http://myjars.download.org/myproject/myjar.jar</span></span>
  <span class="comment"># MANDATORY URL to check for the successful startup of this node.</span>
  <span class="comment"># A successful start is indicated by ANY answer on this URL.</span>
  <span class="comment"># Any status is accepted as long as there is an answer.</span>
  <span class="comment"># If set to &quot;NONE&quot; no check is performed and</span>
  <span class="comment"># the test environment manager will wait for the startup timeout.</span>
  <span class="key">healthcheckUrl</span>: <span class="string"><span class="content">http://127.0.0.1:8080</span></span>
  <span class="comment"># OPTIONAL only declare the server healthy once the specified return code</span>
  <span class="comment"># is given</span>
  <span class="key">healthcheckReturnCode</span>: <span class="string"><span class="content">int</span></span>

  <span class="key">externalJarOptions</span>:
    <span class="comment"># OPTIONAL folder from where to start the external jar.</span>
    <span class="comment"># The downloaded jar file will be stored and executed from here</span>
    <span class="comment"># The default value is empty, which means that the operating-system-specific</span>
    <span class="comment"># temporary folder will be used.</span>
    <span class="key">workingDir</span>: <span class="string"><span class="content">/home/user/test/myspecificjar</span></span>
    <span class="comment"># OPTIONAL Options to pass in to the java executable call.</span>
    <span class="key">options</span>: <span class="string"><span class="content">[]</span></span>
    <span class="comment"># OPTIONAL provide additional arguments to the jar archive call.</span>
    <span class="comment"># Default value is empty.</span>
    <span class="key">arguments</span>:
      - <span class="string"><span class="content">--testarg1</span></span>
      - <span class="string"><span class="content">-singledasharg2</span></span>
      - <span class="string"><span class="content">--paramarg3=testvalue1</span></span>

  <span class="comment"># The following properties are explained in the General properties section above</span>
  <span class="key">pkiKeys</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">environment</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">urlMappings</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">exports</span>: <span class="string"><span class="content">[]</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the JVM used to start the JAR-File is the taken from the <code>java.home</code> system property, thus using the same JVM with which Tiger was started. To change the JVM used you can set the property <code>tiger.lib.javaHome</code> (e.g. by setting <code>-Dtiger.lib.javaHome</code>, by setting <code>TIGER_LIB_JAVAHOME</code> in the environment or by setting <code>lib.javaHome</code> in the <code>tiger.yaml</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_url_node">3.1.8. External URL node</h4>
<div class="paragraph">
<p>The symbolic node type that will not start a server instance, but simply allows external services to be used via the configured hostname. This is achieved by the test environment manager instructing the local Tiger Proxy to provide a route for the symbolic hostname to the external URL of the service.</p>
</div>
<div class="paragraph">
<p>So, in the following example, the test suite can send HTTP(S) requests to the server "http://myExternalServer" via the local Tiger Proxy, which will be rerouted to the external URL "https://www.medizin.de".<br>
If it is ever necessary to change the external URL, the test suite does not have to be modified, only the routing configuration for the node has to be changed.</p>
</div>
<div class="paragraph">
<p>Given the nature of this type, the environment section has no effect and is not to be used.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. External URL configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">externalUrl_001</span>:
  <span class="key">hostname</span>: <span class="string"><span class="content">myExternalServer</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">externalUrl</span></span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">csv string</span></span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">int</span></span>

  <span class="comment"># MANDATORY URL of the external server</span>
  <span class="key">source</span>:
    - <span class="string"><span class="content">https://www.medizin.de</span></span>

  <span class="comment"># OPTIONAL URL to check for successful startup of this node.</span>
  <span class="comment"># A successful start is indicated by ANY answer on this URL.</span>
  <span class="comment"># Any status is accepted as long as there is an answer.</span>
  <span class="comment"># If the value is not set, then no health check is carried out</span>
  <span class="comment"># in the startup phase, instead the startupTimeout is waited for.</span>
  <span class="comment"># After this timeout it is assumed that the server is up.</span>
  <span class="key">healthcheckUrl</span>: <span class="string"><span class="content">https://www.medizin.de/healthyState.jsp</span></span>
  <span class="comment"># OPTIONAL only declare the server healthy once the specified return code</span>
  <span class="comment"># is given</span>
  <span class="key">healthcheckReturnCode</span>: <span class="string"><span class="content">int</span></span>

  <span class="comment"># The following properties are explained in the General properties section above</span>
  <span class="key">pkiKeys</span>: <span class="string"><span class="content">[]</span></span>
  <span class="comment"># IGNORE for this type as it has no effect</span>
  <span class="key">environment</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">urlMappings</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">exports</span>: <span class="string"><span class="content">[]</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tiger_proxy_node">3.1.9. Tiger Proxy node</h4>
<div class="paragraph">
<p>The most complex and versatile node type. The Tiger Proxy will be started as an embedded spring boot application. This way the startup time can be minimized, and it is always guaranteed to start the current version.</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Tiger Proxy configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy_001</span>:
  <span class="key">hostname</span>: <span class="string"><span class="content">myTigerProxy</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">tigerProxy</span></span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">csv string</span></span>
  <span class="key">startupTimeoutSec</span>: <span class="string"><span class="content">int</span></span>

  <span class="key">tigerProxyCfg</span>:
    <span class="comment"># OPTIONAL port of the web user interface and the proxy management</span>
    <span class="comment"># (e.g. rbel-message forwarding)</span>
    <span class="comment"># Default value is empty, which means a random port will be used.</span>
    <span class="key">adminPort</span>: <span class="string"><span class="content">8080</span></span>
    <span class="comment"># OPTIONAL server key of the node this proxy shall be used as reverse proxy for.</span>
    <span class="comment"># If set the routes will be configured appropriately.</span>
    <span class="comment"># Default value is empty.</span>
    <span class="key">proxiedServer</span>: <span class="string"><span class="content">externalJar_001</span></span>
    <span class="comment"># OPTIONAL port of the proxy, where the proxy expects to receive proxy requests</span>
    <span class="comment"># Default value is empty, which means a random port will be used.</span>
    <span class="key">proxyPort</span>: <span class="string"><span class="content">3128</span></span>
    <span class="comment"># OPTIONAL protocol the proxy is expecting requests in. One of [http|https]</span>
    <span class="comment"># Default value is http</span>
    <span class="key">proxiedServerProtocol</span>: <span class="string"><span class="content">http</span></span>
    <span class="comment"># configures the proxy itself. For more details</span>
    <span class="comment"># please check the chapter about the local test suite Tiger Proxy below</span>
    <span class="error">...</span>
    <span class="key">proxyRoutes</span>:
      - <span class="string"><span class="content">from: http://foobar</span></span>
        <span class="comment"># defines a forward-proxy-route from this server...</span>
        <span class="key">to</span>: <span class="string"><span class="content">https://cryptic.backend/server/with/path</span></span>
        <span class="comment"># to this server</span>
    <span class="error">...</span>

  <span class="comment"># The following properties are explained in the General properties section above</span>
  <span class="key">pkiKeys</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">environment</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">urlMappings</span>: <span class="string"><span class="content">[]</span></span>
  <span class="key">exports</span>: <span class="string"><span class="content">[]</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the Tiger Proxy is explained in detail in the section <a href="#_configuring_the_local_test_suite_tiger_proxy">Configuring the local test suite Tiger Proxy</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provided_node_templates">3.2. Provided node templates</h3>
<div class="paragraph">
<p>Besides these basic nodes we also support tailored templates for nodes like IDP, ePA, ERp and DEMIS.<br>
This should allow you to bring up project specific test environments very fast.</p>
</div>
<div class="paragraph">
<p>All currently supported templates can be found in the tiger-testenv-mgr modul in the yaml file at /src/main/resources/de/gematik/test/tiger/testenvmgr/templates.yaml</p>
</div>
<div class="paragraph">
<p>To use such a template, just use the template attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">myPersonalTestIDPInTheRU</span>:
  <span class="key">template</span>: <span class="string"><span class="content">idp-rise-ru</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or if you want to have an environment with a local reference implementation of the ERezept Fachdienst</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">myLocalTestIDP</span>:
  <span class="key">template</span>: <span class="string"><span class="content">idp-ref</span></span>
  <span class="key">hostname</span>: <span class="string"><span class="content">idp</span></span>

<span class="key">myLocalTestERp</span>:
  <span class="key">template</span>: <span class="string"><span class="content">erzpt-fd-ref</span></span>
  <span class="key">dependsUpon</span>: <span class="string"><span class="content">myLocalTestIDP</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_local_idp_reference_nodes">3.2.1. Local IDP reference nodes</h4>
<div class="paragraph">
<p>This template provides the reference implementation of the IDP server as a local docker container. The docker image is loaded from a gematik internal docker registry server.</p>
</div>
<div class="paragraph">
<p>The system property IDP_SERVER is set to the URL of the Discovery Document end point and is available for all subsequently initiated test environment nodes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_idp_rise_instance_nodes">3.2.2. External IDP RISE instance nodes</h4>
<div class="paragraph">
<p>The idp-rise-ru template provides the RU instance of RISE&#8217;s IDP server as an "external URL".<br>
The system properties IDP_SERVER and GEMATIK_TESTCONFIG are set to the URL of the Discovery Document end point and a config-file for the IDP test suite respectively.<br>
They are available for all subsequently initiated test environment nodes.</p>
</div>
<div class="paragraph">
<p>The idp-rise-tu template provides the TU instance accordingly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_erp_reference_nodes">3.2.3. Local ERp reference nodes</h4>
<div class="paragraph">
<p>This template provides the reference implementation of the eRezept server as a local docker container. The docker image is loaded from a gematik internal docker registry server.<br>
Make sure that an IDP server node is instantiated before the ERp FD is started and that it is available under <a href="http://idp" class="bare">http://idp</a> or adapt the environment variable configuration.</p>
</div>
<div class="paragraph">
<p>A large list of environment variables is set. But dont worry, it is just the server that uses them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_epa2_reference_nodes">3.2.4. Local ePA2 reference nodes</h4>
<div class="paragraph">
<p>This template provides the gematik reference Aktensystem simulation as docker compose.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_pssim_node">3.2.5. Local PSSim node</h4>
<div class="paragraph">
<p>This template provides a Primärsystem simulation (as a jar), usable for ePA.<br>
See <a href="https://wiki.gematik.de/display/PTP/epa-ps" class="bare">https://wiki.gematik.de/display/PTP/epa-ps</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_konsim_node">3.2.6. Local KonSim node</h4>
<div class="paragraph">
<p>This template provides a Konnektor simulation (as external jar).<br>
See <a href="https://wiki.gematik.de/display/PTP/KonSim" class="bare">https://wiki.gematik.de/display/PTP/KonSim</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_epa_fdv_sim">3.2.7. Local ePA FdV Sim</h4>
<div class="paragraph">
<p>This template provides FdV simulation, usable for ePA.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_demis_reference_nodes">3.2.8. Local DEMIS reference nodes</h4>
<div class="paragraph">
<p>This template provides the DEMIS Meldeportal as local docker compose.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_local_test_suite_tiger_proxy">3.3. Configuring the local test suite Tiger Proxy</h3>
<div class="paragraph">
<p>The local Tiger Proxy for the test suite can be configured by using the following section(s) in the tiger.yaml file.<br>
For more information about what the Tiger Proxy is and how it works see the chapter <a href="#_tiger_proxy_basics">Tiger Proxy basics</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># Flag whether to activate the local Tiger Proxy</span>
<span class="comment"># Default value is true</span>
<span class="key">localProxyActive</span>: <span class="string"><span class="content">true</span></span>

<span class="comment"># Specifiy additional yaml-files to read in during startup</span>
<span class="key">additionalYamls</span>:
  -
    <span class="comment"># the path to the file to read</span>
    <span class="key">filename</span>: <span class="string"><span class="content">specialEnvironment.yaml</span></span>
    <span class="comment"># the key to which to map the given file. &quot;tiger&quot; is the base-key for the tiger.yaml-file</span>
    <span class="key">baseKey</span>: <span class="string"><span class="content">tiger</span></span>

<span class="comment"># the block where all the Tiger Proxy configuration properties are located</span>
<span class="key">tigerProxy</span>:
  <span class="comment"># the port under which the server will be booted</span>
  <span class="key">port</span>: <span class="string"><span class="content">7777</span></span>
  <span class="comment"># logLevel of the proxy-server. DBEUG and TRACE will print traffic, so use with care!</span>
  <span class="key">proxyLogLevel</span>: <span class="string"><span class="content">TRACE</span></span>
  <span class="comment"># section to configure whether and where the proxy should dump</span>
  <span class="comment"># a traffic HTML report on shutdown</span>
  <span class="key">fileSaveInfo</span>:
    <span class="comment"># should the cleartext http-traffic be logged to a file?</span>
    <span class="key">writeToFile</span>: <span class="string"><span class="content">true</span></span>
    <span class="comment"># configure the file name</span>
    <span class="key">filename</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar.tgr</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># default false</span>
    <span class="key">clearFileOnBoot</span>: <span class="string"><span class="content">true</span></span>
  <span class="comment"># a list of routing entries the proxy should apply to traffic</span>
  <span class="key">proxyRoutes</span>:
      <span class="comment"># defines a forward-proxy-route from this server...</span>
    - <span class="string"><span class="content">from: http://foobar</span></span>
      <span class="comment"># to this server</span>
      <span class="key">to</span>: <span class="string"><span class="content">https://cryptic.backend/server/with/path</span></span>
      <span class="comment"># reverse proxy-route. http://&lt;tiger-proxy&gt;/blub will be forwarded</span>
    - <span class="string"><span class="content">from: &quot;/blub&quot;</span></span>
      <span class="key">to</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://another.de/server</span><span class="delimiter">&quot;</span></span>
      <span class="comment"># the traffic for this route will NOT be logged (default is true)</span>
      <span class="key">activateRbelLogging</span>: <span class="string"><span class="content">false</span></span>

  <span class="comment"># a list of modifications that will be applied to every proxied request and response</span>
  <span class="key">modifications</span>:
    <span class="comment"># a condition that needs to be fulfilled for the modification to be applied</span>
    <span class="comment"># (uses JEXL grammar)</span>
  - <span class="string"><span class="content">condition: &quot;isRequest&quot;</span></span>
    <span class="comment"># which element should be targeted?</span>
    <span class="key">targetElement</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$.header.user-agent</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># the replacement string to be filled in.</span>
    <span class="comment"># This modification will replace the entire &quot;user-agent&quot; in all requests</span>
    <span class="key">replaceWith</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">modified user-agent</span><span class="delimiter">&quot;</span></span>

  - <span class="string"><span class="content">condition: &quot;isResponse &amp;&amp; $.responseCode == 200&quot;</span></span>
    <span class="key">targetElement</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$.body</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># The name of this modification.</span>
    <span class="comment"># This can be used to identify, alter or remove this modification.</span>
    <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">body replacement modification</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># This will replace the body of every 200 response completely with the given json-string</span>
    <span class="comment"># (This ignores the existing body. For example this could be an XML-body.</span>
    <span class="comment"># Content-Type-headers will NOT be set accordingly).</span>
    <span class="key">replaceWith</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{\&quot;another\&quot;:{\&quot;node\&quot;:{\&quot;path\&quot;:\&quot;correctValue\&quot;}}}</span><span class="delimiter">&quot;</span></span>
  - <span class="string"><span class="content">targetElement: &quot;$.body&quot;</span></span>
    <span class="comment"># The given regex will be used to target only parts of targeted element.</span>
    <span class="key">regexFilter</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ErrorSeverityType:((Error)|(Warning))</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># This modification has no condition,</span>
    <span class="comment"># so it will be applied to every request and every response</span>
    <span class="key">replaceWith</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ErrorSeverityType:Error</span><span class="delimiter">&quot;</span></span>

  <span class="comment"># can be used if the target-server (to) is behind another proxy</span>
  <span class="key">forwardToProxy</span>:
    <span class="key">hostname</span>: <span class="string"><span class="content">192.168.110.10</span></span>
    <span class="key">port</span>: <span class="string"><span class="content">3128</span></span>
    <span class="key">type</span>: <span class="string"><span class="content">HTTP</span></span>
  <span class="comment"># The Tiger Proxy will route google.com to google.com even if no route is set.</span>
  <span class="comment"># The traffic routed via this &quot;forwardAll&quot;-routing will be logged by default</span>
  <span class="comment"># (meaning it will show up in the Rbel-Logs and be forwarded to tracing-clients)</span>
  <span class="comment"># This can be deactivated by setting this flag to false</span>
  <span class="key">activateForwardAllLogging</span>: <span class="string"><span class="content">true</span></span>
  <span class="comment"># Limits the rbel-Buffer to approximately this size.</span>
  <span class="comment"># Note: When Rbel debugging is activated the size WILL vastly exceed this limit!</span>
  <span class="key">rbelBufferSizeInMb</span>: <span class="string"><span class="content">1024</span></span>
  <span class="comment"># If set to false disables traffic-analysis by Rbel.</span>
  <span class="comment"># Deactivating will not impede proxy-forwarding nor</span>
  <span class="comment"># the traffic-endpoints.</span>
  <span class="key">activateRbelParsing</span>: <span class="string"><span class="content">true</span></span>
  <span class="comment"># This will share the WebUI-Resources (various CSS-files) from the Tiger Proxy</span>
  <span class="comment"># locally, thus enabling usage when no internet connection exists</span>
  <span class="key">localResources</span>: <span class="string"><span class="content">true</span></span>

  <span class="key">tls</span>:
    <span class="comment"># Can be used to define a CA-Identity to be used with TLS. The Tiger Proxy will</span>
    <span class="comment"># generate an identity when queried by a client that matches the configured route.</span>
    <span class="comment"># If the client then in turn trusts the CA this solution will provide you with a seamless</span>
    <span class="comment"># TLS experience. It however requires access to the private-key of a trusted CA.</span>
    <span class="key">serverRootCa</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">certificate.pem;privateKey.pem;PKCS8</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># Alternative solution: now all incoming TLS-traffic will be handled using this identity.</span>
    <span class="comment"># This might be easier but requires a certificate</span>
    <span class="comment"># which is valid for the configured routes</span>
    <span class="key">serverIdentity</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">certificateAndKeyAndChain.p12;Password</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># Defines which SSL-Suites are allowed. This will delete all default-suites and only add</span>
    <span class="comment"># the one defined here.</span>
    <span class="key">serverSslSuites</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="delimiter">&quot;</span></span>

    <span class="comment"># This identity will be used as a client-identity for mutual-TLS when forwarding to</span>
    <span class="comment"># other servers. The information string can be</span>
    <span class="comment"># &quot;my/file/name.p12;p12password&quot; or</span>
    <span class="comment"># &quot;p12password;my/file/name.p12&quot; or</span>
    <span class="comment"># &quot;cert.pem;key.pkcs8&quot; or</span>
    <span class="comment"># &quot;rsaCert.pem;rsaKey.pkcs1&quot; or</span>
    <span class="comment"># &quot;key/store.jks;key&quot; or</span>
    <span class="comment"># &quot;key/store.jks;key1;key2&quot; or</span>
    <span class="comment"># &quot;key/store.jks;jks;key&quot;</span>
    <span class="comment">#</span>
    <span class="comment"># Each part can be one of:</span>
    <span class="comment"># * filename</span>
    <span class="comment"># * password</span>
    <span class="comment"># * store-type (accepted are P12, PKCS12, JKS, BKS, PKCS1 and PKCS8)</span>
    <span class="key">forwardMutualTlsIdentity</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">directory/where/another/identityResides.jks;changeit;JKS</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># domain which will be used as the server address in the TLS-certificate</span>
    <span class="key">domainName</span>: <span class="string"><span class="content">deep.url.of.server.de</span></span>
    <span class="comment"># Alternate names to be added to the TLS-certificate</span>
    <span class="comment"># (localhost and 127.0.0.1 are added by default)</span>
    <span class="key">alternativeNames</span>:
      - <span class="string"><span class="content">localhost</span></span>
      - <span class="string"><span class="content">63.54.54.43</span></span>
      - <span class="string"><span class="content">foo.bar.server.com</span></span>

  <span class="comment"># the given folders are loaded into RBel for analysis. This is only necessary to decrypt</span>
  <span class="comment"># traffic when analyzing it. It has no effect on the proxy-functions themselves.</span>
  <span class="key">keyFolders</span>:
  - <span class="string"><span class="content">.</span></span>

  <span class="comment"># A list of upstream Tiger Proxies. This proxy will try to connect to all given sources to</span>
  <span class="comment"># gather traffic via the STOMP-protocol. If any of the given endpoints are not accessible</span>
  <span class="comment"># the server will not boot. (fail fast, fail early)</span>
  <span class="key">trafficEndpoints</span>:
    - <span class="string"><span class="content">http://another.tiger.proxy:&lt;proxyPort&gt;</span></span>
  <span class="key">trafficEndpointConfiguration</span>:
    <span class="comment"># the name for the traffic Endpoint. can be any string, which will be</span>
    <span class="comment"># displayed at /tracingpoints</span>
    <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tigerProxy Tracing Point</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_standalone_mode_vs_implicit_startup_with_test_suite">3.4. Standalone mode vs. implicit startup with test suite</h3>
<div class="paragraph">
<p>If your test environment is very "expensive" to start or if you are developing your test suite scenarios thus starting many test runs in short time, you might want to keep your test environment running and not shut it down after each run.<br>
To do so, you need to create a customized test environment configuration file (call it tiger-standalone.yaml,<br>
set the env var TIGER_TESTENV_CFGFILE accordingly) containing all the server nodes needed and<br>
deactivate the local Tiger Proxy in this configuration file.<br>
Now download the <a href="https://repo1.maven.org/maven2/de/gematik/test/tiger-testenv-mgr/0.17.1/tiger-testenv-mgr-0.17.1-jar-with-all-dependencies.jar">tiger test environment jar-with-all-dependencies file v0.17.1</a> from maven or go to <a href="https://repo1.maven.org/maven2/de/gematik/test/tiger-testenv-mgr/">maven index folder</a> to choose a more recent version.</p>
</div>
<div class="paragraph">
<p>If you start the test environment manager standalone, it will keep the nodes running until you enter quit into the console or kill the process with Ctrl + C or the operating equivalent commando to the UNIX command kill ${PROCESS_ID}. In the latter case it is not guaranteed that all processes are cleanly shut down. Please check your process list with operating system specific tools.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">export TIGER_TESTENV_CFGFILE=....../tiger-standalone.yaml
java -jar tiger-testenv-mgr-${VERSION}-jar-with-all-dependencies.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now before starting your test suite scenarios you need to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>disable / remove the test nodes in your default tiger.yaml (either by setting the property active to false or remove the server node entry completely). If you forget to do this, two nodes will be instantiated (one from the standalone test environment manager and the second during test run from the test environment manager started via the test suite hooks).</p>
</li>
<li>
<p>and add routes for each node to the local Tiger Proxy. If you forget to do this, your test suite will not be able to access the test nodes under their configured hostname as this configuration is only known to the standalone test environment manager and NOT to the local tiger proxy started by the test suite hooks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Best practice is to have three test environment configuration files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tiger-standalone.yaml to enable a persistent test environment during the development of test suite scenarios</p>
</li>
<li>
<p>tiger-nonodes.yaml for the test suite that will instantiate no nodes but only configure the routes to the nodes from the standalone test environment manager</p>
</li>
<li>
<p>tiger.yaml a complete configuration that can be used in CI or after the test suite development is completed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first and the latter most of the time are identical besides the root level flag localProxyActive. So you may skip the first and just use it with two different values being set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_environment_variables_and_system_properties">3.5. Using Environment variables and system properties</h3>
<div class="sect3">
<h4 id="_tokenvariable_substitution">3.5.1. Token/variable substitution</h4>
<div class="paragraph">
<p>Entries in the exports list of a node will be parsed and specific tokens will be substituted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${PORT:xxxx} will be replaced with the port on the docker host interface</p>
</li>
<li>
<p>${NAME} will be replaced with the hostname of the node</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All exports entries of a node will be present when subsequent nodesare instantiated and can be used in the following properties:</p>
</div>
<div class="paragraph">
<p>Docker node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>source list</p>
</li>
<li>
<p>environment list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tiger Proxy node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from/to route URLs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>External URL node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>source list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>External Jar node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>options list</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tiger_proxy_2">4. Tiger Proxy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_excurse_what_are_proxies_reverse_forward">4.1. Excurse: What are proxies, reverse, forward</h3>
<div class="paragraph">
<p>There are a lot of different kind of proxies. Here we talk only about HTTP and HTTPS proxies!</p>
</div>
<div class="sect3">
<h4 id="_forward_proxies">4.1.1. Forward proxies</h4>
<div class="paragraph">
<p>Forward proxies work like a switch-station: You send a packet to your destination, via proxy.<br>
The proxy receives the packet, sees the address and can send that packet to wherever he sees fit.<br>
To use a forward proxy the sender has to be aware of it and send the packet accordingly.</p>
</div>
<div class="paragraph">
<p>This allows the creation of virtual domains, something we use extensively in tiger.</p>
</div>
<div class="paragraph">
<p>A forward proxy can always read the entire content of your communication, something we also use heavily.</p>
</div>
<div class="paragraph">
<p>Lastly a forward proxy acts as a man-in-the-middle, enabling the penetration of TLS-traffic.<br>
We also use this, but we will explain it in more depth later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reverse_proxies">4.1.2. Reverse proxies</h4>
<div class="paragraph">
<p>Reverse proxies also receive traffic and may reroute them at their own discretion.<br>
But unlike a forward proxy a reverse proxy is invisible to the sender. Reverse proxies act like<br>
normal servers and are addressed as such. They then send the received packet to its actual<br>
destination and return the answer to the original caller.</p>
</div>
<div class="paragraph">
<p>The reverse proxy can also read the complete traffic.</p>
</div>
<div class="paragraph">
<p>The eventual destination is opaque to the original caller. This also enables path-rewriting<br>
(for example the GET <a href="http://reverse.proxy.de/my/deep/url" class="bare">http://reverse.proxy.de/my/deep/url</a> might be mapped to <a href="http://gematik.de/deep/url" class="bare">http://gematik.de/deep/url</a>, eliminating the /my)</p>
</div>
<div class="paragraph">
<p>A reverse proxy also terminates https, always. This is less of a problem with a reverse proxy<br>
since it is technically not a man-in-the-middle attack, due to the traffic being addressed<br>
to the reverse proxy.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tiger_proxy_basics">4.2. Tiger Proxy basics</h3>
<div class="paragraph">
<p>The Tiger Proxy is a proxy-server. It has two types: Tiger Proxy and Tiger Standalone Proxy. Both types have a proxy-port (configurable via <code>tigerProxy.port</code>),<br>
which supports both http- and https-traffic (so you do not have to differentiate between the two).</p>
</div>
<div class="paragraph">
<p>The Tiger Standalone Proxy has an admin-port on top (configurable via <code>server.port</code>). This provides a webui to monitor the traffic,<br>
a rest-interface to customize the behavior (add/delete route, add/delete modifications) and a web-socket interface to stream rbel-messages between multiple Tiger Proxies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_routes">4.3. Understanding routes</h3>
<div class="paragraph">
<p>Routes are the fundamental mechanic of how the Tiger Proxy handles traffic. They can be for a forward-<br>
or reverse-proxy. A route has the following properties:</p>
</div>
<div class="sect3">
<h4 id="_from">4.3.1. from</h4>
<div class="paragraph">
<p>From where should the traffic be collected? This can either be an absolute URL (eg. <a href="http://foobar" class="bare">http://foobar</a>), which defines a forward-proxy route, or relative (eg. /blub), defining a reverse-proxy-route. Please note: You can freely add parts (eg. <a href="http://foobar/extra/part" class="bare">http://foobar/extra/part</a>) to further specify the mapping.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to">4.3.2. to</h4>
<div class="paragraph">
<p>The target of the mapping. This has to be an absolute URL. The Tiger Proxy will, upon receiving a request to this mapping, execute a matching request to the defined host.</p>
</div>
<div class="paragraph">
<p>An example. Consider the following route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">proxyRoutes</span>:
      - <span class="string"><span class="content">from: http://my.domain/</span></span>
        <span class="key">to</span>: <span class="string"><span class="content">http://orf.at/</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The "http://" in the <strong>from property</strong> indicates that we have a forward-proxy route defined. So when we execute: (assuming the Tiger Proxy is started locally under the port 1234)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -x http://localhost:1234 http://my.domain/news</pre>
</div>
</div>
<div class="paragraph">
<p>The result will match the following curl</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://orf.at/news</pre>
</div>
</div>
<div class="paragraph">
<p>Additional headers are kept and just patched through. The same goes for the body and the HTTP-Method.</p>
</div>
<div class="paragraph">
<p>Added parts of the from-URL are stripped when forwarding. Meaning: If you have a mapping</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">proxyRoutes</span>:
      - <span class="string"><span class="content">from: http://my.domain/deep/</span></span>
        <span class="key">to</span>: <span class="string"><span class="content">http://orf.at/blub/</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and you execute GET <a href="http://my.domain/deep/deeper" class="bare">http://my.domain/deep/deeper</a>, you will get the result of GET <a href="http://orf.at/blub/deeper" class="bare">http://orf.at/blub/deeper</a> (the /deep in between has been eliminated along with my.domain).</p>
</div>
</div>
<div class="sect3">
<h4 id="_disablerbellogging">4.3.3. disableRbelLogging</h4>
<div class="paragraph">
<p>You can deactivate the rbel-Logging on a per-Route basis. Rbel is a versatile and powerful tool, but the analysis of individual messages consumes a lot of both CPU and memory. Deactivating it for routes in which it is not needed is therefore a good idea.</p>
</div>
</div>
<div class="sect3">
<h4 id="_basicauth">4.3.4. basicAuth</h4>
<div class="paragraph">
<p>You can add optional basic-auth configuration which will be added to the forwarded message. Theoretically this could also be done via modifications, but this a more convenient approach.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">proxyRoutes</span>:
      - <span class="string"><span class="content">from: http://my.domain/deep/</span></span>
        <span class="key">to</span>: <span class="string"><span class="content">http://orf.at/blub/</span></span>
        <span class="key">basicAuth</span>:
          <span class="key">username</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">test1</span><span class="delimiter">&quot;</span></span>
          <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">pwd2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tls_keys_certificates_a_quick_tour_on_proxies">4.4. TLS, keys, certificates a quick tour on proxies</h3>
<div class="paragraph">
<p>A fundamental part of a proxy setup is TLS. Since a proxy is a constant man-in-the-middle attack TLS is designed to make this exact scenario (eavesdropping while forwarding) impossible. Since a lot of the traffic in the gematik context is security-relevant and thus TLS-secured this point is a very relevant one.</p>
</div>
<div class="paragraph">
<p>Fundamentally breaking into TLS requires two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A certificate which the server can present which is valid for the given domain</p>
</li>
<li>
<p>The certifying CA (or a CA reachable via a certification path) has to be part of the client truststore</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There a different ways to reach these two requirements. Which one should be taken is dependent on the setting and the client used (most importantly, of course: can you alter the truststore for the test-setup?)</p>
</div>
<div class="paragraph">
<p>Here are a few things to know and ways in which to enable TLS:</p>
</div>
<div class="sect3">
<h4 id="_tls_and_https_proxy">4.4.1. TLS and HTTPS-Proxy</h4>
<div class="paragraph">
<p>TLS can be done via a http- or a https-proxy. The proxy-protocol does NOT equate to the client-server-protocol. To minimize the headache in configuration it is therefore strongly recommended to simply always use the http-proxy (sidenote: using a http-proxy does NOT reduce the security of the overall protocol. The security still relies on server-certificate-verification.)</p>
</div>
<div class="paragraph">
<p>If, however, you can not avoid using the https-proxy you have to make sure that you add the given certificate to your truststore.<br>
In class TigerProxy.java in Tiger there are methods such as SSLContext getConfiguredTigerProxySslContext(), X509TrustManager buildTrustManagerForTigerProxy() and KeyStore buildTruststore() which can help you configure the SSLContext in your case, if you use HTTP 3rd party libraries (Unirest, okHttp, RestAssured, etc.) as well as vanilla Java.<br>
If you encounter any problems, please contact us.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_server_identity">4.4.2. Dynamic server identity</h4>
<div class="paragraph">
<p>For successfully breaking into TLS traffic the Tiger Proxy needs to present a certificate which features the domain-name of the server. Since the domain-names are known only at runtime, we  generate the needed certificate on-the-fly during the first connection.</p>
</div>
<div class="paragraph">
<p>For a forward-proxy this is easy: The client sends not only the path, but the complete URL to the proxy, letting him handle DNS-resolution.<br>
So when the Tiger Proxy receives a new request the necessary domain-name is given by the client. A new, matching, certificate is generated (these are cached) and presented.<br>
To complete the setup the client-truststore needs to be patched.<br>
The default CA used by the Tiger Proxy can be found here: <a href="https://github.com/gematik/app-Tiger/blob/master/tiger-proxy/src/main/resources/CertificateAuthorityCertificate.pem" class="bare">https://github.com/gematik/app-Tiger/blob/master/tiger-proxy/src/main/resources/CertificateAuthorityCertificate.pem</a></p>
</div>
<div class="paragraph">
<p>For a reverse-proxy the domain name, which should be used, is unknown to the Tiger Proxy (DNS-resolution is done on the client-side). Thus, a  domain-name needs to be provided, which should be used for certificate-generation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">tls</span>:
        <span class="key">domainName</span>: <span class="string"><span class="content">deep.url.of.server.de</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_sided_truststore_modification">4.4.3. Client-sided truststore modification</h4>
<div class="paragraph">
<p>When using a non-default certificate (which will almost always be the case for the Tiger Proxy) the modification of the client-truststore is necessary.<br>
For cases where the client is running in the same JVM as the target Tiger Proxy (which is the typical case for a tiger-based testsuite) there exists helper method to make this task easier.</p>
</div>
<div class="paragraph">
<p>Depending on your HTTP- or REST- or SOAP-API you will need to choose the exact way yourself. The following two examples might give you some idea of what to do.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unirest.config().sslContext(tigerProxy.buildSslContext());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()

    .proxy(<span class="keyword">new</span> <span class="predefined-type">Proxy</span>(
        <span class="predefined-type">Proxy</span>.Type.HTTP,
        <span class="keyword">new</span> <span class="predefined-type">InetSocketAddress</span>(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
            tigerProxy.getPort())))

    .sslSocketFactory(
        tigerProxy.getConfiguredTigerProxySslContext().getSocketFactory(),
        tigerProxy.buildTrustManagerForTigerProxy())

    .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_ca">4.4.4. Custom CA</h4>
<div class="paragraph">
<p>If you can not or don&#8217;t want to alter the client-truststore you have two choices: You can either provide a custom CA to be used (and trusted by the client) or you can give the certificate to be used by the Tiger Proxy. To set a custom CA to be used for certificate generation simply specify it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">tls</span>:
        <span class="key">serverRootCa</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">certificate.pem;privateKey.pem;PKCS8</span><span class="delimiter">&quot;</span></span>
<span class="comment"># for more information on specifying PKI identities in tiger see &quot;Configuring PKI identities&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixed_server_identity">4.4.5. Fixed server identity</h4>
<div class="paragraph">
<p>The final, easiest and most unflexible way to solve TLS-issues is to simply give a fixed server-identity. This identity will be used for all routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">tls</span>:
      <span class="key">serverIdentity</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">certificateAndKeyAndChain.p12;Password</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modifications">4.5. Modifications</h3>
<div class="paragraph">
<p>Modifications are a powerful tool to alter messages before forwarding them.<br>
They can be applied to requests and responses, to routes in forward- and reverse-proxy-mode.<br>
You can choose to modify only specific parts of the message and only alter messages,<br>
if certain conditions are met.<br>
Response messages support so called "reason phrases" which are small text explanations to the response code, e.g. "200 OK", ("OK" is a reason phrase).<br>
You can add, modify and remove reason phrases.</p>
</div>
<div class="paragraph">
<p>Below is a sample configuration giving insight into how modifications are organized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">modifications</span>:
    <span class="comment"># a list of modifications that will be applied to every proxied request and response</span>

        <span class="comment"># The following modification will replace the entire &quot;user-agent&quot; in all requests</span>
      -
        <span class="key">condition</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">isRequest</span><span class="delimiter">&quot;</span></span>
        <span class="comment"># a condition that needs to be fullfilled for the modification to be applied (JEXL grammar)</span>
        <span class="key">targetElement</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$.header.user-agent</span><span class="delimiter">&quot;</span></span>
        <span class="comment"># which element should be targeted?</span>
        <span class="key">replaceWith</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">modified user-agent</span><span class="delimiter">&quot;</span></span>
        <span class="comment"># the replacement string to be filled in.</span>

        <span class="comment"># The following modification will replace the body of every 200 response completely with the given json-string</span>
        <span class="comment"># (This ignores the existing body. For example this could be an XML-body. Content-Type-headers will NOT be set accordingly)</span>
      -
        <span class="key">condition</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">isResponse &amp;&amp; $.responseCode == 200</span><span class="delimiter">&quot;</span></span>
        <span class="key">targetElement</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$.body</span><span class="delimiter">&quot;</span></span>
        <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">body replacement modification</span><span class="delimiter">&quot;</span></span>
        <span class="comment"># The name of this modification. This can be used to identify, alter or remove this modification. A name is optional</span>
        <span class="key">replaceWith</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{\&quot;another\&quot;:{\&quot;node\&quot;:{\&quot;path\&quot;:\&quot;correctValue\&quot;}}}</span><span class="delimiter">&quot;</span></span>

        <span class="comment"># The following modification has no condition, so it will be applied to every request and every response</span>
      -
        <span class="key">targetElement</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$.body</span><span class="delimiter">&quot;</span></span>
        <span class="key">regexFilter</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ErrorSeverityType:((Error)|(Warning))</span><span class="delimiter">&quot;</span></span>
        <span class="comment"># The given regex will be used to target only parts of targeted element.</span>
        <span class="key">replaceWith</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ErrorSeverityType:Error</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mesh_setup_traffic_endpoints">4.6. Mesh set up</h3>
<div class="paragraph">
<p>One of the fundamental features of the Tiger Proxy is mesh set up AKA rbel-message forwarding.<br>
This forwards the messages, which the proxy has logged, to other Tiger Proxies (where they will be logged as well). This enables the creation of "proxy-meshes", staggered Tiger Proxies.<br>
Common scenario for this approach might be the use of multiple reverse-proxies on the root level (e.g. when the client only allows the configuration of the server IP or domain, but no path-prefix)<br>
or the aggregation of traffic across machine-boundaries (e.g. one constantly running Tiger Proxy which is used by a testsuite on another machine).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-proxy-message-flow.svg" alt="tiger proxy message flow">
</div>
<div class="title">Figure 6. Tiger Proxy message flow</div>
</div>
<div class="paragraph">
<p>In the above picture the test object 2 would not be accessible directly by the test suite, thus using the reverse proxy allows circumventing network restrictions.<br>
The reverse proxy could either be started by the test environment manager or as standalone process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">proxyId</span>: <span class="string"><span class="content">IBM</span></span>
    <span class="key">trafficEndpoints</span>:
      - <span class="string"><span class="content">http://another.tiger.proxy:&lt;adminPort&gt;</span></span>
    <span class="comment"># A list of upstream Tiger Proxies. This proxy will try to connect to all given sources to</span>
    <span class="comment"># gather traffic via the STOMP-protocol. If any of the given endpoints are not accessible the</span>
    <span class="comment"># server will not boot. (fail fast, fail early)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please be advised to use the server-port (<code>server.port</code>) here, not the proxy-port (<code>tigerProxy.proxyPort</code>). The traffic from routes with <code>activateRbelLogging: false</code> will not show up here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are setting up a Tiger Proxy to run constantly and simply forward traffic to a testsuite that is booted ad-hoc you might run into performance-problems. This is due to the Rbel-Logger being a very hungry beast. To stop Rbel from parsing all message simply add <code>tigerProxy.activateRbelParsing: false</code>. This will vastly reduce memory and CPU consumption of the application, while still forwarding logged traffic.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_mesh_api">4.6.1. Mesh API</h4>
<div class="paragraph">
<p>The Tiger Proxies use <a href="https://stomp.github.io/">STOMP</a> a simple/streaming text oriented messaging protocol via web socket to forward received traffic.<br>
For an external client to receive these traffic data, it must subscribe to the traces topic reachable at the subscription path /topic/traces.<br>
To do so the client must connect to the traffic endpoint URL of the Tiger Proxy. This is answered with HTTP status 100 and then redirected to web socket protocol via the same port.<br>
For each received traffic data pair (request/response) the Tiger Proxy will push a web socket message to all subscribed clients.</p>
</div>
<div class="paragraph">
<p>This JSON encoded message consists of:<br>
* UUID string<br>
* http request as base64 encoded data<br>
* http response as base64 encoded data<br>
* hostname and port of sender (if retrievable, worst case only IP address or empty)<br>
* hostname and port of receiver (if retrievable, worst case only IP address or empty)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UUID string</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">request</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">base64 encoded http request</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">base64 encoded http response</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sender</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">hostname</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hostname/ip address of sender</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="error">p</span><span class="error">o</span><span class="error">r</span><span class="error">t</span><span class="error">A</span><span class="error">s</span><span class="error">I</span><span class="error">n</span><span class="error">t</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">reveiver</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">hostname</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hostname/ip address of receiver</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="error">p</span><span class="error">o</span><span class="error">r</span><span class="error">t</span><span class="error">A</span><span class="error">s</span><span class="error">I</span><span class="error">n</span><span class="error">t</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_rbelpath">4.7. Understanding RBelPath</h3>
<div class="paragraph">
<p>RBeL-Path is a XPath or JSON-Path inspired expression-language enabling the quick traversal of captured RBeL-Traffic (navigation of the RbelElement-tree).</p>
</div>
<div class="paragraph">
<p>A simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">assertThat(convertedMessage.findRbelPathMembers(<span class="string"><span class="delimiter">&quot;</span><span class="content">$.header</span><span class="delimiter">&quot;</span></span>))
    .containsExactly(convertedMessage.getFacetOrFail(RbelHttpMessageFacet.class).getHeader());</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">assertThat(convertedMessage.findElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">$.header</span><span class="delimiter">&quot;</span></span>))
    .get()
    .isSameAs(convertedMessage.getFacetOrFail(RbelHttpMessageFacet.class).getHeader());</code></pre>
</div>
</div>
<div class="paragraph">
<p>(The first example executes the RbelPath and returns a list of all matching element, the second one returns an Optional containing a single result. If there are multiple matches an exception is given.)</p>
</div>
<div class="paragraph">
<p>RBeL-Path provides seamless retrieval of nested members.</p>
</div>
<div class="paragraph">
<p>Here is an example of HTTP-Message containing a JSON-Body:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/rbelPath1.jpg" alt="rbelPath1">
</div>
<div class="title">Figure 7. Rbel-Path expression in a HTTP-Response</div>
</div>
<div class="paragraph">
<p>The following message contains a JWT (Json Web Token, a structure which contains of a header, a body and a signature). In the body there is a claim (essentially a Key/Value pair represented in a JSON-structure) named <code>nbf</code> which we want to inspect.</p>
</div>
<div class="paragraph">
<p>Please note that the RBeL-Path expression contains no information about the types in the structure. This expression would also work if the HTTP-message contained a JSON-Object with the corresponding path, or an XML-Document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">assertThat(convertedMessage.findRbelPathMembers(<span class="string"><span class="delimiter">&quot;</span><span class="content">$.body.body.nbf</span><span class="delimiter">&quot;</span></span>))
    .containsExactly(convertedMessage.getFirst(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>).get()
    .getFirst(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>).get()
    .getFirst(<span class="string"><span class="delimiter">&quot;</span><span class="content">nbf</span><span class="delimiter">&quot;</span></span>).get()
    .getFirst(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>).get());</code></pre>
</div>
</div>
<div class="paragraph">
<p>(The closing .getFirst("content") in the assertion is due to a fix to make RbelPath in JSON-Context easier: If the RbelPath ends on a JSON-Value-Node the corresponding content is returned.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/rbelPath2.jpg" alt="rbelPath2">
</div>
<div class="title">Figure 8. Multiple body references</div>
</div>
<div class="paragraph">
<p>You can also use wildcards to retrieve all members of a certain level:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.body.[*].nbf</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can recursively descend and retrieve all members:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$..nbf</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$.body..nbf</pre>
</div>
</div>
<div class="paragraph">
<p>will both return the same elements (maybe amongst other elements).</p>
</div>
<div class="sect3">
<h4 id="_jexl_expressions">4.7.1. JEXL expressions</h4>
<div class="paragraph">
<p>RBeL-Path can be integrated with JEXL-expression, giving a much more powerful and flexible tool to extract certain element. This can be done using the syntax from the following example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$..[?(key=='nbf')]</pre>
</div>
</div>
<div class="paragraph">
<p>The expression in the round-brackets is interpreted as JEXL. The available syntax is described in more detail here: <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" class="bare">https://commons.apache.org/proper/commons-jexl/reference/syntax.html</a></p>
</div>
<div class="paragraph">
<p>The variables that can be used are listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>element</code> contains the current RBeL-Element</p>
</li>
<li>
<p><code>parent</code> gives direct access to the parent element of the current element.<br>
Is <code>null</code> if not present</p>
</li>
<li>
<p><code>message</code> contains the HTTP-Message under which this element was found</p>
</li>
<li>
<p><code>request</code> is the corresponding HTTP-Request. If <code>message</code> is a response, then the corresponding Request will be returned.<br>
If <code>message</code> is a request, then the <code>message</code> itself will be returned.</p>
</li>
<li>
<p><code>key</code> is a string containing the key that the current element can be found under in the parent-element.</p>
</li>
<li>
<p><code>path</code> contains the complete sequence of keys from <code>message</code> to <code>element</code>.</p>
</li>
<li>
<p><code>type</code> is a string containing the class-name of <code>element</code> (eg <code>RbelJsonElement</code>).</p>
</li>
<li>
<p><code>content</code> is a string describing the content of <code>element</code>. The actual representation depends heavily on the type of <code>element</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_rbel_expressions">4.7.2. Debugging Rbel-Expressions</h4>
<div class="paragraph">
<p>To help users create RbelPath-Expressions there is a Debug-Functionality which produces log message designed to help. These can be activated by <code>RbelOptions.activateRbelPathDebugging();</code>. Please note that this is strictly intended for development purposes and will flood the log with quite a lot of messages. Act accordingly!</p>
</div>
<div class="paragraph">
<p>When you want to debug RbelPath in BDD test suites, you can add a tiger.yaml file to your project root and add the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">rbelPathDebugging</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get a better feel for a RbelElement (whether it being a complete message or just a part) you can print the tree with the <code>RbelElementTreePrinter</code>. It brings various options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RbelElementTreePrinter.builder()
    .rootElement(<span class="local-variable">this</span>) <span class="comment">//the target element</span>
    .printKeys(printKeys) <span class="comment">// should the keys for every leaf be printed?</span>
    .maximumLevels(<span class="integer">100</span>) <span class="comment">// only descend this far into the three</span>
    .printContent(<span class="predefined-constant">true</span>) <span class="comment">// should the content of each element be printed?</span>
    .build()
    .execute();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_tiger_proxy_as_standalone_jar">4.8. Running Tiger Proxy as standalone JAR</h3>
<div class="paragraph">
<p>If you only want to run a Tiger Proxy instance without test environment manager or test library you may do so (e.g. in certain tracing set-ups). A fat JAR is available via maven central.</p>
</div>
<div class="paragraph">
<p>Supplying an application.yaml file allows you to configure the standalone proxy just like an instance started by the test environment manager. All properties can be used the same way as described in <a href="#_configuring_the_local_test_suite_tiger_proxy">this chapter</a>. There is however one additional property for the standalone proxy specifically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># flag whether to load all resources (js,css) locally or via CDN/internet.</span>
<span class="comment"># useful if you have no access to the internet in your environment</span>
<span class="key">localResources</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_configuration">4.9. Additional configuration</h3>
<div class="paragraph">
<p>There are some additional configuration-flags in the Tiger Proxy:</p>
</div>
<div class="sect3">
<h4 id="_performance">4.9.1. Performance</h4>
<div class="paragraph">
<p>Below some properties along with their respective default values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tigerProxy</span>:
    <span class="key">activateRbelParsing</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">activateAsn1Parsing</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">activateVauAnalysis</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_activaterbelparsing">activateRbelParsing</h5>
<div class="paragraph">
<p>Deactivating this flag turns off all Rbel-Analysis of the incoming traffic. This is a huge deal in terms of memory- and CPU-consumption but you will loose all benefit of performing Rbel-Analysis.</p>
</div>
</div>
<div class="sect4">
<h5 id="_activateasn1parsing">activateAsn1Parsing</h5>
<div class="paragraph">
<p>This is off by default. ASN.1 objects are very common in crypto applications. While parsing them will enable you to directly have a look inside certificates it comes with a penalty in performance and also clutters the object-tree. Often it&#8217;s enough to know that there is a certificate, only in some scenarios is the content of interest. If the latter is of interest to you activate ASN.1 parsing.</p>
</div>
</div>
<div class="sect4">
<h5 id="_activatevauanalysis">activateVauAnalysis</h5>
<div class="paragraph">
<p>VAU-Analysis adds information about the current session to every single VAU-message. If you are not trying to analyze EPA-VAU messages leave this option turned off. If you do enabling it will give you additional information about the messages.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tiger_test_library_2">5. Tiger Test library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As outlined in <a href="#_overview">the overview section</a> the Tiger test library is<br>
one of the three core components of the Tiger test framework.<br>
Its main goal is to provide extensive support for BDD/Cucumber testing and integrating the local Tiger Proxy<br>
with the test environment manager and the started test environment.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
As of now we do not support multithreaded / parallel test runs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tiger_test_lib_configuration">5.1. Tiger test lib configuration</h3>
<div class="paragraph">
<p>In the root folder of your test project you may place a <em>tiger.yaml</em> configuration file to customize the Tiger test library integration<br>
and activate / deactivate certain features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">lib</span>:
    <span class="comment"># Flag to activate tracing at the Rbel Path Executor.</span>
    <span class="comment"># If activated the Executor will dump all evaluation steps of all levels to the console</span>
    <span class="comment"># when traversing through the document tree</span>
    <span class="comment"># Deactivated by default</span>
    <span class="key">rbelPathDebugging</span>: <span class="string"><span class="content">false</span></span>
    <span class="comment"># Flag whether the Executor's dump shall be in ANSI color.</span>
    <span class="comment"># If you are working on operating systems (Windows) that do not support</span>
    <span class="comment"># Ansi color sequences in their console you may deactivate the coloring with this flag.</span>
    <span class="comment"># Activated by default.</span>
    <span class="key">rbelAnsiColors</span>: <span class="string"><span class="content">true</span></span>
    <span class="comment"># Flag whether to start a browser window to display</span>
    <span class="comment"># the current steps / banner messages / rbel logs</span>
    <span class="comment"># when executing the test suite.</span>
    <span class="comment"># This feature can be used to instruct the tester to follow</span>
    <span class="comment"># a specific test workflow for manual tests.</span>
    <span class="comment"># Deactivated by default</span>
    <span class="key">activateWorkflowUi</span>: <span class="string"><span class="content">false</span></span>
    <span class="comment"># Flag whether to add a curl command details button to</span>
    <span class="comment"># SerenityRest Restassured calls</span>
    <span class="comment"># in the Serenity BDD report</span>
    <span class="key">addCurlCommandsForRaCallsToReport</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cucumber_and_hooks">5.2. Cucumber and Hooks</h3>
<div class="paragraph">
<p>As Tiger focuses on BDD and Cucumber based test suites all the setup and tear down as well as steps based actions are performed .</p>
</div>
<div class="paragraph">
<p>That&#8217;s why it is mandatory to add the plugin de.gematik.test.tiger.TigerCucumberListener to the plugins list and use the TigerCucumberRunner.</p>
</div>
<div class="paragraph">
<p>The LocalProxyRbelMessageListener class initializes a static single RBelMessage listener to collect all messages received by the local Tiger Proxy and provides those messages via a getter method to the Tiger filter and validation steps.</p>
</div>
<div class="paragraph">
<p>At startup of the TigerCucumberRunner the TigerDirector gets called once to initiate the Tiger test environment manager, the local Tiger Proxy and optionally the workflow UI.<br>
It adds a RbelMessage Listener once to the local Tiger proxy and also clears the RbelMessages queue before each scenario / scenario outline variant.<br>
Utilizing the close integration of SerenityBDD and RestAssured at startup also a Restassured request filter, which parses the details and adds a curl Command details button to the Serenity BDD report, is registered.<br>
The curl command shown in that section in the report allows to repeat the performed REST request, for manual test failure analysis.</p>
</div>
<div class="paragraph">
<p>After each scenario / data variant all collected RbelMessages are saved as HTML file to the <code>target/rbellogs</code> folder, and attached to the SerenityBDD report as test evidence. The current test run state (success/failed rate) is logged to the console.</p>
</div>
<div class="paragraph">
<p>The TigerDirector in the future will become a general high level access class to all the major features of the Tiger test framework.<br>
Such things as syncing test cases and test reports with Polarion, creating requirements coverage reports, using the Tiger test framework from non Cucumber test drivers, &#8230;&#8203;etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For now, the TigerDirector, TigerCucumberRunner, TigerCucumberListener are only for internal use and do not provide any implementation of the aforementioned features.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_cucumber_tiger_validation_steps">5.3. Using the Cucumber Tiger validation steps</h3>
<div class="paragraph">
<p>The Tiger validation steps are a set of Cucumber steps that enable you to search for requests and associated responses<br>
matching certain criteria. All of that without need to write your own code. Basic knowledge about RBelPath and regular expressions are sufficient.<br>
In order to use these steps you must ensure that the relevant traffic is routed via the local Tiger Proxy of the test suite or<br>
construct a <a href="#_mesh_setup_traffic_endpoints">Tiger Proxy mesh</a> set up.</p>
</div>
<div class="sect3">
<h4 id="_filtering_requests">5.3.1. Filtering requests</h4>
<div class="ulist">
<div class="title">Core features</div>
<ul>
<li>
<p>Filter for server, method, path, RBelPath node matching given value in request</p>
</li>
<li>
<p>Find first / next / last matching request</p>
</li>
<li>
<p>Clear all recorded messages</p>
</li>
<li>
<p>Specify timeout for filtering request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the <code>find next request &#8230;&#8203;</code> steps you can validate a complete workflow of requests to exist in a specific order and validate each of their responses (see next chapter).</p>
</div>
<div class="openblock">
<div class="title">Tiger validation filtering steps example</div>
<div class="content">
<pre class="CodeRay highlight">

  Feature Tiger validation steps

    Scenario: Example steps

      <span class="comment"># clear all previously recorded messages (requests and responses)</span>
      <span class="keyword">Given</span> TGR clear recorded messages
      <span class="comment"># restrict filtering requests to a specific host</span>
      <span class="keyword">And</span> TGR filter requests based on host <span class="string">"testnode.example.org"</span>
      <span class="comment"># restrict filtering requests to a specific HTTP method</span>
      <span class="keyword">And</span> TGR filter requests based on method <span class="string">"POST"</span>
      <span class="comment"># specify timeout for filter queries</span>
      <span class="keyword">And</span> TGR set request wait timeout to <span class="string">20</span> seconds
      <span class="comment"># find the first request matching criteria</span>
      <span class="keyword">When</span> TGR find request to path <span class="string">"/path/blabla"</span> with <span class="string">"$..tag.value.text"</span> matching <span class="string">"abc.*"</span>
      <span class="comment"># validate response to the filtered request using RBelPath</span>
      <span class="keyword">Then</span> TGR current response with attribute <span class="string">"$..answer.result.text"</span> matches <span class="string">"OK.*"</span>
      <span class="comment"># find the next request matching criteria</span>
      <span class="keyword">When</span> TGR find next request to path <span class="string">"/path"</span> with <span class="string">"$..value.text"</span> matching <span class="string">"abc.*"</span>

      ....
</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validating_responses">5.3.2. Validating responses</h4>
<div class="ulist">
<div class="title">Core features</div>
<ul>
<li>
<p>Assert that the body of the response matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath node matches regex</p>
</li>
<li>
<p>Assert that a given RBelPath node matches a JSON struct using the JSONChecker feature set</p>
</li>
<li>
<p>Assert that a given RBelPath node matches an XML struct using the XMLUnit difference evaluator</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="title">Tiger response validation steps example</div>
<div class="content">
<pre class="CodeRay highlight">

Feature Tiger validation steps

  Scenario: Example steps
    ...
    <span class="comment"># find the first request matching criteria</span>
    <b>When</b> TGR find request to path <span class="string">"/path/path/blabla"</span> with <span class="string">"$..tag.value.text"</span> matching <span class="string">"abc.*"</span>
    <span class="comment"># validate response to the filtered request using RBelPath</span>
    <b>Then</b> TGR current response with attribute <span class="string">"$..answer.result.text"</span> matches <span class="string">"OK.*"</span>
    <span class="comment"># find the next request matching criteria</span>
    <b>When</b> TGR find next request to path <span class="string">"/path"</span> with <span class="string">"$..value.text"</span> matching <span class="string">"abc.*"</span>
    <span class="comment"># validate response to the filtered request comparing body content</span>
    <b>Then</b> TGR current response body matches
    <span class="string">"""
         body content
    """</span>
    <span class="comment"># validate response to the filtered request based upon JSONChecker</span>
    <b>And</b> TGR current response at <span class="string">"$..tag"</span> matches as JSON
    <span class="string">"""
      {
        "arr1": [
          "asso", "bsso"
        ]
      }
    """</span>
    <span class="comment"># validate response to the filtered request based upon XML comparison</span>
    <b>And</b> TGR current response at <span class="string">"$..tag" matches as XML
    <span class="string">"""
      &lt;arr1>
        &lt;entry index="1">asso&lt;/entry>
        &lt;entry index="2">bsso&lt;/entry>
      &lt;/arr1>
    """</span>
</pre>
</div>
</div>
<div class="sect4">
<h5 id="_xmlunit_diff_builder">XMLUnit Diff Builder</h5>
<div class="paragraph">
<p>Using the validation steps <code>TGR current response at {string} matches as XML</code> or<br>
<code>TGR current response at {string} matches as XML and diff options {string}</code> you are able to compare<br>
the content of any RbelPath node in the response.<br>
The latter method even allows passing in the following options to the XMLUnit&#8217;s DiffBuilder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"nocomment" for DiffBuilder::ignoreComments</p>
</li>
<li>
<p>"txtignoreempty" for DiffBuilder::ignoreElementContentWhitespace</p>
</li>
<li>
<p>"txttrim" for DiffBuilder::ignoreWhitespace</p>
</li>
<li>
<p>"txtnormalize" for DiffBuilder::normalizeWhitespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Per default the comparison algorithm will ignore mismatches in namespace prefixes and URIs. Comparison is also performed on similarity and not equal content.</p>
</div>
<div class="paragraph">
<p>For more detailed explanation about the XMLUnit difference evaluator we refer to the <a href="https://github.com/xmlunit/user-guide/wiki/DiffBuilder">online documentation of the XMLUnit project</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jsonchecker">JSONChecker</h5>
<div class="paragraph">
<p>Using the validation step <code>TGR current response at {string} matches as JSON</code> you are able to compare the content of any RbelPath node<br>
in the response to the doc string beneath the step, with the help of the JSONChecker comparison algorithm.</p>
</div>
<div class="paragraph">
<p>The purpose of JSONChecker class is to compare JSON structures, including checking for the integrity of the whole RbelPath node, as well as matching values for particular keys.</p>
</div>
<div class="paragraph">
<p>To make sure all the attributes in your JSON RbelPath structure are present, such features as ${json-unit.ignore}, $NULL, optional attributes, regular expressions and lenient mode can come in handy.</p>
</div>
<div class="paragraph">
<p>${json-unit.ignore} is a parameter which allows ignoring certain values in your RbelPath node while comparing, and the result of such comparison always returns true.<br>
It also works when ${json-unit.ignore} is used in a JSON array or nested JSON object.<br>
This parameter should be placed as a value of a key.<br>
To ignore some attributes in the JSON structure, you can set a boolean value checkExtraAttributes as false.<br>
In this case if you miss one attribute in your doc string, the comparison will still be equal to true.</p>
</div>
<div class="paragraph">
<p>To check whether the value for a particular key is null, you can either use null or parameter $NULL at the place of the value. Checking whether a nested key is null also works with JSONChecker.</p>
</div>
<div class="paragraph">
<p>Four underscores "<em>__</em>" before the JSON keys indicate that these keys are optional and will be checked for the value ONLY if the value exists in the test JSON RBelPath node.<br>
Please note that checking whether a nested key is optional, is not yet possible with JsonChecker.</p>
</div>
<div class="paragraph">
<p>JSON Arrays are compared in lenient mode, meaning that the order of elements in JSON array doesn&#8217;t matter.</p>
</div>
<div class="paragraph">
<p>Identifying missing keys is made easy in JSONChecker with the help of parameter $REMOVE.</p>
</div>
<div class="paragraph">
<p>If you specify the name of the key and then $REMOVE parameter as its value, the comparison will result in true, if the key is indeed missing and false, if the key is present. It is worth noting that even if the value of the key is null, the key doesn&#8217;t count as missing.</p>
</div>
<div class="paragraph">
<p>Last but not least, regular expressions, which can be used for matching the whole JSON element, as well as particular values. It will be first checked, whether the expected value is equal to the actual one, and only afterwards, if the actual value matches a regular expression.</p>
</div>
<div class="paragraph">
<p>It should also be noted, that although JSONChecker can match multilevel JSON objects at a high level, it is not yet possible to access nested attributes out of the box. We are working on it :)</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Simple adapted example from the IDP test suite</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">alg</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dir</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">enc</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">A256GCM</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cty</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$NULL</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="char">\\</span><span class="content">d]*</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">____kid</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">.*</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dummyentry</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${json-unit.ignore}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dummyarray</span><span class="delimiter">&quot;</span></span>: [ <span class="string"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span> ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dummyarray2</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">${json-unit.ignore}</span><span class="delimiter">&quot;</span></span>
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows three main features of the JSONChecker.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Value specified as $NULL, meaning this value of this key is equal to null.</p>
</li>
<li>
<p>Usage of regular expression (e.g. ".*" and "[\\d]*") to match values.</p>
</li>
<li>
<p>Usage of "<em>__</em>" preceeding a json key.- This indicates that the entry is optional but if it exists it must match the given value.</p>
</li>
<li>
<p>if a value is specified as "${json-unit.ignore}", there is no check performed at all. This applies also to objects and arrays as seen in the dummyarray2 entry.</p>
</li>
<li>
<p>if we match key dummyEntry2 to the value of $REMOVE, it will return true, because this key does not exist.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_regex_matching">Regex matching</h5>
<div class="paragraph">
<p>When comparing values (e.g. in the <code>TGR current response body matches</code>) generally the algorithms check for equality and<br>
only check for regex matches if they were not equal.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_complete_set_of_steps_in_validation_glue_code">5.3.3. Complete set of steps in validation glue code</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// copied from module /tiger-test-lib</span>
<span class="comment">// /src/test/java/de/gematik/test/tiger/glue/RBelValidatorGlue.java</span>

<span class="comment">/**
 * Specify the amount of seconds Tiger should wait when filtering for
 * requests / responses
 * before reporting them as not found.
 */</span>
<span class="annotation">@Gegebensei</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR setze Anfrage Timeout auf {int} Sekunden</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR set request wait timeout to {int} seconds</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * clear all validatable rbel messages. This does not clear the recorded messages later on
 * reported via the rbel log HTML page or the messages shown on web ui of Tiger Proxies.
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR lösche aufgezeichnete Nachrichten</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR clear recorded messages</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * filter all subsequent findRequest steps for hostname. To reset set host name to
 * empty string &quot;&quot;.
 *
 * @param hostname host name (regex supported) to filter for
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR filtere Anfragen nach Server {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR filter requests based on host {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * filter all subsequent findRequest steps for method.
 *
 * @param method method to filter for
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR filtere Anfragen nach HTTP Methode {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR filter requests based on method {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * reset filter for method for subsequent findRequest steps.
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR lösche den gesetzten HTTP Methodenfilter</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR reset request method filter</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * find the first request where the path equals or matches as regex and memorize it
 * in the {@link #rbelValidator} instance
 *
 * @param path path to match
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde die erste Anfrage mit Pfad {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR find request to path {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * find the first request where path and node value equal or match as regex and memorize it
 * in the {@link #rbelValidator} instance.
 *
 * @param path     path to match
 * @param rbelPath rbel path to node/attribute
 * @param value    value to match at given node/attribute
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde die erste Anfrage mit Pfad {string} und Knoten {string} der mit {string} übereinstimmt</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR find request to path {string} with {string} matching {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * find the NEXT request where the path equals or matches as regex and memorize it
 * in the {@link #rbelValidator} instance.
 *
 * @param path path to match
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde die nächste Anfrage mit dem Pfad {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR find next request to path {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * find the NEXT request where path and node value equal or match as regex and memorize it
 * in the {@link #rbelValidator} instance.
 *
 * @param path     path to match
 * @param rbelPath rbel path to node/attribute
 * @param value    value to match at given node/attribute
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde die nächste Anfrage mit Pfad {string} und Knoten {string} der mit {string} übereinstimmt</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR find next request to path {string} with {string} matching {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * find the LAST request where the path equals or matches as regex and memorize it in the {@link #rbelValidator}
 * instance.
 *
 * @param path path to match
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde die letzte Anfrage mit dem Pfad {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR find last request to path {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * find the LAST request where path and node value equal or match as regex and memorize it in the {@link
 * #rbelValidator} instance.
 *
 * @param path     path to match
 * @param rbelPath rbel path to node/attribute
 * @param value    value to match at given node/attribute
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde die letzte Anfrage mit Pfad {string} und Knoten {string} der mit {string} übereinstimmt</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR find last request to path {string} with {string} matching {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * assert that there is any message with given rbel path node/attribute matching given value.
 * The result (request or response) will not be stored in the {@link #rbelValidator}
 * instance.
 *
 * @param rbelPath rbel path to node/attribute
 * @param value    value to match at given node/attribute
 * @deprecated
 */</span>
<span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR finde eine Nachricht mit Knoten {string} der mit {string} übereinstimmt</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR any message with attribute {string} matches {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">// ==========================================================================================</span>
<span class="comment">//</span>
<span class="comment">//    S T O R E   R E S P O N S E   N O D E   I N   C O N T E X T</span>
<span class="comment">//</span>
<span class="comment">// ==========================================================================================</span>

<span class="comment">/**
 * store given rbel path node/attribute text value of curren tresponse.
 *
 * @param rbelPath path to node/attribute
 * @param varName  name of variable to store the node text value in
 */</span>
<span class="annotation">@Dann</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR speichere Wert des Knotens {string} der aktuellen Antwort in der Variable {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR store current response node text value at {string} in variable {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">// ==========================================================================================</span>
<span class="comment">//</span>
<span class="comment">//    R E S P O N S E   V A L I D A T I O N</span>
<span class="comment">//</span>
<span class="comment">// ==========================================================================================</span>

<span class="comment">/**
 * assert that response body of filtered request matches.
 *
 * @param docString value / regex that should equal or match
 */</span>
<span class="annotation">@Dann</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR prüfe aktuelle Antwort stimmt im Body überein mit:</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR current response body matches</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * assert that response of filtered request matches at given rbel path node/attribute.
 *
 * @param rbelPath path to node/attribute
 * @param value    value / regex that should equal or match as string content with MultiLine
 *                 and DotAll regex option
 */</span>
<span class="annotation">@Dann</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR prüfe aktuelle Antwort stimmt im Knoten {string} überein mit {string}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR current response with attribute {string} matches {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * assert that response of filtered request matches at given rbel path node/attribute.
 *
 * @param rbelPath  path to node/attribute
 * @param docString value / regex that should equal or match as string content with MultiLine
 *                  and DotAll regex option supplied as DocString
 */</span>
<span class="annotation">@Dann</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR prüfe aktuelle Antwort im Knoten {string} stimmt überein mit:</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR current response at {string} matches</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * assert that response of filtered request matches at given rbel path node/attribute.
 *
 * @param rbelPath path to node/attribute
 * @param value    value / regex that should equal or match as string content with MultiLine
 *                 and DotAll regex option
 * @deprecated
 */</span>
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR current response at {string} matches {string}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * assert that response of filtered request matches at given rbel path node/attribute
 * assuming its JSON or XML
 *
 * @param rbelPath     path to node/attribute
 * @param mode         one of JSON|XML
 * @param oracleDocStr value / regex that should equal or match as JSON or XML content
 * @see JsonChecker#assertJsonObjectShouldMatchOrContainInAnyOrder(String, String, boolean)
 */</span>
<span class="annotation">@Dann</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR prüfe aktuelle Antwort im Knoten stimmt als {word} überein mit:</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR current response at {string} matches as {word}</span><span class="delimiter">&quot;</span></span>)

<span class="comment">/**
 * assert that response of filtered request matches at given rbel path node/attribute
 * assuming its XML with given list of diff options.
 *
 * @param rbelPath       path to node/attribute
 * @param diffOptionsCSV a csv separated list of diff option identifiers to be applied
 *                       to comparison of the two XML sources
 *                       &lt;ul&gt;
 *                           &lt;li&gt;nocomment ... {@link DiffBuilder#ignoreComments()}&lt;/li&gt;
 *                           &lt;li&gt;
 *                             txtignoreempty ...
 *                             {@link  DiffBuilder#ignoreElementContentWhitespace()}
 *                           &lt;/li&gt;
 *                           &lt;li&gt;txttrim ... {@link DiffBuilder#ignoreWhitespace()}&lt;/li&gt;
 *                           &lt;li&gt;
 *                             txtnormalize ... {@link DiffBuilder#normalizeWhitespace()}
 *                           &lt;/li&gt;
 *                       &lt;/ul&gt;
 * @param xmlDocStr      value / regex that should equal or match as JSON content
 * @see &lt;a href=&quot;https://github.com/xmlunit/user-guide/wiki/DifferenceEvaluator&quot;&gt;
 *        More on DifferenceEvaluator
 *      &lt;/a&gt;
 */</span>
<span class="annotation">@Dann</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR prüfe aktuelle Antwort im Knoten {string} stimmt als XML mit folgenden diff Optionen {string} überein mit:</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR current response at {string} matches as XML and diff options {string}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exemplaric_scenario_konnektorfarm_eau_validation">5.3.4. Exemplaric scenario Konnektorfarm EAU validation</h4>
<div class="paragraph">
<p>The EAU Konnektorfarm scenario is a scenario where customers can use their Primärsystem to test signing and verifying documents via a set of Konnektoren and that this works interoperable. For this purpose a phalanx of local Tiger Proxies is set up as reverse proxies for each Konnektor being hosted at the gematik location.<br>
Any message that is forwarded by any of these proxies is forwarded to an aggregating Tiger Proxy which in turn forwards all the received messages to the local Tiger Proxy for assertion via the validation test suite.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-integration-eau-testenv.svg" alt="tiger integration eau testenv">
</div>
<div class="title">Figure 9. Tiger EAU Konnektorfarm test environment</div>
</div>
<div class="paragraph">
<p>So after starting the validation test suite (and the test environment), the customer / Primärsystem manufacturer must perform the specified workflow. The test suite meanwhile will wait for a given order of requests/responses matching specified criteria to appear.<br>
If all is well, at the end the test report JSON files will be packed into a zip archive and can be uploaded to the Titus platform for further certification steps.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-integration-eau-process.svg" alt="tiger integration eau process">
</div>
<div class="title">Figure 10. Tiger EAU Konnektorfarm process</div>
</div>
</div>
<div class="sect3">
<h4 id="_workflow_ui">5.3.5. Workflow UI</h4>
<div class="paragraph">
<p>The Workflow UI is one of the new experimental features which are currently introduced to Tiger. If activated via the tiger.yaml configuration file (see <a href="#_tiger_test_lib_configuration">Tiger test lib configuration</a>), any TGR banner step will be displayed in the Monitor UI popup and will stay there till the next banner step replaces the message. This way you can instruct manual testers to follow a specified test workflow.<br>
This feature is used in the EAU Konnektorfarm validation test suite to guide the Primärsystem manufacturers through the interoperability combinations of signing/verifying documents against all Konnektors available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/uimonitor.png" alt="uimonitor">
</div>
<div class="title">Figure 11. Workflow UI popup</div>
</div>
<div class="listingblock">
<div class="title">Listing 14. Current message steps for Workflow UI</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// copied from module /tiger-test-lib</span>
<span class="comment">// /src/test/java/de/gematik/test/tiger/glue/TigerGlue.java</span>

    <span class="annotation">@Gegebensei</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR zeige {word} Banner {string}</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR show {word} banner {string}</span><span class="delimiter">&quot;</span></span>)

    <span class="annotation">@Gegebensei</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR zeige {word} Text {string}</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR show {word} text {string}</span><span class="delimiter">&quot;</span></span>)

    <span class="annotation">@Gegebensei</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR zeige Banner {string}</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR show banner {string}</span><span class="delimiter">&quot;</span></span>)

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR wait for user abort</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Wenn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TGR warte auf Abbruch</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last step allows to pause the validation test suite and is mainly used in demo scenarios allowing the manual tester  to perform demo transactions that will be logged and saved to HTML reports but are not validated.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_tiger_test_lib_helper_classes">5.4. Using Tiger test lib helper classes</h3>
<div class="paragraph">
<p>If you don&#8217;t want to use the Tiger test framework but only pick a few helper classes the following classes might be of interest to you:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All classes listed here are part of the tiger-common module
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_banner">5.4.1. Banner</h4>
<div class="paragraph">
<p>If you want to use large ASCII art style log banners you may find this class very helpful.<br>
Supports ANSI coloring and a set of different fonts. Furthermore, all banner messages are displayed and highlighted in the Workflow UI<br>
For more details please check the code and its usages in the Tiger test framework.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tigerserializationutil">5.4.2. TigerSerializationUtil</h4>
<div class="paragraph">
<p>This class supports you in converting String representation of YAML and JSON data to an Java JSONObject or extract that or other loaded data to Java Maps. If you are plannign to implement test data management or configuration sets, we propose to use the TigerGlobalConfiguration class described <a href="#">in detail here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tigerpkiidentityloader_tigerpkiidentity">5.4.3. TigerPkiIdentityLoader, TigerPkiIdentity</h4>
<div class="paragraph">
<p>The loader class allows to easily instantiate PKI identities from given files. For more details on the format and the supported file types please check <a href="#_configuring_pki_identities_in_tiger_proxys_tls_section">this section in the test environment chapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performing_rest_calls_with_tiger">5.4.4. Performing REST calls with Tiger</h4>
<div class="paragraph">
<p>Tiger is closely integrated with SerenityBDD, which in turn has integrated the RestAssured library, so if you use the <code>SerenityRest</code> helper class, you will get detailed information about each call inside the test report.<br>
The Tiger test library configuration also provides a flag to add curl command details to each of these calls, so that you can easily reproduce the REST call manually in case of test failure analysis.</p>
</div>
<div class="paragraph">
<p>For more information about REST testing in Tiger/SerenityBDD please check these two documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://serenity-bdd.github.io/theserenitybook/latest/serenity-rest.html">Serenity REST</a></p>
</li>
<li>
<p><a href="https://serenity-bdd.github.io/theserenitybook/latest/serenity-screenplay-rest.html">Serenity Screenplay REST</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_synchronizing_bdd_scenarios_with_polarion_test_cases_gematik_only">5.5. Synchronizing BDD scenarios with Polarion test cases (Gematik only)</h3>
<div class="paragraph">
<p>Within gematik we maintain test cases via feature files being committed to git repositories. To keep traceability to the requriements maintained in Polarion we have a Tiger sub project that syncrhonizes test cases in Polarion with the scenarios in our feature files. It is a one way synchronisation, where the master are the feature files.</p>
</div>
<div class="paragraph">
<p>To use this feature the scenarios need a minimal set of annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@TCID:XXXXX</strong> &#8230;&#8203; Mandatory - an unique test case identifier, where XXXXX matches the value of the custom field "cfInternalId" in Polarion</p>
</li>
<li>
<p><strong>@Product:PPPPP</strong> &#8230;&#8203; Mandatory - reference to the custom field "cfProductType". As the value most likely is identical for all scenarios you may attach this annotation also to the feature.</p>
</li>
<li>
<p><strong>@PRIO:N</strong> &#8230;&#8203;. Mandatory - priority number (1-3)</p>
</li>
<li>
<p>and the following optional annotations:</p>
<div class="ulist">
<ul>
<li>
<p>@Ready &#8230;&#8203; sets status of test case to "Implemented". If not set defaults to "In progress"</p>
</li>
<li>
<p>@Negative &#8230;&#8203; reference to the custom field "cfNegPosTF". If not set defaults to be "Positive"</p>
</li>
<li>
<p>@manual &#8230;&#8203; to mark the test case as being manually executed. If not set defaults to "Automatic"</p>
</li>
<li>
<p>@Afo:AAAAA &#8230;&#8203; a link to a defined requirement in Polarion, where AAAAA matches the custom field "cfAfoId"</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a scenario is identified that has no test case with a matching TCID, it will be created automatically in the sync run. Background blocks will be merged to each scenario before exporting its steps to Polarion.</p>
</div>
<div class="paragraph">
<p>For more details on how to perform the synchronisation and how to also upload generated test run reports to Polarion and Aurora, please check the PolarionToolbox project on the Gematik GitLab.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tiger_configuration">6. Tiger Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration is an integral part of testing. To make this task easier for you and to make configuration the various parts of the system as easy as possible Tiger has a central configuration store: TigerGlobalConfiguration. It combines properties from multiple source and feeds into various parts of the system.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/tiger-configuration-global.svg" alt="tiger configuration global">
</div>
<div class="title">Figure 12. The TigerGlobalConfiguration with inlets and outlets</div>
</div>
<div class="paragraph">
<p>This allows a vastly simplified retrieval and configuration of nearly all aspects of the system. It is therefore recommended reusing this system for your own testsuite as well.</p>
</div>
<div class="sect2">
<h3 id="_inlets">6.1. Inlets</h3>
<div class="paragraph">
<p>The following inlets are considered in the TigerGlobalConfiguration (ordered from most to least important, meaning if a property occurs in multiple sources the one at the top is considered first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manually added properties (TigerGlobalConfiguration.putString("foo.bar")). Here there are three sub-distinctions:</p>
<div class="ulist">
<ul>
<li>
<p>Global properties</p>
</li>
<li>
<p>Test properties</p>
</li>
<li>
<p>Thread-based properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>Command-line properties</p>
</li>
<li>
<p>System-Properties (System.setProperty)</p>
</li>
<li>
<p>Environment-Variables (export "FOO_BAR" = 42)</p>
</li>
<li>
<p>YAML-Files (tiger.yaml)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_key_translation">6.2. Key-translation</h3>
<div class="paragraph">
<p>To easily convert between the multiple sources the TigerGlobalConfiguration offers key-translation:</p>
</div>
<div class="paragraph">
<p><code>tiger.foo.bar</code> is equal to <code>TIGER_FOO_BAR</code> is equal to <code>tIgER.fOO.BaR</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the key consists only of letters and underscores then the underscores are converted to points.</p>
</li>
<li>
<p>Names are compared without considering the case.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_thread_based_configuration">6.3. Thread-based configuration</h3>
<div class="paragraph">
<p>To enable execution of multiple tests simultaneously some data has to be stored in a thread-based manner (the first step could for example store the result of a request in a variable, the second step could read it from that variable).</p>
</div>
<div class="paragraph">
<p>To enable this simply reference the Thread-context when storing a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TigerGlobalConfiguration.putValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.value</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, SourceType.THREAD_CONTEXT);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When retrieving the variable you could simply ask for <code>foo.value</code>: Only when you are in the thread that stored this variable you will find it again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_placeholders">6.4. Placeholders</h3>
<div class="paragraph">
<p>The TigerGlobalConfiguration supports the use of placeholders. Say for example you have a test-environment with two servers, "A" and "B". For the server "A" you have two choices: Either a real URL in the internet or a locally booted server. The use can choose which to activate by setting "active" of the server to use. The server "B" should now use the activated server, without having to set it manually while booting.</p>
</div>
<div class="paragraph">
<p>You could achieve this by exporting the URL (<code>servers.myServer.exports</code>) and referencing it in an argument which is passed into server "B" (<code>serverAUrl=${serverA.url}</code>. The first part here before the equal is the name of the environment variable passed into server "B" while booting, the second part behind the equal is the name of the property. compare this to the exports in the two serverA-options):</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Configuring using placeholders and exports</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="key">servers</span>:
  <span class="key">serverAInternet</span>:
    <span class="key">active</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">type</span>: <span class="string"><span class="content">externalUrl</span></span>
    <span class="key">source</span>:
      - <span class="string"><span class="content">https://my.real.server/api</span></span>
    <span class="key">exports</span>:
<span class="comment"># The string SERVERA_URL is split internally into SERVERA and URL, which are then considered</span>
<span class="comment"># as lowercase keys</span>
      - <span class="string"><span class="content">SERVERA_URL=https://my.real.server/api</span></span>
  <span class="key">serverALocal</span>:
    <span class="key">active</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">type</span>: <span class="string"><span class="content">externalUrl</span></span>
    <span class="key">source</span>:
      - <span class="string"><span class="content">https://localhost:8080/api</span></span>
    <span class="key">exports</span>:
      - <span class="string"><span class="content">SERVERA_URL=https://localhost:8080/api</span></span>
  <span class="key">serverB</span>:
    <span class="key">type</span>: <span class="string"><span class="content">externalJar</span></span>
    <span class="key">source</span>:
      - <span class="string"><span class="content">http://nexus/download/server.jar</span></span>
    <span class="key">healthcheckUrl</span>: <span class="string"><span class="content">http://127.0.0.1:19307</span></span>
    <span class="key">externalJarOptions</span>:
      <span class="key">arguments</span>:
<span class="comment"># The second part is the placeholder which will be resolved using the internal value store.</span>
<span class="comment"># The string &quot;serverA.url&quot; is split into &quot;serverA&quot; and &quot;url&quot;, again considered as lowercase,</span>
<span class="comment"># which then matches to &quot;SERVERA_URL&quot;,</span>
        - <span class="string"><span class="content">--serverAUrl=${serverA.url}</span></span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Placeholders which can not be resolved will not lead to errors but rather they will simply not be replaced.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_localized_configuration">6.5. Localized configuration</h3>
<div class="paragraph">
<p>Sometimes scope-creep can be a concern: Say you want to add a bunch of values right for one specific call but want to avoid that those values can be seen from everywhere else. By default, TigerGlobalConfiguration does not honor scope, which is a deliberate design-choice. To give you greater control over scope-behavior use the <code>.localScope()</code>-method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TigerGlobalConfiguration.localScope()
    .withValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">local.key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localValue</span><span class="delimiter">&quot;</span></span>)
    .withValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">another.key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">anotherValue</span><span class="delimiter">&quot;</span></span>)
    .execute(() -&gt; assertThat(TigerGlobalConfiguration.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">local.key</span><span class="delimiter">&quot;</span></span>))
        .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">localValue</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bear in mind that this does not work with threading: The values are added to the global store and will remain in the store for the duration of the execution of the given runnable. If you execute multiple tests in parallel you should look into the <code>TigerThreadScopedConfigurationSource</code> (which comes with other drawbacks, threading is not an easy problem to solve).</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples">6.6. Examples</h3>
<div class="paragraph">
<p>Some examples to clarify:</p>
</div>
<div class="sect3">
<h4 id="_example_1">6.6.1. Example 1</h4>
<div class="paragraph">
<p>Say you have an environment configured in your testenv.yaml. You want the Tiger Proxy to forward traffic on one route to your backend-server. This will normally be a local server, but on the build-server you want to address another host. You can simply set an environment variable to do the job for you. Below are the relevant snippets:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. tiger.yaml with the Tiger Proxy routing everything to the local server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="key">tigerProxy</span>:
    <span class="key">proxyRoutes</span>:
        - <span class="string"><span class="content">from: /</span></span>
          <span class="key">to</span>: <span class="string"><span class="content">http://127.0.0.1:8080</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the buildserver you can now simply overwrite the "to"-part of this route like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export TIGERPROXY_PROXYROUTES_0_TO = &quot;http://real.server&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_2">6.6.2. Example 2</h4>
<div class="paragraph">
<p>In the above example let&#8217;s say you only want to customize the port. This can be done by using placeholders:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. tiger.yaml with the Tiger Proxy routing everything to the local server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="key">tigerProxy</span>:
    <span class="key">proxyRoutes</span>:
        - <span class="string"><span class="content">from: /</span></span>
          <span class="key">to</span>: <span class="string"><span class="content">http://127.0.0.1:${backend.server.port}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This time we don&#8217;t overwrite the complete to-url but only the port like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export BACKEND_SERVER_PORT = &quot;8080&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_3">6.6.3. Example 3</h4>
<div class="paragraph">
<p>Now we want to assert that the reply coming from the server has the correct backend-url in the XML that is returned to the sender.<br>
To do this we have to reference the configured URL from above, since the value could be different on every execution.<br>
We can solve this using placeholders:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. The testsuite</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Gherkin">    TGR current response with attribute &quot;$.body.ReplyStructure.Header.Sender.url&quot; matches &quot;http://127.0.0.1:${backend.server.port}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The glue-code in Tiger automatically resolves the placeholders.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pre_defined_values">6.7. Pre-Defined values</h3>
<div class="paragraph">
<p>Tiger adds some pre-defined values to make your life easier configuring the environment.<br>
Currently these are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>free.port.0</code> - <code>free.port.255</code>: Free ports that are randomly determined at startup but stay fixed during the execution.<br>
This enables side effect free execution of the testsuite.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_inline_jexl">6.8. Inline JEXL</h3>
<div class="paragraph">
<p>In addition to the <code>${foo.bar}</code> syntax allowing the retrieval of configuration values there exists the <code>!{'foo' != 'bar'}</code> syntax allowing the execution of JEXL expressions.<br>
The JEXL-syntax is described in more depth here: <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" class="bare">https://commons.apache.org/proper/commons-jexl/reference/syntax.html</a></p>
</div>
<div class="paragraph">
<p>To give you more power and flexibility when creating inline-JEXL-expression you can access several namespaces from inside the JEXL expression.<br>
You will find two predefined namespaces and also the ability to add your own, allowing further customization.</p>
</div>
<div class="sect3">
<h4 id="_the_default_namespace">6.8.1. The default namespace</h4>
<div class="paragraph">
<p>The default-namespace of the inline JEXL-expression carries the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file(&lt;filename&gt;)</code> loads the given file and returns it as a UTF-8 parsed string.</p>
</li>
<li>
<p><code>sha256</code> returns the HEX-encoded SHA256-value of the given string.</p>
</li>
<li>
<p><code>sha256Base64</code> returns the Base64-encoded SHA256-value of the given string.</p>
</li>
<li>
<p><code>sha512</code> returns the HEX-encoded SHA512-value of the given string.</p>
</li>
<li>
<p><code>sha512Base64</code> returns the Base64-encoded SHA512-value of the given string.</p>
</li>
<li>
<p><code>md5</code> returns the HEX-encoded MD5-value of the given string.</p>
</li>
<li>
<p><code>md5Base64</code> returns the Base64-encoded MD5-value of the given string.</p>
</li>
<li>
<p><code>base64Encode</code> returns the Base64-Encoding of the given string (non-url safe).</p>
</li>
<li>
<p><code>base64UrlEncode</code> returns the Base64-URL-Encoding of the given string.</p>
</li>
<li>
<p><code>base64Decode</code> decodes the given Base64-String (URL and non-url) and converts it into a UTF-8 string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a function-invocation in the default namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>!{file('src/test/resources/testMessage.json')}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will load the given file and replace any placeholders found in it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_rbel_namespace">6.8.2. The rbel namespace</h4>
<div class="paragraph">
<p>To give you direct access to the messages sent please use the rbel-namespace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>currentResponse</code> returns the current response, optionally filtered by a given Rbel-path</p>
</li>
<li>
<p><code>currentResponseAsString</code> returns the string-representation of the last response, optionally filtered by a given Rbel-path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can be done like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>!{rbel:currentResponseAsString('$.body.html.head.link.href')}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will immediately return the <code>href</code>-attribute of the link in question as a string.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_custom_namespaces">6.8.3. Adding custom namespaces</h4>
<div class="paragraph">
<p>You can easily register additional namespaces by calling <code>TigerJexlExecutor.registerAdditionalNamespace(&lt;namespace-prefix&gt;, &lt;namespace class or object)</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tiger_user_interfaces">7. Tiger User interfaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_admin_ui">7.1. Admin UI</h3>
<div class="paragraph">
<p>The Tiger Admin UI is a separate module that can be downloaded from maven</p>
</div>
<div class="paragraph">
<p><a href="https://repo1.maven.org/maven2/de/gematik/test/tiger-admin" class="bare">https://repo1.maven.org/maven2/de/gematik/test/tiger-admin</a></p>
</div>
<div class="paragraph">
<p>Choose a current version and download the <code>tiger-admin-x.y.z.jar</code> to a local folder on your computer.</p>
</div>
<div class="paragraph">
<p>Run the following command to get the Tiger Admin UI up and running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">java -jar tiger-admin-x.y.z.jar --server.port=8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now open your firefox browser and go to <a href="http://127.0.0.1:8080" class="bare">http://127.0.0.1:8080</a>.</p>
</div>
<div class="paragraph">
<p>Voila you are ready to start working with the Tiger Admin UI</p>
</div>
</div>
<div class="sect2">
<h3 id="_workflow_ui_2">7.2. Workflow UI</h3>
<div class="paragraph">
<p>The Workflow UI is currently an experimental feature implemented as PoC.<br>
We plan to have this feature in product grade quality in the first half of 2022.<br>
Till then there is not much more than in the <a href="#_workflow_ui">Test lib chapter section</a> above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_standalone_tiger_proxy_ui">7.3. Standalone Tiger Proxy UI</h3>
<div class="paragraph">
<p>To watch the recorded messages and to be able to analyze issues at test run time already you can visit the Tiger Proxy web user interface at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http request">http://127.0.0.1:${SERVERPORT}/webui</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>SERVERPORT</code> being the configured server port of the Tiger Proxy.</p>
</div>
<div class="sect3">
<h4 id="_bottom_menu_bar">7.3.1. Bottom menu bar</h4>
<div class="imageblock">
<div class="content">
<img src="media/TigerProxyBottomNavBar.png" alt="TigerProxyBottomNavBar">
</div>
<div class="title">Figure 13. Tiger Proxy bottom menu bar </div>
</div>
<div class="paragraph">
<p>The displayed buttons can trigger the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Routes</strong> … allows you to modify the routes configured on this Tiger Proxy</p>
</li>
<li>
<p><strong>Scroll Lock</strong> … allows you to lock the scroll position. Incoming messages wills till be added to the list at the bottom of the page.</p>
</li>
<li>
<p><strong>Update buttons</strong> allow you to specify how often the list shall be updated. The Update button is only active if you have choosen manual update mode. To the left of the 1s choice there is a small LED that will indicate active retrieval of new data (green) or failure while retrieving data (red).</p>
</li>
<li>
<p><strong>Reset</strong> … allwos you to delete all recorded messages so far. This will delete all messages on the Tiger Proxy!</p>
</li>
<li>
<p><strong>Save</strong> … allows you to save the current HTML page.</p>
</li>
<li>
<p><strong>Quit</strong> … allows you to quit the Tiger Proxy instance</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links_to_test_relevant_topics">8. Links to test relevant topics</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>3-Amigos</p>
<div class="ulist">
<ul>
<li>
<p>presumably first mentioned in <a href="https://blog.gdinwiddie.com/2009/06/17/if-you-dont-automate-acceptance-tests/">George Dinwiddie&#8217;s blog</a> (2009)</p>
</li>
<li>
<p><a href="https://johnfergusonsmart.com/three-amigos-requirements-discovery/">John Ferguson&#8217;s Blog about 3 Amigos</a></p>
</li>
<li>
<p><a href="https://scrumlog.org/2019/03/06/bdd-and-three-amigos/">Becky Carter&#8217;s blog</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Cucumber</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://cucumber.io/">Product web site</a></p>
</li>
<li>
<p><a href="https://www.guru99.com/gherkin-test-cucumber.html">Guru99&#8217;s Intro to Gherkin</a></p>
</li>
<li>
<p><a href="https://cucumber.io/docs/gherkin/reference/">Cucumbers Gherkin reference</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://serenity-bdd.info/">Serenity BDD</a></p>
</li>
<li>
<p>SOLID</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-five-principles-of-object-oriented-design">Explaining all five concepts with simple Geometry</a></p>
</li>
<li>
<p><a href="https://stackify.com/solid-design-principles/">In depth discussion of the 5 principles</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://effectivesoftwaredesign.com/2012/02/05/separation-of-concerns/">Separation of concerns principle</a></p>
</li>
<li>
<p>Screenplay Pattern</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.infoq.com/articles/Beyond-Page-Objects-Test-Automation-Serenity-Screenplay/">Nice overview of what the screenplay pattern is about</a></p>
</li>
<li>
<p><a href="https://dzone.com/articles/page-objects-refactored-solid-steps-to-the-screenp">From Page Objects to SOLID Screenplay</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>FIRST principle for Unit tests</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://agileinaflash.blogspot.com/2009/02/first.html">AgileOtters Blog</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faqs">9. FAQs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_docker_container_creation_fails">9.1. docker container creation fails</h3>
<div class="paragraph">
<p>Use the command below to remove all unused containers. Or look for containers starting with "tiger", stop and remove them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>docker system prune</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last resort:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>netcfg -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>and restart docker</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-06-02 11:17:56 +0200
</div>
</div>
</body>
</html>